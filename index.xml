<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>ä¸€æ¯å“ˆå¸Œä¸åŠ ç›</title><link>https://pinkhello.github.io/</link><description>Recent content on ä¸€æ¯å“ˆå¸Œä¸åŠ ç›</description><generator>Hugo -- gohugo.io</generator><language>zh</language><copyright>ä¸€æ¯å“ˆå¸Œä¸åŠ ç›, All Rights Reserved</copyright><lastBuildDate>Mon, 15 Feb 2021 10:16:34 +0800</lastBuildDate><atom:link href="https://pinkhello.github.io/index.xml" rel="self" type="application/rss+xml"/><item><title>18 å›æœ›K8S ç™½è¯å®¹å™¨</title><link>https://pinkhello.github.io/posts/18-%E5%9B%9E%E6%9C%9Bk8s-%E7%99%BD%E8%AF%9D%E5%AE%B9%E5%99%A8/</link><pubDate>Mon, 15 Feb 2021 10:16:34 +0800</pubDate><guid>https://pinkhello.github.io/posts/18-%E5%9B%9E%E6%9C%9Bk8s-%E7%99%BD%E8%AF%9D%E5%AE%B9%E5%99%A8/</guid><description>ä¸€æ¯å“ˆå¸Œä¸åŠ ç› https://pinkhello.github.io/posts/18-%E5%9B%9E%E6%9C%9Bk8s-%E7%99%BD%E8%AF%9D%E5%AE%B9%E5%99%A8/ -&lt;h1 id="è¿›ç¨‹å¼€å¯">è¿›ç¨‹å¼€å¯&lt;/h1>
&lt;p>å®¹å™¨, åˆ°åº•æ˜¯ä»€ä¹ˆ?&lt;/p>
&lt;blockquote>
&lt;p>å‰é¢æå‡º: å®¹å™¨æ˜¯ä¸€ç§æ²™ç›’æŠ€æœ¯. å°±æ˜¯ä¸€ä¸ªé›†è£…ç®±, æŠŠåº”ç”¨è£…èµ·æ¥çš„æŠ€æœ¯. è¿™æ ·, åº”ç”¨ä¸åº”ç”¨ä¹‹é—´æœ‰äº†è¾¹ç•Œä¸è‡³äºäº’ç›¸å¹²æ‰°; æœ‰äº†è¿™äº›é›†è£…ç®±, ä¹Ÿæ–¹ä¾¿æ¬æ¥æ¬å».&lt;/p>
&lt;/blockquote>
&lt;p>ç å†œéƒ½çŸ¥é“å¯æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶æ˜¯ä»£ç çš„å¯æ‰§è¡Œé•œåƒ(executable image). ä¸€æ—¦ç¨‹åºæ‰§è¡Œèµ·æ¥, å†…å­˜æ•°æ®ã€å¯„å­˜å™¨çš„å€¼ã€å †æ ˆçš„æŒ‡ä»¤ã€æ‰“å¼€çš„æ–‡ä»¶ç­‰è¿™äº›é›†åˆæ±‡é›†æˆä¸€ä¸ªç¨‹åºçš„è®¡ç®—æœºæ‰§è¡Œç¯å¢ƒæ€»å’Œ: è¿›ç¨‹.&lt;/p>
&lt;p>&lt;code>è¿›ç¨‹&lt;/code>: é™æ€è¡¨ç°æ˜¯ç¨‹åº, åŠ¨æ€è¡¨ç°è®¡ç®—æœºçš„æ•°æ®å’ŒçŠ¶æ€çš„æ€»å’Œã€‚&lt;/p>
&lt;p>å®¹å™¨çš„æ ¸å¿ƒåŠŸèƒ½, å°±æ˜¯é€šè¿‡çº¦æŸå’Œä¿®æ”¹è¿›ç¨‹çš„åŠ¨æ€è¡¨ç°, ä»è€Œä¸ºå…¶åˆ›é€ ä¸€ä¸ª&amp;quot;è¾¹ç•Œ&amp;quot;.&lt;/p>
&lt;ul>
&lt;li>&lt;code>Cgroups æŠ€æœ¯&lt;/code> åˆ¶é€ çº¦æŸçš„ä¸»è¦æ‰‹æ®µ&lt;/li>
&lt;li>&lt;code>Namespace æŠ€æœ¯&lt;/code> ä¿®æ”¹è¿›ç¨‹è§†å›¾çš„ä¸»è¦æ–¹æ³•&lt;/li>
&lt;/ul>
&lt;p>&lt;code>docker run&lt;/code> , &lt;code>-it&lt;/code> å‘Šè¯‰ &lt;code>Docker&lt;/code> å¯åŠ¨å®¹å™¨å, éœ€è¦åˆ†é…ä¸€ä¸ªæ–‡æœ¬è¾“å…¥/è¾“å‡ºç¯å¢ƒ, ä¹Ÿå°±æ˜¯ &lt;code>TTY&lt;/code>, è·Ÿå®¹å™¨çš„æ ‡å‡†è¾“å…¥ç›¸å…³è”, è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å’Œè¿™ä¸ª&lt;code>Docker&lt;/code>å®¹å™¨è¿›è¡Œäº¤äº’äº†ã€‚è€Œ &lt;code>/bin/sh&lt;/code> å°±æ˜¯æˆ‘ä»¬åœ¨ &lt;code>Docker&lt;/code> å®¹å™¨é‡Œè¿è¡Œçš„ç¨‹åº.&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&amp;gt; docker run -it busybox /bin/sh
/ &lt;span style="color:#228b22">#&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¸®æˆ‘å¯åŠ¨ä¸€ä¸ªå®¹å™¨, åœ¨å®¹å™¨é‡Œæ‰§è¡Œ &lt;code>/bin/sh&lt;/code>, å¹¶ä¸”ç»™æˆ‘åˆ†é…ä¸€ä¸ªå‘½ä»¤è¡Œç»ˆç«¯è·Ÿè¿™ä¸ªå®¹å™¨è¿›è¡Œäº¤äº’, åœ¨è¿™ä¸ªæ‰§è¡Œç¯å¢ƒä¸‹å¯ä»¥å®Œå…¨æ‰§è¡Œ&lt;code>LINUX&lt;/code>å‘½ä»¤,ä¸”ä¸å®¿ä¸»æœºå®Œå…¨éš”ç¦»åœ¨ä¸åŒçš„ä¸–ç•Œä¸­.&lt;/p>
&lt;p>&lt;code>Docker&lt;/code>å¯¹è¢«éš”ç¦»åº”ç”¨çš„è¿›ç¨‹ç©ºé—´åšäº†æ‰‹è„š, ä½¿å¾—è¿™äº›è¿›ç¨‹åªèƒ½çœ‹åˆ°é‡æ–°è®¡ç®—çš„è¿›ç¨‹ç¼–å·, å¯æ˜¯å®é™…ä¸Š, ä»–ä»¬åœ¨å®¿ä¸»æœºçš„æ“ä½œç³»ç»Ÿé‡Œ, è¿˜æ˜¯åŸæ¥çš„ç¬¬&lt;code>N&lt;/code>å·è¿›ç¨‹. è¿™ç§æŠ€æœ¯å°±æ˜¯&lt;code>Linux&lt;/code>å†…éƒ¨çš„&lt;code>Namespace&lt;/code>æœºåˆ¶ã€‚&lt;/p>
&lt;p>&lt;code>Namespace&lt;/code> çš„ä½¿ç”¨æ–¹å¼ä¹Ÿéå¸¸æœ‰æ„æ€ï¼šå®ƒå…¶å®åªæ˜¯ &lt;code>Linux&lt;/code> åˆ›å»ºæ–°è¿›ç¨‹çš„ä¸€ä¸ªå¯é€‰å‚æ•°ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ &lt;code>Linux&lt;/code> ç³»ç»Ÿä¸­åˆ›å»ºçº¿ç¨‹çš„ç³»ç»Ÿè°ƒç”¨æ˜¯ &lt;code>clone()&lt;/code>ï¼Œæ¯”å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">int &lt;span style="color:#00688b">pid&lt;/span> = clone(main_function, stack_size, SIGCHLD, NULL);
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªç³»ç»Ÿè°ƒç”¨å°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œå¹¶ä¸”è¿”å›çš„å®ƒçš„è¿›ç¨‹å· pidã€‚&lt;/p>
&lt;p>å½“è°ƒç”¨ clone() ç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹æ—¶ï¼Œå°±å¯ä»¥åœ¨å‚æ•°ä¸­æŒ‡å®š CLONE_NEWPID å‚æ•°ï¼Œæ¯”å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">int &lt;span style="color:#00688b">pid&lt;/span> = clone(main_function, stack_size, CLONE_NEWPID | SIGCHLD, NULL);
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ—¶ï¼Œæ–°åˆ›å»ºçš„è¿™ä¸ªè¿›ç¨‹å°±ä¼šçœ‹åˆ°ä¸€ä¸ªå…¨æ–°çš„è¿›ç¨‹ç©ºé—´ï¼Œåœ¨è¿™ä¸ªè¿›ç¨‹ç©ºé—´é‡Œï¼Œä»–çš„&lt;code>PID&lt;/code>æ˜¯&lt;code>1&lt;/code>ï¼Œä¹‹æ‰€ä»¥è¯´çœ‹åˆ°ï¼Œæ˜¯å› ä¸ºæ˜¯ä¸€ä¸ªéšœçœ¼æ³•ï¼Œåœ¨å®¿ä¸»æœºçœŸå®çš„è¿›ç¨‹ç©ºé—´é‡Œï¼Œè¿™ä¸ª&lt;code>PID&lt;/code>è¿˜æ˜¯çœŸå®çš„æ•°å€¼.å½“å¤šæ¬¡æ‰§è¡Œ&lt;code>clone()&lt;/code>è°ƒç”¨, ä¼šåˆ›å»ºå¤šä¸ª &lt;code>PID Namespace&lt;/code>, æ¯ä¸ª Namespace é‡Œçš„åº”ç”¨è¿›ç¨‹ï¼Œéƒ½ä¼šè®¤ä¸ºè‡ªå·±æ˜¯å½“å‰å®¹å™¨é‡Œçš„ç¬¬&lt;code>1&lt;/code>å·è¿›ç¨‹ï¼Œçœ‹ä¸ä»…&lt;code>å®¿ä¸»æœº&lt;/code>çš„ä¹Ÿçœ‹ä¸åˆ°å…¶ä»–çš„&lt;code>Namespace&lt;/code>.&lt;/p>
&lt;blockquote>
&lt;p>å¤‡æ³¨:
Linuxæä¾›äº†ä¸åŒçš„Namespaceï¼Œå»åº”å¯¹ä¸åŒçš„è¿›ç¨‹ä¸Šä¸‹æ–‡&lt;/p>
&lt;ul>
&lt;li>PID Namespace&lt;/li>
&lt;li>Mount Namespace&lt;/li>
&lt;li>IPC Namespace&lt;/li>
&lt;li>UTS Namespace&lt;/li>
&lt;li>Network Namespace&lt;/li>
&lt;li>User Namespace&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>Dockerå®¹å™¨ï¼Œå°±æ˜¯åœ¨åˆ›å»ºå®¹å™¨è¿›ç¨‹æ—¶å€™ï¼ŒæŒ‡å®šäº†è¿™ä¸ªè¿›ç¨‹æ‰€éœ€è¦å¯ç”¨çš„ä¸€ç»„ Namespace å‚æ•°, è¿™æ ·, å®¹å™¨å°±åªèƒ½ çœ‹åˆ° å½“å‰ Namespace æ‰€é™å®šçš„ èµ„æºã€æ–‡ä»¶ã€è®¾å¤‡ã€çŠ¶æ€ æˆ–è€… é…ç½®ã€‚æ‰€ä»¥è¯´, å®¹å™¨ï¼Œå…¶å®æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿›ç¨‹ã€‚&lt;/p>
&lt;p>&lt;img src="https://pinkhello.github.io/%E5%9B%9E%E6%9C%9BK8S/%E5%AE%B9%E5%99%A8%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.jpg" alt="å®¹å™¨ä¸è™šæ‹Ÿæœºå·¥ä½œåŸç†">&lt;/p>
&lt;p>å¯ä»¥çœ‹å‡ºå›¾ä¸­ &lt;code>Hypervisor&lt;/code> æ˜¯è™šæ‹Ÿæœºä¸»è¦éƒ¨åˆ†ã€‚å®ƒé€šè¿‡ç¡¬ä»¶è™šæ‹ŸåŒ–åŠŸèƒ½ï¼Œæ¨¡æ‹Ÿå‡ºäº†è¿è¡Œä¸€ä¸ªæ“ä½œç³»ç»Ÿéœ€è¦çš„å„ç§ç¡¬ä»¶ï¼Œæ¯”å¦‚ CPUã€å†…å­˜ã€I/Oè®¾å¤‡ç­‰ã€‚ è¿™æ ·ï¼Œç”¨æˆ·çš„è¿›ç¨‹å¯ä»¥åœ¨è¿™ä¸ªè™šæ‹Ÿçš„æœºå™¨ä¸­ï¼Œåªèƒ½çœ‹åˆ°è™šæ‹Ÿç¯å¢ƒçš„æ–‡ä»¶å’Œç›®å½•ä»¥åŠè®¾å¤‡ï¼Œèµ·åˆ°éš”ç¦»çš„ä½œç”¨ã€‚
è€Œå³è¾¹çš„å›¾ï¼Œ&lt;code>Docker Engine&lt;/code>æ›¿æ¢äº†&lt;code>Hypervisor&lt;/code>,ä½†æ˜¯æœ‰ä¸ªæ ¸å¿ƒä¸€ç‚¹&lt;code>Docker Engine&lt;/code>å¹¶ä¸å°‘&lt;code>è½»é‡çº§&lt;/code>è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚&lt;/p>
&lt;p>åœ¨&lt;code>Linux&lt;/code>çš„&lt;code>Namespace&lt;/code>å·¥ä½œæ–¹å¼å, åœ¨ä½¿ç”¨&lt;code>Docker&lt;/code>çš„æ—¶å€™,&lt;code>Docker&lt;/code>å¹¶æ²¡æœ‰ä¸€ä¸ªçœŸæ­£çš„&lt;code>Dockerå®¹å™¨&lt;/code>è¿è¡Œåœ¨å®¿ä¸»æœºé‡Œé¢ï¼Œè€Œæ˜¯&lt;code>Docker&lt;/code>å¯åŠ¨è¿˜æ˜¯åŸæ¥çš„åº”ç”¨è¿›ç¨‹ï¼Œåªä¸è¿‡åœ¨åˆ›å»ºè¿™äº›è¿›ç¨‹æ—¶å€™ï¼ŒåŠ ä¸Šäº†å„ç§&lt;code>Namespace&lt;/code>å‚æ•°ï¼Œä½¿å¾—è¿™äº›è¿›ç¨‹è§‰å¾—è‡ªå·±æ˜¯åœ¨å„è‡ªçš„&lt;code>PID Namespace&lt;/code>æ˜¯ç¬¬ä¸€å·è¿›ç¨‹ï¼Œå¹¶ä¸”åªèƒ½çœ‹åˆ°å„è‡ª&lt;code>Mount Namespace&lt;/code>é‡ŒæŒ‚åœ¨çš„ç›®å½•å’Œæ–‡ä»¶ã€åªèƒ½è®¿é—®å„è‡ª&lt;code>Network Namespace&lt;/code>é‡Œçš„ç½‘ç»œè®¾å¤‡.&lt;/p>
&lt;h1 id="éš”ç¦»å’Œé™åˆ¶">éš”ç¦»å’Œé™åˆ¶&lt;/h1>
&lt;p>å‰é¢æåˆ°å®ç° &lt;code>éš”ç¦»&lt;/code> çš„æ‰‹æ®µ: Namespace. Namespace æŠ€æœ¯å®é™…ä¿®æ”¹äº†åº”ç”¨è¿›ç¨‹çœ‹å¾…æ•´ä¸ªè®¡ç®—æœºçš„&amp;quot;è§†å›¾&amp;quot;ï¼Œå³å®ƒçš„&amp;quot;è§†çº¿&amp;quot;è¢«æ“ä½œç³»ç»Ÿåšäº†é™åˆ¶ï¼Œåªèƒ½&amp;quot;çœ‹åˆ°&amp;quot;æŸäº›çŸ¥é“çš„å†…å®¹.&lt;/p>
&lt;p>ä¸ºä»€ä¹ˆéœ€è¦&lt;code>éš”ç¦»&lt;/code>&lt;/p>
&lt;ul>
&lt;li>é¦–å…ˆï¼Œæ—¢ç„¶å®¹å™¨åªæ˜¯è¿è¡Œåœ¨å®¿ä¸»æœºä¸Šçš„ä¸€ç§ç‰¹æ®Šçš„è¿›ç¨‹ï¼Œé‚£ä¹ˆå¤šä¸ªå®¹å™¨ä¹‹é—´ä½¿ç”¨çš„å°±è¿˜æ˜¯åŒä¸€ä¸ªå®¿ä¸»æœºçš„æ“ä½œç³»ç»Ÿå†…æ ¸ã€‚&lt;/li>
&lt;li>åœ¨Linuxå†…æ ¸ä¸­ï¼Œè¿˜æœ‰è®¸å¤šèµ„æºå’Œå¯¹è±¡æ˜¯ä¸èƒ½è¢« Namespace åŒ–çš„ï¼Œæœ€å…¸å‹çš„ä¾‹å­æ˜¯ï¼šæ—¶é—´
&lt;blockquote>
&lt;p>å®¹å™¨ä¸­ä½¿ç”¨ settimeofday(2) ç³»ç»Ÿè°ƒç”¨ä¿®æ”¹äº†æ—¶é—´ï¼Œæ•´ä¸ªå®¿ä¸»æœºçš„æ—¶é—´éƒ½ä¼šè¢«éšä¹‹ä¿®æ”¹ã€‚è¿™æ ·è‚¯å®šä¸é¢„æœŸä¸ç¬¦&lt;/p>
&lt;/blockquote>
&lt;/li>
&lt;/ul>
&lt;p>ä¸Šè¿°æ˜¯ä¸ºä»€ä¹ˆè¦&lt;code>éš”ç¦»&lt;/code>ï¼Œä¸‹é¢è¯´ä¸ºä»€ä¹ˆè¦&lt;code>é™åˆ¶&lt;/code>è¿™ä¸ªé—®é¢˜ã€‚&lt;/p>
&lt;blockquote>
&lt;p>åœ¨å®¿ä¸»æœºä¸Š,å¯åŠ¨å¤šä¸ªå®¹å™¨éƒ½æ˜¯åœ¨å®¿ä¸»æœºä¸Šçš„ç‰¹æ®Šè¿›ç¨‹,ä½†æ˜¯åœ¨ä¸åŒçš„è¿›ç¨‹ä¹‹é—´, èµ„æºï¼ˆCPUã€å†…å­˜ï¼‰è¿˜æ˜¯å¯èƒ½è¢«å…¶ä»–è¿›ç¨‹ï¼ˆæˆ–è€…å®¹å™¨ï¼‰å ç”¨çš„ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>&lt;code>Linux Cgroups&lt;/code>å…¨ç§°&lt;code>Linux Control Group&lt;/code> å°±æ˜¯ Linux å†…æ ¸ä¸­ç”¨æ¥ä¸ºè¿›ç¨‹è®¾ç½®èµ„æºé™åˆ¶çš„ä¸€ä¸ªé‡è¦åŠŸèƒ½, é™åˆ¶ä¸€ä¸ªè¿›ç¨‹ç»„èƒ½å¤Ÿä½¿ç”¨çš„èµ„æºä¸Šé™, åŒ…æ‹¬ CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œå¸¦å®½ ç­‰ç­‰ã€‚æ­¤å¤– Cgroups è¿˜èƒ½å¤Ÿå¯¹è¿›ç¨‹è¿›è¡Œä¼˜å…ˆçº§è®¾ç½®ã€å®¡è®¡ï¼Œä»¥åŠå°†è¿›ç¨‹æŒ‚èµ·å’Œæ¢å¤æ“ä½œã€‚&lt;/p>
&lt;p>åœ¨&lt;code>Linux&lt;/code>ä¸­,&lt;code>Cgroups&lt;/code>ç»™ç”¨æˆ·æš´éœ²å‡ºæ¥çš„æ“ä½œæ¥å£æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼Œå³å®ƒä»¥æ–‡ä»¶å’Œç›®å½•çš„æ–¹å¼ç»„ç»‡åœ¨æ“ä½œç³»ç»Ÿçš„ &lt;code>/sys/fs/cgroup&lt;/code> è·¯å¾„ä¸‹&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&lt;span style="color:#228b22"># Ubuntu ä¸‹ mount æŒ‡ä»¤å±•ç¤ºå‡ºæ¥&lt;/span>
&amp;gt; mount -t cgroup
cpuset on /sys/fs/cgroup/cpuset &lt;span style="color:#658b00">type&lt;/span> cgroup (rw,nosuid,nodev,noexec,relatime,cpuset)
cpu on /sys/fs/cgroup/cpu &lt;span style="color:#658b00">type&lt;/span> cgroup (rw,nosuid,nodev,noexec,relatime,cpu)
cpuacct on /sys/fs/cgroup/cpuacct &lt;span style="color:#658b00">type&lt;/span> cgroup (rw,nosuid,nodev,noexec,relatime,cpuacct)
blkio on /sys/fs/cgroup/blkio &lt;span style="color:#658b00">type&lt;/span> cgroup (rw,nosuid,nodev,noexec,relatime,blkio)
memory on /sys/fs/cgroup/memory &lt;span style="color:#658b00">type&lt;/span> cgroup (rw,nosuid,nodev,noexec,relatime,memory)
...
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°åœ¨ &lt;code>/sys/fs/cgroup&lt;/code> ä¸‹é¢åˆå¾ˆå¤šè¯¸å¦‚&lt;code>cpuset&lt;/code>ã€&lt;code>cpu&lt;/code>ã€&lt;code>memory&lt;/code>è¿™æ ·çš„å­ç›®,ä¹Ÿå«å­ç³»ç»Ÿ.è¿™äº›éƒ½æ˜¯å¯ä»¥è¢«&lt;code>Cgroups&lt;/code>è¿›è¡Œé™åˆ¶çš„èµ„æºç§ç±»,è€Œåœ¨å­ç³»ç»Ÿå¯¹åº”çš„èµ„æºç§ç±»ä¸‹, ä½ å°±å¯ä»¥çœ‹åˆ°è¯¥ç±»èµ„æºå…·ä½“å¯ä»¥è¢«é™åˆ¶çš„æ–¹æ³•ã€‚æ¯”å¦‚, å¯¹&lt;code>CPU&lt;/code>å­ç³»ç»Ÿæ¥è¯´ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°å‡ ä¸ªé…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªæŒ‡ä»¤æ˜¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&amp;gt; ls /sys/fs/cgroup/cpu
cgroup.clone_children cpu.cfs_period_us cpu.rt_period_us cpu.shares notify_on_release
cgroup.procs cpu.cfs_quota_us cpu.rt_runtime_us cpu.stat tasks
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¾“å‡ºä¸­&lt;code>cfs_period&lt;/code>å’Œ&lt;code>cfs_quota&lt;/code>è¿™æ ·çš„å…³é”®è¯ã€‚ç»„åˆä½¿ç”¨,é™åˆ¶è¿›ç¨‹åœ¨é•¿åº¦ä¸º&lt;code>cfs_period&lt;/code>çš„ä¸€æ®µæ—¶é—´å†…,åªèƒ½è¢«åˆ†é…åˆ°æ€»é‡ä¸º&lt;code>cfs_quota&lt;/code>çš„&lt;code>CPU&lt;/code>æ—¶é—´&lt;/p>
&lt;p>å¦‚ä½•ä½¿ç”¨cgroupså‘¢ï¼Ÿ&lt;/p>
&lt;p>åœ¨å¯¹åº”çš„å­ç³»ç»Ÿçš„ä¸‹é¢åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œæ¯”å¦‚é™åˆ¶CPUè¿›å…¥ /sys/fs/cgroups/cpu ç›®å½•ä¸‹&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&amp;gt; &lt;span style="color:#658b00">cd&lt;/span> /sys/fs/cgroups/cpu
&amp;gt; mkdir container
&amp;gt; ls container/
cgroup.clone_children cpu.cfs_period_us cpu.rt_period_us cpu.shares notify_on_releasecgroup.procs cpu.cfs_quota_us cpu.rt_runtime_us cpu.stat tasks
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªç›®å½•å°±ç§°ä¸ºä¸€ä¸ªæ§åˆ¶ç»„ï¼Œæ“ä½œç³»ç»Ÿè‡ªåŠ¨åœ¨æ–°åˆ›å»ºçš„ container ç›®å½•ä¸‹ï¼Œè‡ªåŠ¨ç”Ÿæˆè¯¥å­ç³»ç»Ÿçš„å¯¹åº”çš„èµ„æºé™åˆ¶æ–‡ä»¶.&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&lt;span style="color:#228b22"># æŸ¥çœ‹ container æ§åˆ¶ç»„çš„ CPU quota è¿˜æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼š-1ï¼ŒCPU period åˆ™æ˜¯é»˜è®¤çš„ 100 ms (100000 us)&lt;/span>
&amp;gt; cat /sys/fs/cgroup/cpu/container/cpu.cfs_quota_us
-1
&amp;gt; cat /sys/fs/cgroup/cpu/container/cpu.cfs_period_us
&lt;span style="color:#b452cd">100000&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å‘ container ç»„é‡Œçš„ cfs_quota æ–‡ä»¶å†™å…¥ 20 msï¼ˆ20000 usï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&lt;span style="color:#228b22">#æ„å‘³ç€åœ¨æ¯ 100 ms çš„æ—¶é—´é‡Œï¼Œè¢«è¯¥æ§åˆ¶ç»„é™åˆ¶çš„è¿›ç¨‹åªèƒ½ä½¿ç”¨ 20 ms çš„ CPU æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¿›ç¨‹åªèƒ½ä½¿ç”¨åˆ° 20% çš„ CPU å¸¦å®½ã€‚&lt;/span>
&amp;gt; &lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#b452cd">20000&lt;/span> &amp;gt; /sys/fs/cgroup/cpu/container/cpu.cfs_quota_us
&lt;span style="color:#228b22"># ç°åœ¨æŠŠéœ€è¦è¢«é™åˆ¶çš„è¿›ç¨‹çš„ PID å†™å…¥ container ç»„é‡Œçš„ tasks æ–‡ä»¶ï¼Œä¸Šé¢çš„è®¾ç½®å°±ä¼šå¯¹è¯¥è¿›ç¨‹ç”Ÿæ•ˆäº†&lt;/span>
&amp;gt; &lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#cd5555">${&lt;/span>&lt;span style="color:#00688b">éœ€è¦é™åˆ¶çš„è¿›ç¨‹PID&lt;/span>&lt;span style="color:#cd5555">}&lt;/span> &amp;gt; /sys/fs/cgroup/cpu/container/tasks
&lt;span style="color:#228b22"># top æŒ‡ä»¤æŸ¥çœ‹, è®¡ç®—æœºCPUä½¿ç”¨ç‡ç«‹åˆ»é™ä½åˆ°20%&lt;/span>
&amp;gt; top
%Cpu0 : 20.3 us, 0.0 sy, 0.0 ni, 79.7 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 st
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·, &lt;code>Cgroups&lt;/code> çš„æ¯ä¸€ä¸ªå­ç³»ç»Ÿéƒ½æœ‰å…¶ç‹¬æœ‰çš„èµ„æºé™åˆ¶èƒ½åŠ›&lt;/p>
&lt;ul>
&lt;li>&lt;code>cpu&lt;/code>, ä¸ºè¿›ç¨‹è®¾å®š&lt;code>cpu&lt;/code>ä½¿ç”¨çš„é™åˆ¶;&lt;/li>
&lt;li>&lt;code>blkio&lt;/code>, ä¸ºå—è®¾å¤‡è®¾å®š I/O é™åˆ¶, ä¸€èˆ¬ç”¨æˆ·ç£ç›˜ç­‰è®¾å¤‡;&lt;/li>
&lt;li>&lt;code>cpuset&lt;/code>, ä¸ºè¿›ç¨‹åˆ†é…å•ç‹¬çš„ CPUæ ¸å’Œå¯¹åº”çš„å†…å­˜èŠ‚ç‚¹;&lt;/li>
&lt;li>&lt;code>memory&lt;/code>, ä¸ºè¿›ç¨‹è®¾å®šå†…å­˜ä½¿ç”¨çš„é™åˆ¶&lt;/li>
&lt;/ul>
&lt;p>&lt;code>Linux Cgroups&lt;/code>çš„è®¾è®¡ï¼Œå®ƒå°±æ˜¯&lt;code>ä¸€ä¸ªå­ç³»ç»Ÿçš„ç›®å½•åŠ ä¸Šä¸€ç»„èµ„æºé™åˆ¶æ–‡ä»¶çš„ç»„åˆ&lt;/code>ã€‚è€Œå¯¹äº&lt;code>Docker&lt;/code>ç­‰&lt;code>Linux&lt;/code>å®¹å™¨é¡¹ç›®æ¥è¯´ï¼Œå®ƒä»¬åªéœ€è¦åœ¨æ¯ä¸ªå­ç³»ç»Ÿä¸‹é¢ï¼Œä¸ºæ¯ä¸ªå®¹å™¨åˆ›å»ºä¸€ä¸ªæ§åˆ¶ç»„(å³åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•), ç„¶ååœ¨å¯åŠ¨è¿›ç¨‹ä¹‹åï¼ŒæŠŠè¿™ä¸ªè¿›ç¨‹çš„&lt;code>PID&lt;/code>å†™åˆ°å¯¹åº”çš„æ§åˆ¶ç»„çš„&lt;code>tasks&lt;/code>æ–‡ä»¶ä¸­.&lt;/p>
&lt;p>é‚£ä¹ˆåœ¨Dockerå®¹å™¨ä¸­ï¼Œå¦‚ä½•å¯åŠ¨çš„æ—¶å€™çŸ¥é“æ§åˆ¶ç»„ä¸‹é¢çš„èµ„æºå¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿ&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&lt;span style="color:#228b22"># docker run æ—¶çš„å‚æ•°æŒ‡å®š&lt;/span>
&amp;gt; docker run -it --cpu-period=&lt;span style="color:#b452cd">100000&lt;/span> --cpu-quota=&lt;span style="color:#b452cd">20000&lt;/span> ubuntu /bin/bash
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨å¯åŠ¨è¿™ä¸ªå®¹å™¨åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ &lt;code>Cgroups&lt;/code> æ–‡ä»¶ç³»ç»Ÿä¸‹ï¼Œ&lt;code>CPU&lt;/code>å­ç³»ç»Ÿä¸­, &lt;code>docker&lt;/code>è¿™ä¸ªæ§åˆ¶ç»„é‡Œçš„èµ„æºé™åˆ¶æ–‡ä»¶å†…å®¹æ¥ç¡®è®¤ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&amp;gt; cat /sys/fs/cgroup/cpu/docker/5d5c9f67d/cpu.cfs_period_us
&lt;span style="color:#b452cd">100000&lt;/span>
&amp;gt; cat /sys/fs/cgroup/cpu/docker/5d5c9f67d/cpu.cfs_quota_us
&lt;span style="color:#b452cd">20000&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™å°±æ„å‘³ç€è¿™ä¸ª&lt;code>Docker&lt;/code>å®¹å™¨,åªèƒ½ä½¿ç”¨åˆ° &lt;code>20%&lt;/code> çš„&lt;code>CPUå¸¦å®½&lt;/code>&lt;/p>
&lt;p>æ ¸å¿ƒæ¦‚å¿µï¼š&lt;/p>
&lt;blockquote>
&lt;p>å®¹å™¨å°±æ˜¯ä¸€ä¸ª&lt;code>å•è¿›ç¨‹&lt;/code>æ¨¡å‹. ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„&lt;code>Docker&lt;/code>å®¹å™¨,å…¶å®å°±æ˜¯å¯ç”¨äº†å¤šä¸ª&lt;code>Linux Namespace&lt;/code>çš„åº”ç”¨è¿›ç¨‹,è€Œè¿™ä¸ªè¿›ç¨‹èƒ½å¤Ÿä½¿ç”¨çš„èµ„æºé‡,åˆ™å—&lt;code>Cgroups&lt;/code>é…ç½®çš„é™åˆ¶&lt;/p>
&lt;/blockquote>
&lt;p>ä¸€ä¸ªå®¹å™¨çš„æœ¬è´¨æ˜¯ä¸€ä¸ªè¿›ç¨‹, ç”¨æˆ·çš„åº”ç”¨è¿›ç¨‹å®é™…ä¸Šå°±æ˜¯å®¹å™¨çš„&lt;code>PID=1&lt;/code>çš„è¿›ç¨‹, ä¹Ÿæ˜¯å…¶ä»–åç»­åˆ›å»ºæ‰€æœ‰è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ã€‚è¿™å°±æ„å‘³ç€ï¼Œåœ¨ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œä½ æ²¡æœ‰åŠæ³•åŒæ—¶è¿è¡Œä¸¤ä¸ªä¸åŒçš„åº”ç”¨ï¼Œé™¤éä½ èƒ½äº‹å…ˆæ‰¾åˆ°å…¬å…±çš„&lt;code>PID=1&lt;/code>çš„ç¨‹åºå……å½“ä¸¤ä¸ªä¸åŒåº”ç”¨çš„çˆ¶è¿›ç¨‹ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¾ˆå¤šä¼šä½¿ç”¨&lt;code>systemd&lt;/code>æˆ–è€…&lt;code>supervisord&lt;/code>ä»£ç†åº”ç”¨æœ¬èº«ä½œä¸ºå®¹å™¨çš„å¯åŠ¨è¿›ç¨‹ã€‚&lt;/p>
&lt;h1 id="å®¹å™¨é•œåƒ">å®¹å™¨é•œåƒ&lt;/h1>
&lt;h1 id="dockerå®¹å™¨">&lt;code>Docker&lt;/code>å®¹å™¨&lt;/h1>
&lt;h1 id="kubernetes-æœ¬è´¨">&lt;code>Kubernetes&lt;/code> æœ¬è´¨&lt;/h1>
- https://pinkhello.github.io/posts/18-%E5%9B%9E%E6%9C%9Bk8s-%E7%99%BD%E8%AF%9D%E5%AE%B9%E5%99%A8/ - ä¸€æ¯å“ˆå¸Œä¸åŠ ç›, All Rights Reserved</description></item><item><title>17 å›æœ›K8S å°é²¸é±¼å®¹å™¨æŠ€æœ¯</title><link>https://pinkhello.github.io/posts/17-%E5%9B%9E%E6%9C%9Bk8s-%E5%B0%8F%E9%B2%B8%E9%B1%BC%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF/</link><pubDate>Thu, 11 Feb 2021 10:50:42 +0800</pubDate><guid>https://pinkhello.github.io/posts/17-%E5%9B%9E%E6%9C%9Bk8s-%E5%B0%8F%E9%B2%B8%E9%B1%BC%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF/</guid><description>ä¸€æ¯å“ˆå¸Œä¸åŠ ç› https://pinkhello.github.io/posts/17-%E5%9B%9E%E6%9C%9Bk8s-%E5%B0%8F%E9%B2%B8%E9%B1%BC%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF/ -&lt;h1 id="ä»€ä¹ˆæ˜¯å®¹å™¨">ä»€ä¹ˆæ˜¯å®¹å™¨&lt;/h1>
&lt;p>åœ¨å®¹å™¨ä¹‹å‰, ç«çˆ†äº‘è®¡ç®—å¸‚åœºçš„æ˜¯ &lt;code>PAAS&lt;/code>, &lt;code>PAAS&lt;/code>å·²ç»æ·±å…¥äººå¿ƒ. é‚£æ—¶å€™çªç„¶æœ‰ä¸€å®¶å…¬å¸ dotCloud å‰‘èµ°åé”‹, ç›´æ¥å¼€æºå‡ºäº† &lt;code>Docker&lt;/code> é¡¹ç›®ï¼Œå¹¶ä¸”ç›´æ¥é¢å‘çš„ç¤¾åŒºã€‚ è¿™æ ·çš„åšæ³•ç›´æ¥å°†å½“æ—¶çš„&lt;code>PAAS&lt;/code>æµä¸»è¦å…¬å¸æ‰“çš„å±æ»šå°¿æµã€‚&lt;/p>
&lt;p>å›å¤´çœ‹, &lt;code>PAAS&lt;/code> æœ€æ ¸å¿ƒçš„æ˜¯éš”ç¦»ç¯å¢ƒ,æˆ–è€…å« &lt;code>æ²™ç›’&lt;/code>,åœ¨æˆ‘çœ‹æ¥ä¹Ÿå°±æ˜¯ &lt;code>å®¹å™¨&lt;/code>. è€Œ &lt;code>Docker&lt;/code> é¡¹ç›®å’Œ &lt;code>Cloud Foundry&lt;/code> çš„å®¹å™¨æ²¡æœ‰å¤ªå¤§çš„ä¸åŒ,ä½†æ˜¯å®ƒä¸ºä»€ä¹ˆèƒ½é’ˆå¯¹ &lt;code>PAAS&lt;/code>è¿›è¡Œäº†ä¸€åœºå¿«é€Ÿçš„é—ªç”µæˆ˜å‘¢ï¼Ÿ&lt;/p>
&lt;blockquote>
&lt;p>å¯¹çš„, å°±æ˜¯ &lt;code>Docker&lt;/code> é•œåƒ, è¿™ä¸ªå°å°çš„åˆ›æ–°, è¿…é€Ÿæ”¹å˜äº†äº‘è®¡ç®—çš„å‘å±•è½¨è¿¹! &lt;code>Docker&lt;/code> é•œåƒè§£å†³çš„æ˜¯ &lt;code>æ‰“åŒ…&lt;/code> é—®é¢˜ã€‚ä¹Ÿè®¸æœ‰äººè¯´&lt;code>Docker&lt;/code> é•œåƒå°±æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…ã€‚ä½†æ˜¯å°±æ˜¯è¿™ä¸ªå‹ç¼©åŒ…åŒ…å«äº†å®Œæ•´çš„æ“ä½œç³»ç»Ÿæ–‡ä»¶å’Œç›®å½•, åŒ…å«äº†æ•´ä¸ªåº”ç”¨æ‰€éœ€è¦çš„ä¾èµ–ï¼Œä¸€åŒ…åœ¨æ‰‹, ä½ å¯ä»¥è½»æ˜“çš„è¿è¡Œä½ çš„&lt;code>æ²™ç›’&lt;/code>,å¹¶ä¸”æœ¬åœ°ç¯å¢ƒä¸äº‘ç«¯ç¯å¢ƒé«˜åº¦ä¸€è‡´ï¼ˆè¿™æ˜¯æœ€å®è´µçš„ï¼‰ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>&lt;code>Docker&lt;/code>ç»™&lt;code>PAAS&lt;/code>è¿›è¡Œäº†è‡´å‘½æ‰“å‡», æä¾›äº†ä¾¿åˆ©çš„æ‰“åŒ…æœºåˆ¶, é¢å‘åç«¯å¼€å‘è€…æ¥è¯´, å±è”½äº†æœºå™¨ã€å†…æ ¸ç­‰æŠ€æœ¯ç»†èŠ‚, é¿å…äº†åœ¨ä¸åŒç¯å¢ƒé—´çš„å·®å¼‚å¼•å…¥çš„è¯•é”™æˆæœ¬ã€‚æ˜¯ä¸€æ¬¡è§£æ”¾ç”Ÿäº§åŠ›çš„é©å‘½ã€‚å½“ç„¶å¾ˆå¤šå¼€å‘è€…ç”¨è„šæŠ•ç¥¨, äº†ç»“äº†&lt;code>PAAS&lt;/code>æ—¶ä»£ã€‚&lt;/p>
&lt;h1 id="docker-ä¸‰å¤§åˆ©å™¨">&lt;code>Docker&lt;/code> ä¸‰å¤§åˆ©å™¨&lt;/h1>
&lt;ul>
&lt;li>&lt;code>Docker&lt;/code>é¡¹ç›®çš„é«˜è°ƒå¼€æº, è§£å†³äº†æ‰“åŒ…å’Œå‘å¸ƒå›°æ‰°è¿ç»´çš„æŠ€æœ¯éš¾é¢˜ï¼ŒåŒæ—¶å®ƒä¹Ÿç¬¬ä¸€æ¬¡çº¯åç«¯çš„æ¦‚å¿µé€šè¿‡å‹å¥½çš„è®¾è®¡å’Œå°è£…äº¤ä»˜åˆ°äº†å¼€å‘è€…çš„æ‰‹é‡Œã€‚&lt;/li>
&lt;li>&lt;code>Swarm&lt;/code>,&lt;code>Docker&lt;/code>æ˜¯åˆ›å»ºå’Œå¯åœå®¹å™¨çš„å·¥å…·,é‚£ä¹ˆ&lt;code>Swarm&lt;/code>æ˜¯ä¸ºäº†å‘å¹³å°åŒ–å‘å±•è€Œæå‡ºçš„ã€‚å®ƒæä¾›äº†å®Œæ•´çš„æ•´ä½“å¯¹å¤–æä¾›é›†ç¾¤ç®¡ç†åŠŸèƒ½,å®ƒçš„äº®ç‚¹æ˜¯å®Œå…¨ä½¿ç”¨&lt;code>Docker&lt;/code>åŸæœ¬çš„ç®¡ç†å®¹å™¨çš„APIæ¥å®Œæˆé›†ç¾¤ç®¡ç†&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&lt;span style="color:#228b22"># Swarmå¤šæœºç¯å¢ƒä¸‹ï¼ŒæŒ‡ä»¤ä¼šè¢«Swarmæ‹¦æˆªå¤„ç†ï¼Œåé¢é€šè¿‡è°ƒåº¦ç®—æ³•æ‰¾åˆ°åˆé€‚çš„Docker Daemonè¿è¡Œ&lt;/span>
docker run -H &lt;span style="color:#cd5555">&amp;#34;Swarmé›†ç¾¤API&amp;#34;&lt;/span> &lt;span style="color:#cd5555">&amp;#34;æˆ‘çš„å®¹å™¨&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>Compose&lt;/code>(Fig)é¡¹ç›®, è¿™æ˜¯ç¬¬ä¸€æ¬¡åœ¨å¼€å‘è€…é¢å‰æå‡º &lt;code>å®¹å™¨ç¼–æ’&lt;/code>(Container Orchestration)æ¦‚å¿µã€‚&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>åº”ç”¨å®¹å™¨ A, æ•°æ®åº“å®¹å™¨B, è´Ÿè½½å‡è¡¡å®¹å™¨C, Compose å…è®¸ Aã€Bã€C ä¸‰ä¸ªå®¹å™¨å®šä¹‰åœ¨é…ç½®æ–‡ä»¶ä¸­, å¹¶æŒ‡å®šå…³è”å…³ç³». åªéœ€è¦æ‰§è¡Œ (fig/docker-compose up)&lt;/p>
&lt;/blockquote>
&lt;h1 id="å®¹å™¨åŒ–ç¾¤é›„å¹¶èµ·ä¸å°˜åŸƒè½å®š">å®¹å™¨åŒ–ç¾¤é›„å¹¶èµ·ä¸å°˜åŸƒè½å®š&lt;/h1>
&lt;p>å®¹å™¨å¼€å¯ç«çˆ†æ¨¡å¼, å¤§é‡å›´ç»• &lt;code>Docker&lt;/code> é¡¹ç›®çš„ç½‘ç»œã€å­˜å‚¨ã€ç›‘æ§ã€&lt;code>CI/CD&lt;/code>ã€UI ç­‰æ¶Œç°äº†è¯¸å¦‚ &lt;code>Rancher&lt;/code>ã€&lt;code>Tutum&lt;/code> ç­‰åœ¨å¼€æºå’Œå•†ä¸šä¸Šå–å¾—æˆåŠŸçš„åˆ›ä¸šå…¬å¸ã€‚
åœ¨ &lt;code>Docker&lt;/code> ã€ &lt;code>Google&lt;/code>ã€&lt;code>CoreOS&lt;/code>ã€&lt;code>ReaHat&lt;/code> ç­‰å…¬å¸åœ¨äº‘è®¡ç®—å¤§æ‰“å‡ºæ‰‹çš„æ—¶å€™ï¼Œè½åœ¨ä¸‹é£çš„ &lt;code>Google&lt;/code>ã€&lt;code>CoreOS&lt;/code>ã€&lt;code>RedHat&lt;/code> å¼€å§‹å¿½æ‚  &lt;code>Docker&lt;/code> å°† &lt;code>Libcontainer&lt;/code> é¡¹ç›®æå‡ºã€ç»„å»ºä¸€ä¸ªå®Œå…¨ç‹¬ç«‹ä¸­ç«‹çš„åŸºé‡‘ä¼šç®¡ç†ï¼Œä»¥ &lt;code>RunC&lt;/code>ï¼ˆæ”¹åçš„ &lt;code>Libcontainer&lt;/code> ï¼‰ä¸ºä¾æ®ï¼Œå¤§å®¶å…±åŒåˆ¶å®šä¸€å¥—å®¹å™¨å’Œé•œåƒçš„æ ‡å‡†å’Œè§„èŒƒã€‚è¿™å¥—æ ‡å‡†å’Œè§„èŒƒå°±æ˜¯ &lt;code>OCI&lt;/code>(&lt;code>Open Container Initiative&lt;/code>),
&lt;code>OCI&lt;/code> çš„æå‡ºï¼Œå°†å®¹å™¨è¿è¡Œæ—¶å’Œé•œåƒçš„å®ç°ä»&lt;code>Docker&lt;/code>é¡¹ç›®åªå®Œå…¨å‰¥ç¦»å¼€æ¥ã€‚ï¼ˆå¥½ä¸€æ‹›å›´é­æ•‘èµµï¼Œæ”¹å–„&lt;code>Docker&lt;/code>å…¬å¸ä¸€å®¶ç‹¬å¤§ï¼Œå…¶ä»–å…¬å¸ä¸ä¾èµ–ä¸&lt;code>Docker&lt;/code>é¡¹ç›®ï¼‰
è¿™æ˜¯ç¬¬ä¸€æ­¥ï¼Œåé¢å°±æ˜¯å®¹å™¨ä¹‹ä¸Šçš„å¹³å°å±‚ï¼Œå°±æ˜¯ &lt;code>PAAS&lt;/code> å±‚äº†,åæ¥&lt;code>Google&lt;/code>ã€&lt;code>RedHat&lt;/code> ç­‰åŸºç¡€è®¾æ–½ç©å®¶ï¼Œå…±åŒå‘èµ· &lt;code>CNCF&lt;/code>(&lt;code>Cloud Native Computing Foundation&lt;/code>) åŸºé‡‘ä¼šã€‚ä»¥ &lt;code>Kubernetes&lt;/code> é¡¹ç›®ä¸ºåŸºç¡€ï¼Œå»ºç«‹ç”±å¼€æºåŸºç¡€è®¾æ–½å‚å•†é¢†å¯¼çš„æŒ‰ç…§åŸºé‡‘ä¼šæ–¹å¼è¿è¥çš„å¹³å°çº§ç¤¾åŒºã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>Kubernetes&lt;/code> é¡¹ç›®å¿…é¡»èƒ½å¤Ÿåœ¨å®¹å™¨ç¼–æ’é¢†åŸŸå–å¾—è¶³å¤Ÿå¤§çš„ç«äº‰ä¼˜åŠ¿&lt;/li>
&lt;li>&lt;code>CNCF&lt;/code> ç¤¾åŒºå¿…é¡»ä»¥ &lt;code>Kubernetes&lt;/code> é¡¹ç›®ä¸ºæ ¸å¿ƒï¼Œè¦†ç›–æ›´å¤šçš„å¸¸è§&lt;/li>
&lt;/ul>
&lt;p>&lt;code>Kubernetes&lt;/code> å½“åˆä¸ºä»€ä¹ˆè¢«è®¤ä¸ºè®¾è®¡æ€æƒ³è¿‡äºè¶…å‰ï¼Œå°±æ˜¯å› ä¸º Google åœ¨å®¹å™¨åŒ–å¤šå¹´çš„æ²‰æ·€å’Œå‡åï¼ˆ&lt;code>Borg&lt;/code> å’Œ &lt;code>Omega&lt;/code> ç‰¹æ€§ã€è½åœ¨ &lt;code>K8S&lt;/code> ä¸Šå°±æ˜¯ &lt;code>Pod&lt;/code>ã€&lt;code>Sidecar&lt;/code> çš„åŠŸèƒ½å’Œè®¾è®¡æ¨¡å¼ï¼‰
&lt;code>Kubernetes&lt;/code> å½“åˆæ²¡æœ‰é€‰æ‹©å’Œ &lt;code>Swarm&lt;/code> å±•å¼€åŒè´¨åŒ–ç«äº‰ï¼Œè€Œæ˜¯æå‡ºå¤ªå¤šçš„è®¾è®¡ç†å¿µå’Œå·å¬åŠ›ï¼Œå¾ˆå¿«æ„å»ºäº†ä¸åŒçš„å®¹å™¨ç¼–æ’çš„ç®¡ç†çš„ç”Ÿæ€ç†å¿µã€‚è¶…è¿‡äº†&lt;code>Swarm&lt;/code>é¡¹ç›®ã€‚æœ‰äº†è¿™ä¸ªåï¼Œåˆå°†å®¹å™¨ç›‘æ§äº‹å®æ ‡å‡† &lt;code>prometheus&lt;/code>èå…¥å…¶ä¸­ï¼Œåé¢åˆæ–°å¢äº† &lt;code>Fluentd&lt;/code>ã€&lt;code>OpenTracing&lt;/code>ã€&lt;code>CNDI&lt;/code> ç­‰è¯¸å¤šå®¹å™¨ç”Ÿæ€å·¥å…·å’Œé¡¹ç›®ã€‚åé¢åˆä¸€è®°è¡¥åˆ€ï¼šæ•´ä¸ªç¤¾åŒºè¿›è¡Œæ¨è¿›&lt;code>æ°‘ä¸»åŒ–&lt;/code>æ¶æ„, ä» API åˆ° å®¹å™¨è¿è¡Œæ—¶çš„ æ¯ä¸€å±‚,
&lt;code>Kubernetes&lt;/code> é¡¹ç›®éƒ½ä¸ºå¼€å‘è€…æš´éœ²å‡ºäº†å¯ä»¥æ‰©å±•çš„æ’ä»¶æœºåˆ¶, é¼“åŠ±ç¤¾åŒºç”¨æˆ·é€šè¿‡ä»£ç çš„æ–¹å¼ä»‹å…¥ &lt;code>Kubernetes&lt;/code> é¡¹ç›®çš„æ¯ä¸€ä¸ªé˜¶æ®µã€‚è¿™ä¸ªæ“ä½œé’ˆå¯¹ &lt;code>Docker&lt;/code> æ¥è¯´æ˜¯è‡´å‘½çš„,æ•´ä¸ªå®¹å™¨ç¤¾åŒºå‚¬ç”Ÿäº†å¤§é‡çš„ã€åŸºäº &lt;code>Kubernetes API&lt;/code> çš„åšæ‰©å±•çš„å’ŒäºŒæ¬¡å¼€å‘åˆ›æ–°çš„&lt;/p>
&lt;ul>
&lt;li>å¾®æœåŠ¡æ²»ç†é¡¹ç›® &lt;code>Istio&lt;/code>&lt;/li>
&lt;li>çŠ¶æ€åº”ç”¨éƒ¨ç½²æ¶æ„ &lt;code>Operator&lt;/code>&lt;/li>
&lt;li>&amp;hellip;&lt;/li>
&lt;/ul>
&lt;p>ç»è¿‡ä¸€äº›åˆ—éªšæ“ä½œåï¼ŒK8S å¤§è¡Œå…¶é“ï¼Œç¼–æ’ä¹‹äº‰è½ä¸‹å¸·å¹•ï¼Œå®¹å™¨ç¤¾åŒºçš„åç»­ç¹è£å®Œå…¨ä»¥ &lt;code>Kubernetes&lt;/code> é¡¹ç›®ä¸ºæ ¸å¿ƒçš„ç™¾å®¶äº‰é¸£, ä» &lt;code>Rancher&lt;/code>é¡¹ç›® çš„å†å²è¿­ä»£è¿‡ç¨‹ä¸­ä¹Ÿèƒ½çœ‹å‡ºè¿™ä¸ªç²¾å½©çº·å‘ˆçš„å±•ç°ã€‚&lt;/p>
- https://pinkhello.github.io/posts/17-%E5%9B%9E%E6%9C%9Bk8s-%E5%B0%8F%E9%B2%B8%E9%B1%BC%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF/ - ä¸€æ¯å“ˆå¸Œä¸åŠ ç›, All Rights Reserved</description></item><item><title>16 Hexoè¿ç§»Hugo</title><link>https://pinkhello.github.io/posts/16-hexo%E8%BF%81%E7%A7%BBhugo/</link><pubDate>Wed, 10 Feb 2021 19:36:33 +0800</pubDate><guid>https://pinkhello.github.io/posts/16-hexo%E8%BF%81%E7%A7%BBhugo/</guid><description>ä¸€æ¯å“ˆå¸Œä¸åŠ ç› https://pinkhello.github.io/posts/16-hexo%E8%BF%81%E7%A7%BBhugo/ -&lt;h1 id="ä¸ºä»€ä¹ˆè¿ç§»-hugo">ä¸ºä»€ä¹ˆè¿ç§» &lt;code>Hugo&lt;/code>&lt;/h1>
&lt;ul>
&lt;li>&lt;code>Hugo&lt;/code> ä½¿ç”¨æ¯” &lt;code>Hexo&lt;/code> ç®€å•, åªæœ‰å•ç‹¬çš„ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶&lt;/li>
&lt;li>è‹¦äº &lt;code>Hexo&lt;/code> çš„ &lt;code>NodeModule&lt;/code> ç®¡ç†&lt;/li>
&lt;li>è¿ç§»æˆæœ¬æ›´ä½, ç»“åˆ &lt;code>Github Action&lt;/code> å®ç° &lt;code>Markdown&lt;/code> æ–‡ç« å‘å¸ƒ, è‡ªåŠ¨æ›´æ–°è‡³é™æ€ç«™&lt;/li>
&lt;li>è§„åˆ’ï¼šåŠ å…¥è‡ªå®šä¹‰åŸŸåä»¥åŠåšé™æ€èµ„æºCDNåšçš„åŠ é€Ÿ&lt;/li>
&lt;/ul>
&lt;h1 id="å‰ç½®å·¥ä½œ">å‰ç½®å·¥ä½œ&lt;/h1>
&lt;p>1ã€ ä¹‹å‰åŸºæœ¬æ‰€æœ‰çš„åšå®¢éƒ½æ‰˜ç®¡ä¸ &lt;code>github&lt;/code>,è¿™æ¬¡ä¹Ÿä¸ä¾‹å¤–, å¤ç”¨ &lt;code>https://pinkhello.github.io&lt;/code>,åˆ›å»ºä¸¤ä¸ªé¡¹ç›®&lt;/p>
&lt;ul>
&lt;li>pinkhello.github.io template ä»“åº“&lt;/li>
&lt;li>pinkhello.github.io.source private ä»“åº“&lt;/li>
&lt;/ul>
&lt;p>2ã€å‡†å¤‡OpenSSHç§é’¥å’Œå…¬é’¥&lt;/p>
&lt;ul>
&lt;li>pinkhello.github.io ä»“åº“ æ·»åŠ  settings -&amp;gt; Deploy keys -&amp;gt; Add Deploy Key (å°†å…¬é’¥æ·»åŠ è¿›å»ã€æ³¨æ„å…è®¸ Write)&lt;/li>
&lt;li>pinkhello.github.io.source ä»“åº“ æ·»åŠ  settings -&amp;gt; Actions secrets -&amp;gt; New Repository Secret ( NAME : ACTION_DEPLOY_KEY, Value: ç§é’¥ )&lt;/li>
&lt;/ul>
&lt;p>3ã€git clone pinkhello.github.io.source ä»“åº“&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">git clone git@github.com:PinkHello/pinkhello.github.io.source.git
&lt;span style="color:#658b00">cd&lt;/span> pinkhello.github.io.source
&lt;span style="color:#228b22"># åˆå§‹åŒ–ç«™ç‚¹ã€--force å¼ºåˆ¶åˆå§‹åŒ–ã€‘&lt;/span>
hugo new site . --force
&lt;span style="color:#228b22"># content site &lt;/span>
&lt;span style="color:#228b22"># data jsonæ•°æ® or å…¶ä»–&lt;/span>
&lt;span style="color:#228b22"># static é™æ€æ–‡ä»¶&lt;/span>
&lt;span style="color:#228b22"># themes ä¸»é¢˜&lt;/span>
&lt;span style="color:#228b22"># åé¢å¯ä»¥æ‰§è¡Œ hugo new posts/XXX.md åˆ›å»ºæ–°çš„æ–‡ç« &lt;/span>
hugo new posts/XXX.md
&lt;span style="color:#228b22"># å…·ä½“å‚è€ƒ https://gohugo.io/getting-started/ è¿›è¡Œæ“ä½œ&lt;/span>
......
&lt;span style="color:#228b22"># é€‰æ‹©ä¸€ä¸ªä¸»é¢˜ https://themes.gohugo.io/ å¯ä»¥é€‰æ‹©&lt;/span>
git submodule add https://github.com/budparr/gohugo-theme-ananke.git themes/ananke
&lt;span style="color:#228b22"># åé¢çš„å‚ç…§å„ä¸ªä¸»é¢˜è®¾ç½®å’¯&lt;/span>
....
&lt;span style="color:#228b22"># æœ¬åœ°æµ‹è¯•&lt;/span>
hugo serve
&lt;span style="color:#228b22"># ç”Ÿæˆæœ€å°çš„é™æ€æ–‡ä»¶, ä¼šç”Ÿæˆ public æ–‡ä»¶&lt;/span>
hugo --minify
&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="è¿ç§»-hexo-åšå®¢è¿›å…¥-hugo">è¿ç§» &lt;code>hexo&lt;/code> åšå®¢è¿›å…¥ &lt;code>hugo&lt;/code>&lt;/h1>
&lt;p>&amp;hellip;&amp;hellip;(å¯ä»¥æ‰‹åŠ¨ã€å¯ä»¥å·¥å…·è¿›è¡Œ)&lt;/p>
&lt;h1 id="æ•´åˆ-github-action">æ•´åˆ &lt;code>Github Action&lt;/code>&lt;/h1>
&lt;p>æ–°å»º &lt;code>Github Action&lt;/code> æè¿°æ–‡ä»¶ &lt;code>.github/workflows/deploy.yml&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#228b22"># This is a basic workflow to help you get started with Actions&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Deploy on Main Branch&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#228b22"># Controls when the action will run. &lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">on&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># Triggers the workflow on push or pull request events but only for the main branch&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">push&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">branches&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>[&lt;span style="color:#bbb"> &lt;/span>main ]&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">pull_request&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">branches&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>[&lt;span style="color:#bbb"> &lt;/span>main ]&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#228b22"># schedule:&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#228b22"># - cron: &amp;#39;0 21 * * *&amp;#39; # å®šæ—¶ä»»åŠ¡&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># Allows you to run this workflow manually from the Actions tab&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">workflow_dispatch&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#228b22"># A workflow run is made up of one or more jobs that can run sequentially or in parallel&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">jobs&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># This workflow contains a single job called &amp;#34;build&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">build&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># The type of runner that the job will run on&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">runs-on&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>ubuntu-latest&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># Steps represent a sequence of tasks that will be executed as part of the job&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">steps&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">uses&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>actions/checkout@v2&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Setup Hugo&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">uses&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>peaceiris/actions-hugo@v2&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># https://github.com/peaceiris/actions-hugo&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">with&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">hugo-version&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#39;latest&amp;#39;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">extended&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Build&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># æ³¨æ„å¼ºåˆ¶æ›´æ–° git submodule ä¸‹è½½ï¼Œå¦åˆ™ç”Ÿæˆçš„ä¸»é¢˜æ²¡æœ‰ html æ–‡ä»¶å“¦&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">run&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>|&lt;span style="color:#cd5555">
&lt;/span>&lt;span style="color:#cd5555"> git submodule update --init --recursive
&lt;/span>&lt;span style="color:#cd5555"> hugo --minify --debug&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Deploy&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">uses&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>peaceiris/actions-gh-pages@v3&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># https://github.com/peaceiris/actions-gh-pages&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">with&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">deploy_key&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>${{ secrets.ACTION_DEPLOY_KEY }}&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># è¿™é‡Œçš„ ACTION_DEPLOY_KEY åˆ™æ˜¯ä¸Šé¢è®¾ç½® Private Keyçš„å˜é‡å&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">external_repository&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>PinkHello/PinkHello.github.io&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># Pages è¿œç¨‹ä»“åº“ &lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">publish_dir&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>./public&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">keep_files&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># remove existing files&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">publish_branch&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>master &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># deploying branch&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">commit_message&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>${{ github.event.head_commit.message }}&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>so å®Œç¾
&lt;img src="https://pinkhello.github.io/hexo%E8%BF%81%E7%A7%BB%E8%87%B3hugo/github_action_in_process_0.jpg" alt="è¿ç§»Hexo">
&lt;img src="https://pinkhello.github.io/hexo%E8%BF%81%E7%A7%BB%E8%87%B3hugo/github_action_in_process.jpg" alt="è¿ç§»Hexo">&lt;/p>
- https://pinkhello.github.io/posts/16-hexo%E8%BF%81%E7%A7%BBhugo/ - ä¸€æ¯å“ˆå¸Œä¸åŠ ç›, All Rights Reserved</description></item><item><title>15 è®°ä¸€æ¬¡dockeræ—¥å¿—ç£ç›˜å‘Šè­¦é—®é¢˜</title><link>https://pinkhello.github.io/posts/15-%E8%AE%B0%E4%B8%80%E6%AC%A1docker%E6%97%A5%E5%BF%97%E7%A3%81%E7%9B%98%E5%91%8A%E8%AD%A6%E9%97%AE%E9%A2%98/</link><pubDate>Wed, 10 Feb 2021 10:05:29 +0800</pubDate><guid>https://pinkhello.github.io/posts/15-%E8%AE%B0%E4%B8%80%E6%AC%A1docker%E6%97%A5%E5%BF%97%E7%A3%81%E7%9B%98%E5%91%8A%E8%AD%A6%E9%97%AE%E9%A2%98/</guid><description>ä¸€æ¯å“ˆå¸Œä¸åŠ ç› https://pinkhello.github.io/posts/15-%E8%AE%B0%E4%B8%80%E6%AC%A1docker%E6%97%A5%E5%BF%97%E7%A3%81%E7%9B%98%E5%91%8A%E8%AD%A6%E9%97%AE%E9%A2%98/ -&lt;h1 id="å‰æ™¯">å‰æ™¯&lt;/h1>
&lt;p>ä»Šæ—¥ï¼Œæˆ‘æ­£åœ¨å¼€å¼€å¿ƒå¿ƒçš„åˆ·ç€JFXçš„Codingä¸­ï¼Œçªç„¶çº¿ä¸ŠæŠ¥è­¦ç¾¤ä¸­çˆ†äº†ä¸ªç‚¸å¼¹ï¼ŒEC2ç£ç›˜è¶…è¿‡80%ã€‚&lt;/p>
&lt;p>&lt;img src="https://pinkhello.github.io/%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/%E8%B5%84%E6%BA%90%E4%B8%8D%E8%B6%B3%E6%8A%A5%E8%AD%A6.png" alt="èµ„æºä¸è¶³é¢„è­¦">&lt;/p>
&lt;h1 id="å¤„ç†è¿‡ç¨‹">å¤„ç†è¿‡ç¨‹&lt;/h1>
&lt;p>è§£å†³é—®é¢˜å§¿åŠ¿å°±ä½ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>èµ¶ç´§å¼€æœº ==ã€‹ â¤ï¸ä¸­ä¸‡åŒ¹ğŸ¦™å¥”è…¾è€Œè¿‡ â¤ï¸ä¸­MMP&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é»˜é»˜çš„é€šè¿‡è·³æ¿æœºè¿›å…¥ç›®æ ‡æœºå™¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸ç®¡ä¸‰ä¸ƒäºŒåä¸€,æ‰§è¡ŒæŸ¥çœ‹ç£ç›˜å ç”¨å¤§å°ï¼Œæˆ‘çš„ä¹–ä¹–ï¼Œå ç”¨ç¡®å®è¶…è¿‡äº†87%äº†ï¼Œä¸€ä¸‹å­æš´æ¶¨çš„&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&lt;span style="color:#228b22"># æŸ¥çœ‹ç£ç›˜å ç”¨å¤§å°&lt;/span>
&amp;gt; sudo df -h
&lt;span style="color:#228b22"># æŸ¥çœ‹å½“å‰ç›®å½•æ€»é‡&lt;/span>
&amp;gt; sudo du -sh
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å¼€å§‹å®šä½å…·ä½“å“ªä¸ªæ–‡ä»¶æˆ–è€…ç›®å½•å ç”¨è¿™ä¹ˆå¤§,è·‘åˆ°æ ¹ç›®å½•ä¸‹ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&lt;span style="color:#228b22"># æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹ä¸€çº§å­æ–‡ä»¶å’Œå­ç›®å½•å ç”¨çš„ç£ç›˜å®¹é‡&lt;/span>
&amp;gt; sudo du -lh --max-depth=&lt;span style="color:#b452cd">1&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>ä¸€å¼€å§‹çŒœæƒ³å¯èƒ½æ˜¯dockerå®¹å™¨çš„æ—¥å¿—å ç”¨å¤§ï¼Œä¸Šé¢æ‰§è¡Œåï¼Œè¿˜çœŸ TM æ˜¯&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">/var/lib/docker/containers ç›®å½•å ç”¨ 42G
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å¼€å§‹æŸ¥çœ‹æ˜¯å“ªä¸ªå®¹å™¨å ç”¨çš„è¿™ä¹ˆå¤§çš„ç©ºé—´&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&lt;span style="color:#228b22"># æŸ¥çœ‹ containers æ—¥å¿—ç›®å½•æ’åº&lt;/span>
&amp;gt; sudo du -d1 -h /var/lib/docker/containers | sort -h
&lt;span style="color:#228b22"># æŸ¥çœ‹å…·ä½“çš„å“ªä¸ªæ—¥å¿—æ–‡ä»¶å¤§&lt;/span>
&amp;gt; sudo find /var/lib/docker/containers -name *.log
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“ç„¶è¿™ä¸ªé…å›¾æ˜¯æˆ‘æ¸…ç†ä¹‹åçš„
&lt;img src="https://pinkhello.github.io/%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/docker%E5%AE%B9%E5%99%A8%E6%96%87%E4%BB%B6%E6%8E%92%E5%BA%8F.png" alt="dockerå®¹å™¨æ–‡ä»¶æ’åº">
&lt;img src="https://pinkhello.github.io/%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/%E6%9F%A5%E6%89%BEdocker%E5%AE%B9%E5%99%A8%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6.png" alt="æŸ¥æ‰¾dockerå®¹å™¨æ—¥å¿—æ–‡ä»¶">&lt;/p>
&lt;ul>
&lt;li>å®šä½åˆ°æœ€å¤§çš„æ–‡ä»¶ï¼Œä¸€é¡¿æ“ä½œ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell"> &lt;span style="color:#228b22"># æ¸…ç©ºæ¯”è¾ƒå¤§çš„æ—¥å¿—æ–‡ä»¶&lt;/span>
&amp;gt; sudo sh -c &lt;span style="color:#cd5555">&amp;#34;cat /dev/null &amp;gt; &lt;/span>&lt;span style="color:#cd5555">${&lt;/span>&lt;span style="color:#00688b">log_file&lt;/span>&lt;span style="color:#cd5555">}&lt;/span>&lt;span style="color:#cd5555">&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://pinkhello.github.io/%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/%E6%B8%85%E7%90%86docker%E5%AE%B9%E5%99%A8%E6%97%A5%E5%BF%97%E5%90%8E.png" alt="æ¸…ç†dockerå®¹å™¨æ—¥å¿—å">&lt;/p>
&lt;h1 id="æ€è€ƒ">æ€è€ƒ&lt;/h1>
&lt;ul>
&lt;li>ä¸Šé¢çš„æ–¹å¼æ˜¯ä¸€ç§æ–¹å¼è§£å†³ã€ä¸´æ—¶ã€‘
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell"> &lt;span style="color:#228b22"># æŸ¥çœ‹ docker çš„ Logging Driver&lt;/span>
&amp;gt; docker info | grep &lt;span style="color:#cd5555">&amp;#39;Logging Driver&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚ä½•å½»åº•è§£å†³è¿™ä¸ªé—®é¢˜ï¼š&lt;/p>
&lt;ul>
&lt;li>å†™ä¸ª&lt;code>shellè„šæœ¬&lt;/code> ä½¿ç”¨ &lt;code>crontab&lt;/code> å®šæœŸæ‰§è¡Œæ¸…ç†
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell"> &lt;span style="color:#228b22">#!/bin/sh&lt;/span>
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#cd5555">&amp;#34;======== start clean docker containers logs ========&amp;#34;&lt;/span>
&lt;span style="color:#00688b">logs&lt;/span>=&lt;span style="color:#8b008b;font-weight:bold">$(&lt;/span>find /var/lib/docker/containers/ -name *-json.log&lt;span style="color:#8b008b;font-weight:bold">)&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> log in &lt;span style="color:#00688b">$logs&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">do&lt;/span>
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#cd5555">&amp;#34;clean logs : &lt;/span>&lt;span style="color:#00688b">$log&lt;/span>&lt;span style="color:#cd5555">&amp;#34;&lt;/span>
cat /dev/null &amp;gt; &lt;span style="color:#00688b">$log&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">done&lt;/span>
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#cd5555">&amp;#34;======== end clean docker containers logs ========&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>å‡å¦‚æ˜¯&lt;code>docker run&lt;/code>åˆ›å»ºå®¹å™¨çš„,æŒ‡å®š &lt;code>--log-opt max-size=${MAX_SIZE}m --log-opt max-file=${NUMBER}&lt;/code>&lt;/li>
&lt;li>&lt;code>docker-compose&lt;/code> æ–¹å¼æ›´é«˜&lt;code>docker-compose.yaml&lt;/code>æ–‡ä»¶
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">logging&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">driver&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;json-file&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">options&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">max-size&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;${MAX_SIZE}m&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">max-file&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>${NUMBER}&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>&lt;code>docker&lt;/code> å…¨å±€ä¿®æ”¹ &lt;code>/etc/docker/daemon.json&lt;/code>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json"> {
&lt;span style="color:#8b008b;font-weight:bold">&amp;#34;log-driver&amp;#34;&lt;/span>: &lt;span style="color:#cd5555">&amp;#34;json-file&amp;#34;&lt;/span>,
&lt;span style="color:#8b008b;font-weight:bold">&amp;#34;log-opts&amp;#34;&lt;/span>: {
&lt;span style="color:#8b008b;font-weight:bold">&amp;#34;max-size&amp;#34;&lt;/span>: &lt;span style="color:#cd5555">&amp;#34;${MAX_SIZE}m&amp;#34;&lt;/span>
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell"> &amp;gt; systemctl daemon-reload
&amp;gt; systemctl restart docker
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ä¸ºä»€ä¹ˆä¼šç¬é—´ğŸ’¥å¼çš„å¢é•¿ ???&lt;/li>
&lt;/ul>
- https://pinkhello.github.io/posts/15-%E8%AE%B0%E4%B8%80%E6%AC%A1docker%E6%97%A5%E5%BF%97%E7%A3%81%E7%9B%98%E5%91%8A%E8%AD%A6%E9%97%AE%E9%A2%98/ - ä¸€æ¯å“ˆå¸Œä¸åŠ ç›, All Rights Reserved</description></item><item><title>14 å·¥ä½œçºªå®2020</title><link>https://pinkhello.github.io/posts/14-%E5%B7%A5%E4%BD%9C%E7%BA%AA%E5%AE%9E2020/</link><pubDate>Wed, 10 Feb 2021 10:00:19 +0800</pubDate><guid>https://pinkhello.github.io/posts/14-%E5%B7%A5%E4%BD%9C%E7%BA%AA%E5%AE%9E2020/</guid><description>ä¸€æ¯å“ˆå¸Œä¸åŠ ç› https://pinkhello.github.io/posts/14-%E5%B7%A5%E4%BD%9C%E7%BA%AA%E5%AE%9E2020/ -&lt;h1 id="æ¯æ—¥ä¸€æ€ç¯‡">æ¯æ—¥ä¸€æ€ç¯‡&lt;/h1>
&lt;h2 id="2019-10-12-æ¯æ—¥ä¸€æ€-mysql-walæŠ€æœ¯-å’Œ-ringbuffer-æ€æƒ³å¥½ä¸€è‡´">[2019-10-12 æ¯æ—¥ä¸€æ€] Mysql WALæŠ€æœ¯ å’Œ RingBuffer æ€æƒ³å¥½ä¸€è‡´?&lt;/h2>
&lt;h2 id="2019-10-14-æ¯æ—¥ä¸€æ€-jwt-ç»­ç­¾è¯¥å¦‚ä½•åš">[2019-10-14 æ¯æ—¥ä¸€æ€] JWT ç»­ç­¾è¯¥å¦‚ä½•åš?&lt;/h2>
&lt;h2 id="2019-10-16-æ¯æ—¥ä¸€æ€-tcpip-åè®®å…·ä½“æŒ‡å“ªäº›">[2019-10-16 æ¯æ—¥ä¸€æ€] TCP/IP åè®®å…·ä½“æŒ‡å“ªäº›?&lt;/h2>
&lt;blockquote>
&lt;p>æˆ‘ä»¬éƒ½çŸ¥é“ç½‘ç»œæ˜¯7å±‚æ¨¡å‹ï¼Œåº”è¡¨ä¼šä¼ ç½‘æ•°ç‰©ï¼Œ
ç°åœ¨æˆ‘åªè®¨è®ºåº”ä¼ ç½‘æ•°è¿™4å±‚ã€‚TCP/IPåè®®åº”è¯¥è¢«ç§°ä¸ºTCP/IPæ—ï¼Œ
æˆ‘çš„ç†è§£ä»–ä¸æ˜¯å±äºå•ä¸ªçš„åè®®ç±»å‹ï¼Œæ˜¯ä¸€ä¸ªç»Ÿç§°ï¼ŒçŸ¥é“ç½‘ç»œæ¨¡å‹æ ¸å¿ƒè®¾è®¡æ€æƒ³æ˜¯åˆ†å±‚ï¼Œä¸ºä»€ä¹ˆåˆ†å±‚ï¼Œåˆ†å±‚ä»è®¾è®¡ä¸Šå’Œå®ç°éš¾åº¦ä¸Šéƒ½ç®€å•å¾ˆå¤šï¼Œå“ªä¸€å±‚éœ€è¦ä¿®æ”¹åªéœ€è¦ä¿®æ”¹è¿™ä¸€å±‚ã€‚&lt;/p>
&lt;ul>
&lt;li>åº”ç”¨å±‚ï¼Œåƒæœ€å¸¸è§çš„httpã€ftpã€dnsã€rtspã€rtmpç­‰ç­‰åè®®éƒ½æ˜¯å±äºè¿™ç±»ï¼Œ&lt;/li>
&lt;li>ä¼ è¾“å±‚å‘¢æŒ‰ç…§ä¼ è¾“ç±»å‹åˆåˆ†äº†TCPå’ŒUDP,&lt;/li>
&lt;li>ç½‘ç»œå±‚ï¼Œæ˜¯æ•°æ®åŒ…äº¤äº’çš„å±‚é¢ï¼Œ&lt;/li>
&lt;li>æ•°æ®é“¾è·¯å±‚æ˜¯å¤„ç†ç½‘å¡ã€æ“ä½œç³»ç»Ÿç­‰ç­‰è½¯ç¡¬æŠ½è±¡å‡ºçš„å¯è§éƒ¨åˆ†ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä¸¾ä¸€ä¸ªæ —å­ï¼Œä¸€ä¸ªhttpè¯·æ±‚ï¼Œåœ¨åº”ç”¨å±‚é¢æ˜¯å®Œæ•´çš„ï¼Œåé¢è¢«ä¼ è¾“å±‚ï¼ˆTCPå±‚ï¼‰è¢«åˆ†åŒ…ï¼Œå¹¶æ‰“ä¸Šåºå·æ ‡è®°ï¼Œå†è¿›å…¥ç½‘ç»œå±‚ï¼ˆIPå±‚ï¼‰æ·»åŠ IPé¦–éƒ¨ï¼ˆç›®æ ‡macåœ°å€ç­‰ç­‰ï¼‰ï¼Œ
ä¸‹é¢å°±æ˜¯å¼€å§‹ç–¯ç‹‚çš„å‘é€äº†ï¼Œæ¥æ”¶æ–¹ä¸€æ ·æ˜¯è¿™ä¸ªè¿‡ç¨‹çš„é€†åºã€‚åº”ç”¨å¤„ç†å®Œæˆåé¢çš„å“åº”è¿‡ç¨‹ä¸è¯·æ±‚è¿‡ç¨‹ä¸€æ ·çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚åŒæ—¶å¯ä»¥æ‰©å±•å‡ºL4ä¸L7çš„é—®é¢˜ï¼Œ
å„è‡ªæ˜¯å¦‚ä½•å»å®ç°è´Ÿè½½å‡è¡¡çš„ï¼ŸL4æ˜¯å¯ä»¥çœ‹å‡ºæ˜¯åŸºäºä¼ è¾“å±‚å³TCPå±‚å·¥ä½œï¼ˆé€šè¿‡å‘å¸ƒVIPï¼ˆç¬¬ä¸‰å±‚ï¼‰ä»¥åŠç¬¬å››å±‚ç«¯å£ï¼‰ï¼ŒL7åŸºäºåº”ç”¨å±‚å·¥ä½œï¼ˆç¬¬å››å±‚åŸºç¡€ä¸Š+è€ƒè™‘åº”ç”¨ç‰¹å¾ï¼‰ï¼Œ
æ¯”å¦‚HTTPçš„URLã€å®¢æˆ·ç«¯çš„ç±»åˆ«ã€è¯­è¨€ç±»å‹ç­‰ç­‰ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="2019-10-18-æ¯æ—¥ä¸€æ€ä¸€ç§åœºæ™¯rabbitmq-çš„-exchange-ä¸º-fanout-ç±»å‹ç»‘å®šåˆ°å¤šä¸ªqueue-ä»€ä¹ˆæƒ…å†µä¼šè§¦å‘-rabbitmq-æµæ§å¦‚ä½•è§£å†³">[2019-10-18 æ¯æ—¥ä¸€æ€]ä¸€ç§åœºæ™¯ï¼Œrabbitmq çš„ Exchange ä¸º fanout ç±»å‹ï¼Œç»‘å®šåˆ°å¤šä¸ªqueue, ä»€ä¹ˆæƒ…å†µä¼šè§¦å‘ rabbitmq æµæ§ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ&lt;/h2>
&lt;h2 id="2019-10-22-æ¯æ—¥ä¸€æ€idåºåˆ—ç”Ÿäº§å™¨æ€ä¹ˆå®ç°å‘¢">[2019-10-22 æ¯æ—¥ä¸€æ€]IDåºåˆ—ç”Ÿäº§å™¨æ€ä¹ˆå®ç°å‘¢ï¼Ÿ&lt;/h2>
&lt;blockquote>
&lt;p>uuidç”Ÿæˆ&lt;/p>
&lt;ul>
&lt;li>åŸºäºæ—¶é—´ï¼ˆ60ä½utcæ—¶é—´ å’Œ æ—¶é—´åºåˆ—å€¼14ä½ï¼Œä»¥åŠmacåœ°å€ï¼‰&lt;/li>
&lt;li>åŸºäºåç§°ï¼ˆé’ˆå¯¹å‘½åç©ºé—´dnsã€urlç­‰åˆ†é…ï¼ŒæŠŠåç§°è½¬æˆå­—èŠ‚åºåˆ—ï¼Œå†ç”¨md5æˆ–sha-1ä¸å‘½åç©ºé—´æ ‡è¯†è¿›è¡Œè®¡ç®—ï¼Œäº§ç”Ÿå“ˆå¸Œç»“æœï¼‰&lt;/li>
&lt;li>åŸºäºéšæœºæ•°ï¼ˆå¯†ç å­¦éšæœºæ•°ï¼Œç³»ç»Ÿçš„ç¡¬ç›˜å†…å­˜çº¿ç¨‹å †æ ˆè¿›ç¨‹å¥æŸ„ç­‰sha-1ç”Ÿæˆå“ˆå¸Œç»“æœï¼‰&lt;/li>
&lt;/ul>
&lt;p>snowflakeï¼Œ64bitï¼Œlongå‹ID&lt;/p>
&lt;ul>
&lt;li>IDç”Ÿæˆæ–¹å¼ 1bitï¼ˆä¸ä½¿ç”¨ï¼‰ï¼Œ41bitæ—¶é—´æˆ³ï¼ˆå½“å‰æ¯«ç§’æ•°ã€69å¹´ä¸€è½®å›ï¼‰ï¼Œ10bitæœºå™¨ç ï¼ˆ1024å°ï¼Œ5bitæ•°æ®ä¸­å¿ƒï¼Œ5bitæœºå™¨IDï¼‰ï¼Œ12bitä½œä¸ºæ¯«ç§’å†…åºåˆ—å·ï¼ˆå•æœºç†è®º 409.6w/sï¼‰&lt;/li>
&lt;li>é›ªèŠ±ç®—æ³•ï¼Œå¤šå°æœºå™¨ï¼Œæœ‰å› ä¸ºæ—¶é’Ÿå›æ‹¨å¯¼è‡´çš„IDç”Ÿæˆé—®é¢˜ï¼Œå½“ç„¶å¯ä»¥é€šè¿‡å‘ç”Ÿæ—¶é’Ÿå›æ‹¨åä¸€ä¸ªé˜ˆå€¼ï¼Œåœ¨é˜ˆå€¼å†…åˆ™ä¸å…è®¸äº§ç”Ÿæ–°çš„IDï¼ŒåŒæ­¥é˜»å¡ï¼Œåœ¨é˜ˆå€¼å¤–é‡æ–°è®¾ç½®æœºå™¨IDæ¥è§£å†³&lt;/li>
&lt;li>github.com/baidu/uid-generator æŠ€æœ¯è€é“ç™¾åº¦å¼€æºçš„åŸºäºsnowflakeå®ç°çš„IDç”Ÿæˆå™¨ï¼Œå¯ä»¥å€Ÿé‰´ç ”è¯»ä¸€ä¸‹&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h2 id="2019-11-01-æ¯æ—¥ä¸€æ€æˆ‘ä»¬å¸¸è¯´çš„é™æµæ˜¯ä»€ä¹ˆä¸ºä»€ä¹ˆè¦é™æµé™æµæœ‰å“ªäº›æ–¹å¼">[2019-11-01 æ¯æ—¥ä¸€æ€]æˆ‘ä»¬å¸¸è¯´çš„é™æµæ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦é™æµï¼Ÿé™æµæœ‰å“ªäº›æ–¹å¼ï¼Ÿ&lt;/h2>
&lt;blockquote>
&lt;p>æˆ‘ä»¬å¸¸è¯´çš„é™æµï¼Œé¡¾åæ€ä¹‰å³é™åˆ¶æµé‡. é™åˆ¶ç³»ç»Ÿçš„è¾“å…¥å’Œè¾“å‡º
å¸¸ç”¨çš„é™æµå‘å±•è‡³ä»Šï¼Œæœ‰å››ç§æ–¹å¼&lt;/p>
&lt;ul>
&lt;li>å›ºå®šæ—¶é—´è®¡æ•°å™¨&lt;/li>
&lt;li>æ¼æ¡¶&lt;/li>
&lt;li>ä»¤ç‰Œæ¡¶&lt;/li>
&lt;li>æ»‘åŠ¨çª—å£è®¡æ•°å™¨&lt;/li>
&lt;/ul>
&lt;p>å›ºå®šçª—å£è®¡æ•°å™¨ï¼šä»¥å•ä½æ—¶é—´å†…è¿›å…¥ç³»ç»Ÿï¼ˆç³»ç»Ÿçº§åˆ«ï¼‰æˆ–è€…æŸä¸€ä¸ªå•ä¸€æ¥å£æœåŠ¡ï¼ˆç³»ç»ŸæœåŠ¡çº§åˆ«ï¼‰è¯·æ±‚æ¬¡æ•°ï¼Œåœ¨è¿™ä¸ªå•ä½æ—¶é—´å†…çš„è¶…è¿‡æ¬¡æ•°ï¼Œæ‹’ç»æœåŠ¡æˆ–è€…æ›´æ¢å…¶ä»–æ–¹æ¡ˆï¼ˆé™çº§ã€ç†”æ–­ï¼‰è¾¾åˆ°é™æµç›®çš„ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å¯ä»¥çœ‹å‡ºï¼Œæ˜æ˜¾çš„ç¼ºç‚¹ï¼Œä»æ•´ä½“æ›²çº¿ä¸Šï¼Œæ¯›åˆºç°è±¡éå¸¸ä¸¥é‡ï¼Œå‡è®¾å•ä½æ—¶é—´ 1s å†…é™åˆ¶ 100 æ¬¡ï¼Œåœ¨0-10mså†…æˆ‘å·²ç»è¯·æ±‚è¶…è¿‡100æ¬¡äº†ï¼Œåé¢çš„è¯·æ±‚å…¨éƒ¨æ‹’ç»æˆ–è€…åšå…¶ä»–å¤„ç†äº†ã€‚æ— æ³•æ§åˆ¶å•ä½æ—¶é—´å†…çš„çªå‘æµé‡ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>æ¼æ¡¶: æ¡¶çš„å®¹é‡å›ºå®šï¼Œæ¡¶æµå‡ºçš„é€Ÿç‡æ’å®šã€‚æ¡¶æ»¡åˆ™é™æµã€‚ä¹Ÿæ˜¯æ— æ³•åº”å¯¹çªå‘æµé‡&lt;/p>
&lt;p>ä»¤ç‰Œæ¡¶ï¼š è¿˜æ˜¯æ¡¶çš„æ–¹å¼ï¼Œ æ¡¶ä¸­å­˜æ”¾çš„æ˜¯ token ï¼Œæ ¹æ®é™æµçš„å¤§å°ï¼Œ token ä»¥æ’å®šé€Ÿç‡è¿›å…¥æ¡¶ä¸­ï¼Œè®¾ç½®æ¡¶çš„æœ€å¤§çš„ token å®¹é‡ï¼Œå½“æ¡¶æ»¡æ—¶å€™æ‹’ç»æ–°æ·»åŠ çš„token
ï¼Œæˆ–è€…ç›´æ¥ä¸¢å¼ƒã€‚æ‰€æœ‰è¯·æ±‚è¿›å…¥å…ˆè·å–ä»¤ç‰Œï¼Œå¾—åˆ°ä»¤ç‰Œç»§ç»­ä¸‹é¢çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¤„ç†å®Œæˆåˆ é™¤ tokenã€‚&lt;/p>
&lt;blockquote>
&lt;p>ç›¸æ¯” æ¼æ¡¶ï¼Œ ä¸€å®šç¨‹åº¦ä¸Šå…è®¸çªå‘æµé‡ï¼Œå¹³æ»‘é™æµï¼Œå› ä¸º æ¡¶ ä¸­çš„ token æ˜¯åŒ€é€Ÿæ”¾å…¥çš„ï¼ŒæŠµå¾¡çªå‘æµé‡ã€‚æ¡¶çš„ token æ•°é‡ä¸ä¼šè¶…è¿‡ç»™å®šçš„æœ€å¤§å€¼ã€‚
å‚è€ƒ guava rate limiter&lt;/p>
&lt;/blockquote>
&lt;p>æ»‘åŠ¨çª—å£è®¡æ•°å™¨:(å‚è€ƒSentinelä¸­ä½¿ç”¨çš„é»˜è®¤é™æµæ–¹å¼)
æ˜¯å¯¹å›ºå®šæ—¶é—´çª—å£è®¡æ•°å™¨çš„ä¼˜åŒ–ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³å›ºå®šæ—¶é—´è®¡æ•°å™¨çš„æ— æ³•é¢å¯¹çªå‘æµé‡ï¼Œä½•ä¸ºæ»‘åŠ¨çª—å£å‘¢ï¼Ÿ
å‡è®¾å•ä½æ—¶é—´å®šä½ 1sï¼Œ è®¡æ•°å™¨é™åˆ¶åœ¨ 1000 æ¬¡ï¼Œ å†å°†è€… 1s åˆ’åˆ†ä¸º 100ms ä¸ºä¸€ä¸ªå°æ ¼å­ï¼Œæ€»å…± 10 ä¸ªæ ¼å­ï¼Œ
æ¯ä¸ªæ ¼å­è¿˜æœ‰è®¡æ•°å™¨ï¼Œå½“ä¸€ä¸ªè¯·æ±‚è¿›æ¥ï¼Œåœ¨å¯¹åº”çš„æ—¶é—´æ ¼å­é‡Œé¢çš„è®¡æ•°å™¨ +1 ï¼Œåªè¦æ€»çš„è¿™ä¸ªå•ä½æ—¶é—´å†…æ‰€æœ‰çš„æ—¶é—´æ ¼å­è®¡æ•°å™¨æ€»å’Œå°äº é™åˆ¶æ¬¡æ•°ï¼Œå°±ä¸ä¼šå¯åŠ¨é™æµä½œç”¨ã€‚
å¯ä»¥çœ‹å‡ºæ¥ï¼Œå‡å¦‚æˆ‘çš„åˆ’åˆ†çš„æ ¼å­å¾ˆå°ï¼Œæ»‘åŠ¨çª—å£æ»šåŠ¨å°†æ˜¯è¶Šå¹³æ»‘çš„ã€‚
psï¼š 0.00 - 1.00 æœ‰ 10 ä¸ªæ ¼å­ï¼Œè¿™æ˜¯ä¸€ä¸ªæ»‘åŠ¨çª—å£æœŸï¼Œç„¶å 0.10-1.10æ˜¯ä¸€ä¸ªçª—å£æœŸï¼Œè¿™æ ·è®¡ç®—çš„&lt;/p>
&lt;/blockquote>
&lt;h2 id="2019-11-04-æ¯æ—¥ä¸€æ€-å‡å¦‚mqæ¶ˆæ¯é˜Ÿåˆ—äº§ç”Ÿäº†å †ç§¯å¦‚ä½•æ›´å¿«çš„æ¶ˆè´¹">[2019-11-04 æ¯æ—¥ä¸€æ€] å‡å¦‚MQæ¶ˆæ¯é˜Ÿåˆ—äº§ç”Ÿäº†å †ç§¯ï¼Œå¦‚ä½•æ›´å¿«çš„æ¶ˆè´¹ï¼Ÿ&lt;/h2>
&lt;blockquote>
&lt;p>ä¼šä»å¤šç§é˜Ÿåˆ—å»åˆ†æï¼Œrabbitmqï¼Œkafkaï¼Œrocketmqï¼Œpulsarç­‰å¤šä¸ªæ¶ˆæ¯ä¸­é—´ä»¶å»åˆ†æã€‚
RabbitMqå¾—çœ‹æ˜¯ä»€ä¹ˆæ¨¡å¼ï¼Œå¦‚æœæ˜¯ç”Ÿäº§æ¶ˆè´¹è€…æ¨¡å¼æ˜¯å¯ä»¥çš„ï¼Œå‘å¸ƒè®¢é˜…æ¨¡å¼å°±æ²¡åµç”¨ï¼ŒåŠ ä¸ªè®¢é˜…è€…è€Œå·²ã€‚kafkaçœ‹consumerçš„æ•°é‡å§ï¼Œå¦‚æœå·²ç»å¤§äºç­‰äºpartitionæ•°é‡äº†ï¼ŒåŠ consumerä¹Ÿæ²¡åµç”¨ã€‚pulsar
æ˜¯ä¹Ÿä¸€æ ·å•Šï¼Œæœ‰ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ï¼Œä¹Ÿæœ‰ç‹¬å å’Œå¤±è´¥æ›¿è¡¥æ¨¡å¼ã€‚&lt;/p>
&lt;p>å¯¹çš„ï¼Œå…ˆè¯´kafkaå’ŒRocketMQï¼Œä»–ä»¬éƒ½æ˜¯åŸºäºpartitionçš„å­˜å‚¨æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªsubjectåˆ†ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªpartitionï¼ŒServeræ”¶åˆ°æ¶ˆæ¯åˆ†å‘åˆ°æŸä¸ªpartitionä¸Šï¼Œè€Œconsumer
æ¶ˆè´¹æ—¶å€™æ˜¯ä¸partitionç›¸å¯¹åº”çš„ï¼Œå½“partitionä¸consumeræ•°é‡ç›¸ç­‰æ—¶ï¼Œæ˜¯ä¸€å¯¹ä¸€ï¼Œå½“å°äºæ—¶å€™ï¼Œä¼šæœ‰consumerç©ºé—²ï¼Œå¤§äºæ—¶å€™ï¼Œçœ‹æ•°é‡ï¼Œæœ‰consumer
ä¼šè´Ÿè´£å¤šä¸ªï¼Œæ¯”è¾ƒç¹å¿™ã€‚åœ¨äº§ç”Ÿé˜Ÿåˆ—ç§¯å‹æ—¶å€™ï¼Œè¿™æ—¶å€™æœ€åˆç†çš„åˆ†é…å‡å‹ç­–ç•¥æ˜¯ partitionæ•°é‡å’Œconsumeræ•°é‡æˆå€æ•°å…³ç³»ï¼Œå•ä¸ªå¢åŠ consumer
æ•°é‡å¹¶ä¸èƒ½æœ‰æ•ˆæé«˜æ—¶å€™ï¼Œå¹¶ä¸”å¹¶ä¸èƒ½é©¬ä¸Šæé«˜æ¶ˆè´¹æ•ˆç‡ï¼Œéœ€è¦æ·»åŠ å¯¹åº”çš„partitionæ•°é‡ï¼Œä½†æ˜¯å°±å¸¦æ¥äº†å¦å¤–çš„é—®é¢˜ï¼Œpartitionæ•°é‡å¢åŠ ï¼Œç‰¹åˆ«æ˜¯kafkaï¼Œpartitionèµ„æºæ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡çš„èµ„æºï¼Œå¢åŠ partition
æ•°é‡è¿˜éœ€è¦è€ƒè™‘é›†ç¾¤çš„å¤„ç†èƒ½åŠ›ï¼Œå¦å¤–åœ¨é«˜å³°è¿‡åï¼Œæƒ³è¦consumerç¼©å®¹ä¹Ÿæ¯”è¾ƒéº»çƒ¦å“¦ï¼Œå› ä¸ºpartitionåªèƒ½å¢åŠ ä¸èƒ½å‡å°‘ã€‚&lt;/p>
&lt;p>é’ˆå¯¹partitionå­˜å‚¨æ–¹å¼çš„ï¼Œæ‰©å®¹ç›¸å…³çš„é—®é¢˜ï¼Œå·²ç»å †ç§¯çš„æ¶ˆæ¯æ˜¯ä¸èƒ½å¿«é€Ÿæ¶ˆè´¹çš„ï¼Œå‡è®¾æ˜¯2partitionå¯¹2ä¸ªconsumerï¼Œè¿™æ—¶å€™å¢åŠ partitionå’Œconsumeræ˜¯æ— ç”¨çš„ï¼Œå› ä¸ºå·²ç»å †ç§¯çš„åªèƒ½ç”±è¿™ä¸¤ä¸ªconsumer
æ¶ˆè´¹ï¼Œæ¨ªå‘æ‰©å±•ä¸å¯èƒ½äº†ï¼Œåªèƒ½çºµå‘æ‰©å±•ï¼Œè¿™æ—¶å€™è¦ä¹ˆåªèƒ½æ¥å—å·²ç»å †ç§¯æ…¢æ…¢æ¶ˆè´¹ï¼Œå¹¶ä¸”å°½é‡å‡å°‘å…¥è¿™ä¸¤ä¸ªpartitionçš„æ¶ˆæ¯ï¼Œæˆ–è€…æ‰§è¡Œæ¯”è¾ƒé‡ç‚¹å†å‡è¡¡ç­–ç•¥ï¼&lt;/p>
&lt;/blockquote>
&lt;h2 id="2019-11-18-æ¯æ—¥ä¸€æ€-httpdnsæœ‰å•¥å¥½å¤„-httpdns-ä¸ºä»€ä¹ˆä¸€èˆ¬åªé€‚ç”¨äº-app-æˆ–è€…-cs-æ¶æ„bs-ä¸ºä½•ä¸é€‚ç”¨">[2019-11-18 æ¯æ—¥ä¸€æ€] HttpDNSæœ‰å•¥å¥½å¤„, HttpDNS ä¸ºä»€ä¹ˆä¸€èˆ¬åªé€‚ç”¨äº APP æˆ–è€… C/S æ¶æ„ï¼ŒB/S ä¸ºä½•ä¸é€‚ç”¨?#&lt;/h2>
&lt;blockquote>
&lt;p>HttpDNS æ˜¯åŸºäºHTTPåè®®å‘èµ·æœåŠ¡å™¨Aè®°å½•çš„åœ°å€ï¼Œä¸å­˜åœ¨å‘æœ¬åœ°è¿è¥å•†è¯¢é—® domain è§£æè¿‡ç¨‹
é€‚ç”¨äºAPPæˆ–è€…C/Sæ¶æ„ï¼Œæ˜¯å®ƒçš„ç‰¹æ®Šæ€§å¯¼è‡´çš„ï¼Œ&lt;/p>
&lt;ul>
&lt;li>ä¸€èˆ¬åœ¨ç»ˆç«¯è¿™ç§ä¿¡å·å·®ã€ä¿¡å·ä¸ç¨³å®šä¸‹ï¼Œè¦æƒ³å°½é‡çš„ä»‹ç»äº¤äº’&lt;/li>
&lt;li>è·‘é©¬æœºåˆ¶é€‰å–å°±è¿‘åœ°å€&lt;/li>
&lt;li>SDKåµŒå…¥&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h2 id="2019-12-12-æ¯æ—¥ä¸€æ€æˆ‘ä»¬çŸ¥é“è®¸å¤šé•¿é“¾æ¥æƒ…å†µä¸‹ä¿è¯é“¾æ¥æœ‰æ•ˆå¤§éƒ¨åˆ†æ˜¯é€šè¿‡-tcp-keepalive-ä¸-åº”ç”¨å¿ƒè·³-æ¥ç¡®å®šå„è‡ªçš„å®šä½æ˜¯ä»€ä¹ˆä¸ºä»€ä¹ˆå¤§å¤šæ•°æƒ…å†µä¸‹å¾ˆå¤šimç³»ç»ŸåŒæ—¶ä½¿ç”¨-tcp-keepalive-ä¸-åº”ç”¨å±‚å¿ƒè·³å»ç¡®è®¤-åº”ç”¨å±‚å¿ƒè·³è®¾è®¡ä¸Šæœ‰å•¥è®²ç©¶">[2019-12-12 æ¯æ—¥ä¸€æ€]æˆ‘ä»¬çŸ¥é“è®¸å¤šé•¿é“¾æ¥æƒ…å†µä¸‹ï¼Œä¿è¯é“¾æ¥æœ‰æ•ˆå¤§éƒ¨åˆ†æ˜¯é€šè¿‡ TCP Keepalive ä¸ åº”ç”¨å¿ƒè·³ æ¥ç¡®å®šï¼Œå„è‡ªçš„å®šä½æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆå¤§å¤šæ•°æƒ…å†µä¸‹å¾ˆå¤šIMç³»ç»ŸåŒæ—¶ä½¿ç”¨ TCP Keepalive ä¸ åº”ç”¨å±‚å¿ƒè·³å»ç¡®è®¤ï¼Ÿ åº”ç”¨å±‚å¿ƒè·³è®¾è®¡ä¸Šæœ‰å•¥è®²ç©¶ï¼Ÿ&lt;/h2>
&lt;blockquote>
&lt;p>TCP Keepalive æ˜¯ TCP/IP åè®®è‡ªå¸¦ï¼Œæ— éœ€é¢å¤–çš„å¼€å‘ï¼Œä½†æ˜¯ä¸çµæ´»ï¼Œè€Œä¸”æˆ‘ä»¬ä¸€èˆ¬åœ¨åº”ç”¨å±‚é¢æ˜¯æ— æ³•æ„ŸçŸ¥ã€‚æ›´æ”¹TCP Keepalive ç›¸å…³å‚æ•°éœ€è¦ä¿®æ”¹/etc/sysctl.conf&lt;/p>
&lt;p>åº”ç”¨å±‚å¿ƒè·³æ˜¯ä¸ºäº†ä¿æ´»ï¼Œä¿è¯é“¾æ¥çš„å¯ç”¨æ€§&lt;/p>
&lt;ul>
&lt;li>è¿è¥å•†çš„ç¯å¢ƒï¼Œï¼Œå­˜åœ¨ NAT è¶…æ—¶æ–­é“¾é—®é¢˜&lt;/li>
&lt;li>è®©åº”ç”¨çŸ¥æ™“ç½‘ç»œå¯ç”¨æƒ…å†µï¼Œé…Œæƒ…å¤„ç†æ–­é“¾é‡è¿é—®é¢˜&lt;/li>
&lt;li>å¯ä»¥æœ‰æ•ˆçš„æ±Ÿéƒ½æœåŠ¡ç«¯ä¸ºäº†ç»´æŠ¤æ— æ•ˆé“¾æ¥çš„å¼€é”€&lt;/li>
&lt;/ul>
&lt;p>åº”ç”¨å±‚å¿ƒè·³è®¾è®¡ä¸Š&lt;/p>
&lt;ul>
&lt;li>å›ºå®šé¢‘ç‡ï¼Œé€šå¸¸åªæœ‰è¯·æ±‚å¤´ï¼Œæ¶ˆæ¯ä½“ç©ºåŒ…ï¼ˆåœ¨åˆ¤æ–­è¿™ç±»å¿ƒè·³å¤„ç†æ—¶å€™ï¼Œå®¢æˆ·ç«¯ä¸€èˆ¬è¦åˆ¤æ–­è¶…æ—¶æ—¶é—´å¤§äºå¿ƒè·³é—´éš”ã€å¯èƒ½å­˜åœ¨ç½‘ç»œå»¶è¿Ÿã€‘ï¼‰&lt;/li>
&lt;li>æ™ºèƒ½å¿ƒè·³ï¼Œæ ¹æ®ç½‘ç»œçŠ¶å†µè‡ªåŠ¨è°ƒæ•´å‘é€çš„é¢‘ç‡ï¼Œæ¥é€‚é…å½“å‰ç½‘ç»œæƒ…å†µçš„æœ€ä½³å¿ƒè·³é¢‘ç‡ï¼ˆå„ä¸ªåœ°åŒºå„ä¸ªæœåŠ¡å•† NAT è¶…æ—¶è®¾è®¡ä¸ä¸€æ ·ï¼Œé•¿çš„å¤šè¾¾å‡ ä¸ªå°æ—¶ï¼Œå°‘çš„åªæœ‰å‡ ç§’ï¼‰&lt;/li>
&lt;/ul>
&lt;p>æ™ºèƒ½å¿ƒè·³ï¼Œä¸€èˆ¬é‡‡ç”¨äºŒåˆ†æ³•æ¥é€æ¸é€¼è¿‘æœåŠ¡å•†çš„ NAT è¶…æ—¶è®¾è®¡ã€‚å¿ƒè·³è®¾è®¡ä¸Šä¸ä¼šæ˜¯ç©ºåŒ…ï¼Œè€Œæ˜¯ä¼ è¾“çš„æ˜¯å®¢æˆ·ç«¯çš„å¿ƒè·³é¢‘ç‡æ˜¯å¤šå°‘ã€‚
ï¼ˆå‡è®¾ æœ€å°å€¼ 20 s æœ€å¤§å€¼ 1å°æ—¶ï¼‰===&amp;gt; é€æ¸äºŒåˆ†ä¸‹å»&lt;/p>
&lt;/blockquote>
&lt;h2 id="2019-12-14-æ¯æ—¥ä¸€æ€-å¦‚ä½•åˆ¤æ–­ä»»æ„ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶åœ¨æœåŠ¡ç«¯æ˜¯å¦å­˜åœ¨å‘¢ç½‘ç›˜çš„ç§’ä¼ çš„å®ç°æ€è·¯">[2019-12-14 æ¯æ—¥ä¸€æ€] å¦‚ä½•åˆ¤æ–­ä»»æ„ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶åœ¨æœåŠ¡ç«¯æ˜¯å¦å­˜åœ¨å‘¢ï¼Ÿç½‘ç›˜çš„â€œç§’ä¼ â€çš„å®ç°æ€è·¯ï¼Ÿ&lt;/h2>
&lt;blockquote>
&lt;p>å¯¹æ¯”æ–‡ä»¶ï¼Œç¡®å®æ˜¯ä½¿ç”¨çš„æ–‡ä»¶çš„æå–çš„ç‰¹å¾å€¼ï¼ˆå•é¡¹å“ˆå¸Œç®—æ³•ï¼‰,å“ˆå¸Œç®—æ³•æ˜¯æœ‰å†²çªçš„ï¼Œè™½ç„¶æ¦‚ç‡è¾ƒå°ï¼Œ é‚£ä¹ˆå¦‚ä½•è¿™ç§å†²çªå‘¢ï¼šåœ¨æœåŠ¡ç«¯ï¼Œ
å¯¹è¯¥æ–‡ä»¶è¿›è¡Œä¸åŒçš„å•å‘Hashç®—æ³•ï¼ˆMD5ï¼ŒSHA-1ï¼‰ç­‰ç­‰å¾—åˆ°å¤šä¸ªå€¼ï¼Œä¸€ä¸€å¯¹æ¯”ï¼Œåªæœ‰å…¨éƒ¨ç›¸åŒæ‰è®¤ä¸ºæ˜¯åŒä¸€ä¸ªæ–‡ä»¶ã€‚&lt;/p>
&lt;p>ä¸ºä»€ä¹ˆè¦å“ˆå¸Œï¼Ÿä¸ºäº†å°†ä¸€ä¸ªä¸å®šé•¿ã€ä¸ç¡®å®šçš„ä¸œä¸œ è½¬åŒ–æˆ å›ºå®šé•¿åº¦çš„å›ºåŒ–çš„ç‰¹å¾å€¼ï¼Œå¹¶è¦ä¿è¯å”¯ä¸€æ€§ã€‚&lt;/p>
&lt;/blockquote>
&lt;h1 id="å¡«å‘è®°å½•">å¡«å‘è®°å½•&lt;/h1>
&lt;h2 id="dockerç›¸å…³">dockerç›¸å…³&lt;/h2>
&lt;ul>
&lt;li>dockeré»˜è®¤ç½‘æ¡¥é—®é¢˜&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>æœåŠ¡å™¨é»˜è®¤ç½‘æ¡¥ 172.19.0.0, è€Œ docker ç½‘æ¡¥é»˜è®¤172.17.0.0,
åœ¨å¯åŠ¨å¤šä¸ªçš„dockerå®¹å™¨çš„æ—¶å€™ä¼šå¯¼è‡´åœ°å€å†²çªï¼Œæ¡¥æ¥ç½‘å¡å‡‰ï¼Œ
éœ€è¦æ›´æ”¹docker é»˜è®¤çš„ç½‘æ¡¥åœ°å€&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-markdown" data-lang="markdown"> {
&amp;#34;debug&amp;#34; : true,
&amp;#34;default-address-pools&amp;#34; : [
{
&amp;#34;base&amp;#34; : &amp;#34;172.31.0.0/16&amp;#34;,
&amp;#34;size&amp;#34; : 24
}
]
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ›´æ”¹æˆå’Œä¸»æœºä¸ä¸€æ ·çš„çš„ç½‘æ®µåœ°å€&lt;/p>
&lt;/blockquote>
&lt;h2 id="redisåˆ†å¸ƒå¼é”">redisåˆ†å¸ƒå¼é”&lt;/h2>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">
&lt;span style="color:#8b008b;font-weight:bold">package&lt;/span> &lt;span style="color:#008b45;text-decoration:underline">com.kezaihui.thor.biz.core.adapter.redis.lock&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">import&lt;/span> &lt;span style="color:#008b45;text-decoration:underline">lombok.extern.slf4j.Slf4j&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">import&lt;/span> &lt;span style="color:#008b45;text-decoration:underline">org.springframework.beans.factory.annotation.Autowired&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">import&lt;/span> &lt;span style="color:#008b45;text-decoration:underline">org.springframework.data.redis.core.RedisTemplate&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">import&lt;/span> &lt;span style="color:#008b45;text-decoration:underline">org.springframework.data.redis.core.script.DefaultRedisScript&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">import&lt;/span> &lt;span style="color:#008b45;text-decoration:underline">org.springframework.stereotype.Component&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">import&lt;/span> &lt;span style="color:#008b45;text-decoration:underline">java.util.Collections&lt;/span>;
&lt;span style="color:#228b22">/**
&lt;/span>&lt;span style="color:#228b22"> * RedisTemplateDistributeLockUtil
&lt;/span>&lt;span style="color:#228b22"> */&lt;/span>
&lt;span style="color:#707a7c">@Slf4j&lt;/span>
&lt;span style="color:#707a7c">@Component&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">RedisTemplateDistributeLockUtil&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">final&lt;/span> String LOCK_SCRIPT =
&lt;span style="color:#cd5555">&amp;#34;local key = KEYS[1]; local value = ARGV[1]; if redis.call(&amp;#39;set&amp;#39;, key, value, &amp;#39;NX&amp;#39; ,&amp;#39;PX&amp;#39;, %d) &amp;#34;&lt;/span>
+ &lt;span style="color:#cd5555">&amp;#34;then return 1 else return 0 end&amp;#34;&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">final&lt;/span> String UNLOCK_SCRIPT =
&lt;span style="color:#cd5555">&amp;#34;if redis.call(&amp;#39;get&amp;#39;, KEYS[1]) == ARGV[1] then return redis.call(&amp;#39;del&amp;#39;,KEYS[1]) else return 0 end&amp;#34;&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">final&lt;/span> &lt;span style="color:#00688b;font-weight:bold">int&lt;/span> EXPIRE = 5000;
&lt;span style="color:#707a7c">@Autowired&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> RedisTemplate redisTemplate;
&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> String &lt;span style="color:#008b45">lockExpireScript&lt;/span>(&lt;span style="color:#00688b;font-weight:bold">int&lt;/span> expireMills) {
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> (expireMills &amp;lt;= 0) {
expireMills = EXPIRE;
}
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> String.&lt;span style="color:#658b00">format&lt;/span>(LOCK_SCRIPT, expireMills);
}
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">boolean&lt;/span> &lt;span style="color:#008b45">lock&lt;/span>(String key, String value, &lt;span style="color:#00688b;font-weight:bold">int&lt;/span> expireMills) {
String script = lockExpireScript(expireMills);
DefaultRedisScript&amp;lt;Long&amp;gt; redisScript = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> DefaultRedisScript&amp;lt;&amp;gt;(script, Long.&lt;span style="color:#658b00">class&lt;/span>);
Long execute = (Long) redisTemplate.&lt;span style="color:#658b00">execute&lt;/span>(redisScript, Collections.&lt;span style="color:#658b00">singletonList&lt;/span>(key),
Collections.&lt;span style="color:#658b00">singletonList&lt;/span>(value));
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> execute != &lt;span style="color:#8b008b;font-weight:bold">null&lt;/span> &amp;amp;&amp;amp; execute != 0;
}
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">boolean&lt;/span> &lt;span style="color:#008b45">blockLock&lt;/span>(String key, String value, &lt;span style="color:#00688b;font-weight:bold">int&lt;/span> expireMills) &lt;span style="color:#8b008b;font-weight:bold">throws&lt;/span> DistributeLockTimeoutException {
&lt;span style="color:#228b22">// è¢«é˜»å¡çš„æ—¶é—´è¶…è¿‡5ç§’å°±åœæ­¢è·å–é”
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#00688b;font-weight:bold">int&lt;/span> blockTime = expireMills;
&lt;span style="color:#228b22">// é»˜è®¤çš„é—´éš”æ—¶é—´
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> (; ; ) {
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> (blockTime &amp;gt;= 0) {
String script = lockExpireScript(expireMills);
DefaultRedisScript&amp;lt;Long&amp;gt; redisScript = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> DefaultRedisScript&amp;lt;&amp;gt;(script, Long.&lt;span style="color:#658b00">class&lt;/span>);
Long result = (Long) redisTemplate.&lt;span style="color:#658b00">execute&lt;/span>(redisScript, Collections.&lt;span style="color:#658b00">singletonList&lt;/span>(key), value);
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> (result != &lt;span style="color:#8b008b;font-weight:bold">null&lt;/span> &amp;amp;&amp;amp; result == 1) {
&lt;span style="color:#228b22">// å¾—åˆ°äº†é”
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>;
} &lt;span style="color:#8b008b;font-weight:bold">else&lt;/span> {
blockTime -= 300;
&lt;span style="color:#8b008b;font-weight:bold">try&lt;/span> {
Thread.&lt;span style="color:#658b00">sleep&lt;/span>(300);
} &lt;span style="color:#8b008b;font-weight:bold">catch&lt;/span> (InterruptedException e) {
log.&lt;span style="color:#658b00">error&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;RedisTemplateDistributeLockUtil.blockLock error!&amp;#34;&lt;/span>, e);
}
}
} &lt;span style="color:#8b008b;font-weight:bold">else&lt;/span> {
&lt;span style="color:#228b22">// å·²ç»è¶…æ—¶
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">throw&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> DistributeLockTimeoutException(&lt;span style="color:#cd5555">&amp;#34;Distribute Lock Timeout&amp;#34;&lt;/span>);
}
}
}
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">boolean&lt;/span> &lt;span style="color:#008b45">unlock&lt;/span>(String key, String value) {
String script = UNLOCK_SCRIPT;
DefaultRedisScript&amp;lt;Long&amp;gt; redisScript = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> DefaultRedisScript&amp;lt;&amp;gt;(script, Long.&lt;span style="color:#658b00">class&lt;/span>);
Long execute = (Long) redisTemplate.&lt;span style="color:#658b00">execute&lt;/span>(redisScript, Collections.&lt;span style="color:#658b00">singletonList&lt;/span>(key), value);
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> execute != &lt;span style="color:#8b008b;font-weight:bold">null&lt;/span> &amp;amp;&amp;amp; execute != 0;
}
}
&lt;/code>&lt;/pre>&lt;/div>- https://pinkhello.github.io/posts/14-%E5%B7%A5%E4%BD%9C%E7%BA%AA%E5%AE%9E2020/ - ä¸€æ¯å“ˆå¸Œä¸åŠ ç›, All Rights Reserved</description></item><item><title>13 Kafkaä¸Debeziumæ„å»ºCDCç®¡é“</title><link>https://pinkhello.github.io/posts/13-kafka%E4%B8%8Edebezium%E6%9E%84%E5%BB%BAcdc%E7%AE%A1%E9%81%93/</link><pubDate>Wed, 10 Feb 2021 09:53:51 +0800</pubDate><guid>https://pinkhello.github.io/posts/13-kafka%E4%B8%8Edebezium%E6%9E%84%E5%BB%BAcdc%E7%AE%A1%E9%81%93/</guid><description>ä¸€æ¯å“ˆå¸Œä¸åŠ ç› https://pinkhello.github.io/posts/13-kafka%E4%B8%8Edebezium%E6%9E%84%E5%BB%BAcdc%E7%AE%A1%E9%81%93/ -&lt;h1 id="å»ºè®¾ç¯‡">å»ºè®¾ç¯‡&lt;/h1>
&lt;h2 id="1ä»€ä¹ˆæ˜¯-debezium">1ã€ä»€ä¹ˆæ˜¯ debezium?&lt;/h2>
&lt;p>&lt;a href="https://debezium.io/">https://debezium.io/&lt;/a>&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>Tutorial
&lt;a href="https://debezium.io/documentation/reference/1.3/tutorial.html">https://debezium.io/documentation/reference/1.3/tutorial.html&lt;/a>&lt;/p>
&lt;h2 id="2debezium-å¦‚ä½•å·¥ä½œçš„">2ã€Debezium å¦‚ä½•å·¥ä½œçš„&lt;/h2>
&lt;p>&lt;img src="https://pinkhello.github.io/Kafka%E4%B8%8EDebezium%E6%9E%84%E5%BB%BACDC%E7%AE%A1%E9%81%93/debezium-architecture.png" alt="Debeziumå·¥ä½œæµç¨‹">&lt;/p>
&lt;h3 id="21-debezium-æ”¯æŒçš„æ•°æ®åº“ç±»å‹">2.1 Debezium æ”¯æŒçš„æ•°æ®åº“ç±»å‹&lt;/h3>
&lt;ul>
&lt;li>MySQL&lt;/li>
&lt;li>MongoDB&lt;/li>
&lt;li>PostgreSQL&lt;/li>
&lt;li>Oracle&lt;/li>
&lt;li>SQL Server&lt;/li>
&lt;li>Db2&lt;/li>
&lt;li>Cassandra&lt;/li>
&lt;/ul>
&lt;h3 id="22-debezium-ä¸‰ç§æ–¹å¼è¿è¡Œ">2.2 Debezium ä¸‰ç§æ–¹å¼è¿è¡Œ&lt;/h3>
&lt;ul>
&lt;li>Kafka Connect&lt;/li>
&lt;li>Debezium Server&lt;/li>
&lt;li>Embedded Engine&lt;/li>
&lt;/ul>
&lt;p>&lt;a href="https://github.com/debezium/debezium-examples/tree/master/kinesis">https://github.com/debezium/debezium-examples/tree/master/kinesis&lt;/a>&lt;/p>
&lt;h2 id="3åœ¨-k8s-ä¸­æ„å»ºåŸºç¡€debeziumé›†ç¾¤ç¯å¢ƒ">3ã€åœ¨ K8S ä¸­æ„å»ºåŸºç¡€Debeziumé›†ç¾¤ç¯å¢ƒ&lt;/h2>
&lt;p>é•œåƒå‡†å¤‡&lt;/p>
&lt;ul>
&lt;li>kafka | debezium &lt;a href="https://hub.docker.com/r/debezium/kafka">https://hub.docker.com/r/debezium/kafka&lt;/a>&lt;/li>
&lt;li>zookeeper | debezium &lt;a href="https://hub.docker.com/r/debezium/zookeeper">https://hub.docker.com/r/debezium/zookeeper&lt;/a>&lt;/li>
&lt;li>connect | debezium &lt;a href="https://hub.docker.com/r/debezium/connect">https://hub.docker.com/r/debezium/connect&lt;/a>&lt;/li>
&lt;li>schema-registry | confluentinc &lt;a href="https://hub.docker.com/r/confluentinc/cp-schema-registry">https://hub.docker.com/r/confluentinc/cp-schema-registry&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>psï¼š
debezium å‚è€ƒåœ°å€ &lt;a href="https://github.com/debezium/docker-images">https://github.com/debezium/docker-images&lt;/a>
confluentinc å‚è€ƒåœ°å€ &lt;a href="https://github.com/confluentinc/cp-all-in-one/tree/latest/cp-all-in-one">https://github.com/confluentinc/cp-all-in-one/tree/latest/cp-all-in-one&lt;/a>&lt;/p>
&lt;h3 id="31-k8såŸºç¡€çŸ¥è¯†">3.1 K8SåŸºç¡€çŸ¥è¯†&lt;/h3>
&lt;ul>
&lt;li>kafka ä¸ zookeeper å»ºè®¾ä¸º stateful çŠ¶æ€é›†ç¾¤&lt;/li>
&lt;li>schema-registry ä¸»è¦ä¸ºäº† æ”¯æŒ avro æ ¼å¼è¿™äº›ä¸éœ€è¦å†™åˆ° kafka æ¶ˆæ¯å¤´é‡Œé¢ï¼Œå‡å°‘æ¶ˆæ¯çš„å¤§å°ï¼Œé¢å¤–çš„æœåŠ¡ï¼Œå±äº kafka ç”Ÿæ€ï¼Œå­˜å‚¨ä¾èµ– kafka brokerä¿è¯ç¨³å®šæ€§ã€‚&lt;/li>
&lt;li>k8s steteful é›†ç¾¤ 0&amp;hellip;~ n ä¸ª POD&lt;/li>
&lt;li>zookeeper é‡Œé¢ zoo.cfg æŒ‡å®šçš„æ˜¯ä» 1 å¼€å§‹&lt;/li>
&lt;li>kafka é‡Œé¢ broker ä¹Ÿæ˜¯ä» 1 å¼€å§‹&lt;/li>
&lt;/ul>
&lt;h3 id="32-zookeeper-æ„å»º">3.2 zookeeper æ„å»º&lt;/h3>
&lt;ul>
&lt;li>å¯¹åº”çš„ docker-entrypoint.sh éœ€è¦æ”¹å†™ï¼Œæ³¨é‡ zoo.cfg çš„ç”Ÿæˆ&lt;/li>
&lt;li>å¼€æ”¾ 2888 ç«¯å£ 3888 ç«¯å£ 2181 ç«¯å£&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#228b22"># ä½¿ç”¨çš„ debezium zk é•œåƒ&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#228b22"># https://github.com/debezium/docker-images/blob/master/zookeeper/1.4/README.md&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Service&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>zookeeper-hs&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>zookeeper&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">ports&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">port&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">2888&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>server&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">port&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">3888&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>leader-election&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">port&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">2181&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>client&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">clusterIP&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>None&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">selector&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>zookeeper&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#008b45;text-decoration:underline">---&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>apps/v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>StatefulSet&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>zookeeper&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">selector&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">matchLabels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>zookeeper&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">serviceName&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>zookeeper-hs&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">replicas&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">3&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">updateStrategy&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">type&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>RollingUpdate&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">podManagementPolicy&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>OrderedReady&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">template&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>zookeeper&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">affinity&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">podAntiAffinity&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">requiredDuringSchedulingIgnoredDuringExecution&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">labelSelector&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">matchExpressions&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">key&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;app&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">operator&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>In&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">values&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- zookeeper&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">topologyKey&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;kubernetes.io/hostname&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">securityContext&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">fsGroup&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">1000&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">runAsUser&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">1000&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">containers&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>zookeeper&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">imagePullPolicy&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Always&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">image&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>debezium/zookeeper:1.3&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">ports&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">containerPort&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">2181&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>client&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">containerPort&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">2888&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>server&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">containerPort&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">3888&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>leader-election&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">resources&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">requests&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">cpu&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>50m&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">memory&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>1500Mi&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">command&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- bash&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- -ec&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- |&lt;span style="color:#cd5555">
&lt;/span>&lt;span style="color:#cd5555"> if [ ! -d &amp;#34;/zookeeper/zdata/data&amp;#34; ];then
&lt;/span>&lt;span style="color:#cd5555"> mkdir /zookeeper/zdata/data
&lt;/span>&lt;span style="color:#cd5555"> fi
&lt;/span>&lt;span style="color:#cd5555"> if [ ! -d &amp;#34;/zookeeper/zdata/txns&amp;#34; ];then
&lt;/span>&lt;span style="color:#cd5555"> mkdir /zookeeper/zdata/txns
&lt;/span>&lt;span style="color:#cd5555"> fi
&lt;/span>&lt;span style="color:#cd5555"> export INDEX=${HOSTNAME##*-}
&lt;/span>&lt;span style="color:#cd5555"> echo $INDEX
&lt;/span>&lt;span style="color:#cd5555"> export SERVER_ID=$(( INDEX + 1 ))
&lt;/span>&lt;span style="color:#cd5555"> export SERVER_COUNT=3
&lt;/span>&lt;span style="color:#cd5555"> export LOG_LEVEL=INFO
&lt;/span>&lt;span style="color:#cd5555"> cp -rn $ZK_HOME/conf.orig/* $ZK_HOME/conf
&lt;/span>&lt;span style="color:#cd5555"> sed -i -r -e &amp;#34;s|\\$\\{zookeeper.root.logger\\}|$LOG_LEVEL, CONSOLE|g&amp;#34; $ZK_HOME/conf/log4j.properties
&lt;/span>&lt;span style="color:#cd5555"> sed -i -r -e &amp;#34;s|\\$\\{zookeeper.console.threshold\\}|$LOG_LEVEL|g&amp;#34; $ZK_HOME/conf/log4j.properties
&lt;/span>&lt;span style="color:#cd5555"> echo &amp;#34;&amp;#34; &amp;gt;&amp;gt; $ZK_HOME/conf/zoo.cfg
&lt;/span>&lt;span style="color:#cd5555"> echo &amp;#34;#Server List&amp;#34; &amp;gt;&amp;gt; $ZK_HOME/conf/zoo.cfg
&lt;/span>&lt;span style="color:#cd5555"> for i in $( eval echo {1..$SERVER_COUNT});do
&lt;/span>&lt;span style="color:#cd5555"> export HS_INDEX=$((i - 1))
&lt;/span>&lt;span style="color:#cd5555"> if [ &amp;#34;$SERVER_ID&amp;#34; = &amp;#34;$i&amp;#34; ];then
&lt;/span>&lt;span style="color:#cd5555"> echo &amp;#34;server.$i=0.0.0.0:2888:3888&amp;#34; &amp;gt;&amp;gt; $ZK_HOME/conf/zoo.cfg
&lt;/span>&lt;span style="color:#cd5555"> else
&lt;/span>&lt;span style="color:#cd5555"> echo &amp;#34;server.$i=zookeeper-$HS_INDEX.zookeeper-hs:2888:3888&amp;#34; &amp;gt;&amp;gt; $ZK_HOME/conf/zoo.cfg
&lt;/span>&lt;span style="color:#cd5555"> fi
&lt;/span>&lt;span style="color:#cd5555"> done
&lt;/span>&lt;span style="color:#cd5555"> echo ${SERVER_ID} &amp;gt; $ZK_HOME/zdata/data/myid
&lt;/span>&lt;span style="color:#cd5555"> sed -i &amp;#34;s|/zookeeper/data|/zookeeper/zdata/data|g&amp;#34; $ZK_HOME/conf/zoo.cfg
&lt;/span>&lt;span style="color:#cd5555"> sed -i &amp;#34;s|/zookeeper/txns|/zookeeper/zdata/txns|g&amp;#34; $ZK_HOME/conf/zoo.cfg
&lt;/span>&lt;span style="color:#cd5555"> export ZOOCFGDIR=&amp;#34;$ZK_HOME/conf&amp;#34;
&lt;/span>&lt;span style="color:#cd5555"> export ZOOCFG=&amp;#34;zoo.cfg&amp;#34;
&lt;/span>&lt;span style="color:#cd5555"> exec $ZK_HOME/bin/zkServer.sh start-foreground&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">volumeMounts&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>zk-data&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">mountPath&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>/zookeeper/zdata&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">volumeClaimTemplates&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>zk-data&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">accessModes&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>[&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;ReadWriteOnce&amp;#34;&lt;/span>&lt;span style="color:#bbb"> &lt;/span>]&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">storageClassName&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>alicloud-disk-efficiency&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">resources&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">requests&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">storage&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>20Gi&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#008b45;text-decoration:underline">---&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Service&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>zookeeper-hs&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>zookeeper&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">ports&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">port&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">2888&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>server&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">port&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">3888&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>leader-election&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">port&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">2181&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>client&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">clusterIP&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>None&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">selector&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>zookeeper&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å‚è€ƒæ–‡æ¡£ &lt;a href="https://github.com/debezium/docker-images/blob/master/zookeeper/1.3/README.md">https://github.com/debezium/docker-images/blob/master/zookeeper/1.3/README.md&lt;/a>&lt;/p>
&lt;h3 id="33-kafka-æ„å»º">3.3 kafka æ„å»º&lt;/h3>
&lt;ul>
&lt;li>Kafka BrokerID è¦å˜æ›´ï¼Œé€šè¿‡ POD çš„ Index&lt;/li>
&lt;li>KAFKA_LISTENERS ä¸ KAFKA_ADVERTISED_LISTENERS çš„é…ç½®&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>apps/v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>StatefulSet&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">selector&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">matchLabels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">serviceName&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">replicas&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">3&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">updateStrategy&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">type&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>RollingUpdate&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">podManagementPolicy&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>OrderedReady&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">template&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">affinity&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">podAntiAffinity&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">requiredDuringSchedulingIgnoredDuringExecution&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">labelSelector&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">matchExpressions&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">key&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;app&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">operator&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>In&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">values&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- kafka&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">topologyKey&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;kubernetes.io/hostname&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">securityContext&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">fsGroup&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">1000&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">runAsUser&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">1000&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">containers&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">imagePullPolicy&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Always&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">image&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>debezium/kafka:1.3&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">ports&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">containerPort&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">9092&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">containerPort&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">9093&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">resources&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">requests&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">cpu&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>100m&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">memory&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>1500Mi&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">env&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>ZOOKEEPER_CONNECT&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;zookeeper-0.zookeeper-hs:2181,zookeeper-1.zookeeper-hs:2181,zookeeper-2.zookeeper-hs:2181&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>LOG_LEVEL&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;INFO&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;2&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>KAFKA_LISTENER_SECURITY_PROTOCOL_MAP&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;PLAINTEXT:PLAINTEXT,EXTERNAL_PLAINTEXT:PLAINTEXT&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>KAFKA_INTER_BROKER_LISTENER_NAME&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;PLAINTEXT&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>KAFKA_LISTENERS&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;PLAINTEXT://0.0.0.0:9092,EXTERNAL_PLAINTEXT://0.0.0.0:9093&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>POD_IP&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">valueFrom&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">fieldRef&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">fieldPath&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>status.podIP&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">command&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- bash&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- -ec&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- |&lt;span style="color:#cd5555">
&lt;/span>&lt;span style="color:#cd5555"> export INDEX=${HOSTNAME##*-}
&lt;/span>&lt;span style="color:#cd5555"> export BROKER_ID=$((INDEX + 1))
&lt;/span>&lt;span style="color:#cd5555"> PORT=$((INDEX + 9093))
&lt;/span>&lt;span style="color:#cd5555"> export JMX_PORT=$((INDEX + 9999))
&lt;/span>&lt;span style="color:#cd5555"> export KAFKA_ADVERTISED_LISTENERS=&amp;#34;PLAINTEXT://${POD_IP}:9092,EXTERNAL_PLAINTEXT://${LB_IP}:${PORT}&amp;#34;
&lt;/span>&lt;span style="color:#cd5555"> exec /docker-entrypoint.sh start&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">volumeMounts&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-data&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">mountPath&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>/kafka/data&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">volumeClaimTemplates&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-data&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">accessModes&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>[&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;ReadWriteOnce&amp;#34;&lt;/span>&lt;span style="color:#bbb"> &lt;/span>]&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">storageClassName&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>alicloud-disk-efficiency&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">resources&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">requests&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">storage&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>20Gi&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#008b45;text-decoration:underline">---&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Service&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-{index}&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">annotations&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># å‚è€ƒé˜¿é‡Œäº‘LB Service é…ç½® è‡ªåŠ¨åˆ›å»º å¥½å‡ ç§ LBç±»å‹ï¼Œè¿™è¾¹æ˜¯å†…ç½‘LB&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">service.beta.kubernetes.io/alicloud-loadbalancer-address-type&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>intranet&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">service.beta.kubernetes.io/alicloud-loadbalancer-id&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>{LBå®ä¾‹ID}&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">service.beta.kubernetes.io/alicloud-loadbalancer-force-override-listeners&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#39;true&amp;#39;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">externalTrafficPolicy&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Local&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">type&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>LoadBalancer&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">selector&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">statefulset.kubernetes.io/pod-name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-{index}&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">ports&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>external&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">port&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>{{&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">9093&lt;/span>&lt;span style="color:#bbb"> &lt;/span>+ index }}&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">protocol&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>TCP&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">targetPort&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">9093&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>jmx&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">port&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>{{&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">9999&lt;/span>&lt;span style="color:#bbb"> &lt;/span>+ index }}&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">protocol&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>TCP&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">targetPort&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>{{&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">9999&lt;/span>&lt;span style="color:#bbb"> &lt;/span>+ index }}&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>internal&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">port&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">9092&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">protocol&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>TCP&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">targetPort&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">9092&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#008b45;text-decoration:underline">---&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">piVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>networking.k8s.io/v1beta1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Ingress&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-manager&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">annotations&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">nginx.ingress.kubernetes.io/enable-global-auth&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;false&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">rules&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">host&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-manager.{åŸŸå}.com&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">http&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">paths&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">path&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>/&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">backend&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">serviceName&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-manager&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">servicePort&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">80&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#008b45;text-decoration:underline">---&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Service&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-manager&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-manager&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">ports&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>http&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">port&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">80&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">targetPort&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">9000&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">selector&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-manager&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#008b45;text-decoration:underline">---&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>apps/v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Deployment&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-manager&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-manager&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">replicas&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">1&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">selector&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">matchLabels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-manager&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">template&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-manager&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">containers&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-manager&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">imagePullPolicy&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Always&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">image&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>dockerkafka/kafka-manager&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">ports&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">containerPort&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">9000&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">env&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>ZK_HOSTS&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;zookeeper-0.zookeeper-hs:2181,zookeeper-1.zookeeper-hs:2181,zookeeper-2.zookeeper-hs:2181&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">resources&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">requests&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">cpu&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>40m&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">memory&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>500Mi&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å‚è€ƒæ–‡æ¡£ &lt;a href="https://github.com/debezium/docker-images/blob/master/kafka/1.4/README.md">https://github.com/debezium/docker-images/blob/master/kafka/1.4/README.md&lt;/a>&lt;/p>
&lt;h3 id="33-kafka-schema-registry-æ„å»º">3.3 kafka schema-registry æ„å»º&lt;/h3>
&lt;ul>
&lt;li>Docker åŸºç¡€é•œåƒç¯å¢ƒå¯åŠ¨è„šæœ¬ &lt;a href="https://github.com/confluentinc/schema-registry-images/blob/master/schema-registry/include/etc/confluent/docker/">https://github.com/confluentinc/schema-registry-images/blob/master/schema-registry/include/etc/confluent/docker/&lt;/a>&lt;/li>
&lt;li>å…ˆå¯åŠ¨ pod å†æ˜ å°„ serviceï¼Œå¦åˆ™å¯åŠ¨æŠ¥é”™, åœ¨è¿™ä¸ªé¡¹ç›®é‡Œé¢æœ‰ä¸ª SCHEMA_REGISTRY_PORT,åœ¨åŸºç¡€å¯åŠ¨è„šæœ¬é‡Œé¢ä¼šä¸»åŠ¨é€€å‡º&lt;/li>
&lt;li>é…ç½® ZK çš„è¯ï¼Œåœ¨kafka listener é‡Œé¢è¦æœ‰ç±»å‹ PLAINTEXTï¼Œ é›†ç¾¤å†…ç½‘å¤–ç½‘ç¯å¢ƒé…ç½®äº† KAFKA_LISTENER_SECURITY_PROTOCOL_MAPï¼ŒæŒ‰ç…§æ­£å¸¸çš„Kafkaæ˜¯æ­£å¸¸çš„ï¼Œä½†æ˜¯ schema-registry å®ç°çš„æ˜¯æ²¡æœ‰å»æ‰¾çš„ï¼Œæœªåšæ˜ å°„ï¼Œåªè¦æ²¡æœ‰ PLAINTEXT å°±æŠ¥é”™é€€å‡ºï¼Œå¯åŠ¨å¤±è´¥&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>apps/v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Deployment&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>schema-registry&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>schema-registry&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">replicas&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">1&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">selector&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">matchLabels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>schema-registry&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">template&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>schema-registry&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">securityContext&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">fsGroup&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">1000&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">runAsUser&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">1000&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">containers&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>schema-registry&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">imagePullPolicy&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Always&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">image&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>confluentinc/cp-schema-registry:6.0.0&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">ports&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">containerPort&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">8081&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">env&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>SCHEMA_REGISTRY_HOST_NAME&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>schema-registry&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>SCHEMA_REGISTRY_KAFKASTORE_CONNECTION_URL&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>zookeeper-0.zookeeper-hs:2181,zookeeper-1.zookeeper-hs:2181,zookeeper-2.zookeeper-hs:2181&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-0:9092,kafka-1:9092,kafka-2:9092&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">resources&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">requests&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">cpu&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>40m&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">memory&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>500Mi&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#008b45;text-decoration:underline">---&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Service&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>schema-registry&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>schema-registry&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">ports&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>http&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">port&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">8081&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">selector&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>schema-registry&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å‚è€ƒæ–‡æ¡£ &lt;a href="https://github.com/confluentinc/cp-all-in-one/blob/latest/cp-all-in-one-cloud/docker-compose.yml">https://github.com/confluentinc/cp-all-in-one/blob/latest/cp-all-in-one-cloud/docker-compose.yml&lt;/a>&lt;/p>
&lt;h3 id="33-kafka-connect-å»ºè®¾">3.3 kafka connect å»ºè®¾&lt;/h3>
&lt;ul>
&lt;li>é…ç½®å‚æ•° ç­‰ç­‰ &lt;a href="http://kafka.apache.org/documentation/#connectconfigs">http://kafka.apache.org/documentation/#connectconfigs&lt;/a>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Service&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>connect&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>connect&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">ports&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>http&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">port&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">80&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">targetPort&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">8083&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">selector&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>connect&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#008b45;text-decoration:underline">---&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>apps/v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Deployment&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>connect&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>connect&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">replicas&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">3&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">selector&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">matchLabels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>connect&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">template&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>connect&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">containers&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>connect&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">imagePullPolicy&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Always&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">image&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>debezium/connect:1.3&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">ports&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">containerPort&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">8083&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">env&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>LOG_LEVEL&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;INFO&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>BOOTSTRAP_SERVERS&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;kafka-0:9092,kafka-1:9092,kafka-2:9092&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>GROUP_ID&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;test_connect&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>CONFIG_STORAGE_TOPIC&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;test_connect_configs&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>OFFSET_STORAGE_TOPIC&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;test_connect_offset&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>STATUS_STORAGE_TOPIC&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;test_connect_status&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>KEY_CONVERTER&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;io.confluent.connect.avro.AvroConverter&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>VALUE_CONVERTER&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;io.confluent.connect.avro.AvroConverter&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>INTERNAL_KEY_CONVERTER&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;org.apache.kafka.connect.json.JsonConverter&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>INTERNAL_VALUE_CONVERTER&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;org.apache.kafka.connect.json.JsonConverter&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>CONNECT_KEY_CONVERTER_SCHEMA_REGISTRY_UR&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;http://schema-registry:8081&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>CONNECT_VALUE_CONVERTER_SCHEMA_REGISTRY_UR&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;http://schema-registry:8081&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">resources&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">requests&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">cpu&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>40m&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">memory&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>500Mi&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#228b22"># ä½¿ç”¨ kafka-connect-uiæ„å»º&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#008b45;text-decoration:underline">---&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>networking.k8s.io/v1beta1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Ingress&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-connect-ui&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">annotations&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">nginx.ingress.kubernetes.io/enable-global-auth&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;false&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">rules&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">host&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-connect.{åŸŸå}.com&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">http&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">paths&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">path&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>/&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">backend&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">serviceName&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-connect-ui&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">servicePort&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">80&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#008b45;text-decoration:underline">---&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Service&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-connect-ui&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-connect-ui&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">ports&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>http&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">port&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">80&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">targetPort&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">8000&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">selector&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-connect-ui&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#008b45;text-decoration:underline">---&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>apps/v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Deployment&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-connect-ui&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-connect-ui&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">replicas&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">1&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">selector&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">matchLabels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-connect-ui&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">template&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-connect-ui&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">containers&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kafka-connect-ui&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">imagePullPolicy&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Always&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">image&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>landoop/kafka-connect-ui&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">ports&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">containerPort&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">8000&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">env&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>CONNECT_URL&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">value&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;http://connect&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">resources&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">requests&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">cpu&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>40m&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">memory&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>500Mi&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å‚è€ƒæ–‡æ¡£&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/debezium/docker-images/blob/master/connect/1.4/README.md">https://github.com/debezium/docker-images/blob/master/connect/1.4/README.md&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/debezium/debezium-examples/blob/master/tutorial/docker-compose-mysql-avro-connector.yaml">https://github.com/debezium/debezium-examples/blob/master/tutorial/docker-compose-mysql-avro-connector.yaml&lt;/a>&lt;/li>
&lt;/ul>
&lt;h1 id="æ•°æ®æ¹–ç¯‡">æ•°æ®æ¹–ç¯‡&lt;/h1>
&lt;h2 id="1hudi-data-lake">1ã€Hudi Data Lakeï¼Ÿ&lt;/h2>
&lt;p>ä¹‹å‰æ„å»ºäº†åŸºäº &lt;code>Debezium&lt;/code> æ•è·åŸºæœ¬çš„æ•°æ®å˜åŒ–ï¼Œå‘é€è‡³ &lt;code>Kafka&lt;/code>, åé¢çš„å¯¹æ¥æ–¹å¯ä»¥æ˜¯å“ªäº›å‘¢ï¼Ÿè¿™äº›æ˜¯è¦å¤„ç†çš„&amp;hellip;&amp;hellip;&lt;/p>
&lt;p>Apache Hudi æ˜¯æ„å»ºåœ¨ HDFS/S3 ç­‰å¤§æ•°æ®é‡çš„å­˜å‚¨ï¼Œæ—¨åœ¨è§£å†³å¤§æ•°æ®ç”Ÿæ€ç³»ç»Ÿä¸­éœ€è¦&lt;code>æ’å…¥æ›´æ–°&lt;/code>åŠ&lt;code>å¢é‡æ¶ˆè´¹&lt;/code>çš„æ‘„å–ç®¡é“å’Œ &lt;code>ETLç®¡é“çš„ä½æ•ˆ&lt;/code>é—®é¢˜ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Near Real-Time Ingestion ï¼ˆè¿‘å®æ—¶è·å–ï¼‰&lt;/p>
&lt;p>å°†æ•°æ®ä»å¤–éƒ¨æ•°æ®&lt;code>event logs, databases, external sources&lt;/code>æå–åˆ°&lt;code>Hadoop Data Lake&lt;/code>ã€‚
å¯¹äº&lt;code>RDBMS&lt;/code>æ‘„å–ï¼Œ&lt;code>Hudi&lt;/code>é€šè¿‡&lt;code>Upserts&lt;/code>æä¾›äº†æ›´å¿«çš„è´Ÿè½½ï¼Œ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Near Real-time Analytics ï¼ˆè¿‘å®æ—¶åˆ†æï¼‰&lt;/p>
&lt;p>&lt;code>Hadoopä¸Š&lt;/code>çš„äº¤äº’å¼SQLè§£å†³æ–¹æ¡ˆï¼ˆå¦‚&lt;code>Presto&lt;/code>å’Œ&lt;code>SparkSQL&lt;/code>ï¼‰ã€‚é€šè¿‡&lt;code>Hudi&lt;/code>å°†æ•°æ®çš„æ›´æ–°æ—¶é—´ç¼©çŸ­è‡³å‡ åˆ†é’Ÿï¼Œè¿˜å¯ä»¥å¯¹å­˜å‚¨åœ¨&lt;code>DFS&lt;/code>ä¸­çš„å¤šä¸ªå¤§å°æ›´å¤§çš„è¡¨è¿›è¡Œå®æ—¶åˆ†æã€‚
è€Œä¸”ï¼Œ&lt;code>Hudi&lt;/code> æ²¡æœ‰å¤–éƒ¨ä¾èµ–é¡¹ï¼ˆå¦‚&lt;code>HBase&lt;/code>ç¾¤é›†ï¼‰ï¼Œå› æ­¤å¯ä»¥åœ¨ä¸å¢åŠ è¿è¥å¼€é”€çš„æƒ…å†µä¸‹ï¼Œå¯¹æ›´æ–°é²œçš„åˆ†æè¿›è¡Œæ›´å¿«çš„åˆ†æã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Incremental Processing Pipelines ï¼ˆå¢é‡å¤„ç†ç®¡é“ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Data Dispersal From DFS ï¼ˆåˆ†æ•£æ•°æ®ï¼‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://pinkhello.github.io/Kafka%E4%B8%8EDebezium%E6%9E%84%E5%BB%BACDC%E7%AE%A1%E9%81%93/hudi-lake.png" alt="Hudiæ¶æ„">&lt;/p>
&lt;h2 id="2timeline">2ã€Timeline&lt;/h2>
&lt;p>Hudiçš„æ ¸å¿ƒæ˜¯ç»´æŠ¤&lt;code>timeline&lt;/code>åœ¨ä¸åŒ&lt;code>instants&lt;/code>æ—¶é—´ä¸Šå¯¹è¡¨ä¸Šæ‰§è¡Œçš„æ‰€æœ‰æ“ä½œä¸­ä¸€ä¸ªæ“ä½œï¼Œè¿™æœ‰åŠ©äºæä¾›è¡¨çš„å³æ—¶è§†å›¾ï¼Œ
åŒæ—¶è¿˜æœ‰æ•ˆåœ°æ”¯æŒæŒ‰åˆ°è¾¾é¡ºåºå¯¹æ•°æ®è¿›è¡Œæ£€ç´¢ã€‚&lt;/p>
&lt;p>Hudiç¬é—´åŒ…å«ä»¥ä¸‹ç»„ä»¶&lt;/p>
&lt;ul>
&lt;li>Instant action ï¼šåœ¨è¡¨æ ¼ä¸Šæ‰§è¡Œçš„æ“ä½œç±»å‹&lt;/li>
&lt;li>Instant time ï¼šå³æ—¶æ—¶é—´é€šå¸¸æ˜¯ä¸€ä¸ªæ—¶é—´æˆ³è®°ï¼ˆä¾‹å¦‚ï¼š20190117010349ï¼‰ï¼Œè¯¥æ—¶é—´æˆ³è®°ä»¥åŠ¨ä½œå¼€å§‹æ—¶é—´çš„é¡ºåºå•è°ƒå¢åŠ ã€‚&lt;/li>
&lt;li>state ï¼šå³æ—¶çŠ¶æ€&lt;/li>
&lt;/ul>
&lt;p>Hudiä¿è¯åœ¨&lt;code>timeline&lt;/code>ä¸Šæ‰§è¡Œçš„æ“ä½œåŸºäºå½“å‰æ—¶é—´æ˜¯åŸå­æ€§å’Œæ—¶é—´è½´ä¸Šä¸€è‡´çš„ã€‚&lt;/p>
&lt;p>æ‰§è¡Œçš„å…³é”®åŠ¨ä½œåŒ…æ‹¬&lt;/p>
&lt;ul>
&lt;li>COMMITS - æäº¤è®°å½• ä¸€æ‰¹è®°å½•åŸå­å†™å…¥è¡¨ä¸­ æäº¤è¡¨ç¤ºå°†ä¸€æ‰¹è®°å½•åŸå­å†™å…¥è¡¨ä¸­ã€‚&lt;/li>
&lt;li>CLEANS - åå°æ¸…é™¤è¡¨ä¸­ä¸éœ€è¦çš„æ–‡ä»¶æ—§ç‰ˆæœ¬è®°å½•ã€‚&lt;/li>
&lt;li>DELTA_COMMIT - å¢é‡æäº¤æ˜¯æŒ‡å°†ä¸€æ‰¹è®°å½•åŸå­å†™å…¥&lt;code>MergeOnRead&lt;/code>ç±»å‹è¡¨ä¸­ï¼Œå…¶ä¸­ä¸€äº›/æ‰€æœ‰ æ•°æ® å¯ä»¥åªå†™åˆ°å¢é‡æ—¥å¿—ä¸­ã€‚&lt;/li>
&lt;li>COMPACTION - è°ƒå’Œ&lt;code>Hudi&lt;/code>ä¸­ä¸åŒæ•°æ®ç»“æ„çš„åå°æ´»åŠ¨ï¼Œä¾‹å¦‚ï¼šå°†æ›´æ–°ä»åŸºäºè¡Œçš„æ—¥å¿—æ–‡ä»¶ç§»åŠ¨åˆ°åˆ—æ ¼å¼ã€‚åœ¨å†…éƒ¨ï¼Œå‹ç¼©è¡¨ç°ä¸ºæ—¶é—´è½´ä¸Šçš„ç‰¹æ®Šæäº¤&lt;/li>
&lt;li>ROLLBACK - è¡¨ç¤ºæäº¤/å¢é‡æäº¤ä¸æˆåŠŸä¸”å·²å›æ»šï¼Œåˆ é™¤äº†åœ¨å†™å…¥è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä»»ä½•éƒ¨åˆ†æ–‡ä»¶&lt;/li>
&lt;li>SAVEPOINT - å°†æŸäº›æ–‡ä»¶ç»„æ ‡è®°ä¸ºâ€œå·²ä¿å­˜â€ï¼Œä»¥ä¾¿æ¸…ç†ç¨‹åºä¸ä¼šåˆ é™¤å®ƒä»¬ã€‚åœ¨å‘ç”Ÿç¾éš¾/æ•°æ®æ¢å¤çš„æƒ…å†µä¸‹ï¼Œå®ƒæœ‰åŠ©äºå°†è¡¨è¿˜åŸåˆ°æ—¶é—´è½´ä¸Šçš„æŸä¸ªç‚¹ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä»»ä½•ç»™å®šçš„ç¬é—´éƒ½å¯ä»¥å¤„äºä»¥ä¸‹çŠ¶æ€ä¹‹ä¸€&lt;/p>
&lt;ul>
&lt;li>REQUESTED -è¡¨ç¤ºå·²ç»å®‰æ’äº†åŠ¨ä½œï¼Œä½†å°šæœªå¼€å§‹&lt;/li>
&lt;li>INFLIGHT -è¡¨ç¤ºå½“å‰æ­£åœ¨æ‰§è¡Œè¯¥æ“ä½œ&lt;/li>
&lt;li>COMPLETED -è¡¨ç¤ºåœ¨æ—¶é—´è¡¨ä¸Šå®Œæˆäº†ä¸€é¡¹æ“ä½œ
&lt;img src="https://pinkhello.github.io/Kafka%E4%B8%8EDebezium%E6%9E%84%E5%BB%BACDC%E7%AE%A1%E9%81%93/hudi_c.png" alt="COW">&lt;/li>
&lt;/ul>
&lt;h2 id="3hudi-çš„å­˜å‚¨ç±»å‹">3ã€Hudi çš„å­˜å‚¨ç±»å‹&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>COW Copy On Write å¿«ç…§æŸ¥è¯¢ + å¢é‡æŸ¥è¯¢&lt;/p>
&lt;p>æ•°æ®ä»…ä»…ä»¥ åˆ—æ–‡ä»¶æ ¼å¼ parquet å­˜å‚¨ï¼Œæ¯æ¬¡å†™æ“ä½œåæ•°æ®çš„åŒæ­¥ Merge ä»¥æ›´æ–°ç‰ˆæœ¬å¹¶é‡å†™æ–‡ä»¶ï¼ŒCOWè¡¨ä¸­æ•°æ®ä½¿ç”¨æ˜¯æœ€æ–°çš„&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://pinkhello.github.io/Kafka%E4%B8%8EDebezium%E6%9E%84%E5%BB%BACDC%E7%AE%A1%E9%81%93/hudi_cow.png" alt="COW">&lt;/p>
&lt;ul>
&lt;li>
&lt;p>MOR merge on read å¿«ç…§æŸ¥è¯¢ + å¢é‡æŸ¥è¯¢ + è¯»å–ä¼˜åŒ–&lt;/p>
&lt;p>æ•°æ®ä»¥ åˆ—æ–‡ä»¶æ ¼å¼ parquet å’Œ åŸºäº è¡Œæ–‡ä»¶æ ¼å¼ avro ç»„åˆå­˜å‚¨ã€‚æ¯æ¬¡å†™å…¥æ“ä½œå°†å¢é‡åˆ›å»ºæ–‡ä»¶ã€‚ç„¶å compact ä»¥ç”Ÿæˆ åˆ—æ–‡ä»¶ çš„æœ€æ–°ç‰ˆ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://pinkhello.github.io/Kafka%E4%B8%8EDebezium%E6%9E%84%E5%BB%BACDC%E7%AE%A1%E9%81%93/hudi_mor.png" alt="MOR">&lt;/p>
- https://pinkhello.github.io/posts/13-kafka%E4%B8%8Edebezium%E6%9E%84%E5%BB%BAcdc%E7%AE%A1%E9%81%93/ - ä¸€æ¯å“ˆå¸Œä¸åŠ ç›, All Rights Reserved</description></item><item><title>12 èŠèŠè™è Chat</title><link>https://pinkhello.github.io/posts/12-%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0chat/</link><pubDate>Wed, 10 Feb 2021 09:10:14 +0800</pubDate><guid>https://pinkhello.github.io/posts/12-%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0chat/</guid><description>ä¸€æ¯å“ˆå¸Œä¸åŠ ç› https://pinkhello.github.io/posts/12-%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0chat/ -&lt;hr>
&lt;p>title: è€å¸æœºèŠèŠBatChat
date: 2021-01-31 21:37:07
tags:&lt;/p>
&lt;ul>
&lt;li>BatChat/åŠ å¯†èŠå¤©&lt;/li>
&lt;/ul>
&lt;hr>
&lt;!-- raw HTML omitted -->
&lt;p>ä»Šå¤©ï¼Œåœ¨æµè§ˆ&lt;code>å°ä¼—è½¯ä»¶&lt;/code>çš„æ—¶å€™ï¼Œçªç„¶çœ‹è§ä¸€ä¸ªæ—©æœŸå°ç¼–çš„æ¨å¹¿ï½ï½ï½è™è APPï¼Œè”æƒ³åˆ°ä¹‹å‰æ–°é—»ä¸­çœ‹åˆ°çš„æœ‰ä¸ªè´©å–ä¸ªäººä¿¡æ¯çš„äººè¯´åœ¨è™è APPä¸Šï¼Œå‹¾èµ·äº†æˆ‘çš„å¥½å¥‡å¿ƒï¼Œä½œä¸ºä¸€ä¸ªç¨‹åºğŸ¶ï¼Œé»˜é»˜çš„æƒ³æ¢ç©¶ä¸€ä¸‹è¿™ä¸ªè™è APPç©çš„ä»€ä¹ˆå¥—è·¯ã€‚&lt;/p>
&lt;h1 id="ä»€ä¹ˆæ˜¯è™è batchat">ä»€ä¹ˆæ˜¯è™è ï¼ˆBatChatï¼‰&lt;/h1>
&lt;p>ä¸€æ¬¾å…è´¹çš„ç«¯åˆ°ç«¯åŠ å¯†çš„è™è APPï¼Œéšæ—¶ç•…èŠï¼
åº”ç”¨ IOSã€Android
&lt;a href="https://batchat.com">https://batchat.com&lt;/a>&lt;/p>
&lt;h1 id="å®ƒçš„ç‰¹æ€§">å®ƒçš„ç‰¹æ€§&lt;/h1>
&lt;ul>
&lt;li>å®‰å…¨ ï½œ ç•…èŠæ—¶ã€ç«¯åˆ°ç«¯åŠ å¯†ï¼ˆæ‰€æœ‰æ¶ˆæ¯ç»è¿‡ç«¯åˆ°ç«¯åŠ å¯†ï¼Œä»»ä½•èŠå¤©è®°å½•ä¸è¿›è¡Œäº‘å­˜å‚¨ï¼Œè®©ä½ çš„ä¿¡æ¯æƒ³è±¡ä¸­æ›´å®‰å…¨ï¼‰&lt;/li>
&lt;li>éšç§ ï½œ ç•…èŠæ—¶ã€åŒå‘æ’¤å›ï¼ˆèŠå¤©è®°å½•ä¸€é”®åŒå‘æ’¤å›ï¼ŒåŒæ—¶åˆ é™¤ä½ å’Œå¯¹æ–¹è®¾å¤‡ä¸Šæ‰€æœ‰çš„èŠå¤©è®°å½•ï¼Œæ’¤å›æ•°æ®å¤šæ¬¡è¦†ç›–åˆ é™¤ã€ä¸å¯æ¢å¤ã€ä¿è¯åŒæ–¹çš„éšç§å®‰å…¨ï¼‰&lt;/li>
&lt;li>åŒ¿åç¾¤èŠ ï½œ å¼€å¯åŒ¿åç¾¤èŠï¼Œç¾¤é‡Œé¢çš„æ¯ä¸€ä¸ªæˆå‘˜éƒ½å¯ä»¥&amp;quot;å˜èº«&amp;quot;ï¼Œéšè—çœŸå®èº«ä»½ï¼Œç¾¤å†…ä¸å—èº«ä»½çº¦æŸ&lt;/li>
&lt;/ul>
&lt;h1 id="ä»€ä¹ˆæ˜¯ç«¯åˆ°ç«¯åŠ å¯†">ä»€ä¹ˆæ˜¯ç«¯åˆ°ç«¯åŠ å¯†ï¼Ÿ&lt;/h1>
&lt;p>ç«¯åˆ°ç«¯åŠ å¯†æ˜¯åœ¨æºç»“ç‚¹å’Œç›®çš„ç»“ç‚¹ä¸­å¯¹ä¼ é€çš„æ•°æ®è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼Œ å› æ­¤æ•°æ®çš„å®‰å…¨æ€§ä¸ä¼šå› ä¸­é—´ç»“ç‚¹çš„ä¸å¯é è€Œå—åˆ°å½±å“ã€‚&lt;code> è™è APPçš„æ‰€æœ‰æ•°æ®éƒ½é€šè¿‡ç”¨æˆ·ç«¯ç”Ÿæˆçš„ç§é’¥è¿›è¡ŒåŠ å¯†åå†å‘é€ï¼Œä»»ä½•ç¬¬ä¸‰æ–¹åŒ…æ‹¬å¼€å‘è€…éƒ½ä¸èƒ½è§£å¼€æ­¤æ•°æ®&lt;/code>.&lt;/p>
&lt;h1 id="è™è appé‡‡ç”¨çš„å®‰å…¨å±‚çº§">è™è APPé‡‡ç”¨çš„å®‰å…¨å±‚çº§ï¼Ÿ&lt;/h1>
&lt;ul>
&lt;li>
&lt;p>é€šé“åŠ å¯†
é€šé“åŠ å¯†ä¸­é‡‡ç”¨äº†å“ªäº›åŠ å¯†ç®—æ³•ï¼Ÿ
é€šé“åŠ å¯†ä¸­ä½¿ç”¨åˆ°çš„ RSA, ECDHE, AES256_CBC, SHA256, SHA1ç­‰ç­‰(å¦‚ä¸‹å›¾)ã€‚&lt;/p>
&lt;p>&lt;img src="https://pinkhello.github.io/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E9%80%9A%E9%81%93%E5%8A%A0%E5%AF%86.png" alt="é€šé“åŠ å¯†">
æ­¥éª¤:&lt;/p>
&lt;ul>
&lt;li>(1. å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å…ˆäº§ç”Ÿéšæœºæ•°&lt;/li>
&lt;li>(2. æœåŠ¡å™¨ä¸‹å‘éšæœºæ•°ã€‚&lt;/li>
&lt;li>(3. å®¢æˆ·ç«¯ç”¨ RSA å¯¹å®¢æˆ·ç«¯éšæœºæ•°è¿›è¡ŒåŠ å¯†ï¼Œå¹¶å‘é€ç»™æœåŠ¡å™¨ã€‚&lt;/li>
&lt;li>(4. æœåŠ¡å™¨ç”¨ RSA è§£å¯†å®¢æˆ·ç«¯éšæœºæ•°ï¼ˆä½¿ç”¨ RSA çš„ç›®çš„æ˜¯é˜²æ­¢ä¸­é—´äººæ”»å‡»ï¼‰ã€‚&lt;/li>
&lt;li>(5. å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨ç”¨è‡ªå·±çš„éšæœºæ•°åŠ ä¸Šå¯¹æ–¹çš„éšæœºæ•°ç”Ÿæˆä¸´æ—¶å¯†é’¥ TempKey å’Œä¸´æ—¶åç§»é‡ TempIV (æ­¤æ—¶åŒæ–¹å‡æŒæœ‰ç›¸åŒçš„ TempKeyå’ŒTempIV)ã€‚&lt;/li>
&lt;li>(6. å®¢æˆ·ç«¯æœåŠ¡å™¨å‡ä½¿ç”¨ ECDHE ç”Ÿæˆå„è‡ªçš„å…¬ç§é’¥å¯¹ã€‚&lt;/li>
&lt;li>(7. å®¢æˆ·ç«¯ç”¨ TempKey, TempIV å¯¹è‡ªå·±çš„ ECDHE å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œå¹¶å°†å¯†æ–‡å‘é€ç»™æœåŠ¡å™¨ã€‚&lt;/li>
&lt;li>(8. æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„ ECDHE å…¬é’¥å¯†æ–‡ï¼Œå¹¶è§£å¯†ã€‚&lt;/li>
&lt;li>(9. æœåŠ¡å™¨ä½¿ç”¨ TempKey, TempIV å¯¹è‡ªå·±çš„ ECDHE å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œå¹¶ä½¿ç”¨ RSA å¯¹ ECDHEã€‚&lt;/li>
&lt;li>(10. æœåŠ¡å™¨ä½¿ç”¨ ECDHE ç®—æ³•ï¼Œä½¿ç”¨å®¢æˆ·ç«¯ ECDHE å…¬é’¥æ˜æ–‡+æœåŠ¡å™¨ ECDHE ç§é’¥æ˜æ–‡ç”ŸæˆShareKeyã€‚&lt;/li>
&lt;li>(11. å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„ ECDHE å…¬é’¥å¯†æ–‡å’Œç­¾åï¼Œç„¶åè¿›è¡Œè§£å¯†å’ŒéªŒè¯ç­¾åï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œå°±ä½¿ç”¨å®¢æˆ·ç«¯ ECDHE ç§é’¥æ˜æ–‡+æœåŠ¡å™¨ECDHE å…¬é’¥æ˜æ–‡ç”Ÿæˆ ShareKeyã€‚&lt;/li>
&lt;li>(12. æœåŠ¡å™¨åˆå§‹åŒ–å„ä¸ªå‚æ•°ï¼Œä¸‹å‘ç»™å®¢æˆ·ç«¯,å‚æ•°åŒ…å«ï¼š
&lt;ul>
&lt;li>
&lt;p>AuthKeyIDï¼š æœåŠ¡å™¨éšæœºç”Ÿæˆçš„å®¢æˆ·ç«¯ä¸´æ—¶æ ‡è¯†ç¬¦&lt;/p>
&lt;/li>
&lt;li>
&lt;p>MsgKeyï¼š ç”± ShareKey, AuthkeyID, MsgID, SessionID, Salt, SeqNo ä»¥åŠçœŸå®çš„æ¶ˆæ¯å†…å®¹ç›¸åŠ åè¿›è¡Œ Sha256 åçš„å€¼&lt;/p>
&lt;blockquote>
&lt;p>æœ¬å‚æ•°ç”¨äºï¼š&lt;/p>
&lt;blockquote>
&lt;p>(a. è¿›è¡Œé˜²æ­¢æ•°æ®ç¯¡æ”¹çš„éªŒè¯&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>(b. ä¸ ShareKey ä¸€èµ·ä½¿ç”¨ï¼Œç”Ÿæˆ Aes256 key, IVï¼Œç”¨æ¥å¯¹å„æ¡æ¶ˆæ¯è¿›è¡ŒåŠ å¯†ã€‚&lt;/p>
&lt;/blockquote>
&lt;/blockquote>
&lt;/li>
&lt;li>
&lt;p>MsgIDï¼šæ—¶é—´ç›¸å…³çš„æ¶ˆæ¯ IDï¼Œç”¨äºé˜²æ­¢é‡æ”¾å’Œå»é‡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>SessionIDï¼šæ¯æ¬¡ç™»å½•å”¯ä¸€çš„ä¼šè¯ IDã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Saltï¼šæ¯æ¬¡ç™»å½•å”¯ä¸€çš„ç›å€¼ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>SeqNoï¼šç”¨äºé˜²æ­¢é‡æ”¾ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>(13. åç»­æ¯æ¡æ¶ˆæ¯å‡ä¼šæœ‰ä¸åŒçš„ MsgID, SessionID, Salt, SeqNo å’ŒçœŸå®çš„æ¶ˆæ¯å†…å®¹ï¼›è¿™äº›å˜åŒ–çš„å€¼ä¼šå¯¼è‡´ MsgKey æ¯æ¬¡éƒ½ä¸åŒã€‚ è¿™ä¸ªæ¯æ¬¡éƒ½ ä¸åŒçš„ MsgKey åŠ ä¸Š ShareKey å¯ä»¥ä¸ºæ¯ä¸€æ¡æ¶ˆæ¯ç”Ÿæˆå¯¹åº”çš„ 32 å­—èŠ‚å¯†é’¥å’Œåç§»é‡ã€‚&lt;/li>
&lt;li>(14. ShareKey ä¼šè¿‡æœŸï¼Œè¿‡æœŸåéœ€è¦é‡æ–°è¿›è¡Œå¯†é’¥åå•†ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å†…å®¹åŠ å¯†&lt;/p>
&lt;ul>
&lt;li>(1. ç”¨æˆ·ç”Ÿæˆ ECDHE å…¬ç§é’¥ï¼Œä¿å­˜åœ¨æœ¬åœ°ã€‚&lt;/li>
&lt;li>(2. å°†å…¬é’¥å‘é€åˆ°æœåŠ¡å™¨ï¼Œç§é’¥ä¿å­˜åœ¨æœ¬åœ°ã€‚&lt;/li>
&lt;li>(3. ç”¨æˆ·ç™»å½•ï¼Œè·å–æ‰€æœ‰å¥½å‹ä¿¡æ¯çš„æ›´æ–°ï¼ŒåŒ…å«æ¯ä¸ªå¥½å‹çš„å…¬é’¥ã€‚&lt;/li>
&lt;li>(4. å‘é€æ¶ˆæ¯ï¼Œå’Œæ¥æ”¶æ¶ˆæ¯æ—¶å‡é‡‡ç”¨è‡ªå·±çš„ç§é’¥+å¯¹æ–¹çš„å…¬é’¥ç”Ÿæˆ ShareKeyã€‚&lt;/li>
&lt;li>(5. ä½¿ç”¨ ShareKey ç”Ÿæˆ AES256 çš„å¯†é’¥ï¼Œè¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://pinkhello.github.io/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86.png" alt="å†…å®¹åŠ å¯†">&lt;/p>
&lt;p>è™è  åŒæ£˜è½®ç®—æ³• å¦‚ä¸‹ï¼š
Alice(A)å‘é€çš„æ¶ˆæ¯ä¼ é€äº†å¥¹çš„æ–°å…¬é’¥ã€‚ æœ€ç»ˆï¼ŒBob(B)å°†æ”¶åˆ°ä»¥ä¸‹æ¶ˆæ¯ä¹‹ä¸€ï¼Œå¹¶æ‰§è¡Œç¬¬äºŒä¸ªDHæ£˜è½®æ­¥éª¤ï¼› åœ¨æ¯ä¸ªDHæ£˜è½®æ­¥éª¤ä¸­ç”Ÿæˆçš„DH è¾“å‡ºç”¨äºå¯¼å‡ºæ–°çš„å‘é€å’Œæ¥æ”¶é“¾å¯†é’¥ã€‚å½“å„æ–¹è½®æµæ‰§è¡ŒDHæ£˜è½®æ­¥éª¤æ—¶ï¼Œä»–ä»¬è½®æµå¼•å…¥æ–°çš„å‘é€é“¾ï¼Œä¾æ­¤ç±»æ¨ã€‚&lt;/p>
&lt;p>&lt;img src="https://pinkhello.github.io/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E5%8F%8C%E6%A3%98%E8%BD%AE%E7%AE%97%E6%B3%95.png" alt="åŒæ£˜è½®ç®—æ³•">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æœåŠ¡å™¨æ•°æ®åº“å®‰å…¨&lt;/p>
&lt;ul>
&lt;li>(1. æ•°æ®åº“æœ‰ç­¾åå­—æ®µã€‚&lt;/li>
&lt;li>(2. æœåŠ¡å™¨ä¸Šç”Ÿæˆ ECDSA å…¬ç§é’¥ã€‚&lt;/li>
&lt;li>(3. æœåŠ¡å™¨ä»£ç ä¸­å¯¹æ•°æ®åº“æ•æ„Ÿå­—æ®µï¼Œæ¯”å¦‚ï¼špassword, userID, friend ç­‰åšå¢åˆ æ”¹æ“ä½œæ—¶å‡é€šè¿‡ ECDSA ç”Ÿæˆç­¾åï¼Œå¹¶æ›´æ–°åˆ°ç­¾åå­—æ®µã€‚&lt;/li>
&lt;li>(4. æœåŠ¡å™¨ä»£ç å¯¹ password, userID, friend ç­‰æ•°æ®è¿›è¡Œè¯»å–ï¼Œåˆ¤æ–­ç­‰æ“ä½œæ—¶è¿›è¡Œ ECDSAéªŒè¯ç­¾åï¼Œåªæœ‰é€šè¿‡éªŒè¯æ‰èƒ½è¿›è¡Œåç»­æµç¨‹ï¼Œå¦åˆ™ ç»™å®¢æˆ·ç«¯æŠ¥é”™ã€‚&lt;/li>
&lt;li>(5. æœåŠ¡ç«¯ç¨‹åºè¿›è¡ŒåŠ å¯†å’Œç­¾åä¿æŠ¤ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h1 id="å¥½äº†ä¸Šé¢çš„éƒ½æ˜¯æ‘˜è‡ª-batchat-å®˜ç½‘ä»‹ç»ç°åœ¨è¿›å…¥æ­£é¢˜">å¥½äº†ï¼Œä¸Šé¢çš„éƒ½æ˜¯æ‘˜è‡ª BatChat å®˜ç½‘ä»‹ç»ï¼ç°åœ¨è¿›å…¥æ­£é¢˜ï¼&lt;/h1>
&lt;p>å…ˆæ¥ä¸€ä¸ªé‡ç£…&lt;/p>
&lt;blockquote>
&lt;p>ã€Šç½‘ç»œå®‰å…¨æ³•ã€‹ ç¬¬äºŒåä¸€æ¡è§„å®šï¼Œç½‘ç»œè¿è¥è€…åº”å½“æŒ‰ç…§ç½‘ç»œå®‰å…¨ç­‰çº§ä¿æŠ¤åˆ¶åº¦çš„è¦æ±‚,å±¥è¡Œå®‰å…¨ä¿æŠ¤ä¹‰åŠ¡,ä¿éšœç½‘ç»œå…å—å¹²æ‰°ã€ç ´åæˆ–è€…æœªç»æˆæƒçš„è®¿é—®,é˜²æ­¢ç½‘ç»œæ•°æ®æ³„éœ²æˆ–è€…è¢«çªƒå–ã€ç¯¡æ”¹ã€‚ç½‘ç»œè¿è¥è€…çš„å®‰å…¨ä¹‰åŠ¡åŒ…æ‹¬é‡‡å–ç›‘æµ‹ã€è®°å½•ç½‘ç»œè¿è¡ŒçŠ¶æ€ã€ç½‘ç»œå®‰å…¨äº‹ä»¶çš„æŠ€æœ¯æªæ–½,å¹¶æŒ‰ç…§è§„å®šç•™å­˜ç›¸å…³çš„ç½‘ç»œæ—¥å¿—ä¸å°‘äºå…­ä¸ªæœˆã€‚&lt;/p>
&lt;/blockquote>
&lt;p>å˜¿å˜¿ ï¼ŒæŒ‰ç…§å°å¼Ÿçš„ç†è§£ï¼Œ&lt;code>BatChat&lt;/code> å·ç§°ç«¯åˆ°ç«¯åŠ å¯†ï¼Œé‚£ä¹ˆä¿¡æ¯åŠ å¯†å’Œå›½å†…å¤‡æ¡ˆæ˜æ˜¾å†²çªäº†ï¼Œæ‰€ä»¥è¦ä¹ˆè¿™å…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯å‡çš„ï¼Œè¦ä¹ˆå°±æ˜¯åœ¨è¿&lt;code>æ³•&lt;/code>çš„è¾¹ç¼˜ç–¯ç‹‚è¯•æ¢ã€‚&lt;/p>
&lt;p>æ­£å› ä¸ºçœ‹åˆ°è¿™äº›ï¼Œæ‰€ä»¥å°å¼Ÿé»˜é»˜çš„ &lt;code>Download&lt;/code> äº†ä¸‹æ¥, ç„¶åé»˜é»˜çš„ &lt;code>Install&lt;/code>, ç„¶åé»˜é»˜çš„æ³¨å†Œç™»å½•è¿›å…¥äº† ğŸ˜¯ ğŸ’ ï½ï½ï½ï½&lt;/p>
&lt;p>è¿›å…¥æ˜¯åŸºç¡€TabåŠŸèƒ½èœå•&lt;/p>
&lt;p>&lt;img src="https://pinkhello.github.io/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/app-%E6%88%91%E7%9A%84.png" alt="app">&lt;/p>
&lt;p>&lt;img src="https://pinkhello.github.io/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/app-%E8%81%94%E7%B3%BB%E4%BA%BA.jpeg" alt="app">&lt;/p>
&lt;p>&lt;img src="https://pinkhello.github.io/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/app-%E8%9D%99%E8%9D%A0%E6%88%91%E7%9A%84.png" alt="app">&lt;/p>
&lt;p>è¿›å…¥ç¬é—´çš„å†…å®¹ï¼Œæˆ‘å‘µå‘µå’¯ï½ï½&lt;/p>
&lt;p>&lt;img src="https://pinkhello.github.io/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E7%9E%AC%E9%97%B4-%E8%BF%9D%E8%A7%84.jpeg" alt="app">&lt;/p>
&lt;p>æœ‰æ²¡æœ‰çœ‹å‡ºæ¥ä»€ä¹ˆï¼Œäººè„¸è¯†åˆ«è‡ªåŠ¨è¯†åˆ«é€ å‡ï¼ˆé»‘ç°äº§ä¸šé“¾ï¼‰&lt;/p>
&lt;p>ä¸‹é¢æ˜¯æˆ‘çš„ä¸€äº›æˆªå›¾ï¼Œä½ ä»¬è‡ªå·±çœ‹å’¯&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ ‡ç­¾æœç´¢ ç‚¹å‡»æ¢ä¸€ç»„ï¼Œè¿™æ˜¯å®˜æ–¹çš„æ¨èçš„ã€‚&lt;/p>
&lt;p>&lt;img src="https://pinkhello.github.io/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E6%A0%87%E7%AD%BE%E6%90%9C%E7%B4%A21.jpeg" alt="æ ‡ç­¾">&lt;/p>
&lt;p>&lt;img src="https://pinkhello.github.io/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E6%A0%87%E7%AD%BE%E6%90%9C%E7%B4%A22.jpeg" alt="æ ‡ç­¾">&lt;/p>
&lt;p>&lt;img src="https://pinkhello.github.io/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E6%A0%87%E7%AD%BE%E6%90%9C%E7%B4%A23.jpeg" alt="æ ‡ç­¾">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æœç´¢æ•æ„Ÿè¯ç¾¤&lt;/p>
&lt;p>&lt;img src="https://pinkhello.github.io/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E7%BE%A4%E6%90%9C%E7%B4%A2%E6%94%AF%E4%BB%98.jpeg" alt="ç¾¤æœç´¢">&lt;/p>
&lt;p>&lt;img src="https://pinkhello.github.io/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E7%BE%A4%E6%90%9C%E7%B4%A2%E7%A6%8F%E5%88%A9.jpeg" alt="ç¾¤æœç´¢">&lt;/p>
&lt;p>&lt;img src="https://pinkhello.github.io/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E7%BE%A4%E6%90%9C%E7%B4%A2%E8%8F%A0%E8%8F%9C%E5%A4%9A.jpeg" alt="ç¾¤æœç´¢">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æˆ‘é»˜é»˜çš„åŠ äº†ä¸€ä¸ªçœ‹ä¼¼æ­£å¸¸çš„ç¾¤ï¼Œè¿›ç¾¤åæˆ‘é£åŒ–äº†ï¼ï¼ï¼ï¼&lt;/p>
&lt;p>&lt;img src="https://pinkhello.github.io/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E7%BE%A4%E8%BF%9D%E8%A7%84%E5%86%85%E5%AE%B91.jpeg" alt="è¿›ç¾¤ä¿¡æ¯">&lt;/p>
&lt;p>&lt;img src="https://pinkhello.github.io/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E7%BE%A4%E8%BF%9D%E8%A7%84%E5%86%85%E5%AE%B92.jpeg" alt="è¿›ç¾¤ä¿¡æ¯">&lt;/p>
&lt;p>&lt;img src="https://pinkhello.github.io/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E8%BF%9D%E8%A7%84%E7%BE%A4%E5%86%85%E5%AE%B95.png" alt="è¿›ç¾¤ä¿¡æ¯">&lt;/p>
&lt;p>ä¸‹é¢æ˜¯é˜²éª—å®˜æ–¹ç¾¤é‡Œçš„&lt;/p>
&lt;p>&lt;img src="https://pinkhello.github.io/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E5%AE%A3%E4%BC%A0%E7%BE%A4%E8%BF%9D%E8%A7%843.jpeg" alt="è¿›ç¾¤ä¿¡æ¯">&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h1 id="å¥½äº†æ€»ç»“ä¸€ä¸‹batchat">å¥½äº†ï¼Œæ€»ç»“ä¸€ä¸‹BatChatï¼&lt;/h1>
&lt;p>è™è APPèšåˆäº†å“ªäº›äººï¼Ÿ&lt;/p>
&lt;ul>
&lt;li>ç»å¤§éƒ¨åˆ†é»‘ç°äº§ä¸šé“¾ä¸Šä¸‹æ¸¸äººå‘˜ï¼&lt;/li>
&lt;li>æå°éƒ¨åˆ†å°é²œçš„å°ç™½&lt;/li>
&lt;li>å½“ç„¶å› ä¸ºé™Œç”ŸäººèŠå¤©ï¼Œæˆ‘èƒ½è¿›å…¥çš„åªæœ‰ç¾¤æœç´¢ï¼Œåº”è¯¥è¿˜æœ‰æ›´æ·±çš„ã€‚&lt;/li>
&lt;/ul>
&lt;p>å½“ç„¶ä¸ªäººè®¤ä¸ºï¼Œæ­¤å¹³å°ç«Ÿç„¶èƒ½è¿è¡Œåˆ°ç°åœ¨ï¼Œåé¢æƒ³è±¡çš„ç©ºé—´å¾ˆå¤§å•Š&lt;/p>
&lt;p>è¡¥ä¸ªåˆ€ï¼ŒçŸ¥ä¹ä¸“æ  &lt;a href="https://zhuanlan.zhihu.com/p/158261618">https://zhuanlan.zhihu.com/p/158261618&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>è¿™å°¼ç›å°±æ˜¯ä¸ºé»‘ç°äº§ä¸šæ­å»ºèšåˆå¹³å°å•Šï¼è™½è¯´ä½ ä¸æƒ³ï¼Œä½†æ˜¯å°±å®£ä¼ çš„ç«¯åˆ°ç«¯åŠ å¯†ä»¥åŠæ¶ˆæ¯æ’¤å›ï¼Œè¿™ä¸ªä¸æ­£æ˜¯ä»–ä»¬åœ¨æ„çš„ä¹ˆï¼Ÿ
å½“ç„¶æŸè…¾ä¹Ÿå®£ç§°ä¸å­˜å‚¨**å•¥çš„ï¼Ÿä½ ä¿¡ï¼Ÿ&lt;/p>
&lt;/blockquote>
&lt;p>ç°åœ¨æˆ‘è¦éƒ‘é‡å£°æ˜ï¼šæˆ‘é»˜é»˜çš„åˆ é™¤äº†æ­¤æ¬¾APPï¼ï¼ï¼&lt;/p>
- https://pinkhello.github.io/posts/12-%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0chat/ - ä¸€æ¯å“ˆå¸Œä¸åŠ ç›, All Rights Reserved</description></item><item><title>11 å‡ ä¸ªå…³äºkafkaçš„çŸ¥è¯†ç‚¹</title><link>https://pinkhello.github.io/posts/11-%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/</link><pubDate>Wed, 10 Feb 2021 08:55:19 +0800</pubDate><guid>https://pinkhello.github.io/posts/11-%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/</guid><description>ä¸€æ¯å“ˆå¸Œä¸åŠ ç› https://pinkhello.github.io/posts/11-%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/ -&lt;h1 id="è®¤è¯†kafka">è®¤è¯†kafka&lt;/h1>
&lt;p>&lt;code>Kafka&lt;/code> æ˜¯åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿï¼Œ &lt;code>Apache&lt;/code> çš„å­é¡¹ç›®ã€‚æ ‡è¯­ä¹Ÿå˜äº†&amp;quot;åˆ†å¸ƒå¼æµå¹³å°&amp;quot;ï¼Œ
ä¸ä¼ ç»Ÿçš„æ¶ˆæ¯ç³»ç»Ÿä¸åŒç‚¹åœ¨äº&lt;/p>
&lt;ul>
&lt;li>åˆ†å¸ƒå¼çš„ï¼Œæ˜“äºæ‰©å±•&lt;/li>
&lt;li>ä¸ºå‘å¸ƒå’Œè®¢é˜…æä¾›äº†é«˜åå&lt;/li>
&lt;li>æ”¯æŒå¤šè®¢é˜…è€…ï¼Œåœ¨å¤±è´¥çš„æ—¶å€™èƒ½è‡ªåŠ¨å¹³è¡¡æ¶ˆè´¹è€…&lt;/li>
&lt;li>æ¶ˆæ¯çš„æŒä¹…åŒ–&lt;/li>
&lt;/ul>
&lt;h1 id="kafka-çš„æ¶æ„">&lt;code>kafka&lt;/code> çš„æ¶æ„&lt;/h1>
&lt;p>å‡ ç‚¹ï¼Ÿ&lt;/p>
&lt;ul>
&lt;li>&lt;code>Kafka&lt;/code> çš„ &lt;code>Topic&lt;/code> å’Œ &lt;code>Partition&lt;/code> å†…éƒ¨å¦‚ä½•å­˜å‚¨ï¼Ÿ&lt;/li>
&lt;li>ä¸ä¼ ç»Ÿçš„æ¶ˆæ¯ç³»ç»Ÿç›¸æ¯”ï¼Œ &lt;code>Kafka&lt;/code> æ¶ˆè´¹æ¨¡å‹æœ‰å•¥ä¼˜ç‚¹ï¼Ÿ&lt;/li>
&lt;li>&lt;code>Kafka&lt;/code> æ˜¯å¦‚ä½•å®ç°åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨å’Œæ•°æ®çš„è¯»å–ï¼Ÿ&lt;/li>
&lt;/ul>
&lt;h2 id="kafka-æ¶æ„">&lt;code>Kafka&lt;/code> æ¶æ„&lt;/h2>
&lt;p>ä¸€ä¸ª &lt;code>Kafka&lt;/code> é›†ç¾¤ï¼Œå¤šä¸ª &lt;code>Producer&lt;/code> ï¼Œå¤šä¸ª &lt;code>Consumer&lt;/code> ï¼Œå¤šä¸ª &lt;code>Broker&lt;/code> ï¼Œ é€‰ä¸¾ &lt;code>Leader&lt;/code> ä»¥åŠåœ¨ &lt;code>Consumer Group&lt;/code> å‘ç”Ÿå˜åŒ–æ—¶è¿›è¡Œ &lt;code>reblance&lt;/code> ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>Broker&lt;/code> æ¶ˆæ¯ä¸­é—´ä»¶çš„å¤„ç†èŠ‚ç‚¹ï¼Œä¸€ä¸ª &lt;code>Kafka&lt;/code> èŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ª &lt;code>Broker&lt;/code> ï¼Œ ä¸€ä¸ªæˆ–è€…å¤šä¸ª &lt;code>Broker&lt;/code> ç»„æˆ &lt;code>Kafka&lt;/code> é›†ç¾¤&lt;/li>
&lt;li>&lt;code>Topic&lt;/code> &lt;code>Kafka&lt;/code> æ ¹æ® &lt;code>Topic&lt;/code> å¯¹ &lt;code>Message&lt;/code> è¿›è¡Œå½’ç±»ï¼Œå‘å¸ƒåˆ° &lt;code>Kafka&lt;/code> çš„æ¯æ¡ &lt;code>Message&lt;/code> éƒ½è¦æŒ‡å®š &lt;code>Topic&lt;/code>&lt;/li>
&lt;li>&lt;code>Producer&lt;/code> å‘ &lt;code>Broker&lt;/code> å‘ç”Ÿ &lt;code>message&lt;/code>&lt;/li>
&lt;li>&lt;code>Consumer&lt;/code> ä» &lt;code>Broker&lt;/code> è¯»å– &lt;code>message&lt;/code>&lt;/li>
&lt;li>&lt;code>Consumer Group&lt;/code> æ¯ä¸ª Consumer å±äºç‰¹å®šçš„ Groupï¼Œä¸€ä¸ª Message å¯ä»¥å‘é€ç»™ä¸åŒçš„ &lt;code>Consumer Group&lt;/code> ï¼Œä½†æ˜¯åŒä¸€ä¸ª &lt;code>Group&lt;/code> ä¸‹çš„åªæœ‰ä¸€ä¸ª &lt;code>Consumer&lt;/code> èƒ½æ¶ˆè´¹è¯¥ &lt;code>Message&lt;/code>&lt;/li>
&lt;li>&lt;code>Partition&lt;/code> ç‰©ç†æ¦‚å¿µï¼Œä¸€ä¸ª &lt;code>Topic&lt;/code> ä¸‹å¯ä»¥åˆ†ä¸ºå¤šä¸ª &lt;code>Partition&lt;/code>, æ¯ä¸ª &lt;code>Partition&lt;/code> ä¸‹æ˜¯æœ‰åºçš„ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://pinkhello.github.io/%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/kafka-%E6%A1%86%E6%9E%B6%E5%9B%BE.jpeg" alt="kafka æ¡†æ¶å›¾">
&lt;img src="https://pinkhello.github.io/%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/kafka-%E6%95%B0%E6%8D%AE%E6%B5%81%E5%90%91.png" alt="kafka æ•°æ®æµå‘">&lt;/p>
&lt;p>ä¸‹é¢æ¥è®²è¿° ä¸Šé¢ä¸ºé—®é¢˜å•Š&lt;/p>
&lt;h2 id="kafka-çš„-topic-å’Œ-partition-å†…éƒ¨å¦‚ä½•å­˜å‚¨">&lt;code>Kafka&lt;/code> çš„ &lt;code>Topic&lt;/code> å’Œ &lt;code>Partition&lt;/code> å†…éƒ¨å¦‚ä½•å­˜å‚¨?&lt;/h2>
&lt;p>&lt;code>Kafka&lt;/code> ä¸ºæ¯ä¸ª &lt;code>Topic&lt;/code> ç»´æŠ¤äº†åˆ†åŒºï¼ˆ &lt;code>Partition&lt;/code> ï¼‰çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ¯ä¸ª &lt;code>Partition&lt;/code> åœ¨ &lt;code>kafka&lt;/code> å­˜å‚¨å±‚ä¸º &lt;code>Append Log&lt;/code>ã€‚ä»»ä½•å‘å¸ƒåˆ°æ­¤ &lt;code>Partition&lt;/code> çš„æ¶ˆæ¯éƒ½ä¼šè¢«è¿½åŠ åˆ° &lt;code>Log&lt;/code> æ–‡ä»¶å°¾éƒ¨ã€‚
åœ¨æ¯ä¸ª &lt;code>Partition&lt;/code> æ¯ä¸ªæ¶ˆæ¯æ˜¯æŒ‰ç…§ &lt;code>Timeline&lt;/code> åˆ†é…åˆ°ä¸€ä¸ªå•è°ƒé€’å¢çš„é¡ºåºç¼–å·çš„ï¼Œå°±æ˜¯æˆ‘ä»¬è¯´çš„ &lt;code>Offset&lt;/code>, &lt;code>Offset&lt;/code> æ˜¯ä¸€ä¸ª &lt;code>long&lt;/code> å‹çš„æ•°å­—ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ª &lt;code>Offset&lt;/code> ç¡®å®šä¸€æ¡åœ¨è¯¥ &lt;code>Partition&lt;/code> ä¸‹çš„å”¯ä¸€æ¶ˆæ¯ã€‚&lt;/p>
&lt;p>è¿™æ ·å°±æœ‰ä¸ªç‰¹æ€§ï¼š &lt;code>Partition&lt;/code> ä¸‹æœ‰åº, &lt;code>Topic&lt;/code> ä¸‹æ— æ³•ä¿è¯æœ‰åºã€‚&lt;/p>
&lt;p>é‚£ä¹ˆï¼Œé—®é¢˜æ¥äº†ï¼Ÿè¿™äº› &lt;code>Message&lt;/code> å¦‚ä½•å‘é€åˆ°å„ä¸ª &lt;code>Partition&lt;/code> çš„å‘¢ï¼Ÿå¦‚ä½•æŒ‡å®šçš„å‘¢ï¼Ÿ&lt;/p>
&lt;ul>
&lt;li>å‘é€è‡³å“ªä¸ª &lt;code>Partition&lt;/code> æ˜¯ç”± ç”Ÿäº§è€…å†³å®šçš„ã€‚&lt;/li>
&lt;li>å¦‚æœæ²¡æœ‰ &lt;code>Key&lt;/code> å€¼ï¼Œåˆ™è½®è¯¢å‘é€&lt;/li>
&lt;li>å¦‚æœæœ‰ &lt;code>key&lt;/code> å€¼ï¼Œå¯¹ &lt;code>key&lt;/code> å€¼è¿›è¡Œ &lt;code>Hash&lt;/code> ï¼Œç„¶åå¯¹åˆ†åŒºæ•°é‡å–ä½™ï¼Œä¿è¯åŒä¸€ä¸ª &lt;code>Key&lt;/code> å€¼çš„ä¼šè·¯ç”±åˆ°åŒä¸€ä¸ª &lt;code>Partition&lt;/code> ã€‚å¦‚æœæƒ³é˜Ÿåˆ—å¼ºé¡ºåºä¸€è‡´ï¼Œå¯ä»¥è®©æ‰€æœ‰çš„æ¶ˆæ¯è®¾ç½®ä¸ºåŒä¸€ä¸ª &lt;code>Key&lt;/code> ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸ä¼ ç»Ÿçš„æ¶ˆæ¯ç³»ç»Ÿç›¸æ¯”-kafka-æ¶ˆè´¹æ¨¡å‹æœ‰å•¥ä¼˜ç‚¹">ä¸ä¼ ç»Ÿçš„æ¶ˆæ¯ç³»ç»Ÿç›¸æ¯”ï¼Œ &lt;code>Kafka&lt;/code> æ¶ˆè´¹æ¨¡å‹æœ‰å•¥ä¼˜ç‚¹ï¼Ÿ&lt;/h2>
&lt;h3 id="kafka-consumer-æ¶ˆè´¹æ¨¡å‹">&lt;code>Kafka Consumer&lt;/code> æ¶ˆè´¹æ¨¡å‹&lt;/h3>
&lt;p>æ¶ˆæ¯ç”± &lt;code>producer&lt;/code> å‘é€åˆ° &lt;code>Kafka&lt;/code> é›†ç¾¤åï¼Œè¢« &lt;code>Consumer&lt;/code> æ¶ˆè´¹ï¼Œä¸€èˆ¬æ¥è¯´æˆ‘ä»¬çš„æ¶ˆè´¹æ¨¡å‹æœ‰ä¸¤ç§ï¼š &lt;code>Push&lt;/code> æ¨é€æ¨¡å‹ å’Œ &lt;code>Pull&lt;/code> æ‹‰å–æ¨¡å‹&lt;/p>
&lt;p>&lt;code>Push&lt;/code> æ¨é€æ¨¡å‹ï¼š&lt;/p>
&lt;blockquote>
&lt;p>æ¶ˆæ¯ &lt;code>Broker&lt;/code> è®°å½•æ¶ˆè´¹çŠ¶æ€ã€‚æ¶ˆæ¯ &lt;code>Broker&lt;/code> å°†æ¶ˆæ¯æ¨é€ç»™æ¶ˆè´¹è€…åï¼Œè®°å½•è¿™æ¡æ¶ˆæ¯å·²ç»è¢«æ¶ˆè´¹ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼æ— æ³•å¾ˆå¥½çš„ä¿è¯æ¶ˆè´¹å¤„ç†çš„è¯­ä¹‰ã€‚
æ¶ˆæ¯æ¨é€å®Œæˆåï¼Œæ¶ˆè´¹è€…æŒ‚æ‰æˆ–è€…çº¿ç¨‹ Hang ä½ ï¼Œæˆ–è€…ç½‘ç»œåŸå› æœªæ”¶åˆ°ï¼Œä½†æ˜¯ æ¶ˆæ¯ &lt;code>Broker&lt;/code> å°†å…¶æ ‡è®°ä¸ºå·²æ¶ˆè´¹ï¼Œè¿™ä¸ªæ¶ˆæ¯å°†æ°¸è¿œä¸¢å¤±äº†ã€‚
ä¹Ÿå°±æ˜¯è¯´ï¼Œé‡‡ç”¨ &lt;code>Push&lt;/code> ï¼Œæ¶ˆæ¯æ¶ˆè´¹å®Œå…¨ä¾èµ– æ¶ˆæ¯ &lt;code>Broker&lt;/code> æ§åˆ¶ï¼Œä¸€æ—¦ &lt;code>Consumer&lt;/code> å‘ç”Ÿé˜»å¡ï¼Œä¼šå‡ºç°é—®é¢˜ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>&lt;code>Pull&lt;/code> æ‹‰å–æ¨¡å‹ï¼š&lt;/p>
&lt;blockquote>
&lt;p>ç”± &lt;code>Consumer&lt;/code> æ§åˆ¶ &lt;code>Speed&lt;/code> ï¼Œä»¥åŠæ¶ˆè´¹ &lt;code>Offset&lt;/code> ï¼Œ &lt;code>Consumer&lt;/code> å¯ä»¥æŒ‰ç…§ä»»æ„çš„åç§»é‡è¿›è¡Œ &lt;code>Consumer&lt;/code>
&lt;code>Consumer&lt;/code> å¯ä»¥å›æ”¾å·²ç»æ¶ˆè´¹è¿‡çš„æ¶ˆæ¯ï¼Œè¿›è¡Œé‡æ–°å¤„ç†æˆ–è€…æ¶ˆè´¹æœ€è¿‘çš„æ¶ˆæ¯&lt;/p>
&lt;/blockquote>
&lt;h3 id="kafka-çš„ç½‘ç»œæ¨¡å‹">&lt;code>Kafka&lt;/code> çš„ç½‘ç»œæ¨¡å‹&lt;/h3>
&lt;p>&lt;code>Kafka Client&lt;/code> å•çº¿ç¨‹ &lt;code>Selector&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://pinkhello.github.io/%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/kafka-client-selector.png" alt="kafka å•çº¿ç¨‹æ¨¡å‹">&lt;/p>
&lt;blockquote>
&lt;p>å¹¶å‘é“¾æ¥æ•°ç›®å°ï¼Œé€»è¾‘ç®€å•ï¼Œæ•°æ®é‡å°ã€‚åœ¨ &lt;code>Kafka Consumer&lt;/code> å’Œ &lt;code>Kafka Producer&lt;/code> éƒ½æ˜¯é‡‡ç”¨çš„ å•çº¿ç¨‹æ¨¡å‹ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>&lt;code>kafka Server&lt;/code> å¤šçº¿ç¨‹ &lt;code>Selector&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://pinkhello.github.io/%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/kafka-server-selector.png" alt="kafka å¤šçº¿ç¨‹æ¨¡å‹">&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>Acceptor&lt;/code> è¿è¡Œäºä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ï¼Œå¯¹äºè¯»å–æ“ä½œçš„çº¿ç¨‹æ± ä¸­çº¿ç¨‹éƒ½æ˜¯åœ¨ &lt;code>selector&lt;/code> æ³¨å†Œ &lt;code>Op_Read&lt;/code> äº‹ä»¶ï¼Œè´Ÿè´£æœåŠ¡ç«¯è¯»å–è¯·æ±‚ã€‚
æˆåŠŸè¯»å–åï¼Œå°†è¯·æ±‚æ”¾å…¥ &lt;code>Message Queue&lt;/code> å…±äº«é˜Ÿåˆ—ä¸­ï¼Œç„¶ååœ¨ å†™æ“ä½œçš„çº¿ç¨‹æ± ä¸­ï¼Œå–å‡ºè¿™ä¸ªè¯·æ±‚ï¼Œå¯¹å…¶è¿›è¡Œé€»è¾‘å¤„ç†ã€‚
å³ä½¿æŸä¸ªçº¿ç¨‹é˜»å¡äº†ï¼Œåé¢è¿˜æœ‰åç»­çš„çº¿ç¨‹ä» &lt;code>Message Queue&lt;/code> å…±äº«é˜Ÿåˆ—é‡Œé¢è·å–è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚
å†™çº¿ç¨‹å¤„ç†å®Œé€»è¾‘åï¼Œç”±äºæ³¨å†Œäº† &lt;code>Op_Write&lt;/code> äº‹ä»¶ï¼Œè¿˜éœ€è¦å‘é€å“åº”ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kafka-æ˜¯å¦‚ä½•å®ç°åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨å’Œæ•°æ®çš„è¯»å–">&lt;code>Kafka&lt;/code> æ˜¯å¦‚ä½•å®ç°åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨å’Œæ•°æ®çš„è¯»å–ï¼Ÿ&lt;/h2>
&lt;h3 id="kafka-é«˜å¯é çš„åˆ†å¸ƒå¼å­˜å‚¨æ¨¡å‹">&lt;code>Kafka&lt;/code> é«˜å¯é çš„åˆ†å¸ƒå¼å­˜å‚¨æ¨¡å‹&lt;/h3>
&lt;p>ä¸»è¦ä¾é  å‰¯æœ¬ æœºåˆ¶ï¼Œæœ‰äº†å‰¯æœ¬æœºåˆ¶ï¼Œæœºå™¨å®•æœºï¼Œä¹Ÿä¼šæ¢å¤ã€‚&lt;/p>
&lt;h3 id="kafka-é«˜æ€§èƒ½æ—¥å¿—å­˜å‚¨">&lt;code>Kafka&lt;/code> é«˜æ€§èƒ½æ—¥å¿—å­˜å‚¨&lt;/h3>
&lt;p>&lt;img src="https://pinkhello.github.io/%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/kafka-segement.png" alt="kafka é«˜æ€§èƒ½æ—¥å¿—å­˜å‚¨">
&lt;img src="https://pinkhello.github.io/%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/kafka-append-log.png" alt="kafka é«˜æ€§èƒ½æ—¥å¿—å­˜å‚¨">&lt;/p>
&lt;p>&lt;code>Kafka&lt;/code> çš„ä¸€ä¸ª &lt;code>Topic&lt;/code> ä¸‹çš„æ‰€æœ‰çš„ &lt;code>Message&lt;/code> éƒ½æ˜¯ä»¥ &lt;code>Partition&lt;/code> çš„æ–¹å¼ï¼Œåˆ†å¸ƒå¼å­˜å‚¨åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šã€‚&lt;/p>
&lt;p>åŒæ—¶åœ¨ kafka æœºå™¨ä¸Šï¼Œæ¯ä¸ª &lt;code>Partition&lt;/code> éƒ½ä¼šå¯¹åº”ä¸€ä¸ªæ—¥å¿—ç›®å½•ï¼Œåœ¨ç›®å½•ä¸‹é¢ä¼šå¯¹åº”å¯¹æ­Œ æ—¥å¿—åˆ†æ®µï¼ˆ&lt;code>LogSegment&lt;/code>ï¼‰ã€‚
LogSegment ç»„æˆ &amp;ldquo;.index&amp;rdquo; ä¸ &amp;ldquo;.log&amp;rdquo; , åˆ†åˆ«è¡¨ç¤º &lt;code>segment&lt;/code> ç´¢å¼•æ–‡ä»¶ å’Œ æ•°æ®æ–‡ä»¶ã€‚
ä¸¤ä¸ªæ–‡ä»¶çš„å‘½åè§„åˆ™: &lt;code>partition&lt;/code> å…¨å±€çš„ç¬¬ä¸€ä¸ª &lt;code>segment&lt;/code> ä» 0 å¼€å§‹ï¼Œåç»­çš„æ¯ä¸ª &lt;code>Segment&lt;/code> æ–‡ä»¶åä¸ºä¸Šä¸€ä¸ª &lt;code>Segment&lt;/code> æ–‡ä»¶æœ€åä¸€æ¡æ¶ˆæ¯çš„ &lt;code>offset&lt;/code> å€¼ã€‚
æ•°å€¼ä¸º 64 ä½ï¼Œ 20 ä½æ•°å­—å­—ç¬¦é•¿åº¦ï¼Œæ²¡æœ‰æ•°å­—ç”¨ 0 å¡«å……ã€‚&lt;/p>
&lt;p>å‡å¦‚æœ‰ 1000 æ¡æ¶ˆæ¯ï¼Œæ¯ä¸ª &lt;code>LogSegment&lt;/code> çš„å¤§å°ä¸º 100ï¼Œé‚£ä¹ˆå±•ç° 900-1000 çš„ç´¢å¼• å’Œ Logï¼š
&lt;img src="https://pinkhello.github.io/%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/kafka-log.jpg" alt="kafka LogSegment">&lt;/p>
&lt;p>&lt;code>kafka&lt;/code> æ¶ˆæ¯æ•°æ®é‡æ‰“ï¼Œé‡‡ç”¨çš„æ˜¯ &lt;code>ç¨€ç–ç´¢å¼•&lt;/code> çš„æ–¹å¼ï¼ŒåŠ å¿«åæŸ¥è¯¢é€Ÿåº¦ã€‚&lt;/p>
&lt;p>å¦‚ä½•è¯»å–æ•°æ®ï¼Ÿ å¦‚æœæˆ‘ä»¬è¦è¯»å–ç¬¬ 911 æ¡æ•°æ®&lt;/p>
&lt;ul>
&lt;li>å…ˆæ‰¾åˆ°å®ƒå±äºå“ªä¸ªæ®µï¼Ÿ äºŒåˆ†æ³•æŸ¥æ‰¾å±äºæ–‡ä»¶ï¼Œæ‰¾åˆ° 0000900.index å’Œ 0000900.log ä¹‹å&lt;/li>
&lt;li>å»ç´¢å¼•æ–‡ä»¶ 0000900.index æŸ¥æ‰¾ (911-900)=11 è¿™ä¸ªç´¢å¼• æˆ–è€… å°äº11 æœ€è¿‘çš„ç´¢å¼•&lt;/li>
&lt;li>åé¢é€šè¿‡ äºŒåˆ†æ³•æˆ‘ä»¬æ‰¾åˆ°ç´¢å¼• [10,1367]&lt;/li>
&lt;li>ç„¶åé€šè¿‡è¿™æ¡ç´¢å¼•çš„ç‰©ç†ä½ç½® 1367ï¼Œå¼€å§‹å¾€åæ‰¾ï¼ŒçŸ¥é“æ‰¾åˆ° ç¬¬ 911 æ¡æ•°æ®&lt;/li>
&lt;/ul>
&lt;p>&lt;code>ä¸ºä»€ä¹ˆåˆ†åŒºï¼Ÿåªæœ‰ä¸€ä¸ªåˆ†åŒºä¸è¡Œä¹ˆï¼Ÿåˆ†åŒºæ˜¯ä¸ºäº†å¹²å•¥ï¼Ÿé‚£ä¹ˆæ—¥å¿—ä¸ºä»€ä¹ˆè¦åˆ†æ®µå‘¢ï¼Ÿ&lt;/code>&lt;/p>
&lt;h2 id="kafka-çš„å‰¯æœ¬æœºåˆ¶">&lt;code>Kafka&lt;/code> çš„å‰¯æœ¬æœºåˆ¶&lt;/h2>
&lt;p>&lt;code>Kafka&lt;/code> å‰¯æœ¬æœºåˆ¶ä¸º å¤šä¸ªèŠ‚ç‚¹å¯¹å…¶ä»–æœåŠ¡ç«¯èŠ‚ç‚¹çš„ä¸»é¢˜åˆ†åŒºçš„æ—¥å¿—è¿›è¡Œå¤åˆ¶ã€‚å½“é›†ç¾¤æŸä¸ªèŠ‚ç‚¹å‡ºç°é—®é¢˜ï¼Œè®¿é—®è¯¥æ•…éšœèŠ‚ç‚¹çš„è¯·æ±‚å¯ä»¥è¢«è½¬ç§»åˆ°å…¶ä»–æ­£å¸¸çš„èŠ‚ç‚¹ï¼ˆè¿‡ç¨‹è„š &lt;code>reblance&lt;/code> ï¼‰&lt;/p>
&lt;p>&lt;code>kafka&lt;/code> çš„æ¯ä¸ª &lt;code>Topic&lt;/code> çš„æ¯ä¸ª &lt;code>Partition&lt;/code> éƒ½æœ‰ä¸€ä¸ª ä¸»å‰¯æœ¬ä»¥åŠ &lt;code>0-n&lt;/code> ä¸ªå‰¯æœ¬ï¼Œå‰¯æœ¬ä¿æŒä¸ä¸»å‰¯æœ¬çš„æ•°æ®åŒæ­¥ï¼Œå½“ ä¸»å‰¯æœ¬ å‡ºç°æ•…éšœæ—¶ä¼šè¢«æ›¿ä»£ã€‚&lt;/p>
&lt;p>&lt;img src="https://pinkhello.github.io/%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/kafka-partition-replicas.png" alt="kafka é«˜æ€§èƒ½å‰¯æœ¬æœºåˆ¶">&lt;/p>
&lt;p>åœ¨ &lt;code>kafka&lt;/code> ä¸­ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„å‰¯æœ¬éƒ½è¢«æ‹¿æ¥ä»£æ›¿ä¸»å‰¯æœ¬çš„ï¼Œæ‰€ä»¥åœ¨ &lt;code>kafka&lt;/code> çš„ &lt;code>leader&lt;/code> èŠ‚ç‚¹ä¸­ç»´æŠ¤è€…ä¸€ä¸ª &lt;code>ISRï¼ˆIn Sync Replicasï¼‰&lt;/code>é›†åˆ
&lt;code>ISR (In Sync Replicas)&lt;/code> å‰¯æœ¬ &lt;code>follower&lt;/code> åŒæ­¥é˜Ÿåˆ—, ç»´æŠ¤ç€æœ‰èµ„æ ¼çš„ &lt;code>follower&lt;/code> çš„èŠ‚ç‚¹&lt;/p>
&lt;ul>
&lt;li>å‰¯æœ¬çš„æ‰€æœ‰èŠ‚ç‚¹å¿…é¡»å’Œ &lt;code>ZK&lt;/code> ä¿æŒé“¾æ¥&lt;/li>
&lt;li>åœ¨åŒæ­¥è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªå‰¯æœ¬ä¸èƒ½è½åä¸»å‰¯æœ¬å¤ªå¤š(å³å‰¯æœ¬æœ€åä¸€æ¡æ¶ˆæ¯çš„ &lt;code>offset&lt;/code> å’Œ &lt;code>leader&lt;/code> å‰¯æœ¬çš„æœ€å¥½ä¸€æ¡æ¶ˆæ¯çš„ &lt;code>offset&lt;/code> ä¹‹é—´çš„å·®å€¼ä¸èƒ½è¶…è¿‡é˜ˆå€¼)
(&lt;code>replica.lag.max.messages&lt;/code>)&lt;/li>
&lt;/ul>
&lt;p>&lt;code>ARï¼ˆAssigned Replicasï¼‰&lt;/code>æ ‡è®°å‰¯æœ¬çš„å…¨é›† ï¼Œ&lt;code>OSR&lt;/code> è¡¨ç¤ºè½åè¢«å‰”é™¤çš„å‰¯æœ¬é›†åˆ&lt;/p>
&lt;p>ISR = leader + æ²¡æœ‰è½åå¤ªå¤šçš„å‰¯æœ¬
AR = OSR + ISR&lt;/p>
&lt;p>&lt;code>HW &amp;amp; LEO&lt;/code>
&lt;code>Follower&lt;/code> å‰¯æœ¬åŒæ­¥è¿‡ç¨‹ä¸­ï¼Œä¸¤ä¸ªæ¦‚å¿µ &lt;code>HW&lt;/code> &lt;code>HighWatermark&lt;/code> å’Œ &lt;code>LEO&lt;/code> &lt;code>Log End Offset&lt;/code>ï¼Œä¸ &lt;code>ISR&lt;/code> ç´§å¯†ç›¸å…³ã€‚&lt;/p>
&lt;p>&lt;code>HW&lt;/code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ &lt;code>Offset&lt;/code> ï¼Œå½“ &lt;code>Consumer&lt;/code> å¤„ç†æ¶ˆæ¯çš„æ—¶å€™ï¼Œåªèƒ½ &lt;code>Pull&lt;/code> åˆ° &lt;code>HW&lt;/code> ä¹‹å‰çš„æ¶ˆæ¯ï¼Œ &lt;code>HW&lt;/code> ä¹‹åçš„æ¶ˆæ¯å¯¹ &lt;code>Consumer&lt;/code> ä¸å¯è§ã€‚
ä¹Ÿå°±æ˜¯è¯´ &lt;code>Partition&lt;/code> å¯¹åº”çš„ ISR ä¸­æœ€å°çš„ &lt;code>LEO&lt;/code> ä½œä¸º &lt;code>HW&lt;/code> ï¼Œ &lt;code>Consumer&lt;/code> æœ€å¤šåªèƒ½æ¶ˆè´¹åˆ° &lt;code>HW&lt;/code> æ‰€åœ¨çš„ä½ç½®ï¼Œæ¯ä¸ª &lt;code>Replica&lt;/code> éƒ½æœ‰ &lt;code>HW&lt;/code> ï¼Œ
&lt;code>leader&lt;/code> å’Œ &lt;code>follower&lt;/code> å„è‡ªç»´æŠ¤æ›´æ–°è‡ªå·±çš„ &lt;code>HW&lt;/code> çš„çŠ¶æ€ï¼Œå¯¹äº &lt;code>Leader&lt;/code> æ–°å†™å…¥çš„æ¶ˆæ¯ï¼Œ &lt;code>Consumer&lt;/code> ä¸èƒ½ç«‹åˆ»æ¶ˆè´¹ï¼Œ &lt;code>Leader&lt;/code> ä¼šç­‰å¾…
è¯¥æ¶ˆæ¯è¢«æ‰€æœ‰çš„ &lt;code>ISR&lt;/code> ä¸­çš„ &lt;code>Replicas&lt;/code> åŒæ­¥æ›´æ–° &lt;code>HW&lt;/code> ï¼Œæ­¤æ—¶æ¶ˆæ¯æ‰èƒ½è¢« &lt;code>Consumer&lt;/code> æ¶ˆè´¹ï¼Œè¿™æ ·ä¿è¯äº†å¦‚æœ &lt;code>Leader&lt;/code> å‰¯æœ¬æŸåï¼Œ
è¯¥æ¶ˆæ¯ä»ç„¶å¯ä»¥ä»æ–°é€‰ä¸¾çš„ &lt;code>Leader&lt;/code> è·å–ã€‚&lt;/p>
&lt;p>&lt;code>LEO&lt;/code> æ˜¯æ‰€æœ‰å‰¯éƒ½ä¼šæœ‰çš„ä¸€ä¸ª &lt;code>offset&lt;/code> æ ‡è®°ï¼Œå®ƒæŒ‡å‘è¿½åŠ åˆ°å½“å‰å‰¯æœ¬çš„æœ€åä¸€ä¸ªæ¶ˆæ¯çš„ &lt;code>offset&lt;/code> ï¼Œå½“ç”Ÿäº§è€…å‘ &lt;code>Leader&lt;/code> å‰¯æœ¬è¿½åŠ æ¶ˆæ¯æ—¶å€™ï¼Œ &lt;code>Leader&lt;/code> å‰¯æœ¬çš„ &lt;code>LEO&lt;/code> æ ‡è®°å°±ä¼šé€’å¢ï¼›
å½“ &lt;code>follower&lt;/code> å‰¯æœ¬æˆåŠŸä» &lt;code>leader&lt;/code> å‰¯æœ¬ &lt;code>pull&lt;/code> æ¶ˆæ¯å¹¶æ›´æ–°åˆ°æœ¬åœ°çš„æ—¶å€™ï¼Œ &lt;code>follower&lt;/code> å‰¯æœ¬ä¹Ÿä¼šå¢è‚Œ&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>producer&lt;/code> å‘ &lt;code>leader&lt;/code> å‘é€æ¶ˆæ¯ï¼Œå¯ä»¥é€šè¿‡ &lt;code>request.required.acks&lt;/code> å‚æ•°æ¥è®¾ç½®æ•°æ®å¯é æ€§çº§åˆ«ï¼š&lt;/p>
&lt;ul>
&lt;li>1 é»˜è®¤ï¼Œ &lt;code>producer&lt;/code> åœ¨ &lt;code>ISR&lt;/code> ä¸­çš„ &lt;code>leader&lt;/code> å·²æˆåŠŸæ”¶åˆ°æ•°æ®å¹¶å¾—åˆ°ç¡®è®¤åå‘é€ä¸‹ä¸€æ¡ &lt;code>Message&lt;/code> ã€‚å¦‚æœ &lt;code>Leader&lt;/code> å®•æœºï¼Œä¼šä¸¢å¤±æ•°æ®&lt;/li>
&lt;li>0 &lt;code>producer&lt;/code> æ— éœ€ç­‰å¾…ï¼Œç»§ç»­å‘é€ä¸‹ä¸€æ‰¹æ¶ˆæ¯ï¼Œæ•ˆç‡é«˜ï¼Œä½†æ˜¯æ•°æ®å¯é æ€§ä½&lt;/li>
&lt;li>-1 &lt;code>producer&lt;/code> éœ€è¦ç­‰å¾… &lt;code>ISR&lt;/code> ä¸­æ‰€ä»¥çš„ &lt;code>follower&lt;/code> éƒ½ç¡®è®¤æ¥æ”¶åˆ°æ•°æ®æ‰ç®—å‘é€å®Œæˆã€‚å¯é æ€§é«˜ï¼Œä½†æ˜¯æ²¡æœ‰ä¹Ÿä¸èƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œæ¯”å¦‚ &lt;code>ISR&lt;/code> é‡Œåªæœ‰ &lt;code>leader&lt;/code> ï¼ˆå…¶ä»–èŠ‚ç‚¹å’Œ &lt;code>ZK&lt;/code> æ–­é“¾ï¼Œæˆ–è€…æ²¡æœ‰è¿½ä¸Šï¼‰ï¼Œè¿™æ ·å°±å˜æˆäº† &lt;code>acks=1&lt;/code> çš„æƒ…å†µ&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h1 id="kafka-åˆ°åº•ä¼šä¸ä¼šä¸¢æ¶ˆæ¯">&lt;code>kafka&lt;/code> åˆ°åº•ä¼šä¸ä¼šä¸¢æ¶ˆæ¯&lt;/h1>
&lt;p>ä¸€ä¸ªæ¶ˆæ¯çš„æµè½¬&lt;/p>
&lt;ul>
&lt;li>&lt;code>Producer&lt;/code> å‘é€ç»™ &lt;code>Kafka Broker&lt;/code>&lt;/li>
&lt;li>&lt;code>kafka Broker&lt;/code> æ¶ˆæ¯åŒæ­¥å’ŒæŒä¹…åŒ–&lt;/li>
&lt;li>&lt;code>Kafka Brokder&lt;/code> å°†æ¶ˆæ¯ä¼ é€’ç»™æ¶ˆè´¹è€…&lt;/li>
&lt;/ul>
&lt;h1 id="å¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨-kafka-consumer">å¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨ Kafka Consumer&lt;/h1>
&lt;p>æ³¨æ„ç‚¹ç­‰ç­‰&amp;hellip;..&lt;/p>
&lt;h1 id="kafka-producer-æµç¨‹è¯¦ç»†">&lt;code>kafka Producer&lt;/code> æµç¨‹è¯¦ç»†&lt;/h1>
&lt;p>&lt;img src="https://pinkhello.github.io/%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/kafka-producer-flow.png" alt="kafkaProduceræµç¨‹è§£è¯»">
&lt;img src="https://pinkhello.github.io/%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/kafka-meta-get.png" alt="kafka è·å–å…ƒæ•°æ®">&lt;/p>
- https://pinkhello.github.io/posts/11-%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/ - ä¸€æ¯å“ˆå¸Œä¸åŠ ç›, All Rights Reserved</description></item><item><title>10 å¤šåŸŸåä¸‹çš„SSH</title><link>https://pinkhello.github.io/posts/10-%E5%A4%9A%E5%9F%9F%E5%90%8D%E4%B8%8B%E7%9A%84ssh/</link><pubDate>Wed, 10 Feb 2021 08:52:57 +0800</pubDate><guid>https://pinkhello.github.io/posts/10-%E5%A4%9A%E5%9F%9F%E5%90%8D%E4%B8%8B%E7%9A%84ssh/</guid><description>ä¸€æ¯å“ˆå¸Œä¸åŠ ç› https://pinkhello.github.io/posts/10-%E5%A4%9A%E5%9F%9F%E5%90%8D%E4%B8%8B%E7%9A%84ssh/ -&lt;h1 id="å‰è¨€">å‰è¨€&lt;/h1>
&lt;p>æœ‰æ—¶å€™æˆ‘ä»¬ï¼Œæœ‰å¤šä¸ª git è´¦å·ï¼ˆGitlabã€GitHubï¼‰ï¼Œè¿™æ—¶å€™å¦‚æœæ˜¯åŒä¸€ä¸ªè´¦å·ï¼ˆé‚®ç®±æ³¨å†Œï¼‰ï¼Œé‚£ä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœä¸æ˜¯ç›¸åŒçš„è´¦å·å‘¢ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ SSH KEY åšå…å¯†ç™»å½•æ—¶å€™ï¼Œå¤´ç—›äº†ã€‚&lt;/p>
&lt;p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦é’ˆå¯¹ä¸åŒçš„è´¦å·ï¼Œç”Ÿæˆä¸åŒçš„ SSH Keyï¼Œå¹¶ä¸”é…ç½®ä¸åŒçš„åŸŸåä½¿ç”¨ä¸åŒçš„Key&lt;/p>
&lt;h1 id="ç”Ÿæˆä¸€ä¸ª-ssh-key">ç”Ÿæˆä¸€ä¸ª SSH KEY&lt;/h1>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">ssh-keygen -t rsa -C &lt;span style="color:#cd5555">&amp;#34;username@email.com&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;blockquote>
&lt;p>ä¸€è·¯ Enterï¼Œå¹¶ä¸”åœ¨ç”Ÿæˆæ—¶å€™æŒ‡å®šåå­—ï¼Œï¼ˆä¸æŒ‡å®šåå­—ä¼šä½¿ç”¨é»˜è®¤çš„ï¼‰å¾—åˆ°&lt;/p>
&lt;/blockquote>
&lt;/blockquote>
&lt;pre>&lt;code>id_rsa # ç§é’¥
id_rsa.pub # å…¬é’¥
&lt;/code>&lt;/pre>&lt;h1 id="é‡å¤ä¸Šä¸€ä¸ªæ­¥éª¤ç”Ÿæˆå¤šä¸ª-ç§é’¥å’Œå…¬é’¥">é‡å¤ä¸Šä¸€ä¸ªæ­¥éª¤ï¼Œç”Ÿæˆå¤šä¸ª ç§é’¥å’Œå…¬é’¥&lt;/h1>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">github_id_rsa
github_id_rsa.pub
gitlab_id_rsa
gitlab_id_rsa.pub
&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="é…ç½®ç›¸åº”çš„åŸŸåå¯¹åº”çš„-ssh-key">é…ç½®ç›¸åº”çš„åŸŸåå¯¹åº”çš„ SSH-KEY&lt;/h1>
&lt;ul>
&lt;li>æœ¬åœ°ç›®å½• &lt;code>~/.ssh/&lt;/code> ä¸‹ï¼ŒæŸ¥é˜…æœ‰æ²¡æœ‰ &lt;code>config&lt;/code> æ–‡ä»¶, ä¸å­˜åœ¨å°±æ–°å»º &lt;code>config&lt;/code> æ–‡ä»¶&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">Host github
HostName github.com
User UserName
PreferredAuthentications publickey
IdentityFile ~/.ssh/github_id_rsa
Host gitlab
HostName gitlab.com
User UserName
PreferredAuthentications publickey
IdentityFile ~/.ssh/gitlab_id_rsa
&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="å°†å¯†é’¥æ·»åŠ è¿›å…¥--ssh-agent-ä¸­">å°†å¯†é’¥æ·»åŠ è¿›å…¥ SSH-AGENT ä¸­&lt;/h1>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">ssh-add ~/.ssh/github_id_rsa
ssh-add ~/.ssh/gitlab_id_rsa
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŸ¥çœ‹å¯†é’¥&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">ssh-add -l
&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="å°†ç”Ÿæˆçš„-å…¬é’¥-åŠ å…¥åˆ°å¯¹åº”çš„ç½‘ç«™é‡Œé¢-ssh-key-é…ç½®">å°†ç”Ÿæˆçš„ å…¬é’¥ åŠ å…¥åˆ°å¯¹åº”çš„ç½‘ç«™é‡Œé¢ SSH KEY é…ç½®&lt;/h1>
&lt;p>ä¸‹é¢å°±å¯ä»¥ä½¿ç”¨ &lt;code>git clone git@github.com/****&lt;/code> &lt;code>git clone git@gitlab.com/****&lt;/code>&lt;/p>
&lt;h1 id="å…³äº-mac-ä¸‹-æ¯æ¬¡å¼€æœº-éœ€è¦é‡æ–°-ssh-add-è§£å†³åŠæ³•">å…³äº Mac ä¸‹ æ¯æ¬¡å¼€æœº éœ€è¦é‡æ–° ssh-add è§£å†³åŠæ³•&lt;/h1>
&lt;ul>
&lt;li>æ·»åŠ è‡ªå¯åŠ¨ç¨‹åº&lt;/li>
&lt;li>è¯´ä¸€ä¸ªç®€å•çš„ï¼Œå°† ssh-add ~/.ssh/**id_rsa æ·»åŠ åˆ° .*shrc æ–‡ä»¶é‡Œé¢å»&lt;/li>
&lt;/ul>
- https://pinkhello.github.io/posts/10-%E5%A4%9A%E5%9F%9F%E5%90%8D%E4%B8%8B%E7%9A%84ssh/ - ä¸€æ¯å“ˆå¸Œä¸åŠ ç›, All Rights Reserved</description></item><item><title>09 ä½¿ç”¨githookç»Ÿä¸€codestyle</title><link>https://pinkhello.github.io/posts/09-%E4%BD%BF%E7%94%A8githook%E7%BB%9F%E4%B8%80codestyle/</link><pubDate>Wed, 10 Feb 2021 08:46:52 +0800</pubDate><guid>https://pinkhello.github.io/posts/09-%E4%BD%BF%E7%94%A8githook%E7%BB%9F%E4%B8%80codestyle/</guid><description>ä¸€æ¯å“ˆå¸Œä¸åŠ ç› https://pinkhello.github.io/posts/09-%E4%BD%BF%E7%94%A8githook%E7%BB%9F%E4%B8%80codestyle/ -&lt;h1 id="gradle-ä¼˜åŒ–">gradle ä¼˜åŒ–&lt;/h1>
&lt;ul>
&lt;li>build æŒ‡å®š -g cache ç¼“å­˜&lt;/li>
&lt;/ul>
&lt;h1 id="checkstyle-å®è·µ">checkstyle å®è·µ&lt;/h1>
&lt;ul>
&lt;li>åŸºç¡€é•œåƒåŒ…å« &lt;code>checkstyle.xml&lt;/code> æˆ–è€… æ”¾åˆ°è¿œç¨‹å…¶ä»–å¯è¢«æ‹‰å–åˆ°çš„å­˜å‚¨ä»‹è´¨ ï¼Œé˜²æ­¢é¡¹ç›®æˆå‘˜æ”¹åŠ¨&lt;/li>
&lt;li>&lt;code>gitlab-ci&lt;/code> &lt;code>beforeScript&lt;/code> æ ‡ç­¾æ‰§è¡Œå‘½ä»¤ &lt;code>copy /checkstyle.xml&lt;/code> è¿›å…¥é¡¹ç›®ï¼Œ(è¦†ç›–é¡¹ç›®ä¸­å­˜åœ¨çš„).&lt;/li>
&lt;li>&lt;code>gradle&lt;/code> ç¼–è¯‘çš„è¯ å°† &lt;code>maven-publish.gradle&lt;/code> &lt;code>repos.gradle&lt;/code> &lt;code>checkstyle.gradle&lt;/code>(&lt;code>checkstyle&lt;/code> æ’ä»¶é…ç½® ç‰ˆæœ¬ä»¥åŠ &lt;code>configFile&lt;/code>) æŠ½å‡ºæ”¾åˆ°å…¬å…±çš„åœ°æ–¹ï¼Œé˜²æ­¢é¡¹ç›®å›¢é˜Ÿæˆå‘˜æ”¹çš„.&lt;/li>
&lt;li>&lt;code>maven&lt;/code> çš„è¯ï¼Œå¯ä»¥åœ¨å…¬å…±çš„é¡¶çº§ç»§æ‰¿ &lt;code>pom&lt;/code> é‡Œé¢æŒ‡å®šå˜é‡&lt;code>checkstyle.config.location&lt;/code>. &lt;code>mvn checkstyle -Dcheckstyle.config.location=checkstyle.xml&lt;/code>&lt;/li>
&lt;/ul>
&lt;h1 id="git-hook-å®è·µ">git hook å®è·µ&lt;/h1>
&lt;p>æ¯ä¸ªé¡¹ç›®é‡Œé¢ &lt;code>.git/hooks&lt;/code> é‡Œé¢æœ‰å¾ˆå¤šçš„ &lt;code>hook&lt;/code> æ¨¡æ¿&lt;/p>
&lt;p>å®¢æˆ·ç«¯é’©å­åŒ…æ‹¬:&lt;code>pre-commit&lt;/code>ã€&lt;code>prepare-commit-msg&lt;/code>ã€&lt;code>commit-msg&lt;/code>ã€&lt;code>post-commit&lt;/code>ç­‰ï¼Œä¸»è¦ç”¨äºæ§åˆ¶å®¢æˆ·ç«¯gitçš„æäº¤å·¥ä½œæµã€‚&lt;/p>
&lt;p>æœåŠ¡ç«¯é’©å­ï¼š&lt;code>pre-receive&lt;/code>ã€&lt;code>post-receive&lt;/code>ã€&lt;code>update&lt;/code>ï¼Œä¸»è¦åœ¨æœåŠ¡ç«¯æ¥æ”¶æäº¤å¯¹è±¡æ—¶ã€æ¨é€åˆ°æœåŠ¡å™¨ä¹‹å‰è°ƒç”¨ã€‚&lt;/p>
&lt;p>ä»Šå¤©å®è·µçš„æ˜¯ å®¢æˆ·ç«¯é’©å­ï¼Œä¼˜åŒ–å‡å°‘ä¸ç¬¦åˆè§„èŒƒæˆ–è€…ä½è´¨é‡ä»£ç è¿›å…¥ &lt;code>gitflow&lt;/code> æµç¨‹.&lt;/p>
&lt;p>&lt;code>pre-commit&lt;/code> å’Œ &lt;code>commit-msg&lt;/code> æ˜¯ä»Šå¤©çš„ä¸»è§’ï¼Œ&lt;code>pre-commit&lt;/code> æ‰§è¡Œä¸ &lt;code>git add&lt;/code> ä¹‹åï¼Œåœ¨è¿›è¡Œ &lt;code>git commit&lt;/code> ä¹‹å‰è¿›è¡Œçš„æ“ä½œ.
å¯ä»¥ç”¨æ¥è¿›è¡Œ &lt;code>code check&lt;/code> &lt;code>code lint&lt;/code> ç­‰ç­‰, &lt;code>commit-msg&lt;/code> æ‰§è¡Œä¸ &lt;code>git commit&lt;/code> å¸¸ç”¨äºè¡¥å…¨ &lt;code>git commit message&lt;/code> &lt;code>check msg&lt;/code> ç­‰ç­‰
å½“ç„¶è¿˜æœ‰å…¶ä»–éªšæ“ä½œçš„åŠŸèƒ½ï¼Œå¯ä»¥é€šçŸ¥ï¼Œç­‰ç­‰ï¼Œåšå¤šç§è‡ªåŠ¨åŒ–&lt;/p>
&lt;p>ç›®å½•ç»“æ„&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yml" data-lang="yml">project&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>- .git/..ç­‰ç­‰&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>- git_hooks&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>-- pre-commit &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># pre-commit action&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>-- commit-msg &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># commit-msg action&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>-- init.sh &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># åˆå§‹åŒ–è„šæœ¬&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>pre-commit&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&lt;span style="color:#1e889b">#!/bin/bash
&lt;/span>&lt;span style="color:#1e889b">&lt;/span>&lt;span style="color:#00688b">workPath&lt;/span>=&lt;span style="color:#8b008b;font-weight:bold">$(&lt;/span>&lt;span style="color:#658b00">pwd&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">)&lt;/span>
&lt;span style="color:#00688b">CHECK_DIR&lt;/span>=&lt;span style="color:#cd5555">${&lt;/span>&lt;span style="color:#00688b">workPath&lt;/span>&lt;span style="color:#cd5555">}&lt;/span>/checks
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> [ ! -d &lt;span style="color:#00688b">$CHECK_DIR&lt;/span> ]
&lt;span style="color:#8b008b;font-weight:bold">then&lt;/span>
mkdir &lt;span style="color:#00688b">$CHECK_DIR&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">fi&lt;/span>
&lt;span style="color:#00688b">DOWNLOAD_PATH&lt;/span>=&lt;span style="color:#cd5555">&amp;#34;http://{download.path}/checkstyle&amp;#34;&lt;/span>
&lt;span style="color:#00688b">CONFIG_CHECK_JAR&lt;/span>=&lt;span style="color:#00688b">$CHECK_DIR&lt;/span>/checkstyle.jar;
&lt;span style="color:#00688b">CONFIG_CHECK_FILE&lt;/span>=&lt;span style="color:#00688b">$CHECK_DIR&lt;/span>/checkstyle.xml;
&lt;span style="color:#00688b">CONFIG_ERROR_FILE&lt;/span>=&lt;span style="color:#00688b">$CHECK_DIR&lt;/span>/checkstyle_errors.xml;
&lt;span style="color:#00688b">CONFIG_ERROR_REPORT_FILE&lt;/span>=&lt;span style="color:#00688b">$CHECK_DIR&lt;/span>/checkstyle_report.xml;
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> [ ! -f &lt;span style="color:#00688b">$CONFIG_CHECK_JAR&lt;/span> ]
&lt;span style="color:#8b008b;font-weight:bold">then&lt;/span>
curl -o &lt;span style="color:#00688b">$CONFIG_CHECK_JAR&lt;/span> &lt;span style="color:#00688b">$DOWNLOAD_PATH&lt;/span>/checkstyle-8.8-all.jar || true;
&lt;span style="color:#8b008b;font-weight:bold">fi&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> [ ! -f &lt;span style="color:#00688b">$CONFIG_CHECK_FILE&lt;/span> ]
&lt;span style="color:#8b008b;font-weight:bold">then&lt;/span>
curl -o &lt;span style="color:#00688b">$CONFIG_CHECK_FILE&lt;/span> &lt;span style="color:#00688b">$DOWNLOAD_PATH&lt;/span>/checkstyle.xml || true;
&lt;span style="color:#8b008b;font-weight:bold">fi&lt;/span>
&lt;span style="color:#00688b">javafiles&lt;/span>=&lt;span style="color:#cd5555">`&lt;/span>git diff --cached --name-only | grep &lt;span style="color:#cd5555">&amp;#39;\.java&amp;#39;&lt;/span>&lt;span style="color:#cd5555">`&lt;/span>;
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#00688b">$javafiles&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> [ -f &lt;span style="color:#00688b">$CONFIG_ERROR_FILE&lt;/span> ]
&lt;span style="color:#8b008b;font-weight:bold">then&lt;/span>
rm &lt;span style="color:#00688b">$CONFIG_ERROR_FILE&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">fi&lt;/span>
&lt;span style="color:#00688b">CHECK_CMD&lt;/span>=&lt;span style="color:#cd5555">&amp;#34;java -cp &lt;/span>&lt;span style="color:#00688b">$CONFIG_CHECK_JAR&lt;/span>&lt;span style="color:#cd5555"> com.puppycrawl.tools.checkstyle.Main -c &lt;/span>&lt;span style="color:#00688b">$CONFIG_CHECK_FILE&lt;/span>&lt;span style="color:#cd5555"> &lt;/span>&lt;span style="color:#00688b">$javafiles&lt;/span>&lt;span style="color:#cd5555"> -f xml -o &lt;/span>&lt;span style="color:#00688b">$CONFIG_ERROR_FILE&lt;/span>&lt;span style="color:#cd5555">&amp;#34;&lt;/span>;
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#cd5555">&amp;#34;&lt;/span>&lt;span style="color:#00688b">$CHECK_CMD&lt;/span>&lt;span style="color:#cd5555">&amp;#34;&lt;/span>;
&lt;span style="color:#00688b">$CHECK_CMD&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> [ -f &lt;span style="color:#00688b">$CONFIG_ERROR_FILE&lt;/span> ]
&lt;span style="color:#8b008b;font-weight:bold">then&lt;/span>
&lt;span style="color:#00688b">errorResponse&lt;/span>=&lt;span style="color:#cd5555">`&lt;/span>cat &lt;span style="color:#00688b">$CONFIG_ERROR_FILE&lt;/span> | grep &lt;span style="color:#cd5555">\&amp;lt;&lt;/span>error|head -n 1&lt;span style="color:#cd5555">`&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> [[ &lt;span style="color:#00688b">$errorResponse&lt;/span> == *&lt;span style="color:#cd5555">&amp;#34;error&amp;#34;&lt;/span>* ]]
&lt;span style="color:#8b008b;font-weight:bold">then&lt;/span>
awk &lt;span style="color:#cd5555">&amp;#39;{print;} NR == 1 { print &amp;#34;&amp;lt;?xml-stylesheet xmlns=\&amp;#34;http://www.w3.org/1999/xhtml\&amp;#34; href=\&amp;#34;checkstyle-simple.xsl\&amp;#34; type=\&amp;#34;text/xsl\&amp;#34;?&amp;gt;&amp;#34;}&amp;#39;&lt;/span> &lt;span style="color:#00688b">$CONFIG_ERROR_FILE&lt;/span> &amp;gt; &lt;span style="color:#00688b">$CONFIG_ERROR_REPORT_FILE&lt;/span>;
&lt;span style="color:#658b00">echo&lt;/span> -e &lt;span style="color:#cd5555">&amp;#34;Check your code. Open by Safari or Chrome ( --allow-file-access-from-files ): &lt;/span>&lt;span style="color:#00688b">$CONFIG_ERROR_REPORT_FILE&lt;/span>&lt;span style="color:#cd5555">&amp;#34;&lt;/span>;
open &lt;span style="color:#00688b">$CONFIG_ERROR_REPORT_FILE&lt;/span>
&lt;span style="color:#658b00">exit&lt;/span> &lt;span style="color:#b452cd">1&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">fi&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">fi&lt;/span>
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#cd5555">&amp;#34;check pass! pre_commit successfully!&amp;#34;&lt;/span>;
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>commit-msg&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&lt;span style="color:#1e889b">#!/bin/sh
&lt;/span>&lt;span style="color:#1e889b">&lt;/span>&lt;span style="color:#228b22"># append CL message ä¿¡æ¯ï¼ˆåŠ å…¥ä½œè€… ä¾‹å­ï¼‰&lt;/span>
&lt;span style="color:#228b22">#name=[PinkHello]&lt;/span>
&lt;span style="color:#228b22">#commit=&amp;#34;$name $(cat $1)&amp;#34;&lt;/span>
&lt;span style="color:#228b22">#echo &amp;#34;$commit&amp;#34; &amp;gt; &amp;#34;$1&amp;#34;&lt;/span>
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#00688b">$commit&lt;/span>
&lt;span style="color:#00688b">commit&lt;/span>=&lt;span style="color:#cd5555">`&lt;/span>cat &lt;span style="color:#00688b">$1&lt;/span>&lt;span style="color:#cd5555">`&lt;/span>
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#cd5555">&amp;#34;&lt;/span>&lt;span style="color:#00688b">$commit&lt;/span>&lt;span style="color:#cd5555">&amp;#34;&lt;/span> &amp;gt; &lt;span style="color:#cd5555">&amp;#34;&lt;/span>&lt;span style="color:#00688b">$1&lt;/span>&lt;span style="color:#cd5555">&amp;#34;&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> [[ &lt;span style="color:#00688b">$commit&lt;/span> =~ ^([A-Z]+)-([0-9]+):.*|(Merge.*)|(Revert.*)|(Other.*) ]]
&lt;span style="color:#8b008b;font-weight:bold">then&lt;/span>
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#cd5555">&amp;#34;commit successful!&amp;#34;&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">else&lt;/span>
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#cd5555">&amp;#34;\033 Error: the commit message must start with JIRA ticket number \033&amp;#34;&lt;/span>
&lt;span style="color:#658b00">exit&lt;/span> &lt;span style="color:#b452cd">1&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">fi&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>init.sh&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&lt;span style="color:#1e889b">#!/bin/sh
&lt;/span>&lt;span style="color:#1e889b">&lt;/span>&lt;span style="color:#228b22"># å½“å‰ç›®å½•&lt;/span>
&lt;span style="color:#00688b">workPath&lt;/span>=&lt;span style="color:#8b008b;font-weight:bold">$(&lt;/span>&lt;span style="color:#658b00">pwd&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">)&lt;/span>
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#cd5555">&amp;#34;å½“å‰åˆå§‹åŒ–ç›®å½•&lt;/span>&lt;span style="color:#00688b">$workPath&lt;/span>&lt;span style="color:#cd5555">&amp;#34;&lt;/span>
&lt;span style="color:#228b22"># é“¾æ¥åˆ° .git hooks ç›®å½•é‡Œé¢&lt;/span>
ln -s -f &lt;span style="color:#00688b">$workPath&lt;/span>/pre-commit &lt;span style="color:#00688b">$workPath&lt;/span>/../.git/hooks/pre-commit
ln -s -f &lt;span style="color:#00688b">$workPath&lt;/span>/commit-msg &lt;span style="color:#00688b">$workPath&lt;/span>/../.git/hooks/commit-msg
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#cd5555">&amp;#34;ln pre-commit commit-msg.....success.&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="google-cr-mr-è§„èŒƒ">google CR MR è§„èŒƒ&lt;/h1>
&lt;p>&lt;a href="https://github.com/google/eng-practices">https://github.com/google/eng-practices&lt;/a>&lt;/p>
&lt;p>&lt;code>CL&lt;/code> è§„èŒƒï¼š&lt;/p>
&lt;ul>
&lt;li>æäº¤æ–°çš„ &lt;code>subject&lt;/code> ï¼Œæ‰æœ‰ç¥ˆä½¿å¥ï¼Œä¸€ä¸ªå‘½ä»¤çš„å½¢å¼è¨€ç®€æ„èµ…çš„è¡¨è¾¾è¿™æ¬¡è¦æ”¹å˜çš„ä»€ä¹ˆï¼Œå¦‚éœ€è¦è¯¦ç»†ä¸Šä¸‹æ–‡ï¼Œå…³è” &lt;code>ticket&lt;/code>ï¼Œåœ¨ &lt;code>body&lt;/code> ä¸­è¯´æ˜&lt;/li>
&lt;li>ç®€åŒ– &lt;code>cl&lt;/code> ï¼Œå°½å¯èƒ½å°ï¼Œä¸è¦ç§¯æ”’ä¸€å † &lt;code>change&lt;/code> ï¼Œä¸€æ¬¡æ€§æäº¤ï¼Œç„¶åå†ä¸€æ¬¡æ€§ &lt;code>MR&lt;/code> ï¼ŒåŠ å¤§äº† &lt;code>review&lt;/code> é£é™©ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;code>MR&lt;/code> è§„èŒƒ&lt;/p>
&lt;ul>
&lt;li>ç´§æ€¥ &lt;code>MR&lt;/code> é€‚å½“æ”¾æ¾&lt;/li>
&lt;li>&lt;code>MR&lt;/code> ä¸èƒ½å¸¦æœ‰è„¾æ°”ï¼Œç›®çš„æ˜¯åŸºäºé—®é¢˜è®¨è®ºï¼Œè§£å†³é—®é¢˜&lt;/li>
&lt;li>é’ˆå¯¹åšçš„å¥½çš„ç»™äºˆè‚¯å®šå’ŒğŸ‘&lt;/li>
&lt;li>&lt;code>LGTM means look good to me &lt;/code>= æœ•çŸ¥é“äº†ï¼&lt;/li>
&lt;li>&lt;code>MR&lt;/code> å†²çªï¼Œè”ç³»å¿…è¦å¼€å‘è€…ä¸€èµ·å‚ä¸å†³å®šé¿å…å‡ºç°ä»£ç ä¸¢å¤±ä¸é”™è¯¯.&lt;/li>
&lt;/ul>
&lt;p>&lt;code>CR&lt;/code> è§„èŒƒ&lt;/p>
&lt;ul>
&lt;li>é€Ÿåº¦å¯ä»¥ç­æ€ä¸€åˆ‡æŠ±æ€¨ï¼Œä¸èƒ½è®© &lt;code>cr&lt;/code> æ—¶é—´è¿‡é•¿&lt;/li>
&lt;li>&lt;code>CR&lt;/code> å‘ç°é—®é¢˜ä¸€å®šè¦è®©å¼€å‘è€…å»ä¿®æ”¹ï¼Œä¸è¦æœ‰ä»¥åå†ä¿®æ”¹çš„æƒ³æ³•ï¼Œè¿™ç§æ–¹å¼å¾€å¾€æ˜¯è®©ç³»ç»Ÿå˜å¾—æ›´å·®çš„åŸå› .&lt;/li>
&lt;/ul>
- https://pinkhello.github.io/posts/09-%E4%BD%BF%E7%94%A8githook%E7%BB%9F%E4%B8%80codestyle/ - ä¸€æ¯å“ˆå¸Œä¸åŠ ç›, All Rights Reserved</description></item></channel></rss>