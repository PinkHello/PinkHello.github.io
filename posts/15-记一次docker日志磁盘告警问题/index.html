<!doctype html><html lang=en><head><title>ä¸€æ¯å“ˆå¸Œä¸åŠ ç›</title><meta charset=utf-8><meta content="utf-8" http-equiv=encoding><meta name=viewport content="width=device-width,initial-scale=1"><meta name=format-detection content="telephone=no"><meta name=theme-color content="#000084"><link rel=icon href=https://pinkhello.github.io//favicon.ico><link rel=canonical href=https://pinkhello.github.io/></head><body><nav class="navbar navbar-inverse navbar-fixed-top"><div class=navbar-inner><div class=container><button type=button class="btn btn-navbar" data-toggle=collapse data-target=.nav-collapse></button>
<a class=brand href=https://pinkhello.github.io/>ä¸€æ¯å“ˆå¸Œä¸åŠ ç›</a><div class="nav-collapse collapse"><ul class=nav><li><a href=/about/><span>About</span></a></li><li><a href=/posts/><span>Archive</span></a></li></ul></div></div></div></nav><div id=content class=container><div class="row-fluid navmargin"><div class=page-header><h1>15 è®°ä¸€æ¬¡dockeræ—¥å¿—ç£ç›˜å‘Šè­¦é—®é¢˜ - Wed, Feb 10, 2021</h1></div><p class=lead></p><h1 id=å‰æ™¯>å‰æ™¯</h1><p>ä»Šæ—¥ï¼Œæˆ‘æ­£åœ¨å¼€å¼€å¿ƒå¿ƒçš„åˆ·ç€JFXçš„Codingä¸­ï¼Œçªç„¶çº¿ä¸ŠæŠ¥è­¦ç¾¤ä¸­çˆ†äº†ä¸ªç‚¸å¼¹ï¼ŒEC2ç£ç›˜è¶…è¿‡80%ã€‚</p><p><img src=/%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/%E8%B5%84%E6%BA%90%E4%B8%8D%E8%B6%B3%E6%8A%A5%E8%AD%A6.png alt=èµ„æºä¸è¶³é¢„è­¦></p><h1 id=å¤„ç†è¿‡ç¨‹>å¤„ç†è¿‡ç¨‹</h1><p>è§£å†³é—®é¢˜å§¿åŠ¿å°±ä½ï¼š</p><ul><li><p>èµ¶ç´§å¼€æœº ==ã€‹ â¤ï¸ä¸­ä¸‡åŒ¹ğŸ¦™å¥”è…¾è€Œè¿‡ â¤ï¸ä¸­MMP</p></li><li><p>é»˜é»˜çš„é€šè¿‡è·³æ¿æœºè¿›å…¥ç›®æ ‡æœºå™¨</p></li><li><p>ä¸ç®¡ä¸‰ä¸ƒäºŒåä¸€,æ‰§è¡ŒæŸ¥çœ‹ç£ç›˜å ç”¨å¤§å°ï¼Œæˆ‘çš„ä¹–ä¹–ï¼Œå ç”¨ç¡®å®è¶…è¿‡äº†87%äº†ï¼Œä¸€ä¸‹å­æš´æ¶¨çš„</p></li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># æŸ¥çœ‹ç£ç›˜å ç”¨å¤§å°</span>
&gt; sudo df -h
<span style=color:#75715e># æŸ¥çœ‹å½“å‰ç›®å½•æ€»é‡</span>
&gt; sudo du -sh
</code></pre></div><ul><li>å¼€å§‹å®šä½å…·ä½“å“ªä¸ªæ–‡ä»¶æˆ–è€…ç›®å½•å ç”¨è¿™ä¹ˆå¤§,è·‘åˆ°æ ¹ç›®å½•ä¸‹ã€‚</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹ä¸€çº§å­æ–‡ä»¶å’Œå­ç›®å½•å ç”¨çš„ç£ç›˜å®¹é‡</span>
&gt; sudo du -lh --max-depth<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</code></pre></div><ul><li>ä¸€å¼€å§‹çŒœæƒ³å¯èƒ½æ˜¯dockerå®¹å™¨çš„æ—¥å¿—å ç”¨å¤§ï¼Œä¸Šé¢æ‰§è¡Œåï¼Œè¿˜çœŸ TM æ˜¯</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>/var/lib/docker/containers ç›®å½•å ç”¨ 42G
</code></pre></div><ul><li>å¼€å§‹æŸ¥çœ‹æ˜¯å“ªä¸ªå®¹å™¨å ç”¨çš„è¿™ä¹ˆå¤§çš„ç©ºé—´</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># æŸ¥çœ‹ containers æ—¥å¿—ç›®å½•æ’åº</span>
&gt; sudo du -d1 -h /var/lib/docker/containers | sort -h
<span style=color:#75715e># æŸ¥çœ‹å…·ä½“çš„å“ªä¸ªæ—¥å¿—æ–‡ä»¶å¤§</span>
&gt; sudo find /var/lib/docker/containers -name *.log
</code></pre></div><p>å½“ç„¶è¿™ä¸ªé…å›¾æ˜¯æˆ‘æ¸…ç†ä¹‹åçš„
<img src=/%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/docker%E5%AE%B9%E5%99%A8%E6%96%87%E4%BB%B6%E6%8E%92%E5%BA%8F.png alt=dockerå®¹å™¨æ–‡ä»¶æ’åº>
<img src=/%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/%E6%9F%A5%E6%89%BEdocker%E5%AE%B9%E5%99%A8%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6.png alt=æŸ¥æ‰¾dockerå®¹å™¨æ—¥å¿—æ–‡ä»¶></p><ul><li>å®šä½åˆ°æœ€å¤§çš„æ–‡ä»¶ï¼Œä¸€é¡¿æ“ä½œ</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>   <span style=color:#75715e># æ¸…ç©ºæ¯”è¾ƒå¤§çš„æ—¥å¿—æ–‡ä»¶</span>
   &gt; sudo sh -c <span style=color:#e6db74>&#34;cat /dev/null &gt; </span><span style=color:#e6db74>${</span>log_file<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</code></pre></div><p><img src=/%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/%E6%B8%85%E7%90%86docker%E5%AE%B9%E5%99%A8%E6%97%A5%E5%BF%97%E5%90%8E.png alt=æ¸…ç†dockerå®¹å™¨æ—¥å¿—å></p><h1 id=æ€è€ƒ>æ€è€ƒ</h1><ul><li>ä¸Šé¢çš„æ–¹å¼æ˜¯ä¸€ç§æ–¹å¼è§£å†³ã€ä¸´æ—¶ã€‘<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>  <span style=color:#75715e># æŸ¥çœ‹ docker çš„ Logging Driver</span>
  &gt; docker info | grep <span style=color:#e6db74>&#39;Logging Driver&#39;</span>
</code></pre></div><p>å¦‚ä½•å½»åº•è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p><ul><li>å†™ä¸ª<code>shellè„šæœ¬</code> ä½¿ç”¨ <code>crontab</code> å®šæœŸæ‰§è¡Œæ¸…ç†<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>   <span style=color:#75715e>#!/bin/sh</span>
   echo <span style=color:#e6db74>&#34;======== start clean docker containers logs ========&#34;</span>  
   logs<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>find /var/lib/docker/containers/ -name *-json.log<span style=color:#66d9ef>)</span>  
   <span style=color:#66d9ef>for</span> log in $logs  
     <span style=color:#66d9ef>do</span>  
     echo <span style=color:#e6db74>&#34;clean logs : </span>$log<span style=color:#e6db74>&#34;</span>  
     cat /dev/null &gt; $log  
     <span style=color:#66d9ef>done</span>  
   echo <span style=color:#e6db74>&#34;======== end clean docker containers logs ========&#34;</span>
</code></pre></div></li><li>å‡å¦‚æ˜¯<code>docker run</code>åˆ›å»ºå®¹å™¨çš„,æŒ‡å®š <code>--log-opt max-size=${MAX_SIZE}m --log-opt max-file=${NUMBER}</code></li><li><code>docker-compose</code> æ–¹å¼æ›´é«˜<code>docker-compose.yaml</code>æ–‡ä»¶<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>  <span style=color:#f92672>logging</span>:
      <span style=color:#f92672>driver</span>: <span style=color:#e6db74>&#34;json-file&#34;</span>
      <span style=color:#f92672>options</span>:
        <span style=color:#f92672>max-size</span>: <span style=color:#e6db74>&#34;${MAX_SIZE}m&#34;</span>
        <span style=color:#f92672>max-file</span>: <span style=color:#ae81ff>${NUMBER}</span>
</code></pre></div></li><li><code>docker</code> å…¨å±€ä¿®æ”¹ <code>/etc/docker/daemon.json</code><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>  {
    <span style=color:#f92672>&#34;log-driver&#34;</span>: <span style=color:#e6db74>&#34;json-file&#34;</span>,
    <span style=color:#f92672>&#34;log-opts&#34;</span>: {
      <span style=color:#f92672>&#34;max-size&#34;</span>: <span style=color:#e6db74>&#34;${MAX_SIZE}m&#34;</span>
    }
  }
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>  &gt; systemctl daemon-reload
  &gt; systemctl restart docker
</code></pre></div></li></ul></li><li>ä¸ºä»€ä¹ˆä¼šç¬é—´ğŸ’¥å¼çš„å¢é•¿ ???</li></ul><h4><a href=https://pinkhello.github.io/>Back to Home</a></h4></div></div><footer class=container><hr class=soften><p><a href=https://pinkhello.github.io/>hugo.386 theme</a> |
&copy;
<a href=https://pinkhello.github.io/ target=_blank>ä¸€æ¯å“ˆå¸Œä¸åŠ ç›</a>
<span id=thisyear>2020</span>
| Built on <a href=//gohugo.io target=_blank>Hugo</a></p><p class=text-center><a href=https://github.com/PinkHello>GitHub</a></p></footer></body><link rel=stylesheet href=/css/bootstrap.css><link rel=stylesheet href=/css/bootstrap-responsive.css><link rel=stylesheet href=/css/style.css><script src=/js/jquery.js></script><script src=/js/bootstrap-386.js></script><script src=/js/bootstrap-transition.js></script><script src=/js/bootstrap-alert.js></script><script src=/js/bootstrap-modal.js></script><script src=/js/bootstrap-dropdown.js></script><script src=/js/bootstrap-scrollspy.js></script><script src=/js/bootstrap-tab.js></script><script src=/js/bootstrap-tooltip.js></script><script src=/js/bootstrap-popover.js></script><script src=/js/bootstrap-button.js></script><script src=/js/bootstrap-collapse.js></script><script src=/js/bootstrap-carousel.js></script><script src=/js/bootstrap-typeahead.js></script><script src=/js/bootstrap-affix.js></script><script>_386={fastLoad:false,onePass:false,speedFactor:1};function ThisYear(){document.getElementById('thisyear').innerHTML=new Date().getFullYear();};</script></html>