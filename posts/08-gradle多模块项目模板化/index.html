<!doctype html><html lang=en><head><title>一杯哈希不加盐</title><meta charset=utf-8><meta content="utf-8" http-equiv=encoding><meta name=viewport content="width=device-width,initial-scale=1"><meta name=format-detection content="telephone=no"><meta name=theme-color content="#000084"><link rel=icon href=https://pinkhello.github.io//favicon.ico><link rel=canonical href=https://pinkhello.github.io/></head><body><nav class="navbar navbar-inverse navbar-fixed-top"><div class=navbar-inner><div class=container><button type=button class="btn btn-navbar" data-toggle=collapse data-target=.nav-collapse></button>
<a class=brand href=https://pinkhello.github.io/>一杯哈希不加盐</a><div class="nav-collapse collapse"><ul class=nav><li><a href=/about/><span>About</span></a></li><li><a href=/posts/><span>Archive</span></a></li></ul></div></div></div></nav><div id=content class=container><div class="row-fluid navmargin"><div class=page-header><h1>08 Gradle多模块项目模板化 - Wed, Feb 10, 2021</h1></div><p class=lead></p><h2 id=前言>前言</h2><p>Maven 冗余， Gradle 简单轻便
公司原有的 CI/CD 流程，借助 Maven 插件 build Docker Image,改为原生 Docker Runner 原始构建</p><h2 id=1多模块项目>1、多模块项目</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ae81ff>project</span>
 - <span style=color:#ae81ff>app</span>
   - <span style=color:#ae81ff>src/main/[java|resources] | src/test/[java|resources]  </span> <span style=color:#75715e># classpath</span>
   - <span style=color:#ae81ff>Dockerfile        </span> <span style=color:#75715e># Dockerfile</span>
   - <span style=color:#ae81ff>build.gradle      </span> <span style=color:#75715e># APP 模块 gradle 配置</span>
 - <span style=color:#ae81ff>sdk                 </span> <span style=color:#75715e># SDK 模块 可有可无</span>
   - <span style=color:#ae81ff>src/main/java</span>
   - <span style=color:#ae81ff>build.gradle      </span> <span style=color:#75715e># SDK 的 gradle 配置</span>
 - <span style=color:#ae81ff>deploy              </span> <span style=color:#75715e># delpoy 项目 注意 checkstyle 相关配置在这里面</span>
   - <span style=color:#ae81ff>checkstyle/**</span>
   - <span style=color:#75715e>**.yml</span>
 - <span style=color:#ae81ff>build.gradle        </span> <span style=color:#75715e># 项目顶级 gradle配置</span>
 - <span style=color:#ae81ff>gradle</span>
   - <span style=color:#ae81ff>wrapper/**        </span> <span style=color:#75715e># gradle 配置信息</span>
   - <span style=color:#ae81ff>check.gradle      </span> <span style=color:#75715e># pmd &amp; checkstyle</span>
   - <span style=color:#ae81ff>repo.gradle       </span> <span style=color:#75715e># 仓库定义</span>
<span style=color:#75715e># test.gradle 放这儿，就没有高亮了 =&gt; 暂时维护在 顶层的 build.gradle 中，单独维护，不要和其他配置混在一起。</span>
 - <span style=color:#ae81ff>settings.gradle     </span> <span style=color:#75715e># 配置</span>
 - <span style=color:#ae81ff>versions-prod.gradle     </span> <span style=color:#75715e># 版本定义</span>
 - <span style=color:#ae81ff>versions-dev.gradle     </span> <span style=color:#75715e># 版本定义</span>
 - <span style=color:#ae81ff>.gitignore          </span> <span style=color:#75715e># git忽略文件</span>
 - <span style=color:#ae81ff>.gitlab-ci.yml      </span> <span style=color:#75715e># CI/CD</span>
</code></pre></div><h2 id=2project-下各个gradle文件>2、Project 下各个gradle文件</h2><p>Project/versions.gradle 可以统一版本管理</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=color:#75715e>//start step
</span><span style=color:#75715e></span><span style=color:#66d9ef>def</span> versions <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Expando<span style=color:#f92672>()</span>
<span style=color:#66d9ef>def</span> deps <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Expando<span style=color:#f92672>()</span>
ext<span style=color:#f92672>.</span><span style=color:#a6e22e>versions</span> <span style=color:#f92672>=</span> versions
ext<span style=color:#f92672>.</span><span style=color:#a6e22e>deps</span> <span style=color:#f92672>=</span> deps

<span style=color:#75715e>//set versions
</span><span style=color:#75715e></span>versions<span style=color:#f92672>.</span><span style=color:#a6e22e>springboot</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;2.1.16.RELEASE&#34;</span>
versions<span style=color:#f92672>.</span><span style=color:#a6e22e>mysql</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;8.0.16&#34;</span>
versions<span style=color:#f92672>.</span><span style=color:#a6e22e>guava</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;25.1-jre&#34;</span>
versions<span style=color:#f92672>.</span><span style=color:#a6e22e>httpclient</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;4.5.9&#34;</span>

versions<span style=color:#f92672>.</span><span style=color:#a6e22e>okhttp3</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;3.8.1&#34;</span>
versions<span style=color:#f92672>.</span><span style=color:#a6e22e>apm</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;1.7.0&#34;</span>

versions<span style=color:#f92672>.</span><span style=color:#a6e22e>kotlin</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;1.4.10&#34;</span>

<span style=color:#75715e>//set dependencies
</span><span style=color:#75715e></span>
<span style=color:#75715e>// 基础开源包
</span><span style=color:#75715e></span>deps<span style=color:#f92672>.</span><span style=color:#a6e22e>mysql</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;mysql:mysql-connector-java:${versions.mysql}&#34;</span>
deps<span style=color:#f92672>.</span><span style=color:#a6e22e>guava</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;com.google.guava:guava:${versions.guava}&#34;</span>
deps<span style=color:#f92672>.</span><span style=color:#a6e22e>okhttp3</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;com.squareup.okhttp3:okhttp:${versions.okhttp3}&#34;</span>
deps<span style=color:#f92672>.</span><span style=color:#a6e22e>apm</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;co.elastic.apm:apm-agent-attach:${versions.apm}&#34;</span>

</code></pre></div><p>Project/settings.gradle 根配置文件，build 快不快全靠它</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=color:#75715e>//配置插件走国内代理
</span><span style=color:#75715e></span>pluginManagement <span style=color:#f92672>{</span>
    repositories <span style=color:#f92672>{</span>
        maven <span style=color:#f92672>{</span>
            url <span style=color:#e6db74>&#39;https://maven.aliyun.com/repository/gradle-plugin&#39;</span>
        <span style=color:#f92672>}</span>
        gradlePluginPortal<span style=color:#f92672>()</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>

rootProject<span style=color:#f92672>.</span><span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;project-name&#39;</span>
include <span style=color:#e6db74>&#39;:app&#39;</span>
include <span style=color:#e6db74>&#39;:sdk&#39;</span>    <span style=color:#75715e>// 没有SDK模块的化不需要这个
</span></code></pre></div><p>Project/build.gradle</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>buildscript <span style=color:#f92672>{</span>
    ext <span style=color:#f92672>{</span>
        kotlinVersion <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;1.4.10&#34;</span>
        springBootVersion <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;2.1.16.RELEASE&#39;</span>
        springBootGradleVersion <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;2.3.3.RELEASE&#39;</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>

plugins <span style=color:#f92672>{</span>
    id <span style=color:#e6db74>&#34;java&#34;</span>
    id <span style=color:#e6db74>&#34;pmd&#34;</span>
    id <span style=color:#e6db74>&#34;checkstyle&#34;</span>
    id <span style=color:#e6db74>&#34;maven-publish&#34;</span>

    id <span style=color:#e6db74>&#34;org.jetbrains.kotlin.jvm&#34;</span> version <span style=color:#e6db74>&#34;$kotlinVersion&#34;</span>
    id <span style=color:#e6db74>&#34;org.jetbrains.kotlin.plugin.spring&#34;</span> version <span style=color:#e6db74>&#34;$kotlinVersion&#34;</span>

    id <span style=color:#e6db74>&#34;org.springframework.boot&#34;</span> version <span style=color:#e6db74>&#34;$springBootVersion&#34;</span>
    id <span style=color:#e6db74>&#34;io.spring.dependency-management&#34;</span> version <span style=color:#e6db74>&#34;1.0.9.RELEASE&#34;</span>

<span style=color:#f92672>}</span>

apply from: file<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;versions.gradle&#34;</span><span style=color:#f92672>)</span>

<span style=color:#75715e>// 为了一如不同的版本环境下的代码配置
</span><span style=color:#75715e></span><span style=color:#66d9ef>def</span> env <span style=color:#f92672>=</span> System<span style=color:#f92672>.</span><span style=color:#a6e22e>getProperty</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;env&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>?:</span> <span style=color:#e6db74>&#39;dev&#39;</span>
apply from: <span style=color:#e6db74>&#34;${rootDir}/versions-${env}.gradle&#34;</span>



allprojects <span style=color:#f92672>{</span>

    <span style=color:#75715e>// 配置 group 
</span><span style=color:#75715e></span>    group <span style=color:#e6db74>&#34;com.XXX.XXX&#34;</span>
    <span style=color:#75715e>//配置版本
</span><span style=color:#75715e></span>    version <span style=color:#f92672>=</span> findProperty <span style=color:#e6db74>&#39;version&#39;</span> <span style=color:#f92672>?:</span> <span style=color:#e6db74>&#39;1.0.0-SNAPSHOT&#39;</span>
    
    bootJar <span style=color:#f92672>{</span>
        enabled <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>
    <span style=color:#f92672>}</span>

    apply plugin: <span style=color:#e6db74>&#34;java&#34;</span>
    apply plugin: <span style=color:#e6db74>&#34;idea&#34;</span>
    apply plugin: <span style=color:#e6db74>&#34;maven-publish&#34;</span>

    apply plugin: <span style=color:#e6db74>&#34;org.jetbrains.kotlin.jvm&#34;</span>
    apply plugin: <span style=color:#e6db74>&#34;kotlin-spring&#34;</span>

    apply plugin: <span style=color:#e6db74>&#34;org.springframework.boot&#34;</span>
    apply plugin: <span style=color:#e6db74>&#34;io.spring.dependency-management&#34;</span>

    apply plugin: <span style=color:#e6db74>&#39;jacoco&#39;</span>

    <span style=color:#75715e>//假如 你的 mapper.xml 或者 grovvy 写在 src/main/java ，打包需要处理到 需要加入的resources，需要手动处理
</span><span style=color:#75715e></span>    <span style=color:#75715e>// 当然如果 你的 mapper.xml 直接在 src/main/resources 里面 不需要处理，可以直接删除
</span><span style=color:#75715e></span>    processResources <span style=color:#f92672>{</span>
        from<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;src/main/java&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
            include <span style=color:#e6db74>&#39;**/*.xml&#39;</span>
            include <span style=color:#e6db74>&#39;**/*.groovy&#39;</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>

<span style=color:#f92672>}</span>

<span style=color:#75715e>// apply from: file(&#34;gradle/repo.gradle&#34;)
</span><span style=color:#75715e>// apply from: file(&#34;gradle/check.gradle&#34;)
</span><span style=color:#75715e>// apply from: file(&#34;gradle/maven-publish.gradle&#34;)
</span><span style=color:#75715e></span>apply from: <span style=color:#e6db74>&#39;https://${DownloadPath}/gradle/check-style.gradle&#39;</span>
apply from: <span style=color:#e6db74>&#39;https://${DownloadPath}/gradle/maven-repo.gradle&#39;</span>
apply from: <span style=color:#e6db74>&#39;https://${DownloadPath}/gradle/maven-publish.gradle&#39;</span>


subprojects <span style=color:#f92672>{</span>

    configurations <span style=color:#f92672>{</span>
        provided
    <span style=color:#f92672>}</span>
    sourceSets<span style=color:#f92672>.</span><span style=color:#a6e22e>main</span><span style=color:#f92672>.</span><span style=color:#a6e22e>compileClasspath</span> <span style=color:#f92672>+=</span> configurations<span style=color:#f92672>.</span><span style=color:#a6e22e>provided</span>
    sourceSets<span style=color:#f92672>.</span><span style=color:#a6e22e>test</span><span style=color:#f92672>.</span><span style=color:#a6e22e>compileClasspath</span> <span style=color:#f92672>+=</span> configurations<span style=color:#f92672>.</span><span style=color:#a6e22e>provided</span>
    sourceSets<span style=color:#f92672>.</span><span style=color:#a6e22e>test</span><span style=color:#f92672>.</span><span style=color:#a6e22e>runtimeClasspath</span> <span style=color:#f92672>+=</span> configurations<span style=color:#f92672>.</span><span style=color:#a6e22e>provided</span>

    tasks<span style=color:#f92672>.</span><span style=color:#a6e22e>withType</span><span style=color:#f92672>(</span>JavaCompile<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        options<span style=color:#f92672>.</span><span style=color:#a6e22e>encoding</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;UTF-8&#39;</span>
    <span style=color:#f92672>}</span>

    task <span style=color:#a6e22e>sourceJar</span><span style=color:#f92672>(</span>type: Jar<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        from sourceSets<span style=color:#f92672>.</span><span style=color:#a6e22e>main</span><span style=color:#f92672>.</span><span style=color:#a6e22e>allJava</span>
        classifier <span style=color:#e6db74>&#34;sources&#34;</span>
    <span style=color:#f92672>}</span>

    task <span style=color:#a6e22e>javadocJar</span><span style=color:#f92672>(</span>type: Jar<span style=color:#f92672>,</span> dependsOn: javadoc<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        from javadoc<span style=color:#f92672>.</span><span style=color:#a6e22e>destinationDir</span>
    <span style=color:#f92672>}</span>
    dependencies <span style=color:#f92672>{</span>
        implementation <span style=color:#e6db74>&#34;com.google.guava:guava:$versions.guava&#34;</span>

        compileOnly <span style=color:#e6db74>&#39;org.projectlombok:lombok:1.18.4&#39;</span>
        annotationProcessor <span style=color:#e6db74>&#39;org.projectlombok:lombok:1.18.4&#39;</span>

        testCompileOnly <span style=color:#e6db74>&#39;org.projectlombok:lombok:1.18.4&#39;</span>
        testAnnotationProcessor <span style=color:#e6db74>&#39;org.projectlombok:lombok:1.18.4&#39;</span>

        testImplementation <span style=color:#e6db74>&#34;org.springframework.boot:spring-boot-starter-test:$springBootVersion&#34;</span>
        testImplementation <span style=color:#e6db74>&#34;org.mockito:mockito-core:2.23.4&#34;</span>
        testImplementation <span style=color:#e6db74>&#39;junit:junit:4.13&#39;</span>
        <span style=color:#75715e>// h2
</span><span style=color:#75715e></span>        testImplementation <span style=color:#e6db74>&#34;com.h2database:h2:1.4.200&#34;</span>
        <span style=color:#75715e>// redis memery
</span><span style=color:#75715e></span>        testImplementation <span style=color:#e6db74>&#34;com.github.kstyrc:embedded-redis:0.6&#34;</span>
    <span style=color:#f92672>}</span>

    <span style=color:#75715e>// jacoco report
</span><span style=color:#75715e></span>    jacocoTestReport <span style=color:#f92672>{</span>
        reports <span style=color:#f92672>{</span>
            xml<span style=color:#f92672>.</span><span style=color:#a6e22e>enabled</span> <span style=color:#66d9ef>false</span>
            html<span style=color:#f92672>.</span><span style=color:#a6e22e>enabled</span> <span style=color:#66d9ef>true</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>

    check<span style=color:#f92672>.</span><span style=color:#a6e22e>dependsOn</span> jacocoTestReport

    
<span style=color:#f92672>}</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>
allprojects <span style=color:#f92672>{</span>
    apply plugin: <span style=color:#e6db74>&#39;maven-publish&#39;</span>

    publishing <span style=color:#f92672>{</span>

        task <span style=color:#a6e22e>sourceJar</span><span style=color:#f92672>(</span>type: Jar<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
            from sourceSets<span style=color:#f92672>.</span><span style=color:#a6e22e>main</span><span style=color:#f92672>.</span><span style=color:#a6e22e>allJava</span>
            classifier <span style=color:#e6db74>&#34;sources&#34;</span>
        <span style=color:#f92672>}</span>


        publications <span style=color:#f92672>{</span>
            mavenSnapshots<span style=color:#f92672>(</span>MavenPublication<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
                groupId project<span style=color:#f92672>.</span><span style=color:#a6e22e>group</span>
                artifactId project<span style=color:#f92672>.</span><span style=color:#a6e22e>name</span>
                version project<span style=color:#f92672>.</span><span style=color:#a6e22e>version</span>
                from components<span style=color:#f92672>.</span><span style=color:#a6e22e>java</span>
                artifact sourceJar
                ext<span style=color:#f92672>.</span><span style=color:#a6e22e>repo</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Dev&#39;</span>
            <span style=color:#f92672>}</span>

            mavenRelease<span style=color:#f92672>(</span>MavenPublication<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
                groupId project<span style=color:#f92672>.</span><span style=color:#a6e22e>group</span>
                artifactId project<span style=color:#f92672>.</span><span style=color:#a6e22e>name</span>
                version project<span style=color:#f92672>.</span><span style=color:#a6e22e>version</span>
                from components<span style=color:#f92672>.</span><span style=color:#a6e22e>java</span>
                artifact sourceJar
                ext<span style=color:#f92672>.</span><span style=color:#a6e22e>repo</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Prod&#39;</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>}</span>
        repositories <span style=color:#f92672>{</span>
            maven <span style=color:#f92672>{</span>
                name <span style=color:#e6db74>&#39;Dev&#39;</span>
                url <span style=color:#e6db74>&#34;${NEXUS_URL}/repository/maven-snapshots/&#34;</span>
                authentication <span style=color:#f92672>{</span>
                    header<span style=color:#f92672>(</span>HttpHeaderAuthentication<span style=color:#f92672>)</span>
                <span style=color:#f92672>}</span>
                credentials<span style=color:#f92672>(</span>HttpHeaderCredentials<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
                    name <span style=color:#e6db74>&#34;Authorization&#34;</span>
                    value <span style=color:#e6db74>&#34;Basic ${NEXUS_CAS_HEADER}&#34;</span>
                <span style=color:#f92672>}</span>
            <span style=color:#f92672>}</span>
            maven <span style=color:#f92672>{</span>
                name <span style=color:#e6db74>&#39;Prod&#39;</span>
                url <span style=color:#e6db74>&#34;${NEXUS_URL}/repository/maven-releases/&#34;</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>

</code></pre></div><p>Project/gradle/repo.gradle 指定私有仓库地址以及验证方式</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>buildscript <span style=color:#f92672>{</span>
    repositories <span style=color:#f92672>{</span>
        mavenLocal<span style=color:#f92672>()</span>
        maven <span style=color:#f92672>{</span>
            url <span style=color:#e6db74>&#34;${NEXUS_URL}/repository/maven-releases/&#34;</span>
            authentication <span style=color:#f92672>{</span>
                header<span style=color:#f92672>(</span>HttpHeaderAuthentication<span style=color:#f92672>)</span>
            <span style=color:#f92672>}</span>
            credentials<span style=color:#f92672>(</span>HttpHeaderCredentials<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
                name <span style=color:#e6db74>&#34;Authorization&#34;</span>
                value <span style=color:#e6db74>&#34;Basic ${NEXUS_CAS_HEADER}&#34;</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>}</span>
        maven <span style=color:#f92672>{</span>
            url <span style=color:#e6db74>&#34;${NEXUS_URL}/repository/maven-snapshots/&#34;</span>
            authentication <span style=color:#f92672>{</span>
                header<span style=color:#f92672>(</span>HttpHeaderAuthentication<span style=color:#f92672>)</span>
            <span style=color:#f92672>}</span>
            credentials<span style=color:#f92672>(</span>HttpHeaderCredentials<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
                name <span style=color:#e6db74>&#34;Authorization&#34;</span>
                value <span style=color:#e6db74>&#34;Basic ${NEXUS_CAS_HEADER}&#34;</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>}</span>
        maven <span style=color:#f92672>{</span>
            url <span style=color:#e6db74>&#34;${NEXUS_URL}/repository/maven-public/&#34;</span>
            authentication <span style=color:#f92672>{</span>
                header<span style=color:#f92672>(</span>HttpHeaderAuthentication<span style=color:#f92672>)</span>
            <span style=color:#f92672>}</span>
            credentials<span style=color:#f92672>(</span>HttpHeaderCredentials<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
                name <span style=color:#e6db74>&#34;Authorization&#34;</span>
                value <span style=color:#e6db74>&#34;Basic ${NEXUS_CAS_HEADER}&#34;</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>}</span>
        maven <span style=color:#f92672>{</span> url <span style=color:#e6db74>&#34;https://maven.aliyun.com/nexus/content/groups/public/&#34;</span> <span style=color:#f92672>}</span>
        maven <span style=color:#f92672>{</span> url <span style=color:#e6db74>&#34;https://repo.spring.io/milestone&#34;</span> <span style=color:#f92672>}</span>
        maven <span style=color:#f92672>{</span> url <span style=color:#e6db74>&#34;https://oss.sonatype.org/content/repositories/snapshots/&#34;</span> <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>

<span style=color:#f92672>}</span>

allprojects <span style=color:#f92672>{</span>
    repositories <span style=color:#f92672>{</span>
        mavenLocal<span style=color:#f92672>()</span>
        maven <span style=color:#f92672>{</span>
            url <span style=color:#e6db74>&#34;${NEXUS_URL}/repository/maven-releases/&#34;</span>
            authentication <span style=color:#f92672>{</span>
                header<span style=color:#f92672>(</span>HttpHeaderAuthentication<span style=color:#f92672>)</span>
            <span style=color:#f92672>}</span>
            credentials<span style=color:#f92672>(</span>HttpHeaderCredentials<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
                name <span style=color:#e6db74>&#34;Authorization&#34;</span>
                value <span style=color:#e6db74>&#34;Basic ${NEXUS_CAS_HEADER}&#34;</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>}</span>
        maven <span style=color:#f92672>{</span>
            url <span style=color:#e6db74>&#34;${NEXUS_URL}/repository/maven-snapshots/&#34;</span>
            authentication <span style=color:#f92672>{</span>
                header<span style=color:#f92672>(</span>HttpHeaderAuthentication<span style=color:#f92672>)</span>
            <span style=color:#f92672>}</span>
            credentials<span style=color:#f92672>(</span>HttpHeaderCredentials<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
                name <span style=color:#e6db74>&#34;Authorization&#34;</span>
                value <span style=color:#e6db74>&#34;Basic ${NEXUS_CAS_HEADER}&#34;</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>}</span>
        maven <span style=color:#f92672>{</span>
            url <span style=color:#e6db74>&#34;${NEXUS_URL}/repository/maven-public/&#34;</span>
            authentication <span style=color:#f92672>{</span>
                header<span style=color:#f92672>(</span>HttpHeaderAuthentication<span style=color:#f92672>)</span>
            <span style=color:#f92672>}</span>
            credentials<span style=color:#f92672>(</span>HttpHeaderCredentials<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
                name <span style=color:#e6db74>&#34;Authorization&#34;</span>
                value <span style=color:#e6db74>&#34;Basic ${NEXUS_CAS_HEADER}&#34;</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>}</span>
        maven <span style=color:#f92672>{</span> url <span style=color:#e6db74>&#34;https://maven.aliyun.com/nexus/content/groups/public/&#34;</span> <span style=color:#f92672>}</span>
        maven <span style=color:#f92672>{</span> url <span style=color:#e6db74>&#34;https://repo.spring.io/milestone&#34;</span> <span style=color:#f92672>}</span>
        maven <span style=color:#f92672>{</span> url <span style=color:#e6db74>&#34;https://oss.sonatype.org/content/repositories/snapshots/&#34;</span> <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>

<span style=color:#f92672>}</span>

subprojects <span style=color:#f92672>{</span>

    repositories <span style=color:#f92672>{</span>
        mavenLocal<span style=color:#f92672>()</span>
        maven <span style=color:#f92672>{</span>
            url <span style=color:#e6db74>&#34;${NEXUS_URL}/repository/maven-releases/&#34;</span>
            authentication <span style=color:#f92672>{</span>
                header<span style=color:#f92672>(</span>HttpHeaderAuthentication<span style=color:#f92672>)</span>
            <span style=color:#f92672>}</span>
            credentials<span style=color:#f92672>(</span>HttpHeaderCredentials<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
                name <span style=color:#e6db74>&#34;Authorization&#34;</span>
                value <span style=color:#e6db74>&#34;Basic ${NEXUS_CAS_HEADER}&#34;</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>}</span>
        maven <span style=color:#f92672>{</span>
            url <span style=color:#e6db74>&#34;${NEXUS_URL}/repository/maven-snapshots/&#34;</span>
            authentication <span style=color:#f92672>{</span>
                header<span style=color:#f92672>(</span>HttpHeaderAuthentication<span style=color:#f92672>)</span>
            <span style=color:#f92672>}</span>
            credentials<span style=color:#f92672>(</span>HttpHeaderCredentials<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
                name <span style=color:#e6db74>&#34;Authorization&#34;</span>
                value <span style=color:#e6db74>&#34;Basic ${NEXUS_CAS_HEADER}&#34;</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>}</span>
        maven <span style=color:#f92672>{</span>
            url <span style=color:#e6db74>&#34;${NEXUS_URL}/repository/maven-public/&#34;</span>
            authentication <span style=color:#f92672>{</span>
                header<span style=color:#f92672>(</span>HttpHeaderAuthentication<span style=color:#f92672>)</span>
            <span style=color:#f92672>}</span>
            credentials<span style=color:#f92672>(</span>HttpHeaderCredentials<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
                name <span style=color:#e6db74>&#34;Authorization&#34;</span>
                value <span style=color:#e6db74>&#34;Basic ${NEXUS_CAS_HEADER}&#34;</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>}</span>
        maven <span style=color:#f92672>{</span> url <span style=color:#e6db74>&#34;https://maven.aliyun.com/nexus/content/groups/public/&#34;</span> <span style=color:#f92672>}</span>
        maven <span style=color:#f92672>{</span> url <span style=color:#e6db74>&#34;https://repo.spring.io/milestone&#34;</span> <span style=color:#f92672>}</span>
        maven <span style=color:#f92672>{</span> url <span style=color:#e6db74>&#34;https://oss.sonatype.org/content/repositories/snapshots/&#34;</span> <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Project/gradle/check.gradle</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>subprojects <span style=color:#f92672>{</span>
    apply plugin: <span style=color:#e6db74>&#39;checkstyle&#39;</span>
    checkstyle <span style=color:#f92672>{</span>
        configFile <span style=color:#f92672>=</span> rootProject<span style=color:#f92672>.</span><span style=color:#a6e22e>file</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;deploy/checkstyle/checkstyle.xml&#39;</span><span style=color:#f92672>)</span>
        showViolations <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
       <span style=color:#75715e>// ignoreFailures = true
</span><span style=color:#75715e></span>
    <span style=color:#f92672>}</span>

    <span style=color:#75715e>//可以指定排查
</span><span style=color:#75715e></span>    checkstyleMain <span style=color:#f92672>{</span>
        exclude <span style=color:#e6db74>&#34;**/*.groovy&#34;</span>
    <span style=color:#f92672>}</span>

    apply plugin: <span style=color:#e6db74>&#39;pmd&#39;</span>
    dependencies <span style=color:#f92672>{</span>
        pmd <span style=color:#e6db74>&#34;com.alibaba.p3c:p3c-pmd:2.0.0&#34;</span>
    <span style=color:#f92672>}</span>
    pmd <span style=color:#f92672>{</span>
        consoleOutput <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
        ruleSets <span style=color:#f92672>=</span> <span style=color:#f92672>[</span>
                <span style=color:#e6db74>&#34;java-ali-comment&#34;</span><span style=color:#f92672>,</span>
                <span style=color:#e6db74>&#34;java-ali-concurrent&#34;</span><span style=color:#f92672>,</span>
                <span style=color:#e6db74>&#34;java-ali-constant&#34;</span><span style=color:#f92672>,</span>
                <span style=color:#e6db74>&#34;java-ali-exception&#34;</span><span style=color:#f92672>,</span>
                <span style=color:#e6db74>&#34;java-ali-flowcontrol&#34;</span><span style=color:#f92672>,</span>
                <span style=color:#e6db74>&#34;java-ali-naming&#34;</span><span style=color:#f92672>,</span>
                <span style=color:#e6db74>&#34;java-ali-oop&#34;</span><span style=color:#f92672>,</span>
                <span style=color:#e6db74>&#34;java-ali-orm&#34;</span><span style=color:#f92672>,</span>
                <span style=color:#e6db74>&#34;java-ali-other&#34;</span><span style=color:#f92672>,</span>
                <span style=color:#e6db74>&#34;java-ali-set&#34;</span>
        <span style=color:#f92672>]</span>
        incrementalAnalysis <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>
    <span style=color:#f92672>}</span>

    pmdMain <span style=color:#f92672>{</span>
        exclude <span style=color:#e6db74>&#34;**/exclude_package/**&#34;</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
test<span style=color:#f92672>.</span><span style=color:#a6e22e>mustRunAfter</span> checkstyleMain<span style=color:#f92672>,</span> checkstyleTest
</code></pre></div><p>Project/sdk/build.gradle</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>apply from: file<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;$rootDir/versions.gradle&#34;</span><span style=color:#f92672>)</span>

jar <span style=color:#f92672>{</span>
    enabled <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
<span style=color:#f92672>}</span>
bootJar <span style=color:#f92672>{</span>
    enabled <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>
<span style=color:#f92672>}</span>
dependencies <span style=color:#f92672>{</span>
    implementation <span style=color:#e6db74>&#39;org.springframework.cloud:spring-cloud-starter-openfeign:2.1.0.RELEASE&#39;</span>
    <span style=color:#f92672>......</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Project/app/build.gradle</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>apply from: file<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;$rootDir/versions.gradle&#34;</span><span style=color:#f92672>)</span>

bootJar <span style=color:#f92672>{</span>
    enabled <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
<span style=color:#f92672>}</span>

jar <span style=color:#f92672>{</span>
    enabled <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>
<span style=color:#f92672>}</span>

dependencies <span style=color:#f92672>{</span>
    implementation deps<span style=color:#f92672>.</span><span style=color:#a6e22e>springboot</span><span style=color:#f92672>.</span><span style=color:#a6e22e>starter</span>
    implementation deps<span style=color:#f92672>.</span><span style=color:#a6e22e>springboot</span><span style=color:#f92672>.</span><span style=color:#a6e22e>starter_web</span>
    implementation deps<span style=color:#f92672>.</span><span style=color:#a6e22e>mysql</span>
    implementation deps<span style=color:#f92672>.</span><span style=color:#a6e22e>myabtis</span><span style=color:#f92672>.</span><span style=color:#a6e22e>myabtis</span>
    implementation deps<span style=color:#f92672>.</span><span style=color:#a6e22e>myabtis</span><span style=color:#f92672>.</span><span style=color:#a6e22e>starter</span>
    implementation <span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-starter-amqp:2.1.2.RELEASE&#39;</span>
    implementation <span style=color:#e6db74>&#34;org.springframework.cloud:spring-cloud-starter-openfeign:2.1.0.RELEASE&#34;</span>
    implementation <span style=color:#e6db74>&#39;com.zaxxer:HikariCP:3.4.1&#39;</span>
    implementation <span style=color:#e6db74>&#39;com.baomidou:mybatis-plus:2.2.0&#39;</span>
    implementation <span style=color:#e6db74>&#39;com.github.pagehelper:pagehelper:5.1.2&#39;</span>
    implementation <span style=color:#e6db74>&#39;org.mongodb:mongo-java-driver:3.8.0&#39;</span>
    <span style=color:#f92672>......</span> <span style=color:#75715e>//剩余映射依赖
</span><span style=color:#75715e></span><span style=color:#f92672>}</span>

</code></pre></div><h2 id=3-dockerfile-注意-add-文件路径>3、 Dockerfile 注意 ADD 文件路径</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> {HARBOR_HOST}/BaseImage</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ADD</span> ./build/libs/app.jar /app.jar<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span>.... 其他配置<span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><h2 id=4project-下添加-gradleproperties-注意在-gitignore-里面添加上它不要传递到公开服务器是你的密码等敏感信息>4、Project/ 下添加 gradle.properties, 注意在 .gitignore 里面添加上它，不要传递到公开服务器，是你的密码等敏感信息</h2><pre><code class=language-properties data-lang=properties># Nexus 仓库地址
NEXUS_URL=https://nexus-url
# 指定为你自己的maven的用户配置 settings.xml 里面的你的配置
NEXUS_CAS_HEADER=XXXXXXX
# gradle daemon
org.gradle.daemon=true
# 禁用Gradle 6.x 版本 SHA-256和SHA-512校验和的发布
# https://juejin.im/post/6844904101126553614
systemProp.org.gradle.internal.publish.checksums.insecure=true
</code></pre><h2 id=5gitlab-ci-模板化下次分享>5、gitlab-ci 模板化，下次分享~~~~</h2><h4><a href=https://pinkhello.github.io/>Back to Home</a></h4></div></div><footer class=container><hr class=soften><p><a href=https://pinkhello.github.io/>hugo.386 theme</a> |
&copy;
<a href=https://pinkhello.github.io/ target=_blank>一杯哈希不加盐</a>
<span id=thisyear>2020</span>
| Built on <a href=//gohugo.io target=_blank>Hugo</a></p><p class=text-center><a href=https://github.com/PinkHello>GitHub</a></p></footer></body><link rel=stylesheet href=/css/bootstrap.css><link rel=stylesheet href=/css/bootstrap-responsive.css><link rel=stylesheet href=/css/style.css><script src=/js/jquery.js></script><script src=/js/bootstrap-386.js></script><script src=/js/bootstrap-transition.js></script><script src=/js/bootstrap-alert.js></script><script src=/js/bootstrap-modal.js></script><script src=/js/bootstrap-dropdown.js></script><script src=/js/bootstrap-scrollspy.js></script><script src=/js/bootstrap-tab.js></script><script src=/js/bootstrap-tooltip.js></script><script src=/js/bootstrap-popover.js></script><script src=/js/bootstrap-button.js></script><script src=/js/bootstrap-collapse.js></script><script src=/js/bootstrap-carousel.js></script><script src=/js/bootstrap-typeahead.js></script><script src=/js/bootstrap-affix.js></script><script>_386={fastLoad:false,onePass:false,speedFactor:1};function ThisYear(){document.getElementById('thisyear').innerHTML=new Date().getFullYear();};</script></html>