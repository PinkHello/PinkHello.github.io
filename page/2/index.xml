<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>PinkHello</title><link>https://pinkhello.me/</link><description>Recent content on PinkHello</description><generator>Hugo -- gohugo.io</generator><language>zh</language><copyright>PinkHello, All Rights Reserved</copyright><lastBuildDate>Tue, 25 May 2021 19:00:00 +0800</lastBuildDate><atom:link href="https://pinkhello.me/index.xml" rel="self" type="application/rss+xml"/><item><title>06 é«˜æ€§èƒ½é˜Ÿåˆ—Disruptor</title><link>https://pinkhello.me/posts/06-%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97disruptor/</link><pubDate>Mon, 15 Mar 2021 08:35:29 +0800</pubDate><guid>https://pinkhello.me/posts/06-%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97disruptor/</guid><description>PinkHello https://pinkhello.me/posts/06-%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97disruptor/ -&lt;h1 id="èƒŒæ™¯">èƒŒæ™¯&lt;/h1>
&lt;p>&lt;code>Disruptor&lt;/code> æ˜¯ å¤–æ±‡äº¤æ˜“å…¬å¸&lt;code>LMAX&lt;/code>å¼€å‘çš„é«˜æ€§èƒ½é˜Ÿåˆ—ã€ç ”å‘æ˜¯ä¸ºäº†è§£å†³å†…å­˜é˜Ÿåˆ—å»¶è¿Ÿé—®é¢˜ã€‚
&lt;code>Disruptor&lt;/code> ä¸€èˆ¬ç”¨äºçº¿ç¨‹é—´çš„æ¶ˆæ¯ä¼ é€’ã€‚
&lt;a href="http://lmax-exchange.github.io/disruptor/">Disruptor GitHub åœ°å€&lt;/a>&lt;/p>
&lt;h1 id="disruptor-ä»‹ç»">&lt;code>Disruptor&lt;/code> ä»‹ç»&lt;/h1>
&lt;p>ç†è§£ &lt;code>Disruptor&lt;/code> æœ€å¥½çš„æ–¹å¼ï¼Œé€‰æ‹©ä¸€ä¸ªæœ€æ¥è¿‘ç†Ÿæ‚‰çš„æ ·æœ¬è¿›è¡Œæ¯”è¾ƒã€‚åœ¨è¿™ä¸ªå‰æä¸‹ï¼Œå¯ä»¥é€‰æ‹© &lt;code>Java&lt;/code> ä¸­çš„ &lt;code>BlockingQueue&lt;/code>.
å’Œé˜Ÿåˆ—ç›¸ä¼¼ï¼Œ&lt;code>Disruptor&lt;/code> ä¹Ÿæ˜¯åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ä¸åŒçš„çº¿ç¨‹ä¹‹é—´è¿›è¡Œä¼ é€’æ•°æ®çš„ï¼ˆä¾‹å¦‚æ¶ˆæ¯æˆ–è€…äº‹ä»¶ï¼‰ï¼ŒåŒæ—¶ &lt;code>Disruptor&lt;/code> æä¾›äº†ä¸€äº›å°†å…³é”®åŠŸèƒ½å’Œé˜Ÿåˆ—åˆ†å¼€çš„ç‰¹æ€§ï¼š&lt;/p>
&lt;ul>
&lt;li>å‘æ¶ˆè´¹è€…å‘é€å¤šæ’­äº‹ä»¶&lt;/li>
&lt;li>æ¶ˆæ¯è€…ä¾èµ–å…³ç³»å›¾&lt;/li>
&lt;li>é¢„å…ˆä¸ºäº‹ä»¶åˆ†é…å†…å­˜&lt;/li>
&lt;li>å¯é€‰çš„ï¼ˆæ— é”ï¼‰&lt;/li>
&lt;/ul>
&lt;h1 id="disruptor-æ ¸å¿ƒæ¦‚å¿µ">&lt;code>Disruptor&lt;/code> æ ¸å¿ƒæ¦‚å¿µ&lt;/h1>
&lt;p>åœ¨æˆ‘ä»¬ç†è§£&lt;code>Disruptor&lt;/code>å¦‚ä½•å·¥ä½œä¹‹å‰ï¼Œäº†è§£ä¸‹æ ¸å¿ƒæ¦‚å¿µ&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/RingBuffer.java">Ring Buffer&lt;/a>
ç¯å½¢æ•°ç»„è®¾è®¡ï¼Œä¸ºäº†é¿å…åƒåœ¾å›æ”¶ï¼Œé‡‡ç”¨çš„æ•°ç»„ç»“æ„ï¼Œä»3.0å¼€å§‹ï¼Œç¯å½¢ç¼“å†²åŒºä¸»è¦å­˜å‚¨å’Œæ›´æ–°åœ¨&lt;code>Disruptor&lt;/code>ä¸­ç§»åŠ¨çš„æ•°æ®ï¼ˆäº‹ä»¶ï¼‰&lt;/li>
&lt;li>&lt;a href="https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/Sequence.java">Sequence&lt;/a>
&lt;code>Disruptor&lt;/code> æ¯ä¸ªæ¶ˆè´¹è€…(&lt;code>EventProcessor&lt;/code>)ç»´æŠ¤ä¸€ä¸ª &lt;code>Sequence&lt;/code>ï¼Œå¹¶å‘çš„å¤§å¤šæ•°ä»£ç éƒ½ä¾èµ– &lt;code>Sequence&lt;/code> å€¼çš„æ”¹åŠ¨ï¼Œæ‰€ä»¥ &lt;code>Sequence&lt;/code> æ”¯æŒ &lt;code>AtomicLong&lt;/code> çš„å¤§éƒ¨åˆ†ä¹Ÿè¡Œ, å”¯ä¸€ä¸åŒçš„æ˜¯ &lt;code>Sequence&lt;/code> åŒ…å«é¢å¤–çš„åŠŸèƒ½æ¥é˜»æ­¢&lt;code>Sequence&lt;/code>å’Œå…¶ä»–å€¼ä¹‹é—´çš„ä¼ªå…±äº«(&lt;code>false sharing&lt;/code>)&lt;/li>
&lt;li>&lt;a href="https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/Sequencer.java">Sequencer&lt;/a>&lt;br>
&lt;code>Disruptor&lt;/code> æ ¸å¿ƒé€»è¾‘, ä¸¤ä¸ªå®ç°: å•ç”Ÿäº§è€…å’Œå¤šç”Ÿäº§è€…ã€‚ä»–ä»¬å®ç°äº†ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ä¹‹é—´çš„å¿«é€Ÿä¼ é€’çš„å¹¶å‘ç®—æ³•ã€‚&lt;/li>
&lt;li>&lt;a href="https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/SequenceBarrier.java">Sequence Barrier&lt;/a>
ç”± &lt;code>Sequencer&lt;/code> ç”Ÿæˆï¼ŒåŒ…å«æ­¤ &lt;code>Sequencer&lt;/code> å‘å¸ƒçš„ &lt;code>Sequence&lt;/code> æŒ‡é’ˆä»¥åŠä¾èµ–çš„å…¶ä»–æ¶ˆè´¹è€…çš„ &lt;code>Sequence&lt;/code>ã€‚åŒ…å«äº†æ¶ˆè´¹è€…æ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨çš„äº‹ä»¶çš„ä»£ç ã€‚&lt;/li>
&lt;li>&lt;a href="https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/WaitStrategy.java">Wait Strategy&lt;/a>
æ¶ˆè´¹è€…ç­‰å¾…äº‹ä»¶çš„ç­–ç•¥ï¼Œè¿™ä¸ªäº‹ä»¶ç”±ç”Ÿäº§è€…æ”¾å…¥ï¼Œå†³å®šäº†æ¶ˆè´¹è€…æ€ä¹ˆç­‰å¾…ç”Ÿäº§è€…å°†äº‹ä»¶æ”¾å…¥ &lt;code>Disruptor&lt;/code>&lt;/li>
&lt;li>Event ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ä¼ é€’çš„äº‹ä»¶ï¼Œå®Œå…¨ç”±ç”¨æˆ·å®šä¹‰&lt;/li>
&lt;li>&lt;a href="https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/EventProcessor.java">EventProcessor&lt;/a>
å¤„ç†äº‹ä»¶çš„ä¸»è¦å¾ªç¯ï¼ˆ&lt;code>main event loop&lt;/code>ï¼‰ï¼ŒåŒ…å«äº†ä¸€ä¸ª &lt;code>Sequeuece&lt;/code>. æœ‰ä¸€ä¸ªå…·ä½“çš„å®ç°ç±» &lt;code>BatchEventProcessor&lt;/code>&lt;/li>
&lt;li>&lt;a href="https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/EventHandler.java">EventHandler&lt;/a>
ç”¨æˆ·å®ç°çš„æ¥å£ï¼Œä»£è¡¨ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚å¤„ç†äº‹ä»¶ã€‚&lt;/li>
&lt;li>Producer ç”Ÿäº§è€…ã€å…ˆè·å¾—å ä½ï¼Œç„¶åæäº¤äº‹ä»¶ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://pinkhello.me/%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97-Disruptor/Disruptor%E8%AE%BE%E8%AE%A1%E7%BB%84%E4%BB%B6%E5%9B%BE.jpg" alt="Disruptorè®¾è®¡ç»„ä»¶å›¾">&lt;/p>
&lt;ul>
&lt;li>
&lt;p>äº‹ä»¶å¹¿æ’­(&lt;code>Multicast Events&lt;/code>)&lt;/p>
&lt;p>äº‹ä»¶å¹¿æ’­æ˜¯ &lt;code>Disruptor&lt;/code> ä¸ &lt;code>Queue&lt;/code> æœ€å¤§çš„åŒºåˆ«ï¼Œå½“ä½ æœ‰å¤šä¸ªæ¶ˆè´¹è€…ç›‘å¬ä¸€ä¸ª &lt;code>Disruptor&lt;/code>, æ‰€æœ‰çš„äº‹ä»¶å°†ä¼šå‘å¸ƒåˆ°è¿™ä¸ªæ‰€æœ‰çš„æ¶ˆè´¹è€…ã€‚
&lt;code>Disruptor&lt;/code> è¿™ä¸€ç‰¹æ€§è¢«ç”¨æ¥éœ€è¦å¯¹åŒä¸€æ•°æ®è¿›è¡Œå¤šä¸ªå¹¶è¡Œæ“ä½œçš„æƒ…å†µã€‚
å¦‚åœ¨LMAXç³»ç»Ÿä¸­æœ‰ä¸‰ä¸ªæ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œï¼šæ—¥å¿—ï¼ˆå°†æ•°æ®æŒä¹…åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼‰ï¼Œå¤åˆ¶ï¼ˆå°†æ•°æ®å‘é€åˆ°å…¶ä»–çš„æœºå™¨ä¸Šï¼Œä»¥ç¡®ä¿å­˜åœ¨æ•°æ®è¿œç¨‹å‰¯æœ¬ï¼‰ï¼Œä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚
ä¹Ÿå¯ä»¥ä½¿ç”¨&lt;code>WokrerPool&lt;/code>æ¥å¹¶è¡Œå¤„ç†ä¸åŒçš„äº‹ä»¶ã€‚&lt;/p>
&lt;p>å¦‚ä¸Šå›¾ã€‚å¯ä»¥çœ‹åˆ°æœ‰3ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºæ­£åœ¨ä¾¦å¬&lt;code>Disrupto&lt;/code>rï¼ˆ&lt;code>JournalConsumer&lt;/code>ï¼Œ&lt;code>ReplicationConsumer&lt;/code> å’Œ &lt;code>ApplicationConsumer&lt;/code>ï¼‰ï¼Œ
è¿™äº›äº‹ä»¶å¤„ç†ç¨‹åºä¸­çš„æ¯ä¸ªå°†æ¥æ”¶&lt;code>Disruptor&lt;/code>ä¸­æ‰€æœ‰å¯ç”¨çš„æ¶ˆæ¯ï¼ˆæŒ‰ç›¸åŒé¡ºåºï¼‰ã€‚è¿™å…è®¸è¿™äº›æ¶ˆè´¹è€…ä¸­çš„æ¯ä¸€ä¸ªå¹¶è¡Œå·¥ä½œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ¶ˆè´¹è€…ä¾èµ–å…³ç³»å›¾(&lt;code>Consumer Dependency Graph&lt;/code>)&lt;/p>
&lt;p>ä¸ºäº†æ”¯æŒå®ç°ä¸šåŠ¡å¹¶è¡Œå¤„ç†æµç¨‹ï¼Œ&lt;code>Disruptor&lt;/code> æä¾›äº†å¤šä¸ªæ¶ˆè´¹è€…ä¹‹é—´çš„åä½œåŠŸèƒ½ã€‚å›åˆ°ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°† &lt;code>journalling&lt;/code> å’Œ &lt;code>replication&lt;/code> æ¶ˆè´¹å®Œæˆä»–ä»¬çš„ä¸šåŠ¡ï¼Œåå†ç»§ç»­æ‰§è¡Œä¸šåŠ¡é€»è¾‘æµç¨‹ã€‚
æˆ‘ä»¬ç§°å‘¼è¿™ä¸ªåŠŸèƒ½ä¸º &lt;code>gating&lt;/code> , &lt;code>gating&lt;/code> å‘ç”Ÿåœ¨ä¸¤ç§åœºæ™¯ä¸‹:&lt;/p>
&lt;ul>
&lt;li>ç¡®ä¿ &lt;code>Producer&lt;/code> ä¸èƒ½è¿è¡Œè¶…è¿‡ &lt;code>Consumer&lt;/code> ï¼Œå¯ä»¥é€šå¤šè°ƒç”¨ &lt;code>RingBuffer.addGatingConsumers()&lt;/code> æ¥å¢åŠ ç›¸å…³çš„æ¶ˆè´¹è€…æ¥å®Œæˆ&lt;/li>
&lt;li>ä¹‹å‰æ‰€è¯´çš„åœºæ™¯ï¼Œé€šè¿‡å¿…é¡»å…ˆå®Œæˆçš„&lt;code>Consumer&lt;/code> çš„ &lt;code>Sequence&lt;/code>çš„&lt;code>SequenceBarrier&lt;/code>æ¥å®ç°ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>äº‹ä»¶é¢„åˆ†é…(&lt;code>Event Preallocation&lt;/code>)&lt;/p>
&lt;p>&lt;code>Disruptor&lt;/code> çš„ä¸€ä¸ªç›®æ ‡å°±æ˜¯åœ¨ä½å»¶æ—¶ç¯å¢ƒä¸‹ï¼Œå‡å°‘æˆ–å¼‚å¸¸å†…å­˜çš„å ç”¨ã€‚ï¼ˆåœ¨JAVAç¯å¢ƒä¸‹ï¼Œéœ€è¦è¾ƒå°‘GCåœé¡¿çš„æ¬¡æ•°ï¼‰ï¼ˆC/C++ç¯å¢ƒä¸‹ï¼Œå¤§é‡çš„å†…å­˜åˆ†é…ä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯é€‰æ‹©çš„æ— é”(&lt;code>Optionally Lock-free&lt;/code>)&lt;/p>
&lt;p>æ— é”çš„ &lt;code>Disruptor&lt;/code> çš„ä½å»¶è¿Ÿçš„æ— é”çš„ç‰¹æ€§å®ç°ç»†èŠ‚æ˜¯éƒ½æ˜¯åŸºäº å†…å­˜å±éšœ å’Œ CAS æ“ä½œå®ç°çš„ï¼Œåªæœ‰ä¸€ä¸ªåœºæ™¯ &lt;code>BlockingWaitStrategy&lt;/code> ä¸­ä½¿ç”¨çš„ &lt;code>Lock&lt;/code>
æ˜¯ä¸ºäº†ä½¿ç”¨ &lt;code>Lock&lt;/code> é‡Œé¢çš„ &lt;code>Condition&lt;/code>, æ–¹ä¾¿æ¶ˆè´¹è€…çº¿ç¨‹è¢« &lt;code>Park&lt;/code> æ—¶å€™ç­‰å¾…æ–°çš„äº‹ä»¶æ¥è§¦å‘ã€‚è®¸å¤šä½å»¶è¿Ÿç³»ç»Ÿä½¿ç”¨è‡ªæ—‹ï¼ˆ&lt;code>busy-wait&lt;/code>ï¼‰æ¥é¿å…ä½¿ç”¨ &lt;code>Condition&lt;/code>é€ æˆçš„æŠ–åŠ¨
ç„¶è€Œï¼Œå¤ªå¤šçš„ &lt;code>busy-wait&lt;/code> ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œç‰¹åˆ«åœ¨CPUèµ„æºå—é™çš„æƒ…å†µä¸‹ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h1 id="disruptor-å‡ ä¸ªæ ¸å¿ƒçš„è®¾è®¡">&lt;code>Disruptor&lt;/code> å‡ ä¸ªæ ¸å¿ƒçš„è®¾è®¡&lt;/h1>
&lt;h2 id="sequence-è®¾è®¡">&lt;code>Sequence&lt;/code> è®¾è®¡&lt;/h2>
&lt;p>&lt;img src="https://pinkhello.me/%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97-Disruptor/Sequence.jpg" alt="Sequence è®¾è®¡">&lt;/p>
&lt;p>Sequence çœŸæ­£è®¡æ•°æ˜¯ &lt;code>value&lt;/code> é‡‡ç”¨ç¼“å†²è¡Œé˜²æ­¢ &lt;code>false sharing&lt;/code>ã€‚åœ¨&lt;code>value&lt;/code>çš„å‰åæœ‰7ä¸ª &lt;code>long&lt;/code> å‹çš„å¡«å……å€¼ï¼Œåš&lt;code>CPU cache line&lt;/code>å¡«å……é˜²æ­¢ä¼ªå…±äº«ã€‚&lt;/p>
&lt;h2 id="ringbuffer-è®¾è®¡">&lt;code>RingBuffer&lt;/code> è®¾è®¡&lt;/h2>
&lt;p>&lt;img src="https://pinkhello.me/%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97-Disruptor/RingBuffer.jpg" alt="RingBuffer è®¾è®¡">&lt;/p>
&lt;p>&lt;code>RingBuffer&lt;/code> æ˜¯ä¸€ä¸ªç¯ï¼ˆé¦–å°¾ç›¸æ¥ï¼‰ï¼Œå¯ä»¥ç”¨ä½œä¸åŒçš„ä¸Šä¸‹æ–‡ï¼ˆçº¿ç¨‹ï¼‰é—´ä¼ é€’æ•°æ®çš„ &lt;code>Buffer&lt;/code>ç¯å½¢è®¾è®¡ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸ªåæ ‡ï¼Œå–å¾—å…ƒç´ é€šè¿‡å–modæ“ä½œã€‚
æ˜¯æ•°ç»„è®¾è®¡ã€éé“¾è¡¨ã€‚&lt;/p>
&lt;p>ä¸€èˆ¬æ˜¯&lt;code>2^N&lt;/code>æ¬¡æ–¹ï¼Œè¿™æ · sequence &amp;amp; (array length - 1 ) = array indexã€‚å“ˆå¸ŒMapä¹Ÿæ˜¯è¿™ç§ä½è¿ç®—åšçš„ã€‚&lt;/p>
&lt;p>&lt;code>RingBuffer&lt;/code> ç‰¹ç‚¹&lt;/p>
&lt;ul>
&lt;li>æ•°ç»„å®ç°ã€å¿«é€Ÿè®¿é—®&lt;/li>
&lt;li>å…ƒç´ æ˜¯è¦†ç›–å¼çš„ï¼Œä¸ä¸»åŠ¨æ¸…é™¤&lt;/li>
&lt;li>ç¥å¥‡çš„ç¼“å­˜è¡Œï¼ˆç¼“å­˜æ˜¯ç”±ç¼“å­˜è¡Œç»„æˆçš„ï¼Œé€šå¸¸64ä¸ªå­—èŠ‚ã€ä¸€ä¸ªJAVA long ç±»å‹ 8 å­—èŠ‚ï¼‰&lt;/li>
&lt;/ul>
&lt;h2 id="æ¶ˆè´¹è€…ä¾èµ–è®¾è®¡">æ¶ˆè´¹è€…ä¾èµ–è®¾è®¡&lt;/h2>
&lt;h2 id="ç¼“å­˜å†…å­˜åŠ è½½è¿‡ç¨‹">ç¼“å­˜å†…å­˜åŠ è½½è¿‡ç¨‹&lt;/h2>
&lt;p>&lt;img src="https://pinkhello.me/%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97-Disruptor/cache-line-1.jpg" alt="ç¼“å­˜åŠ è½½è¿‡ç¨‹">
&lt;img src="https://pinkhello.me/%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97-Disruptor/cache-line-2.jpg" alt="ç¼“å­˜åŠ è½½è¿‡ç¨‹">
&lt;img src="https://pinkhello.me/%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97-Disruptor/cache-line-3.jpg" alt="ç¼“å­˜åŠ è½½è¿‡ç¨‹">&lt;/p>
&lt;p>&lt;a href="https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/RingBuffer.java">ç¥å¥‡çš„è§£å†³æ–¹å¼&amp;mdash;&amp;ndash; ç¼“å­˜è¡Œå¡«å……&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">long&lt;/span> p1, p2, p3, p4, p5, p6, p7; &lt;span style="color:#228b22">// cache line padding
&lt;/span>&lt;span style="color:#228b22">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">volatile&lt;/span> &lt;span style="color:#00688b;font-weight:bold">long&lt;/span> cursor = INITIAL_CURSOR_VALUE;
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">long&lt;/span> p8, p9, p10, p11, p12, p13, p14; &lt;span style="color:#228b22">// cache line padding
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="disruptor-ä½¿ç”¨demo">&lt;code>Disruptor&lt;/code> ä½¿ç”¨Demo&lt;/h1>
&lt;p>&lt;code>TransactionOrder&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">TransactionOrder&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> String id;
&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> &lt;span style="color:#00688b;font-weight:bold">double&lt;/span> price;
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>TransactionHandler&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">TransactionHandler&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">implements&lt;/span> EventHandler&amp;lt;TransactionOrder&amp;gt;, WorkHandler&amp;lt;TransactionOrder&amp;gt; {
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">onEvent&lt;/span>(TransactionOrder transactionOrder, &lt;span style="color:#00688b;font-weight:bold">long&lt;/span> sequence, &lt;span style="color:#00688b;font-weight:bold">boolean&lt;/span> endOfBatch) &lt;span style="color:#8b008b;font-weight:bold">throws&lt;/span> Exception {
&lt;span style="color:#8b008b;font-weight:bold">this&lt;/span>.&lt;span style="color:#658b00">onEvent&lt;/span>(transactionOrder);
}
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">onEvent&lt;/span>(TransactionOrder transactionOrder) &lt;span style="color:#8b008b;font-weight:bold">throws&lt;/span> Exception {
&lt;span style="color:#228b22">//å…·ä½“çš„æ¶ˆè´¹é€»è¾‘
&lt;/span>&lt;span style="color:#228b22">&lt;/span> transactionOrder.&lt;span style="color:#658b00">setId&lt;/span>(UUID.&lt;span style="color:#658b00">randomUUID&lt;/span>().&lt;span style="color:#658b00">toString&lt;/span>());
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Demo1&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">Demo1&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">main&lt;/span>(String[] args) &lt;span style="color:#8b008b;font-weight:bold">throws&lt;/span> ExecutionException, InterruptedException {
&lt;span style="color:#00688b;font-weight:bold">int&lt;/span> BUFFER_SIZE = 1024;
&lt;span style="color:#00688b;font-weight:bold">int&lt;/span> THREAD_NUM = 4;
&lt;span style="color:#228b22">//createSingleProducer åˆ›å»ºå•ç”Ÿäº§è€…çš„ RingBuffer
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">final&lt;/span> RingBuffer&amp;lt;TransactionOrder&amp;gt; ringBuffer =
RingBuffer.&lt;span style="color:#658b00">createSingleProducer&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> EventFactory&amp;lt;TransactionOrder&amp;gt;() {
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> TransactionOrder &lt;span style="color:#008b45">newInstance&lt;/span>() {
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> TransactionOrder();
}
}, BUFFER_SIZE, &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> YieldingWaitStrategy());
&lt;span style="color:#228b22">//åˆ›å»ºçº¿ç¨‹æ± 
&lt;/span>&lt;span style="color:#228b22">&lt;/span> ExecutorService service = Executors.&lt;span style="color:#658b00">newFixedThreadPool&lt;/span>(THREAD_NUM);
&lt;span style="color:#228b22">//åˆ›å»º SequenceBarrier
&lt;/span>&lt;span style="color:#228b22">&lt;/span> SequenceBarrier sequenceBarrier = ringBuffer.&lt;span style="color:#658b00">newBarrier&lt;/span>();
&lt;span style="color:#228b22">//åˆ›å»ºæ¶ˆæ¯å¤„ç†å™¨
&lt;/span>&lt;span style="color:#228b22">&lt;/span> BatchEventProcessor&amp;lt;TransactionOrder&amp;gt; eventProcessor =
&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> BatchEventProcessor&amp;lt;TransactionOrder&amp;gt;(ringBuffer, sequenceBarrier, &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> TransactionHandler());
&lt;span style="color:#228b22">//è¿™ä¸€éƒ¨åˆ†æ˜¯è®© RingBufferæ ¹æ®æ¶ˆè´¹è€…çŠ¶æ€è¿›è¡Œgating, åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…çš„è¯å¯ä»¥çœç•¥
&lt;/span>&lt;span style="color:#228b22">&lt;/span> ringBuffer.&lt;span style="color:#658b00">addGatingSequences&lt;/span>(eventProcessor.&lt;span style="color:#658b00">getSequence&lt;/span>());
&lt;span style="color:#228b22">//æŠŠæ¶ˆæ¯å¤„ç†å™¨æäº¤åˆ°çº¿ç¨‹æ± 
&lt;/span>&lt;span style="color:#228b22">&lt;/span> service.&lt;span style="color:#658b00">submit&lt;/span>(eventProcessor);
Future&amp;lt;?&amp;gt; future = service.&lt;span style="color:#658b00">submit&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> Callable&amp;lt;Void&amp;gt;() {
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> Void &lt;span style="color:#008b45">call&lt;/span>() &lt;span style="color:#8b008b;font-weight:bold">throws&lt;/span> Exception {
&lt;span style="color:#00688b;font-weight:bold">long&lt;/span> seq;
&lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> (&lt;span style="color:#00688b;font-weight:bold">int&lt;/span> i = 0; i&amp;lt;10000; i++) {
seq = ringBuffer.&lt;span style="color:#658b00">next&lt;/span>(); &lt;span style="color:#228b22">//ringbuffer çš„ä¸€ä¸ªå¯ç”¨åŒºå—
&lt;/span>&lt;span style="color:#228b22">&lt;/span> ringBuffer.&lt;span style="color:#658b00">get&lt;/span>(seq).&lt;span style="color:#658b00">setPrice&lt;/span>(Math.&lt;span style="color:#658b00">random&lt;/span>() *9999); &lt;span style="color:#228b22">// ç»™è¿™ä¸ªåŒºå—æ”¾å…¥æ•°æ®
&lt;/span>&lt;span style="color:#228b22">&lt;/span> ringBuffer.&lt;span style="color:#658b00">publish&lt;/span>(seq); &lt;span style="color:#228b22">//å‘å¸ƒæ•°æ®ä½¿å¾— consumer å¯ä»¥è·å–è¯¥æ•°æ®
&lt;/span>&lt;span style="color:#228b22">&lt;/span> }
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">null&lt;/span>;
}
});
future.&lt;span style="color:#658b00">get&lt;/span>(); &lt;span style="color:#228b22">//ç­‰å¾…ç”Ÿäº§è€…ç»“æŸ
&lt;/span>&lt;span style="color:#228b22">&lt;/span>
eventProcessor.&lt;span style="color:#658b00">halt&lt;/span>(); &lt;span style="color:#228b22">//é€šçŸ¥äº‹ä»¶
&lt;/span>&lt;span style="color:#228b22">&lt;/span>
service.&lt;span style="color:#658b00">shutdown&lt;/span>(); &lt;span style="color:#228b22">//ç»ˆæ­¢çº¿ç¨‹
&lt;/span>&lt;span style="color:#228b22">&lt;/span>
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Demo2&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">Demo2&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">main&lt;/span>(String[] args) {
&lt;span style="color:#00688b;font-weight:bold">int&lt;/span> BUFFER_SIZE = 1024;
&lt;span style="color:#00688b;font-weight:bold">int&lt;/span> THREAD_NUM = 4;
EventFactory&amp;lt;TransactionOrder&amp;gt; eventFactory = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> EventFactory&amp;lt;TransactionOrder&amp;gt;() {
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> TransactionOrder &lt;span style="color:#008b45">newInstance&lt;/span>() {
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> TransactionOrder();
}
};
RingBuffer&amp;lt;TransactionOrder&amp;gt; ringBuffer = RingBuffer.&lt;span style="color:#658b00">createSingleProducer&lt;/span>(eventFactory, BUFFER_SIZE);
SequenceBarrier sequenceBarrier = ringBuffer.&lt;span style="color:#658b00">newBarrier&lt;/span>();
ExecutorService service = Executors.&lt;span style="color:#658b00">newFixedThreadPool&lt;/span>(THREAD_NUM);
WorkHandler&amp;lt;TransactionOrder&amp;gt; workHandler = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> TransactionHandler();
WorkerPool&amp;lt;TransactionOrder&amp;gt; workerPool =
&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> WorkerPool&amp;lt;TransactionOrder&amp;gt;(ringBuffer, sequenceBarrier, &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> IgnoreExceptionHandler(),
workHandler);
&lt;span style="color:#228b22">//åºåˆ—åè°ƒè€…
&lt;/span>&lt;span style="color:#228b22">&lt;/span> ringBuffer.&lt;span style="color:#658b00">addGatingSequences&lt;/span>(workerPool.&lt;span style="color:#658b00">getWorkerSequences&lt;/span>());
workerPool.&lt;span style="color:#658b00">start&lt;/span>(service);
&lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> (&lt;span style="color:#00688b;font-weight:bold">int&lt;/span> i=0; i&amp;lt;8; i++) {
&lt;span style="color:#00688b;font-weight:bold">long&lt;/span> seq = ringBuffer.&lt;span style="color:#658b00">next&lt;/span>();
ringBuffer.&lt;span style="color:#658b00">get&lt;/span>(seq).&lt;span style="color:#658b00">setPrice&lt;/span>(Math.&lt;span style="color:#658b00">random&lt;/span>() * 9999);
ringBuffer.&lt;span style="color:#658b00">publish&lt;/span>(seq);
}
workerPool.&lt;span style="color:#658b00">halt&lt;/span>();
service.&lt;span style="color:#658b00">shutdown&lt;/span>();
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Demo3&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">Demo3&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">main&lt;/span>(String[] args) &lt;span style="color:#8b008b;font-weight:bold">throws&lt;/span> InterruptedException {
&lt;span style="color:#00688b;font-weight:bold">long&lt;/span> start = System.&lt;span style="color:#658b00">currentTimeMillis&lt;/span>();
&lt;span style="color:#00688b;font-weight:bold">int&lt;/span> BUFFER_SIZE = 1024;
&lt;span style="color:#00688b;font-weight:bold">int&lt;/span> THREAD_NUM = 4;
ExecutorService service = Executors.&lt;span style="color:#658b00">newFixedThreadPool&lt;/span>(THREAD_NUM);
Disruptor&amp;lt;TransactionOrder&amp;gt; disruptor = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> Disruptor&amp;lt;TransactionOrder&amp;gt;(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> EventFactory&amp;lt;TransactionOrder&amp;gt;() {
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> TransactionOrder &lt;span style="color:#008b45">newInstance&lt;/span>() {
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> TransactionOrder();
}
}, BUFFER_SIZE, service, ProducerType.&lt;span style="color:#658b00">SINGLE&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> BusySpinWaitStrategy());
&lt;span style="color:#228b22">/**
&lt;/span>&lt;span style="color:#228b22"> * è±å½¢æ“ä½œ
&lt;/span>&lt;span style="color:#228b22"> */&lt;/span>
&lt;span style="color:#228b22">//ä½¿ç”¨ disruptor åˆ›å»ºæ¶ˆè´¹ç»„ C1 ä¸ C2
&lt;/span>&lt;span style="color:#228b22">&lt;/span> EventHandlerGroup&amp;lt;TransactionOrder&amp;gt; eventHandlerGroup =
disruptor.&lt;span style="color:#658b00">handleEventsWith&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> TransactionHandler(), &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> TransactionVasConsumer());
&lt;span style="color:#228b22">//C3
&lt;/span>&lt;span style="color:#228b22">&lt;/span> TransactionJmsNotifyHandler jmsNotifyHandler = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> TransactionJmsNotifyHandler();
&lt;span style="color:#228b22">//å£°æ˜åœ¨ C1 å’Œ C2 å®Œäº‹å æ‰§è¡Œ JMSæ¶ˆæ¯å‘é€æ“ä½œï¼ˆC3ï¼‰
&lt;/span>&lt;span style="color:#228b22">&lt;/span> eventHandlerGroup.&lt;span style="color:#658b00">then&lt;/span>(jmsNotifyHandler);
&lt;span style="color:#228b22">/**
&lt;/span>&lt;span style="color:#228b22"> * é¡ºåºæ‰§è¡Œ
&lt;/span>&lt;span style="color:#228b22"> */&lt;/span>
&lt;span style="color:#228b22">// disruptor.handleEventsWith(new TransactionHandler())
&lt;/span>&lt;span style="color:#228b22">// .then(new TransactionVasConsumer())
&lt;/span>&lt;span style="color:#228b22">// .then(new TransactionJmsNotifyHandler());
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#228b22">/**
&lt;/span>&lt;span style="color:#228b22"> * å…­è¾¹å½¢æ“ä½œ
&lt;/span>&lt;span style="color:#228b22"> */&lt;/span>
&lt;span style="color:#228b22">// TransactionHandler h1 = new TransactionHandler();
&lt;/span>&lt;span style="color:#228b22">// TransactionHandler h2 = new TransactionHandler();
&lt;/span>&lt;span style="color:#228b22">// TransactionHandler h3 = new TransactionHandler();
&lt;/span>&lt;span style="color:#228b22">// TransactionHandler h4 = new TransactionHandler();
&lt;/span>&lt;span style="color:#228b22">// TransactionHandler h5 = new TransactionHandler();
&lt;/span>&lt;span style="color:#228b22">// TransactionHandler h6 = new TransactionHandler();
&lt;/span>&lt;span style="color:#228b22">// disruptor.handleEventsWith(h1, h2);
&lt;/span>&lt;span style="color:#228b22">// disruptor.after(h1).handleEventsWith(h4);
&lt;/span>&lt;span style="color:#228b22">// disruptor.after(h2).handleEventsWith(h5);
&lt;/span>&lt;span style="color:#228b22">// disruptor.after(h4, h5).handleEventsWith(h3);
&lt;/span>&lt;span style="color:#228b22">&lt;/span>
&lt;span style="color:#228b22">//å¯åŠ¨
&lt;/span>&lt;span style="color:#228b22">&lt;/span> disruptor.&lt;span style="color:#658b00">start&lt;/span>();
CountDownLatch latch = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> CountDownLatch(1);
&lt;span style="color:#228b22">//ç”Ÿäº§è€…å‡†å¤‡
&lt;/span>&lt;span style="color:#228b22">&lt;/span> service.&lt;span style="color:#658b00">submit&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> TransactionPubllisher(disruptor, latch));
latch.&lt;span style="color:#658b00">await&lt;/span>(); &lt;span style="color:#228b22">//ç­‰å¾…ç”Ÿäº§è€…å®Œäº‹
&lt;/span>&lt;span style="color:#228b22">&lt;/span>
disruptor.&lt;span style="color:#658b00">shutdown&lt;/span>();
service.&lt;span style="color:#658b00">shutdown&lt;/span>();
System.&lt;span style="color:#658b00">out&lt;/span>.&lt;span style="color:#658b00">println&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;æ€»è€—æ—¶:&amp;#34;&lt;/span>+ (System.&lt;span style="color:#658b00">currentTimeMillis&lt;/span>() - start));
}
}
&lt;/code>&lt;/pre>&lt;/div>- https://pinkhello.me/posts/06-%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97disruptor/ - PinkHello, All Rights Reserved</description></item><item><title>16 Hexoè¿ç§»Hugo</title><link>https://pinkhello.me/posts/16-hexo%E8%BF%81%E7%A7%BBhugo/</link><pubDate>Wed, 10 Feb 2021 19:36:33 +0800</pubDate><guid>https://pinkhello.me/posts/16-hexo%E8%BF%81%E7%A7%BBhugo/</guid><description>PinkHello https://pinkhello.me/posts/16-hexo%E8%BF%81%E7%A7%BBhugo/ -&lt;h1 id="ä¸ºä»€ä¹ˆè¿ç§»-hugo">ä¸ºä»€ä¹ˆè¿ç§» &lt;code>Hugo&lt;/code>&lt;/h1>
&lt;ul>
&lt;li>&lt;code>Hugo&lt;/code> ä½¿ç”¨æ¯” &lt;code>Hexo&lt;/code> ç®€å•, åªæœ‰å•ç‹¬çš„ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶&lt;/li>
&lt;li>è‹¦äº &lt;code>Hexo&lt;/code> çš„ &lt;code>NodeModule&lt;/code> ç®¡ç†&lt;/li>
&lt;li>è¿ç§»æˆæœ¬æ›´ä½, ç»“åˆ &lt;code>Github Action&lt;/code> å®ç° &lt;code>Markdown&lt;/code> æ–‡ç« å‘å¸ƒ, è‡ªåŠ¨æ›´æ–°è‡³é™æ€ç«™&lt;/li>
&lt;li>è§„åˆ’ï¼šåŠ å…¥è‡ªå®šä¹‰åŸŸåä»¥åŠåšé™æ€èµ„æºCDNåšçš„åŠ é€Ÿ&lt;/li>
&lt;/ul>
&lt;h1 id="å‰ç½®å·¥ä½œ">å‰ç½®å·¥ä½œ&lt;/h1>
&lt;p>1ã€ ä¹‹å‰åŸºæœ¬æ‰€æœ‰çš„åšå®¢éƒ½æ‰˜ç®¡ä¸ &lt;code>github&lt;/code>,è¿™æ¬¡ä¹Ÿä¸ä¾‹å¤–, å¤ç”¨ &lt;code>https://pinkhello.github.io&lt;/code>,åˆ›å»ºä¸¤ä¸ªé¡¹ç›®&lt;/p>
&lt;ul>
&lt;li>pinkhello.github.io template ä»“åº“&lt;/li>
&lt;li>pinkhello.github.io.source private ä»“åº“&lt;/li>
&lt;/ul>
&lt;p>2ã€å‡†å¤‡OpenSSHç§é’¥å’Œå…¬é’¥&lt;/p>
&lt;ul>
&lt;li>pinkhello.github.io ä»“åº“ æ·»åŠ  settings -&amp;gt; Deploy keys -&amp;gt; Add Deploy Key (å°†å…¬é’¥æ·»åŠ è¿›å»ã€æ³¨æ„å…è®¸ Write)&lt;/li>
&lt;li>pinkhello.github.io.source ä»“åº“ æ·»åŠ  settings -&amp;gt; Actions secrets -&amp;gt; New Repository Secret ( NAME : ACTION_DEPLOY_KEY, Value: ç§é’¥ )&lt;/li>
&lt;/ul>
&lt;p>3ã€git clone pinkhello.github.io.source ä»“åº“&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">git clone git@github.com:PinkHello/pinkhello.github.io.source.git
&lt;span style="color:#658b00">cd&lt;/span> pinkhello.github.io.source
&lt;span style="color:#228b22"># åˆå§‹åŒ–ç«™ç‚¹ã€--force å¼ºåˆ¶åˆå§‹åŒ–ã€‘&lt;/span>
hugo new site . --force
&lt;span style="color:#228b22"># content site &lt;/span>
&lt;span style="color:#228b22"># data jsonæ•°æ® or å…¶ä»–&lt;/span>
&lt;span style="color:#228b22"># static é™æ€æ–‡ä»¶&lt;/span>
&lt;span style="color:#228b22"># themes ä¸»é¢˜&lt;/span>
&lt;span style="color:#228b22"># åé¢å¯ä»¥æ‰§è¡Œ hugo new posts/XXX.md åˆ›å»ºæ–°çš„æ–‡ç« &lt;/span>
hugo new posts/XXX.md
&lt;span style="color:#228b22"># å…·ä½“å‚è€ƒ https://gohugo.io/getting-started/ è¿›è¡Œæ“ä½œ&lt;/span>
......
&lt;span style="color:#228b22"># é€‰æ‹©ä¸€ä¸ªä¸»é¢˜ https://themes.gohugo.io/ å¯ä»¥é€‰æ‹©&lt;/span>
git submodule add https://github.com/budparr/gohugo-theme-ananke.git themes/ananke
&lt;span style="color:#228b22"># åé¢çš„å‚ç…§å„ä¸ªä¸»é¢˜è®¾ç½®å’¯&lt;/span>
....
&lt;span style="color:#228b22"># æœ¬åœ°æµ‹è¯•&lt;/span>
hugo serve
&lt;span style="color:#228b22"># ç”Ÿæˆæœ€å°çš„é™æ€æ–‡ä»¶, ä¼šç”Ÿæˆ public æ–‡ä»¶&lt;/span>
hugo --minify
&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="è¿ç§»-hexo-åšå®¢è¿›å…¥-hugo">è¿ç§» &lt;code>hexo&lt;/code> åšå®¢è¿›å…¥ &lt;code>hugo&lt;/code>&lt;/h1>
&lt;p>&amp;hellip;&amp;hellip;(å¯ä»¥æ‰‹åŠ¨ã€å¯ä»¥å·¥å…·è¿›è¡Œ)&lt;/p>
&lt;h1 id="æ•´åˆ-github-action">æ•´åˆ &lt;code>Github Action&lt;/code>&lt;/h1>
&lt;p>æ–°å»º &lt;code>Github Action&lt;/code> æè¿°æ–‡ä»¶ &lt;code>.github/workflows/deploy.yml&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#228b22"># This is a basic workflow to help you get started with Actions&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Deploy on Main Branch&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#228b22"># Controls when the action will run. &lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">on&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># Triggers the workflow on push or pull request events but only for the main branch&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">push&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">branches&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>[&lt;span style="color:#bbb"> &lt;/span>main ]&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">pull_request&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">branches&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>[&lt;span style="color:#bbb"> &lt;/span>main ]&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#228b22"># schedule:&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#228b22"># - cron: &amp;#39;0 21 * * *&amp;#39; # å®šæ—¶ä»»åŠ¡&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># Allows you to run this workflow manually from the Actions tab&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">workflow_dispatch&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#228b22"># A workflow run is made up of one or more jobs that can run sequentially or in parallel&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">jobs&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># This workflow contains a single job called &amp;#34;build&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">build&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># The type of runner that the job will run on&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">runs-on&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>ubuntu-latest&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># Steps represent a sequence of tasks that will be executed as part of the job&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">steps&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">uses&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>actions/checkout@v2&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Setup Hugo&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">uses&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>peaceiris/actions-hugo@v2&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># https://github.com/peaceiris/actions-hugo&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">with&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">hugo-version&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#39;latest&amp;#39;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">extended&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Build&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># æ³¨æ„å¼ºåˆ¶æ›´æ–° git submodule ä¸‹è½½ï¼Œå¦åˆ™ç”Ÿæˆçš„ä¸»é¢˜æ²¡æœ‰ html æ–‡ä»¶å“¦&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">run&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>|&lt;span style="color:#cd5555">
&lt;/span>&lt;span style="color:#cd5555"> git submodule update --init --recursive
&lt;/span>&lt;span style="color:#cd5555"> hugo --minify --debug&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Deploy&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">uses&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>peaceiris/actions-gh-pages@v3&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># https://github.com/peaceiris/actions-gh-pages&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">with&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">deploy_key&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>${{ secrets.ACTION_DEPLOY_KEY }}&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># è¿™é‡Œçš„ ACTION_DEPLOY_KEY åˆ™æ˜¯ä¸Šé¢è®¾ç½® Private Keyçš„å˜é‡å&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">external_repository&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>PinkHello/PinkHello.github.io&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># Pages è¿œç¨‹ä»“åº“ &lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">publish_dir&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>./public&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">keep_files&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># remove existing files&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">publish_branch&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>master &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># deploying branch&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">commit_message&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>${{ github.event.head_commit.message }}&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>so å®Œç¾
&lt;img src="https://pinkhello.me/hexo%E8%BF%81%E7%A7%BB%E8%87%B3hugo/github_action_in_process_0.jpg" alt="è¿ç§»Hexo">
&lt;img src="https://pinkhello.me/hexo%E8%BF%81%E7%A7%BB%E8%87%B3hugo/github_action_in_process.jpg" alt="è¿ç§»Hexo">&lt;/p>
- https://pinkhello.me/posts/16-hexo%E8%BF%81%E7%A7%BBhugo/ - PinkHello, All Rights Reserved</description></item><item><title>15 è®°ä¸€æ¬¡dockeræ—¥å¿—ç£ç›˜å‘Šè­¦é—®é¢˜</title><link>https://pinkhello.me/posts/15-%E8%AE%B0%E4%B8%80%E6%AC%A1docker%E6%97%A5%E5%BF%97%E7%A3%81%E7%9B%98%E5%91%8A%E8%AD%A6%E9%97%AE%E9%A2%98/</link><pubDate>Wed, 10 Feb 2021 10:05:29 +0800</pubDate><guid>https://pinkhello.me/posts/15-%E8%AE%B0%E4%B8%80%E6%AC%A1docker%E6%97%A5%E5%BF%97%E7%A3%81%E7%9B%98%E5%91%8A%E8%AD%A6%E9%97%AE%E9%A2%98/</guid><description>PinkHello https://pinkhello.me/posts/15-%E8%AE%B0%E4%B8%80%E6%AC%A1docker%E6%97%A5%E5%BF%97%E7%A3%81%E7%9B%98%E5%91%8A%E8%AD%A6%E9%97%AE%E9%A2%98/ -&lt;h1 id="å‰æ™¯">å‰æ™¯&lt;/h1>
&lt;p>ä»Šæ—¥ï¼Œæˆ‘æ­£åœ¨å¼€å¼€å¿ƒå¿ƒçš„åˆ·ç€JFXçš„Codingä¸­ï¼Œçªç„¶çº¿ä¸ŠæŠ¥è­¦ç¾¤ä¸­çˆ†äº†ä¸ªç‚¸å¼¹ï¼ŒEC2ç£ç›˜è¶…è¿‡80%ã€‚&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/%E8%B5%84%E6%BA%90%E4%B8%8D%E8%B6%B3%E6%8A%A5%E8%AD%A6.png" alt="èµ„æºä¸è¶³é¢„è­¦">&lt;/p>
&lt;h1 id="å¤„ç†è¿‡ç¨‹">å¤„ç†è¿‡ç¨‹&lt;/h1>
&lt;p>è§£å†³é—®é¢˜å§¿åŠ¿å°±ä½ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>èµ¶ç´§å¼€æœº ==ã€‹ â¤ï¸ä¸­ä¸‡åŒ¹ğŸ¦™å¥”è…¾è€Œè¿‡ â¤ï¸ä¸­MMP&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é»˜é»˜çš„é€šè¿‡è·³æ¿æœºè¿›å…¥ç›®æ ‡æœºå™¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸ç®¡ä¸‰ä¸ƒäºŒåä¸€,æ‰§è¡ŒæŸ¥çœ‹ç£ç›˜å ç”¨å¤§å°ï¼Œæˆ‘çš„ä¹–ä¹–ï¼Œå ç”¨ç¡®å®è¶…è¿‡äº†87%äº†ï¼Œä¸€ä¸‹å­æš´æ¶¨çš„&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&lt;span style="color:#228b22"># æŸ¥çœ‹ç£ç›˜å ç”¨å¤§å°&lt;/span>
&amp;gt; sudo df -h
&lt;span style="color:#228b22"># æŸ¥çœ‹å½“å‰ç›®å½•æ€»é‡&lt;/span>
&amp;gt; sudo du -sh
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å¼€å§‹å®šä½å…·ä½“å“ªä¸ªæ–‡ä»¶æˆ–è€…ç›®å½•å ç”¨è¿™ä¹ˆå¤§,è·‘åˆ°æ ¹ç›®å½•ä¸‹ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&lt;span style="color:#228b22"># æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹ä¸€çº§å­æ–‡ä»¶å’Œå­ç›®å½•å ç”¨çš„ç£ç›˜å®¹é‡&lt;/span>
&amp;gt; sudo du -lh --max-depth=&lt;span style="color:#b452cd">1&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>ä¸€å¼€å§‹çŒœæƒ³å¯èƒ½æ˜¯dockerå®¹å™¨çš„æ—¥å¿—å ç”¨å¤§ï¼Œä¸Šé¢æ‰§è¡Œåï¼Œè¿˜çœŸ TM æ˜¯&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">/var/lib/docker/containers ç›®å½•å ç”¨ 42G
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å¼€å§‹æŸ¥çœ‹æ˜¯å“ªä¸ªå®¹å™¨å ç”¨çš„è¿™ä¹ˆå¤§çš„ç©ºé—´&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&lt;span style="color:#228b22"># æŸ¥çœ‹ containers æ—¥å¿—ç›®å½•æ’åº&lt;/span>
&amp;gt; sudo du -d1 -h /var/lib/docker/containers | sort -h
&lt;span style="color:#228b22"># æŸ¥çœ‹å…·ä½“çš„å“ªä¸ªæ—¥å¿—æ–‡ä»¶å¤§&lt;/span>
&amp;gt; sudo find /var/lib/docker/containers -name *.log
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“ç„¶è¿™ä¸ªé…å›¾æ˜¯æˆ‘æ¸…ç†ä¹‹åçš„
&lt;img src="https://pinkhello.me/%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/docker%E5%AE%B9%E5%99%A8%E6%96%87%E4%BB%B6%E6%8E%92%E5%BA%8F.png" alt="dockerå®¹å™¨æ–‡ä»¶æ’åº">
&lt;img src="https://pinkhello.me/%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/%E6%9F%A5%E6%89%BEdocker%E5%AE%B9%E5%99%A8%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6.png" alt="æŸ¥æ‰¾dockerå®¹å™¨æ—¥å¿—æ–‡ä»¶">&lt;/p>
&lt;ul>
&lt;li>å®šä½åˆ°æœ€å¤§çš„æ–‡ä»¶ï¼Œä¸€é¡¿æ“ä½œ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell"> &lt;span style="color:#228b22"># æ¸…ç©ºæ¯”è¾ƒå¤§çš„æ—¥å¿—æ–‡ä»¶&lt;/span>
&amp;gt; sudo sh -c &lt;span style="color:#cd5555">&amp;#34;cat /dev/null &amp;gt; &lt;/span>&lt;span style="color:#cd5555">${&lt;/span>&lt;span style="color:#00688b">log_file&lt;/span>&lt;span style="color:#cd5555">}&lt;/span>&lt;span style="color:#cd5555">&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://pinkhello.me/%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/%E6%B8%85%E7%90%86docker%E5%AE%B9%E5%99%A8%E6%97%A5%E5%BF%97%E5%90%8E.png" alt="æ¸…ç†dockerå®¹å™¨æ—¥å¿—å">&lt;/p>
&lt;h1 id="æ€è€ƒ">æ€è€ƒ&lt;/h1>
&lt;ul>
&lt;li>ä¸Šé¢çš„æ–¹å¼æ˜¯ä¸€ç§æ–¹å¼è§£å†³ã€ä¸´æ—¶ã€‘
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell"> &lt;span style="color:#228b22"># æŸ¥çœ‹ docker çš„ Logging Driver&lt;/span>
&amp;gt; docker info | grep &lt;span style="color:#cd5555">&amp;#39;Logging Driver&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚ä½•å½»åº•è§£å†³è¿™ä¸ªé—®é¢˜ï¼š&lt;/p>
&lt;ul>
&lt;li>å†™ä¸ª&lt;code>shellè„šæœ¬&lt;/code> ä½¿ç”¨ &lt;code>crontab&lt;/code> å®šæœŸæ‰§è¡Œæ¸…ç†
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell"> &lt;span style="color:#228b22">#!/bin/sh&lt;/span>
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#cd5555">&amp;#34;======== start clean docker containers logs ========&amp;#34;&lt;/span>
&lt;span style="color:#00688b">logs&lt;/span>=&lt;span style="color:#8b008b;font-weight:bold">$(&lt;/span>find /var/lib/docker/containers/ -name *-json.log&lt;span style="color:#8b008b;font-weight:bold">)&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> log in &lt;span style="color:#00688b">$logs&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">do&lt;/span>
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#cd5555">&amp;#34;clean logs : &lt;/span>&lt;span style="color:#00688b">$log&lt;/span>&lt;span style="color:#cd5555">&amp;#34;&lt;/span>
cat /dev/null &amp;gt; &lt;span style="color:#00688b">$log&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">done&lt;/span>
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#cd5555">&amp;#34;======== end clean docker containers logs ========&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>å‡å¦‚æ˜¯&lt;code>docker run&lt;/code>åˆ›å»ºå®¹å™¨çš„,æŒ‡å®š &lt;code>--log-opt max-size=${MAX_SIZE}m --log-opt max-file=${NUMBER}&lt;/code>&lt;/li>
&lt;li>&lt;code>docker-compose&lt;/code> æ–¹å¼æ›´é«˜&lt;code>docker-compose.yaml&lt;/code>æ–‡ä»¶
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">logging&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">driver&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;json-file&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">options&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">max-size&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;${MAX_SIZE}m&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">max-file&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>${NUMBER}&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>&lt;code>docker&lt;/code> å…¨å±€ä¿®æ”¹ &lt;code>/etc/docker/daemon.json&lt;/code>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json"> {
&lt;span style="color:#8b008b;font-weight:bold">&amp;#34;log-driver&amp;#34;&lt;/span>: &lt;span style="color:#cd5555">&amp;#34;json-file&amp;#34;&lt;/span>,
&lt;span style="color:#8b008b;font-weight:bold">&amp;#34;log-opts&amp;#34;&lt;/span>: {
&lt;span style="color:#8b008b;font-weight:bold">&amp;#34;max-size&amp;#34;&lt;/span>: &lt;span style="color:#cd5555">&amp;#34;${MAX_SIZE}m&amp;#34;&lt;/span>
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell"> &amp;gt; systemctl daemon-reload
&amp;gt; systemctl restart docker
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ä¸ºä»€ä¹ˆä¼šç¬é—´ğŸ’¥å¼çš„å¢é•¿ ???&lt;/li>
&lt;/ul>
- https://pinkhello.me/posts/15-%E8%AE%B0%E4%B8%80%E6%AC%A1docker%E6%97%A5%E5%BF%97%E7%A3%81%E7%9B%98%E5%91%8A%E8%AD%A6%E9%97%AE%E9%A2%98/ - PinkHello, All Rights Reserved</description></item><item><title>05 OAuth2.0 é‚£ç‚¹äº‹</title><link>https://pinkhello.me/posts/05-oauth2.0%E9%82%A3%E7%82%B9%E4%BA%8B/</link><pubDate>Wed, 10 Feb 2021 08:32:02 +0800</pubDate><guid>https://pinkhello.me/posts/05-oauth2.0%E9%82%A3%E7%82%B9%E4%BA%8B/</guid><description>PinkHello https://pinkhello.me/posts/05-oauth2.0%E9%82%A3%E7%82%B9%E4%BA%8B/ -&lt;h2 id="oauth20-æ˜¯ä»€ä¹ˆ">&lt;code>OAuth2.0&lt;/code> æ˜¯ä»€ä¹ˆ?&lt;/h2>
&lt;p>&lt;code>OAuth2.0&lt;/code> Framework RFC 6749 [https://tools.ietf.org/html/rfc6749]&lt;/p>
&lt;p>&lt;code>OAuth&lt;/code> å°±æ˜¯ä¸€ç§æˆæƒæœºåˆ¶ï¼Œå®ƒä»‹äºå®¢æˆ·ç«¯ä¸èµ„æºæ‰€æœ‰è€…çš„æˆæƒå±‚ï¼Œä¸ºäº†åˆ†ç¦»ä¸åŒçš„è§’è‰²ã€‚
åœ¨èµ„æºæ‰€æœ‰è€…åŒæ„å¹¶å‘å®¢æˆ·ç«¯é¢å‘ä»¤ç‰Œåï¼Œå®¢æˆ·ç«¯æºå¸¦ä»¤ç‰Œå¯ä»¥è®¿é—®éƒ¨åˆ†æˆ–å…¨éƒ¨èµ„æºã€‚&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->OAuth2.0&lt;!-- raw HTML omitted --> æ˜¯&lt;!-- raw HTML omitted -->OAuth&lt;!-- raw HTML omitted --> åè®®çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œä¸º&lt;!-- raw HTML omitted -->2.0&lt;!-- raw HTML omitted -->ç‰ˆæœ¬ã€‚æœ‰æ„æ€çš„æ˜¯ &lt;!-- raw HTML omitted -->2.0&lt;!-- raw HTML omitted --> ä¸ &lt;!-- raw HTML omitted -->1.0&lt;!-- raw HTML omitted --> å¹¶ä¸å…¼å®¹ã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h2 id="oauth20-æˆæƒæ–¹å¼">&lt;code>OAuth2.0&lt;/code> æˆæƒæ–¹å¼&lt;/h2>
&lt;p>è·å–æˆæƒçš„è¿‡ç¨‹&lt;/p>
&lt;ul>
&lt;li>æˆæƒç (&lt;!-- raw HTML omitted -->authorization-code&lt;!-- raw HTML omitted -->)&lt;/li>
&lt;li>éšè—å¼(&lt;!-- raw HTML omitted -->implicit&lt;!-- raw HTML omitted -->)&lt;/li>
&lt;li>å¯†ç (&lt;!-- raw HTML omitted -->password&lt;!-- raw HTML omitted -->)&lt;/li>
&lt;li>å®¢æˆ·ç«¯å‡­è¯(&lt;!-- raw HTML omitted -->client credentials&lt;!-- raw HTML omitted -->)&lt;/li>
&lt;/ul>
&lt;p>ä¸ç®¡å“ªç§æ–¹å¼ï¼Œéƒ½éœ€è¦åœ¨ç¬¬ä¸‰æ–¹åº”ç”¨ç”³è¯·ä»¤ç‰Œä¹‹å‰ï¼Œéœ€è¦åœ¨ç³»ç»Ÿä¸­ç”³è¯·èº«ä»½å”¯ä¸€æ ‡è¯†: å®¢æˆ·ç«¯ID &lt;!-- raw HTML omitted -->Client ID&lt;!-- raw HTML omitted --> å’Œ å®¢æˆ·ç«¯ç§˜é’¥ &lt;!-- raw HTML omitted -->Client Secret&lt;!-- raw HTML omitted -->.
è¿™æ ·èƒ½ç¡®ä¿Tokenä¸è¢«æ¶æ„ä½¿ç”¨ã€‚&lt;/p>
&lt;p>æˆæƒé‡è¦çš„å‚æ•°å’ŒæŒ‡æ ‡:&lt;/p>
&lt;ul>
&lt;li>&lt;!-- raw HTML omitted -->response_type&lt;!-- raw HTML omitted --> å“åº”ç±»å‹: &lt;!-- raw HTML omitted -->code&lt;!-- raw HTML omitted -->(è¦æ±‚è¿”å›æˆæƒç ),&lt;!-- raw HTML omitted -->token&lt;!-- raw HTML omitted -->(è¦æ±‚è¿”å›æˆæƒToken)&lt;/li>
&lt;li>&lt;!-- raw HTML omitted -->client_id&lt;!-- raw HTML omitted --> å®¢æˆ·ç«¯èº«ä»½æ ‡è¯†&lt;/li>
&lt;li>&lt;!-- raw HTML omitted -->client_secret&lt;!-- raw HTML omitted --> å®¢æˆ·ç«¯ç§˜é’¥&lt;/li>
&lt;li>&lt;!-- raw HTML omitted -->redirect_uri&lt;!-- raw HTML omitted --> é‡å®šå‘åœ°å€&lt;/li>
&lt;li>&lt;!-- raw HTML omitted -->scope&lt;!-- raw HTML omitted --> æˆæƒèŒƒå›´, &lt;!-- raw HTML omitted -->read&lt;!-- raw HTML omitted --> åªè¯»æƒé™, &lt;!-- raw HTML omitted -->all&lt;!-- raw HTML omitted --> å…¨éƒ¨æƒé™&lt;/li>
&lt;li>&lt;!-- raw HTML omitted -->grant_type&lt;!-- raw HTML omitted --> æˆæƒæ–¹å¼ &lt;!-- raw HTML omitted -->authorization_code&lt;!-- raw HTML omitted -->(æˆæƒç )ã€&lt;!-- raw HTML omitted -->password&lt;!-- raw HTML omitted -->(å¯†ç )ã€&lt;!-- raw HTML omitted -->client_credentials&lt;!-- raw HTML omitted -->
(å‡­è¯)ã€&lt;!-- raw HTML omitted -->refresh_token&lt;!-- raw HTML omitted -->(æ›´æ–°ä»¤ç‰Œ)&lt;/li>
&lt;li>&lt;!-- raw HTML omitted -->state&lt;!-- raw HTML omitted --> åº”ç”¨ç¨‹åºä¼ é€’çš„ä¸€ä¸ªéšæœºæ•°ï¼Œé˜²æ­¢ &lt;!-- raw HTML omitted -->CSRF&lt;!-- raw HTML omitted --> æ”»å‡»&lt;/li>
&lt;/ul>
&lt;h3 id="æˆæƒç httpswwwoauthcomoauth2-serversaccess-tokensauthorization-code-request-authorization-code-request">&lt;a href="https://www.oauth.com/oauth2-servers/access-tokens/authorization-code-request/" title="authorization-code-request">æˆæƒç &lt;/a>&lt;/h3>
&lt;p>åœ¨è®¿é—®ç¬¬ä¸‰æ–¹åº”ç”¨å…ˆç”³è¯·ä¸€ä¸ªæˆæƒç ï¼Œç„¶åå†ç”¨æˆæƒç è·å–ä»¤ç‰Œ.è¿™ç§æ–¹å¼ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æµç¨‹ï¼Œå®‰å…¨æ€§ä¹Ÿæ˜¯æœ€é«˜çš„ï¼Œé€‚ç”¨äºæœ‰åç«¯çš„&lt;!-- raw HTML omitted -->Web&lt;!-- raw HTML omitted -->åº”ç”¨ã€‚æˆæƒç é€šè¿‡å‰ç«¯ä¼ é€ï¼Œä»¤ç‰Œå­˜å‚¨åœ¨åç«¯ã€‚æ‰€æœ‰çš„å’Œèµ„æºæœåŠ¡å™¨çš„äº¤äº’éƒ½åœ¨æœåŠ¡ç«¯å®Œæˆï¼Œé¿å…äº†ä»¤ç‰Œçš„æ³„éœ²ã€‚
æˆæƒç å’Œä»¤ç‰Œçš„åœ¨ æµè§ˆå™¨å’Œå®¢æˆ·ç«¯&lt;!-- raw HTML omitted -->WEB&lt;!-- raw HTML omitted -->åº”ç”¨ä»¥åŠèµ„æºæœåŠ¡å™¨çš„äº¤äº’æµç¨‹å¤§è‡´å¦‚ä¸‹:
&lt;img src="https://pinkhello.me/OAuth2-0%E9%82%A3%E7%82%B9%E4%BA%8B/auth_code.png" alt="authorization-code">&lt;/p>
&lt;ul>
&lt;li>1.2.3.4 ç”¨æˆ·é€‰æ‹© &lt;!-- raw HTML omitted -->Google&lt;!-- raw HTML omitted --> ç™»é™† &lt;!-- raw HTML omitted -->yelp.com&lt;!-- raw HTML omitted -->&lt;/li>
&lt;li>3.4 &lt;!-- raw HTML omitted -->Yelp.com&lt;!-- raw HTML omitted --> è¯·æ±‚ç”¨æˆ·æˆæƒ &lt;!-- raw HTML omitted -->Google&lt;!-- raw HTML omitted --> æƒé™&lt;/li>
&lt;li>5.6 ç”¨æˆ·åŒæ„åè¿”å›æˆæƒç 
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;/li>
&lt;li>7.8 &lt;!-- raw HTML omitted -->Yelp.com&lt;!-- raw HTML omitted --> é€šè¿‡æˆæƒç  ä¼šå‘ &lt;!-- raw HTML omitted -->Google&lt;!-- raw HTML omitted -->å‘èµ·è¯·æ±‚&lt;!-- raw HTML omitted -->Token&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;/li>
&lt;li>9 éªŒè¯å¿…è¦å‚æ•°ï¼Œè¿”å› &lt;!-- raw HTML omitted -->Token&lt;!-- raw HTML omitted -->&lt;/li>
&lt;li>10.11 æ“ä½œè¯·æ±‚&lt;/li>
&lt;/ul>
&lt;h3 id="éšè—å¼httpsauth0comblogoauth2-implicit-grant-and-spa-oauth2-implicit-grant-and-spa">&lt;a href="https://auth0.com/blog/oauth2-implicit-grant-and-spa/" title="oauth2-implicit-grant-and-spa">éšè—å¼&lt;/a>&lt;/h3>
&lt;p>&lt;img src="https://pinkhello.me/OAuth2-0%E9%82%A3%E7%82%B9%E4%BA%8B/implicit.png" alt="implicit">&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h3 id="å¯†ç å¼httpswwwoauthcomoauth2-serversaccess-tokenspassword-grant-password-grant">&lt;a href="https://www.oauth.com/oauth2-servers/access-tokens/password-grant/" title="password-grant">å¯†ç å¼&lt;/a>&lt;/h3>
&lt;p>é¡¾åæ€è®®,åœ¨è‡ªå·±çš„ç³»ç»Ÿè¾“å…¥ç¬¬ä¸‰æ–¹ç³»ç»Ÿçš„è´¦å·å¯†ç ,è‡ªå·±çš„ç³»ç»Ÿæ‹¿è´¦å·å¯†ç å»ç”³è¯·ä»¤ç‰Œï¼Œå“åº”é¢˜é‡Œé¢è¿”å›token&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h3 id="å‡­è¯å¼httpswwwoauthcomoauth2-serversaccess-tokensclient-credentials-client-credentials">&lt;a href="https://www.oauth.com/oauth2-servers/access-tokens/client-credentials/" title="client-credentials">å‡­è¯å¼&lt;/a>&lt;/h3>
&lt;p>å‡­è¯å¼å’Œå¯†ç å¾ˆç›¸ä¼¼ï¼Œä¸»è¦ç»™æ²¡æœ‰å‰ç«¯è¾“å…¥çš„é¡¹ç›®æˆ–è€…å‘½ä»¤è¡Œ&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h2 id="ä»¤ç‰Œçš„ä½¿ç”¨å’Œæ›´æ–°">ä»¤ç‰Œçš„ä½¿ç”¨å’Œæ›´æ–°&lt;/h2>
&lt;h3 id="ä»¤ç‰Œçš„ä½¿ç”¨">&lt;a href="">ä»¤ç‰Œçš„ä½¿ç”¨&lt;/a>&lt;/h3>
&lt;p>ä»¤ç‰Œçš„æ‹¿åˆ°äº†ï¼Œå°±å¯ä»¥è°ƒç”¨Googleçš„APIè¿›è¡Œè¯·æ±‚æ•°æ®äº†ï¼Œ
ä¸€èˆ¬è®² Token æ”¾å…¥è¯·æ±‚å¤´ Authorization.&lt;/p>
&lt;h3 id="ä»¤ç‰Œçš„æ›´æ–°httpswwwoauthcomoauth2-serversaccess-tokensrefreshing-access-tokens-refreshing-access-tokens">&lt;a href="https://www.oauth.com/oauth2-servers/access-tokens/refreshing-access-tokens/" title="refreshing-access-tokens">ä»¤ç‰Œçš„æ›´æ–°&lt;/a>&lt;/h3>
&lt;p>&lt;!-- raw HTML omitted -->Token&lt;!-- raw HTML omitted --> æ˜¯æœ‰æ—¶æ•ˆæ€§çš„ï¼Œä¸€æ—¦è¿‡æœŸå°±éœ€è¦é‡æ–°è·å–ï¼Œä½†æ˜¯é‡èµ°ä¸€éæˆæƒæµç¨‹ï¼Œä¸ä»…éº»çƒ¦è€Œä¸”ç”¨æˆ·ä½“éªŒä¹Ÿä¸å¥½ï¼Œé‚£å¦‚ä½•è®©ç”¨æˆ·ä½¿ç”¨çš„ä¼˜é›…å‘¢ï¼Ÿ&lt;/p>
&lt;p>ä¸€èˆ¬åœ¨é¢å‘ä»¤ç‰Œçš„æ—¶å€™ï¼Œé¢å‘ä¸¤ä¸ª&lt;!-- raw HTML omitted -->Token&lt;!-- raw HTML omitted -->, ä¸€ä¸ªæˆæƒ&lt;!-- raw HTML omitted -->Token&lt;!-- raw HTML omitted -->,ä¸€ä¸ª&lt;!-- raw HTML omitted -->Refresh Token&lt;!-- raw HTML omitted -->,
åœ¨æ›´æ–°&lt;!-- raw HTML omitted -->refresh_token&lt;!-- raw HTML omitted -->æ—¶å€™,å°†&lt;!-- raw HTML omitted -->grant_type&lt;!-- raw HTML omitted -->æŒ‡å®šä¸º&lt;!-- raw HTML omitted -->refresh_token&lt;!-- raw HTML omitted -->,
å‚æ•°&lt;!-- raw HTML omitted -->refresh_token&lt;!-- raw HTML omitted -->æ˜¯ç”¨äºæ›´æ–°&lt;!-- raw HTML omitted -->Token&lt;!-- raw HTML omitted -->çš„&lt;!-- raw HTML omitted -->refresh_token&lt;!-- raw HTML omitted -->&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h1 id="æ€»ç»“">æ€»ç»“&lt;/h1>
&lt;h1 id="å®‰åˆ©">å®‰åˆ©&lt;/h1>
&lt;ul>
&lt;li>Client
&lt;ul>
&lt;li>Go &lt;a href="https://godoc.org/golang.org/x/oauth2">https://godoc.org/golang.org/x/oauth2&lt;/a>&lt;/li>
&lt;li>Java
&lt;ul>
&lt;li>&lt;a href="https://spring.io/projects/spring-social/">https://spring.io/projects/spring-social/&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://spring.io/projects/spring-security/">https://spring.io/projects/spring-security/&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Server
&lt;ul>
&lt;li>Go
&lt;ul>
&lt;li>&lt;a href="https://github.com/go-oauth2/oauth2">https://github.com/go-oauth2/oauth2&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/zalando/gin-oauth2">https://github.com/zalando/gin-oauth2&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Java &lt;a href="https://github.com/zalando/tokens">https://github.com/zalando/tokens&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>å‚è€ƒ&lt;/p>
&lt;ul>
&lt;li>jsonwebtoken.io &lt;a href="https://www.jsonwebtoken.io/">https://www.jsonwebtoken.io/&lt;/a>&lt;/li>
&lt;li>oauth.net &lt;a href="https://oauth.net/2/">https://oauth.net/2/&lt;/a>&lt;/li>
&lt;li>aliyun.com
&lt;ul>
&lt;li>&lt;a href="https://help.aliyun.com/document_detail/32144.html?spm=5176.87240.400427.53.32fa4614S88B0N">https://help.aliyun.com/document_detail/32144.html?spm=5176.87240.400427.53.32fa4614S88B0N&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://help.aliyun.com/document_detail/32008.html?spm=a2c4g.11186623.6.780.40435837SXpbPT">https://help.aliyun.com/document_detail/32008.html?spm=a2c4g.11186623.6.780.40435837SXpbPT&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://help.aliyun.com/document_detail/32026.html?spm=a2c4g.11186623.6.856.20b1c06dgVW6Ri">https://help.aliyun.com/document_detail/32026.html?spm=a2c4g.11186623.6.856.20b1c06dgVW6Ri&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
- https://pinkhello.me/posts/05-oauth2.0%E9%82%A3%E7%82%B9%E4%BA%8B/ - PinkHello, All Rights Reserved</description></item><item><title>04 å¦‚ä½•æ„å»ºä¸€ä¸ªç®€å•çš„RPCè°ƒç”¨</title><link>https://pinkhello.me/posts/04-%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84rpc%E8%B0%83%E7%94%A8/</link><pubDate>Wed, 10 Feb 2021 08:24:19 +0800</pubDate><guid>https://pinkhello.me/posts/04-%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84rpc%E8%B0%83%E7%94%A8/</guid><description>PinkHello https://pinkhello.me/posts/04-%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84rpc%E8%B0%83%E7%94%A8/ -&lt;p>1ã€ä»€ä¹ˆå«RPC?&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>&lt;img src="https://pinkhello.me/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/RPC%E8%B0%83%E7%94%A8%E6%9C%8D%E5%8A%A1%E8%BF%87%E7%A8%8B.jpg" alt="RPCè°ƒç”¨æœåŠ¡è¿‡ç¨‹">&lt;/p>
&lt;p>RPCæ„æˆ&lt;/p>
&lt;ul>
&lt;li>RPC Consumer&lt;/li>
&lt;li>RPC Provider&lt;/li>
&lt;li>ConfigServer&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>1ã€&lt;code>Provider&lt;/code> å¯åŠ¨ &lt;code>ConfigServer&lt;/code> æ³¨å†ŒæœåŠ¡&lt;/li>
&lt;li>2ã€&lt;code>Consumer&lt;/code> å¯åŠ¨ &lt;code>ConfigServer&lt;/code> è®¢é˜…æœåŠ¡ï¼Œ&lt;/li>
&lt;li>3ã€å‘èµ·è°ƒç”¨ &lt;code>Consumer&lt;/code> &amp;mdash;&amp;gt; &lt;code>Provider&lt;/code>&lt;/li>
&lt;li>4ã€å“åº”è°ƒç”¨ &lt;code>Consumer&lt;/code> &amp;lt;&amp;mdash; &lt;code>Provider&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>2ã€ä»€ä¹ˆæ˜¯ &lt;code>Netty&lt;/code> ? &lt;a href="https://netty.io/">https://netty.io/&lt;/a>&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>&lt;img src="https://pinkhello.me/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/netty%E6%A1%86%E6%9E%B6%E5%9B%BE.png" alt="nettyæ¡†æ¶å›¾">&lt;/p>
&lt;p>3ã€ç°æœ‰çš„å¼€æºçš„é¡¹ç›®æ˜¯å¦ä½¿ç”¨äº† &lt;code>Netty&lt;/code> ?&lt;/p>
&lt;ul>
&lt;li>Dubbo&lt;/li>
&lt;li>Grpc&lt;/li>
&lt;li>Spark&lt;/li>
&lt;li>&amp;hellip;.&lt;/li>
&lt;/ul>
&lt;p>4ã€&lt;code>RPC Provider&lt;/code> å¯åŠ¨&lt;/p>
&lt;ul>
&lt;li>&lt;code>Netty Server&lt;/code> æ–¹å¼å¯åŠ¨&lt;/li>
&lt;li>&lt;code>Rpc&lt;/code> æœåŠ¡çš„æ³¨å†Œ
&lt;img src="https://pinkhello.me/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/RPC%E4%B8%8ENetty%E7%BB%93%E5%90%88Provider%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B.png" alt="RPCä¸Nettyç»“åˆProviderè°ƒç”¨è¿‡ç¨‹">&lt;/li>
&lt;/ul>
&lt;p>5ã€&lt;code>RPC Consumer&lt;/code> å¯åŠ¨&lt;/p>
&lt;ul>
&lt;li>&lt;code>Netty Client&lt;/code> æ–¹å¼å¯åŠ¨&lt;/li>
&lt;li>&lt;code>RPC&lt;/code> æ³›åŒ–è°ƒç”¨ã€é€šè¿‡å­—èŠ‚ç åŸºäºåå°„æ¥å®ç°è¿œç¨‹è°ƒåº¦&lt;/li>
&lt;li>&lt;code>Consumer&lt;/code> æœåŠ¡è®¢é˜…&lt;/li>
&lt;li>å¯åŠ¨æ—¶å»ºç«‹é•¿è¿æ¥
&lt;img src="https://pinkhello.me/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/RPC%E4%B8%8ENetty%E7%BB%93%E5%90%88Consumer%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B.png" alt="RPCä¸Nettyç»“åˆConsumerè°ƒç”¨è¿‡ç¨‹">&lt;/li>
&lt;/ul>
&lt;p>6ã€ä»ç¬¬å››å¯ä»¥çœ‹å‡ºï¼Œå¤šä¸ª &lt;code>Provider&lt;/code> æ˜¯ç”±ä¸€ä¸ª &lt;code>NettyServer&lt;/code> æä¾›çš„ï¼Œé€šè¿‡ &lt;code>HandlerMap&lt;/code> æ˜ å°„æ‰¾åˆ°å¯¹åº”çš„ &lt;code>Ioc Bean&lt;/code>ï¼Œå®ŒæˆæœåŠ¡è°ƒç”¨&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">æœåŠ¡ç«¯
EventLoopGroup bossGroup = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> NioEventLoopGroup(1);
EventLoopGroup workerGroup = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> NioEventLoopGroup();
&lt;span style="color:#8b008b;font-weight:bold">try&lt;/span> {
ServerBootstrap b = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> ServerBootstrap();
b.&lt;span style="color:#658b00">group&lt;/span>(bossGroup, workerGroup)
.&lt;span style="color:#658b00">channel&lt;/span>(NioServerSocketChannel.&lt;span style="color:#658b00">class&lt;/span>)
.&lt;span style="color:#658b00">option&lt;/span>(ChannelOption.&lt;span style="color:#658b00">SO_BACKLOG&lt;/span>, 100)
.&lt;span style="color:#658b00">handler&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> LoggingHandler(LogLevel.&lt;span style="color:#658b00">INFO&lt;/span>))
.&lt;span style="color:#658b00">childHandler&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> ChannelInitializer&amp;lt;SocketChannel&amp;gt;() {
&lt;span style="color:#707a7c">@Override&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">initChannel&lt;/span>(SocketChannel ch) &lt;span style="color:#8b008b;font-weight:bold">throws&lt;/span> Exception {
ChannelPipeline p = ch.&lt;span style="color:#658b00">pipeline&lt;/span>();
p.&lt;span style="color:#658b00">addLast&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> RpcEncoder(RpcRequest.&lt;span style="color:#658b00">class&lt;/span>));
p.&lt;span style="color:#658b00">addLast&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> RpcDecoder(RpcResponse.&lt;span style="color:#658b00">class&lt;/span>));
p.&lt;span style="color:#658b00">addLast&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> RpcHandler());
}});
&lt;span style="color:#228b22">// Start the server.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> ChannelFuture f = b.&lt;span style="color:#658b00">bind&lt;/span>(PORT).&lt;span style="color:#658b00">sync&lt;/span>();
&lt;span style="color:#228b22">// Wait until the server socket is closed.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> f.&lt;span style="color:#658b00">channel&lt;/span>().&lt;span style="color:#658b00">closeFuture&lt;/span>().&lt;span style="color:#658b00">sync&lt;/span>();
} &lt;span style="color:#8b008b;font-weight:bold">finally&lt;/span> {
&lt;span style="color:#228b22">// Shut down all event loops to terminate all threads.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> bossGroup.&lt;span style="color:#658b00">shutdownGracefully&lt;/span>();
workerGroup.&lt;span style="color:#658b00">shutdownGracefully&lt;/span>();
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://pinkhello.me/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/Netty%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E5%AE%A2%E6%88%B7%E7%AB%AFTCP%E9%93%BE%E6%8E%A5%E4%B8%8A%E7%9A%84%E8%AF%B7%E6%B1%82.jpg" alt="Nettyå¦‚ä½•å¤„ç†å®¢æˆ·ç«¯TCPé“¾æ¥ä¸Šçš„è¯·æ±‚">&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/NettyReactor%E5%B7%A5%E4%BD%9C%E6%A1%86%E6%9E%B6%E5%9B%BE.jpg" alt="NettyReactorå·¥ä½œæ¡†æ¶å›¾">&lt;/p>
&lt;ul>
&lt;li>&lt;code>BossGroup&lt;/code> -&amp;gt; å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚&lt;/li>
&lt;li>&lt;code>EventGroup&lt;/code> â€”&amp;gt; å¤„ç†IO &lt;code>Read/Write&lt;/code> æ“ä½œã€æ‰§è¡Œä»»åŠ¡ç³»ç»ŸTaskã€å®šæ—¶ä»»åŠ¡&lt;/li>
&lt;li>&lt;code>ChildChannelHandler&lt;/code> æ–¹å¼æ˜¯å¯¹ &lt;code>ChannelPipeline&lt;/code> çš„è®¾ç½®ã€&lt;/li>
&lt;li>&lt;code>ChannelPipeline&lt;/code> æ˜¯ç›¸å½“äºä»»åŠ¡é“¾çš„æ¨¡å¼, æ˜¯ä¸€ä¸² &lt;code>ChannelHandler&lt;/code> çš„å®ä¾‹&lt;/li>
&lt;li>&lt;code>ChannelHandlerContext&lt;/code> æ˜¯ &lt;code>ChannelPipeline&lt;/code> å’Œ &lt;code>ChannelHandler&lt;/code> çš„å…³ç³»&lt;/li>
&lt;li>æ¯ä¸ªé“¾æ¥å¯¹äº &lt;code>Sever&lt;/code> ç«¯éƒ½ä¼šåˆ›å»ºä¸€ä¸ª &lt;code>Channel&lt;/code> ï¼Œå¯ä»¥å°† &lt;code>Channel&lt;/code> ç†è§£ä¸º &lt;code>Connection&lt;/code> ï¼ˆå…¶å®çœŸæ­£çš„æ˜¯ &lt;code>Connection&lt;/code> å±äº &lt;code>Channel&lt;/code> çš„ä¸€éƒ¨åˆ†ï¼‰&lt;/li>
&lt;li>æ¯ä¸ª &lt;code>Channel&lt;/code> éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„å”¯ä¸€çš„ &lt;code>ChannelPipeline&lt;/code> æ“ä½œï¼Œå¯¹äºå…¶ä»–çš„ &lt;code>Channel&lt;/code> çš„ &lt;code>ChannelPipeline&lt;/code> æ˜¯éš”ç¦»çš„&lt;/li>
&lt;li>&lt;code>RPC Handler&lt;/code> æ˜¯æˆ‘ä»¬å¯¹äºè‡ªå·±çš„æ‰¾å¯» &lt;code>RPC&lt;/code> æœåŠ¡å¤„ç†çš„ &lt;code>Handler&lt;/code> å®ç°&lt;/li>
&lt;li>&lt;code>RPC Encoder&lt;/code> æ˜¯æˆ‘ä»¬å¯¹äºè‡ªå·±çš„æ‰¾å¯» &lt;code>RPC&lt;/code> åºåˆ—åŒ–çš„ç¼–ç çš„ &lt;code>Handler&lt;/code> å®ç°&lt;/li>
&lt;li>&lt;code>RPC Decoder&lt;/code> æ˜¯æˆ‘ä»¬å¯¹äºè‡ªå·±çš„æ‰¾å¯» &lt;code>RPC&lt;/code> åºåˆ—åŒ–çš„è§£ç çš„ &lt;code>Handler&lt;/code> å®ç°&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">å®¢æˆ·ç«¯
EventLoopGroup group = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> NioEventLoopGroup();
&lt;span style="color:#8b008b;font-weight:bold">try&lt;/span> {
Bootstrap b = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> Bootstrap();
b.&lt;span style="color:#658b00">group&lt;/span>(group)
.&lt;span style="color:#658b00">channel&lt;/span>(NioSocketChannel.&lt;span style="color:#658b00">class&lt;/span>)
.&lt;span style="color:#658b00">option&lt;/span>(ChannelOption.&lt;span style="color:#658b00">TCP_NODELAY&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>)
.&lt;span style="color:#658b00">handler&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> ChannelInitializer&amp;lt;SocketChannel&amp;gt;() {
&lt;span style="color:#707a7c">@Override&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">initChannel&lt;/span>(SocketChannel ch) &lt;span style="color:#8b008b;font-weight:bold">throws&lt;/span> Exception {
ChannelPipeline p = ch.&lt;span style="color:#658b00">pipeline&lt;/span>();
p.&lt;span style="color:#658b00">addLast&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> RpcEncoder(RpcResponse.&lt;span style="color:#658b00">class&lt;/span>));
p.&lt;span style="color:#658b00">addLast&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> RpcDecoder(RpcRequest.&lt;span style="color:#658b00">class&lt;/span>));
p.&lt;span style="color:#658b00">addLast&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> RpcClientHandler());
}});
&lt;span style="color:#228b22">// Start the client.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> ChannelFuture f = b.&lt;span style="color:#658b00">connect&lt;/span>(HOST, PORT).&lt;span style="color:#658b00">sync&lt;/span>();
&lt;span style="color:#228b22">// Wait until the connection is closed.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> f.&lt;span style="color:#658b00">channel&lt;/span>().&lt;span style="color:#658b00">closeFuture&lt;/span>().&lt;span style="color:#658b00">sync&lt;/span>();
} &lt;span style="color:#8b008b;font-weight:bold">finally&lt;/span> {
&lt;span style="color:#228b22">// Shut down the event loop to terminate all threads.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> group.&lt;span style="color:#658b00">shutdownGracefully&lt;/span>();
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>7ã€&lt;code>RPC&lt;/code> åºåˆ—åŒ–&lt;/p>
&lt;ul>
&lt;li>äºŒè¿›åˆ¶æ•°æ®&lt;/li>
&lt;li>Hessian&lt;/li>
&lt;li>Avro&lt;/li>
&lt;li>ProtoBuffer (Protobuf)&lt;/li>
&lt;li>JSON&lt;/li>
&lt;li>XML&lt;/li>
&lt;/ul>
&lt;p>8ã€å…³äº &lt;code>RPC&lt;/code> çš„å®ç°æ€è€ƒä¸æŠ€æœ¯è®¨è®º&lt;/p>
&lt;ul>
&lt;li>ä¸šåŠ¡æ–¹æ³•ã€å› ä¸ºæ˜¯æ”¶åˆ°è¯·æ±‚æ¶ˆæ¯è€Œè§¦å‘çš„åç»­åŠ¨ä½œè°ƒç”¨ï¼Œä¸åšé¢å¤–è®¾ç½®ï¼Œè‚¯å®šæ˜¯ä½¿ç”¨çš„ &lt;code>WorkGroup&lt;/code> é‡Œé¢çš„çº¿ç¨‹æ“ä½œçš„ã€‚
è€Œä½œä¸ºä¸šåŠ¡å±‚ï¼Œä¸åº”è¯¥ä¸åº•å±‚å…³è”ï¼Œåº”è¯¥åˆ‡å‰²å¼€æ¥ï¼ŒåŠ¿å¿…ä¼šå¼•å…¥çœŸçš„ä¸šåŠ¡ä¾§çº¿ç¨‹æ± ã€‚
é‚£ä¹ˆå¦‚ä½•å¼•ç”¨ã€æ€ä¹ˆå¼•ç”¨ï¼Ÿ(å…³äº ä¸šåŠ¡çº¿ç¨‹æ±  ä¸ &lt;code>WorkGroup&lt;/code> çš„ &lt;code>EvenLoop&lt;/code> çš„æ€è€ƒ )&lt;/li>
&lt;li>å…³äº &lt;code>RPC&lt;/code> è°ƒç”¨å¤§éƒ¨åˆ†æ˜¯åŒæ­¥çš„è°ƒç”¨ï¼Œè€Œ &lt;code>Netty&lt;/code> åº•å±‚æ˜¯å®Œå…¨å¼‚æ­¥äº‹ä»¶æœºåˆ¶ï¼Œåœ¨RPCæ¡†æ¶å±‚é¢å¦‚ä½•å®ç°åŒæ­¥çš„è°ƒç”¨æ–¹å¼çš„ï¼Ÿ&lt;/li>
&lt;li>åŸºäº &lt;code>TCP&lt;/code> çš„é•¿é“¾æ¥è°ƒç”¨ï¼Œåœ¨ &lt;code>RPC&lt;/code> ä¸Šä½ ä¼šæƒ³åˆ°å…¶ä»–çš„å“ªäº›ä¸œä¸œï¼Ÿ&lt;/li>
&lt;li>åœ¨æ­¤ç¯å¢ƒä¸‹ï¼Œæˆ‘æ²¡æœ‰ä»‹ç» &lt;code>RPC&lt;/code> æœåŠ¡äº IOCå®¹å™¨çš„ç»“åˆï¼Œå¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Œå¦‚ä½•åšåˆ° æ³¨è§£æœºåˆ¶ã€&lt;code>JAVA CONFIG&lt;/code> æœºåˆ¶ã€&lt;code>XML SCHEMA&lt;/code> æœºåˆ¶æ¥åš?
&lt;ul>
&lt;li>GUICE&lt;/li>
&lt;li>SPRING&lt;/li>
&lt;li>SPI&lt;/li>
&lt;li>&amp;hellip;.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
- https://pinkhello.me/posts/04-%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84rpc%E8%B0%83%E7%94%A8/ - PinkHello, All Rights Reserved</description></item><item><title>é“¾æ¥</title><link>https://pinkhello.me/links/</link><pubDate>Tue, 09 Feb 2021 10:38:21 +0800</pubDate><guid>https://pinkhello.me/links/</guid><description>PinkHello https://pinkhello.me/links/ -- https://pinkhello.me/links/ - PinkHello, All Rights Reserved</description></item><item><title>å…³äºæˆ‘</title><link>https://pinkhello.me/about/</link><pubDate>Tue, 09 Feb 2021 10:36:43 +0800</pubDate><guid>https://pinkhello.me/about/</guid><description>PinkHello https://pinkhello.me/about/ -&lt;h2 id="--pinkhello-viewshttpsviewswhatilearenedtodayviewsgithubpinkhellopinkhellosvg">ğŸ“§ ğŸ‘· pinkhello &lt;img src="https://views.whatilearened.today/views/github/pinkhello/pinkhello.svg" alt="views">&lt;/h2>
&lt;ul>
&lt;li>Email: &lt;a href="mailto:lee123lee123@163.com">lee123lee123@163.com&lt;/a>&lt;/li>
&lt;li>å¾®ä¿¡: chess_1&lt;/li>
&lt;li>åšå®¢: &lt;a href="https://pinkhello.me">https://pinkhello.me&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://github-readme-stats.vercel.app/api?username=pinkhello&amp;amp;show_icons=true&amp;amp;theme=vue&amp;amp;hide_border=true&amp;amp;line_height=20&amp;amp;count_private=true" alt="">
&lt;img src="https://github-readme-stats.vercel.app/api/top-langs/?username=pinkhello&amp;amp;layout=compact&amp;amp;hide_border=true&amp;amp;hide=html,vim&amp;amp;count_private=true" alt="">&lt;/p>
&lt;h2 id="-ä¸ªäººå¼€æºé¡¹ç›®">ğŸ³ ä¸ªäººå¼€æºé¡¹ç›®&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">é¡¹ç›®&lt;/th>
&lt;th style="text-align:left">æè¿°&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">&lt;a href="https://github.com/pinkhello/gopush">GoPush&lt;/a>&lt;/td>
&lt;td style="text-align:left">ä¸€ä¸ªå®æ—¶æ¨é€ç»„ä»¶&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;a href="https://github.com/pinkhello/spring-boot-starter-dubbo">spring-boot-starter-dubbo&lt;/a>&lt;/td>
&lt;td style="text-align:left">dubbo-spring-boot-è„šæ‰‹æ¶&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;a href="https://github.com/pinkhello/go-starter">go-starter&lt;/a>&lt;/td>
&lt;td style="text-align:left">GoæœåŠ¡å¼€å‘è„šæ‰‹æ¶&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="-æŠ€èƒ½">âš¡ æŠ€èƒ½&lt;/h2>
&lt;p>Language&lt;br>
&lt;img src="https://img.shields.io/badge/-Java-black?style=flat-square&amp;amp;logo=Java" alt="Java">
&lt;img src="https://img.shields.io/badge/-Go-black?style=flat-square&amp;amp;logo=Go" alt="Go">
&lt;img src="https://img.shields.io/badge/-Python-black?style=flat-square&amp;amp;logo=Python" alt="Python">
&lt;img src="https://img.shields.io/badge/-JavaScript-black?style=flat-square&amp;amp;logo=JavaScript" alt="JavaScript">&lt;/p>
&lt;p>Framework&lt;br>
&lt;img src="https://img.shields.io/badge/-Vue-000000?style=flat-square&amp;amp;logo=Vue.js" alt="Vue">
&lt;img src="https://img.shields.io/badge/-Spring-black?style=flat-square&amp;amp;logo=Spring" alt="Spring">
&lt;img src="https://img.shields.io/badge/-Spring%20Boot(Cloud)-black?style=flat-square&amp;amp;logo=Spring%20Boot(Cloud)" alt="Spring Boot(Cloud)">
&lt;img src="https://img.shields.io/badge/-Dubbo-black?style=flat-square&amp;amp;logo=Dubbo" alt="Dubbo">
&lt;img src="https://img.shields.io/badge/-Flask-black?style=flat-square&amp;amp;logo=Flask" alt="Flask">
&lt;img src="https://img.shields.io/badge/-Echo-black?style=flat-square&amp;amp;logo=Echo" alt="Echo">
&lt;img src="https://img.shields.io/badge/-Gin-black?style=flat-square&amp;amp;logo=Gin" alt="Gin">
&lt;img src="https://img.shields.io/badge/-Grpc-black?style=flat-square&amp;amp;logo=Grpc" alt="Grpc">&lt;/p>
&lt;p>Tools&lt;br>
&lt;img src="https://img.shields.io/badge/-Redis-black?style=flat-square&amp;amp;logo=Redis" alt="Redis">
&lt;img src="https://img.shields.io/badge/-MySQL-black?style=flat-square&amp;amp;logo=mysql" alt="MySQL">
&lt;img src="https://img.shields.io/badge/-Nginx-black?style=flat-square&amp;amp;logo=Nginx" alt="Nginx">
&lt;img src="https://img.shields.io/badge/-MongoDB-black?style=flat-square&amp;amp;logo=MongoDB" alt="MongoDB">
&lt;img src="https://img.shields.io/badge/-Pulsar-black?style=flat-square&amp;amp;logo=Pulsar" alt="Pulsar">
&lt;img src="https://img.shields.io/badge/-Kafka-black?style=flat-square&amp;amp;logo=Kafka" alt="Kafka">
&lt;img src="https://img.shields.io/badge/-Nsq-black?style=flat-square&amp;amp;logo=Nsq" alt="Nsq">
&lt;img src="https://img.shields.io/badge/-RabbitMQ-black?style=flat-square&amp;amp;logo=RabbitMQ" alt="RabbitMQ">
&lt;img src="https://img.shields.io/badge/-GitHub-181717?style=flat-square&amp;amp;logo=github" alt="GitHub">&lt;/p>
&lt;p>Others&lt;br>
&lt;img src="https://img.shields.io/badge/-Kubernetes-black?style=flat-square&amp;amp;logo=Kubernetes" alt="Kubernetes">
&lt;img src="https://img.shields.io/badge/-Docker-black?style=flat-square&amp;amp;logo=Docker" alt="Docker">
&lt;img src="https://img.shields.io/badge/-Linux-black?style=flat-square&amp;amp;logo=Linux" alt="Linux">
&lt;img src="https://img.shields.io/badge/-Deepin-007CFF?style=flat-square&amp;amp;logo=deepin" alt="Deepin">
&lt;img src="https://img.shields.io/badge/-Centos-262577?style=flat-square&amp;amp;logo=Centos" alt="Centos">
&lt;img src="https://img.shields.io/badge/-Raspberry%20Pi-C51A4A?style=flat-square&amp;amp;logo=Raspberry-Pi" alt="Raspberry Pi">&lt;/p>
&lt;h2 id="-2021-okr-è¿›åº¦">ğŸš€ 2021 OKR è¿›åº¦&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">åŠ¨ä½œ&lt;/th>
&lt;th style="text-align:left">è¿›åº¦&lt;/th>
&lt;th style="text-align:left">ç›®æ ‡&lt;/th>
&lt;th style="text-align:left">ç¼ºé™·&lt;/th>
&lt;th style="text-align:left">å…¶ä»–&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">ğŸ‘¯ GoæœåŠ¡å¼€å‘è„šæ‰‹æ¶&lt;/td>
&lt;td style="text-align:left">done&lt;/td>
&lt;td style="text-align:left">&lt;a href="https://github.com/pinkhello/go-starter">go-starter&lt;/a>&lt;/td>
&lt;td style="text-align:left">ut&lt;/td>
&lt;td style="text-align:left">-&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">ğŸ’µ GoæœåŠ¡å¼€å‘è„šæ‰‹æ¶å¼€å‘ä¸€ä¸ªç®€å•å‰åç«¯ç³»ç»Ÿ&lt;/td>
&lt;td style="text-align:left">done&lt;/td>
&lt;td style="text-align:left">&lt;a href="http://121.4.242.26">æˆ¿äº§CRMä¿¡æ¯ç³»ç»Ÿ&lt;/a> test/123456&lt;/td>
&lt;td style="text-align:left">-&lt;/td>
&lt;td style="text-align:left">BEé‡‡ç”¨çš„&lt;a href="https://github.com/pinkhello/go-starter">go-starter&lt;/a>, FE é‡‡ç”¨çš„&lt;a href="https://pro.antdv.com/">ant-design-vue-pro&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">ğŸ³ K8SåŸç†&lt;/td>
&lt;td style="text-align:left">running&lt;/td>
&lt;td style="text-align:left">&lt;a href="https://pinkhello.me/categories/k8s/">K8Såšå®¢æˆæ¡£&lt;/a>&lt;/td>
&lt;td style="text-align:left">-&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">ğŸš€ RocketMQ æºä»£ç é˜…è¯»(Java)&lt;/td>
&lt;td style="text-align:left">running&lt;/td>
&lt;td style="text-align:left">&lt;a href="https://pinkhello.me/categories/rocketmq/">RocketMQåšå®¢æˆæ¡£&lt;/a>&lt;/td>
&lt;td style="text-align:left">-&lt;/td>
&lt;td style="text-align:left">-&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">ğŸš€ RocketMQ å®¢æˆ·ç«¯ä»£ç é˜…è¯»(Compare Go/Java)&lt;/td>
&lt;td style="text-align:left">running&lt;/td>
&lt;td style="text-align:left">&lt;a href="https://pinkhello.me/categories/rocketmq/">RocketMQåšå®¢æˆæ¡£&lt;/a>&lt;/td>
&lt;td style="text-align:left">-&lt;/td>
&lt;td style="text-align:left">-&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">ğŸ˜„ MySQLå®ç°åŸç†è§£æ&lt;/td>
&lt;td style="text-align:left">prepare&lt;/td>
&lt;td style="text-align:left">åšå®¢æˆæ¡£&lt;/td>
&lt;td style="text-align:left">-&lt;/td>
&lt;td style="text-align:left">-&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">ğŸ« æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾&lt;/td>
&lt;td style="text-align:left">prepare&lt;/td>
&lt;td style="text-align:left">åšå®¢æˆæ¡£&lt;/td>
&lt;td style="text-align:left">-&lt;/td>
&lt;td style="text-align:left">-&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
- https://pinkhello.me/about/ - PinkHello, All Rights Reserved</description></item><item><title>å›æœ›K8S æŒä¹…åŒ–å­˜å‚¨</title><link>https://pinkhello.me/posts/22-%E5%9B%9E%E6%9C%9Bk8s-%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8/</link><pubDate>Sat, 21 Mar 2020 17:17:13 +0800</pubDate><guid>https://pinkhello.me/posts/22-%E5%9B%9E%E6%9C%9Bk8s-%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8/</guid><description>PinkHello https://pinkhello.me/posts/22-%E5%9B%9E%E6%9C%9Bk8s-%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8/ -&lt;h1 id="pvpvcstorageclass-è¯´çš„å•¥">&lt;code>PV&lt;/code>ã€&lt;code>PVC&lt;/code>ã€&lt;code>StorageClass&lt;/code> è¯´çš„å•¥ï¼Ÿ&lt;/h1>
&lt;p>&lt;code>PV&lt;/code>: æŒä¹…åŒ–å­˜å‚¨æ•°æ®å·ï¼Œè¿™ä¸ª API ä¸»è¦å®šä¹‰çš„æ˜¯ä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨åœ¨å®¿ä¸»æœºä¸Šçš„ä¸€ä¸ªç›®å½•ã€‚ä¸€èˆ¬ç”±è¿ç»´äººå‘˜è¿›è¡Œå®šä¹‰ï¼Œæ¯”å¦‚å®šä¹‰ä¸€ä¸ª NFS ç±»å‹çš„ PV&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>PersistentVolume&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>nfs&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">storageClassName&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>manual&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">capacity&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">storage&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>1Gi&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">accessModes&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- ReadWriteMany&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">nfs&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">server&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">10.244.1.5&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">path&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>PVC&lt;/code>: POD æ‰€å¸Œæœ›ä½¿ç”¨çš„æŒä¹…åŒ–å­˜å‚¨çš„å±æ€§. æ¯”å¦‚ &lt;code>Volume&lt;/code> çš„å­˜å‚¨å¤§å°ã€å¯è¯»å†™æƒé™ç­‰.
&lt;code>PVC&lt;/code> ä¸€èˆ¬ç”±å¼€å‘äººå‘˜åˆ›å»ºã€æˆ–è€…ç”± &lt;code>PVC&lt;/code>æ¨¡æ¿çš„æ–¹å¼æˆä¸º&lt;code>StatefulSet&lt;/code>çš„ä¸€éƒ¨åˆ†ï¼Œç”±&lt;code>StatefulSet&lt;/code>æ§åˆ¶å™¨è´Ÿè´£åˆ›å»ºå¸¦ç¼–å·çš„&lt;code>PVC&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#228b22"># åˆ›å»ºä¸€ä¸ª 1 GB å¤§å°çš„PVC&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#008b45;text-decoration:underline">---&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>PersistentVolumeClaim&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>nfs&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">accessModes&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- ReadWriteMany&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">storageClassName&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>manual&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">resources&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">requests&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">storage&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>1Gi&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#008b45;text-decoration:underline">...&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”¨æˆ·åˆ›å»ºçš„&lt;code>PVC&lt;/code>è¦çœŸæ­£çš„è¢«å®¹å™¨ä½¿ç”¨çš„åŒ–ï¼Œéœ€è¦äºå¿ƒå’ŒæŸä¸ªç¬¦åˆæ¡ä»¶çš„&lt;code>PV&lt;/code>è¿›è¡Œç»‘å®šï¼š&lt;/p>
&lt;ul>
&lt;li>ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼Œ&lt;code>PV&lt;/code> å’Œ &lt;code>PVC&lt;/code> çš„ &lt;code>spec&lt;/code> å­—æ®µã€‚ä¾‹å¦‚: &lt;code>PV&lt;/code> çš„å­˜å‚¨(&lt;code>storage&lt;/code>)å¤§å°å°±å¿…é¡»æ»¡è¶³ &lt;code>PVC&lt;/code> çš„è¦æ±‚&lt;/li>
&lt;li>ç¬¬äºŒä¸ªæ¡ä»¶ï¼Œ&lt;code>PV&lt;/code> å’Œ &lt;code>PVC&lt;/code> çš„ &lt;code>storageClassName&lt;/code> å­—æ®µåç§°å¿…é¡»ä¸€æ ·ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä¸‹é¢æ˜¯å»ä½¿ç”¨è¿™ä¸ª&lt;code>PVC&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Pod&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">role&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>web-frontend&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">containers&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>web&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">image&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>nginx&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">ports&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>web&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">containerPort&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">80&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">volumeMounts&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>nfs&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">mountPath&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;/usr/share/nginx/html&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">volumes&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>nfs&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">persistentVolumeClaim&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">claimName&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>nfs&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>PVC&lt;/code> ç†è§£ä¸ºæŒä¹…åŒ–å­˜å‚¨çš„ æ¥å£ï¼Œå®ƒæä¾›äº†å¯¹æŸç§æŒä¹…åŒ–å­˜å‚¨çš„æè¿°ï¼Œä½†ä¸æä¾›å…·ä½“çš„å®ç°ï¼Œè€Œè¿™ä¸ªæŒä¹…åŒ–çš„å®ç°éƒ¨åˆ†ç”± &lt;code>PV&lt;/code> å®Œæˆã€‚&lt;/p>
&lt;p>å‡è®¾ï¼Œæˆ‘ä»¬åœ¨åˆ›å»º &lt;code>POD&lt;/code> çš„æ—¶å€™ï¼Œç³»ç»Ÿå†…å¹¶æ²¡æœ‰åˆé€‚çš„ &lt;code>PV&lt;/code> è·Ÿå®ƒå®šä¹‰çš„ &lt;code>PVC&lt;/code> ç»‘å®šï¼Œè¿™ä¸ªæ—¶å€™å®¹å™¨æƒ³è¦ä½¿ç”¨çš„ &lt;code>Volume&lt;/code> ä¸å­˜åœ¨ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ&lt;/p>
&lt;p>åœ¨ &lt;code>Kubernetes&lt;/code> å†…ï¼Œæ—¶æœºå­˜åœ¨ä¸€ä¸ªä¸“é—¨å¤„ç†æŒä¹…åŒ–å­˜å‚¨çš„æ§åˆ¶å™¨ï¼Œå«åš &lt;code>VolumeController&lt;/code>ã€‚è¿™ä¸ª&lt;code>VolumeController&lt;/code>ç»´æŠ¤ç€å¤šä¸ªæ§åˆ¶å¾ªç¯,
å…¶ä¸­æœ‰ä¸ªå¾ªç¯å°±æ˜¯ç”¨æ¥æ’®åˆ &lt;code>PV&lt;/code> å’Œ &lt;code>PVC&lt;/code> è¿›è¡Œç»‘å®šçš„è§’è‰²ï¼Œåå­—å« &lt;code>PersistentVolumeController&lt;/code>. å®ƒä¼šä¸æ–­çš„æŸ¥çœ‹å½“å‰çš„æ¯ä¸€ä¸ª &lt;code>PVC&lt;/code>ï¼Œ æ˜¯å¦å¤„äº &lt;code>Bound&lt;/code> çŠ¶æ€
å¦‚æœä¸æ˜¯ï¼Œå®ƒä¼šéå†æ‰€ä»¥çš„ã€å¯ç”¨çš„ &lt;code>PV&lt;/code>ï¼Œå¹¶å°è¯•å°†å…¶ä¸è¿™ä¸ªå£°æ˜çš„PVCè¿›è¡Œç»‘å®šã€‚è¿™æ ·ï¼Œ&lt;code>Kubernetes&lt;/code> å°±å¯ä»¥ä¿è¯ç”¨æˆ·æäº¤çš„æ¯ä¸€ä¸ª &lt;code>PVC&lt;/code>ï¼Œåªè¦æœ‰åˆé€‚çš„ &lt;code>PV&lt;/code> å‡ºç°ï¼Œå®ƒèƒ½å¿«é€Ÿçš„è¿›å…¥ç»‘å®šçŠ¶æ€ã€‚
è€Œæ‰€è°“çš„ç»‘å®šï¼Œå…¶å®å°±æ˜¯å°†è¿™ä¸ª &lt;code>PV&lt;/code> å¯¹è±¡çš„åå­—å¡«å……åœ¨äº† &lt;code>PVC&lt;/code> å¯¹è±¡çš„ &lt;code>spec.volumeName&lt;/code> å­—æ®µä¸Šã€‚æ¥ä¸‹æ¥ &lt;code>Kubernetes&lt;/code> åªè¦è·å–åˆ°è¿™ä¸ª &lt;code>PVC&lt;/code> å¯¹è±¡ï¼Œå°±ä¸€å®šèƒ½å¤Ÿæ‰¾åˆ°å®ƒæ‰€ç»‘å®šçš„ &lt;code>PV&lt;/code>.&lt;/p>
&lt;p>&lt;code>PV&lt;/code> å¯¹è±¡å¦‚ä½•å˜æˆå®¹å™¨é‡Œçš„ä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨çš„å‘¢ï¼Ÿ&lt;/p>
&lt;p>æ‰€è°“å®¹å™¨çš„ &lt;code>Volume&lt;/code> ï¼Œå…¶å®å°±æ˜¯å°†ä¸€ä¸ªå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œè·Ÿå®¹å™¨é‡Œçš„ç›®å½•è¿›è¡Œç»‘å®šæŒ‚è½½åœ¨ä¸€èµ·çš„ï¼Œ
æ‰€è°“çš„ &lt;code>æŒä¹…åŒ–Volume&lt;/code> ï¼ŒæŒ‡çš„å°±æ˜¯è¿™ä¸ªå®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œå…·å¤‡&lt;code>æŒä¹…åŒ–&lt;/code>,å³å½“ç›®å½•é‡Œé¢çš„å†…å®¹ï¼Œæ—¢ä¸ä¼šå› ä¸ºå®¹å™¨çš„åˆ é™¤è€Œè¢«æ¸…ç†ã€ä¹Ÿä¸ä¼šè·Ÿå½“å‰çš„å®¿ä¸»æœºç»‘å®šï¼Œå½“å®¹å™¨è¿›è¡Œé‡å¯æˆ–è€…åœ¨å…¶ä»–èŠ‚ç‚¹ä¸Šé‡å»ºä¹‹åï¼Œä¾ç„¶èƒ½å¤ŸæŒ‚è½½åˆ°è¿™ä¸ª &lt;code>Volume&lt;/code>, è®¿é—®è¿™äº›å†…å®¹ï¼Œ
æ‰€ä»¥ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒæŒä¹…åŒ–çš„ &lt;code>Volume&lt;/code> çš„å®ç°ï¼Œå¾€å¾€ä¾èµ–ä¸€ä¸ªè¿œç¨‹å­˜å‚¨æœåŠ¡ï¼Œæ¯”å¦‚è¿œç¨‹æ–‡ä»¶å­˜å‚¨ï¼ˆ&lt;code>NFS&lt;/code>ã€&lt;code>GlusterFS&lt;/code>ï¼‰ï¼Œè¿œç¨‹å—å­˜å‚¨ï¼ˆå…¬æœ‰äº‘çš„è¿œç¨‹ç£ç›˜ï¼‰ã€‚&lt;/p>
&lt;p>&lt;code>æŒä¹…åŒ–&lt;/code>å®¿ä¸»æœºç›®å½•çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªå½¢è±¡çš„æˆä¸º &lt;code>ä¸¤é˜¶æ®µå¤„ç†&lt;/code>&lt;/p>
&lt;p>å½“ä¸€ä¸ª &lt;code>POD&lt;/code> è°ƒåº¦åˆ°ä¸€ä¸ªèŠ‚ç‚¹ä¸Šå, &lt;code>Kubelet&lt;/code> å°±è¦ä¸ºè¿™ä¸ª &lt;code>POD&lt;/code> åˆ›å»ºä¸€ä¸ª &lt;code>Volume&lt;/code> ç›®å½•, é»˜è®¤æƒ…å†µä¸‹ &lt;code>Kubelet&lt;/code> ä¸º &lt;code>Volume&lt;/code> åˆ›å»ºçš„ç›®å½•å¦‚ä¸‹æ‰€ç¤ºï¼ˆåœ¨å®¿ä¸»æœºä¸Šï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">/var/lib/kubelet/pods/&amp;lt;Podçš„ID&amp;gt;/volumes/kubernetes.io~&amp;lt;Volumeç±»å‹&amp;gt;/&amp;lt;Volumeåå­—&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¥ä¸‹æ¥, &lt;code>Kubelet&lt;/code> è¦åšçš„æ“ä½œå–å†³äº &lt;code>Volume&lt;/code> ç±»å‹.
å¦‚æœ &lt;code>Volume&lt;/code> ç±»å‹æ˜¯è¿œç¨‹å—å­˜å‚¨ï¼Œæ¯”å¦‚ &lt;code>Google CLoud&lt;/code> çš„ &lt;code>Persistent Disk&lt;/code>, é‚£ä¹ˆ &lt;code>Kubelet&lt;/code> å°±éœ€è¦å…ˆè°ƒç”¨ &lt;code>Google Cloud&lt;/code> çš„ &lt;code>API&lt;/code>, å°†å®ƒæ‰€æä¾›çš„ &lt;code>Persistent Disk&lt;/code> æŒ‚è½½åˆ° &lt;code>Pod&lt;/code> æ‰€åœ¨çš„å®¿ä¸»æœºä¸Šã€‚
ç›¸å½“äºæ‰§è¡Œäº†&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">gcloud compute instances attach-disk &amp;lt;è™šæ‹Ÿæœºåå­—&amp;gt; --disk &amp;lt;è¿œç¨‹ç£ç›˜åå­—&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸ºè™šæ‹ŸæœºæŒ‚è½½è¿œç¨‹ç£ç›˜çš„æ“ä½œï¼Œå¯¹åº”çš„æ­£æ˜¯ &lt;code>ä¸¤é˜¶æ®µå¤„ç†&lt;/code> çš„ç¬¬ä¸€æ®µã€‚å³åœ¨ &lt;code>Kubernetes&lt;/code> ä¸­çš„ &lt;code>Attach&lt;/code> é˜¶æ®µã€‚&lt;/p>
&lt;p>&lt;code>Attach&lt;/code> é˜¶æ®µå,è¦èƒ½å¤Ÿä½¿ç”¨è¿™ä¸ªè¿œç¨‹ç£ç›˜, &lt;code>Kubelet&lt;/code> éœ€è¦è¿›è¡Œç¬¬äºŒä¸ªæ“ä½œ: å³ä½¿ä¼šè¿™ä¸ªç£ç›˜è®¾å¤‡, ç„¶åå°†å®ƒæŒ‚è½½åˆ°å®¿ä¸»æœºçŸ¥é“çš„æŒ‚è½½ç‚¹ä¸Šã€‚ è¿™ä¸€æ­¥ç›¸å½“äºæ‰§è¡Œ:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&lt;span style="color:#228b22"># é€šè¿‡lsblkå‘½ä»¤è·å–ç£ç›˜è®¾å¤‡ID&lt;/span>
sudo lsblk
&lt;span style="color:#228b22"># æ ¼å¼åŒ–æˆext4æ ¼å¼&lt;/span>
sudo mkfs.ext4 -m &lt;span style="color:#b452cd">0&lt;/span> -F -E &lt;span style="color:#00688b">lazy_itable_init&lt;/span>=0,lazy_journal_init=0,discard /dev/&amp;lt;ç£ç›˜è®¾å¤‡ID&amp;gt;
&lt;span style="color:#228b22"># æŒ‚è½½åˆ°æŒ‚è½½ç‚¹&lt;/span>
sudo mkdir -p /var/lib/kubelet/pods/&amp;lt;Podçš„ID&amp;gt;/volumes/kubernetes.io~&amp;lt;Volumeç±»å‹&amp;gt;/&amp;lt;Volumeåå­—&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªå°†ç£ç›˜è®¾å¤‡æ ¼å¼åŒ–å¹¶æŒ‚è½½åˆ° &lt;code>Volume&lt;/code> å®¿ä¸»æœºç›®å½•çš„æ“ä½œ,å¯¹åº”çš„æ­£æ˜¯ &amp;ldquo;ä¸¤é˜¶æ®µå¤„ç†&amp;rdquo; çš„ç¬¬äºŒæ®µ: &lt;code>Mount&lt;/code>&lt;/p>
&lt;p>&lt;code>Kubernetes&lt;/code> å¦‚ä½•å®šä¹‰å’ŒåŒºåˆ†è¿™ä¸¤ä¸ªé˜¶æ®µçš„ï¼Ÿ
åœ¨å…·ä½“çš„ &lt;code>Volume&lt;/code> æ’ä»¶çš„å®ç°æ¥å£ä¸Š, &lt;code>Kubernetes&lt;/code> åˆ†åˆ«ç»™è¿™ä¸¤ä¸ªé˜¶æ®µæä¾›äº†ä¸¤ç§ä¸åŒçš„å‚æ•°åˆ—è¡¨:&lt;/p>
&lt;ul>
&lt;li>ç¬¬ä¸€é˜¶æ®µ &lt;code>Attach&lt;/code>, &lt;code>Kubernetes&lt;/code> æä¾›çš„å¯ç”¨å‚æ•°æ˜¯ &lt;code>nodeName&lt;/code>, å³å®¿ä¸»æœºçš„åå­—&lt;/li>
&lt;li>ç¬¬äºŒé˜¶æ®µ &lt;code>Mount&lt;/code>, &lt;code>Kubernetes&lt;/code> æä¾›çš„å¯ç”¨å‚æ•°æ˜¯ &lt;code>dir&lt;/code>, å³ &lt;code>Volume&lt;/code> çš„å®¿ä¸»æœºç›®å½•&lt;/li>
&lt;/ul>
&lt;p>åœ¨ç»è¿‡ &amp;ldquo;ä¸¤é˜¶æ®µå¤„ç†&amp;rdquo;, æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ª &lt;code>æŒä¹…åŒ–&lt;/code> çš„ &lt;code>Volume&lt;/code> å®¿ä¸»æœºç›®å½•, ç„¶å, &lt;code>Kubelet&lt;/code> åªè¦æŠŠè¿™ä¸ª &lt;code>Volume&lt;/code> ç›®å½•é€šè¿‡ &lt;code>CRI&lt;/code> é‡Œçš„ &lt;code>Mounts&lt;/code> å‚æ•°,ä¼ é€’ç»™ &lt;code>Docker&lt;/code>, ç„¶åå°±å¯ä»¥ä¸º &lt;code>POD&lt;/code> é‡Œçš„å®¹å™¨æŒ‚è½½è¿™ä¸ª &amp;ldquo;æŒä¹…åŒ–&amp;rdquo; çš„ &lt;code>Volume&lt;/code>ã€‚&lt;/p>
&lt;p>å¦å¤–è¿˜æœ‰ä¸€ä¸ªæ ¸å¿ƒçš„æ¦‚å¿µ &lt;code>StorageClass&lt;/code>, &lt;code>Kubernetes&lt;/code> ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€å¥—å¯ä»¥è‡ªåŠ¨åˆ›å»º &lt;code>PV&lt;/code> çš„æœºåˆ¶, å³ &lt;code>Dynamic Provisioning&lt;/code>, å‰é¢äººå·¥ç®¡ç†çš„ &lt;code>PV&lt;/code> æ–¹å¼å«åš &lt;code>Static Provisioning&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;code>Dynamic Provisioning&lt;/code> æœºåˆ¶å·¥ä½œçš„æ ¸å¿ƒ, åœ¨äºä¸€ä¸ªåå« &lt;code>StorageClass&lt;/code> çš„APIå¯¹è±¡ã€‚è€Œè¿™ä¸ªå¯¹è±¡çš„ä½œç”¨ï¼Œå°±æ˜¯åˆ›å»º PV çš„æ¨¡æ¿ã€‚&lt;code>StorageClass&lt;/code>å¯¹è±¡ä¼šå®šä¹‰å¦‚ä¸‹ä¸¤ä¸ªéƒ¨åˆ†å†…å®¹:&lt;/p>
&lt;ul>
&lt;li>ç¬¬ä¸€, &lt;code>PV&lt;/code> çš„å±æ€§ã€‚æ¯”å¦‚ å­˜å‚¨ç±»å‹ã€&lt;code>Volume&lt;/code> å¤§å°ç­‰&lt;/li>
&lt;li>ç¬¬äºŒ, åˆ›å»ºè¿™ç§ &lt;code>PV&lt;/code> éœ€è¦ç”¨åˆ°çš„å­˜å‚¨æ’ä»¶ã€‚æ¯”å¦‚ &lt;code>Ceph&lt;/code> ç­‰
æœ‰è¿™ä¸¤ä¸ªä¿¡æ¯å, &lt;code>Kubernetes&lt;/code> å°±å¯ä»¥æ ¹æ®ç”¨æˆ·æäº¤çš„ &lt;code>PVC&lt;/code>,æ‰¾åˆ°ä¸€ä¸ªå¯¹åº”çš„ &lt;code>StorageClass&lt;/code>ï¼Œç„¶å &lt;code>Kubernetes&lt;/code> å°±å¥½è°ƒç”¨è¯¥ &lt;code>StorageClass&lt;/code> å£°æ˜çš„å­˜å‚¨æ’ä»¶, åˆ›å»ºå‡ºéœ€è¦çš„ &lt;code>PV&lt;/code>ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#228b22">#åœ¨è¿™ä¸ª YAML æ–‡ä»¶é‡Œï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåå« block-service çš„ StorageClassã€‚&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>storage.k8s.io/v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>StorageClass&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>block-service&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">provisioner&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kubernetes.io/gce-pd&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># GCE PD å­˜å‚¨æ’ä»¶çš„åå­—&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">parameters&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">type&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>pd-ssd&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># SSDæ ¼å¼çš„GCEè¿œç¨‹ç£ç›˜&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="kubernetes-pv-å’Œ-pvc-ä½“ç³»æ˜¯ä¸æ˜¯å¤šæ­¤ä¸€æ ·">Kubernetes PV å’Œ PVC ä½“ç³»æ˜¯ä¸æ˜¯å¤šæ­¤ä¸€æ ·&lt;/h1>
&lt;p>Kubernetes æ”¯æŒå¤šç§çš„æŒä¹…åŒ– &lt;a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#types-of-persistent-volumes">Kuberneteså†…ç½®çš„æŒä¹…åŒ–æ•°æ®å·å®ç°&lt;/a>&lt;/p>
&lt;p>åœ¨é€šè¿‡ &lt;code>PV&lt;/code> å’Œ &lt;code>PVC&lt;/code>, ä»¥åŠ &lt;code>StorageClass&lt;/code> è¿™å¥—å­˜å‚¨ä½“ç³», ä¸ºåæ¥æ·»åŠ æŒä¹…åŒ–å­˜å‚¨æ–¹æ¡ˆ,å¯¹å·²æœ‰çš„ &lt;code>Kubernetes&lt;/code> çš„å½±å“,å‡ ä¹å¯ä»¥å¿½ç•¥ä¸åŠã€‚ä½œä½ç”¨æˆ·, &lt;code>POD&lt;/code> çš„ &lt;code>YAML&lt;/code> å’Œ &lt;code>PVC&lt;/code> çš„ &lt;code>YAML&lt;/code> å¹¶æ²¡æœ‰ä»»ä½•ç‰¹æ®Šçš„æ”¹å˜.&lt;/p>
&lt;h1 id="æ€»ç»“">æ€»ç»“&lt;/h1>
&lt;p>&lt;img src="https://pinkhello.me/%E5%9B%9E%E6%9C%9BK8S/pvc-pv-storageclass-check.png" alt="PVC-PVè®¾è®¡">&lt;/p>
&lt;ul>
&lt;li>&lt;code>PVC&lt;/code> æè¿° &lt;code>POD&lt;/code> æƒ³è¦ä½¿ç”¨çš„æŒä¹…åŒ–å­˜å‚¨çš„å±æ€§ï¼Œæ¯”å¦‚å­˜å‚¨çš„å¤§å°ã€è¯»å†™æƒé™ã€‚&lt;/li>
&lt;li>&lt;code>PV&lt;/code> æè¿°çš„ ä¸€ä¸ªå…·ä½“çš„ &lt;code>Volume&lt;/code> çš„å±æ€§ã€æ¯”å¦‚ &lt;code>Volume&lt;/code> çš„ç±»å‹ã€æŒ‚è½½ç›®å½•ã€è¿œç¨‹å­˜å‚¨æœåŠ¡å™¨åœ°å€&lt;/li>
&lt;li>&lt;code>StorageClass&lt;/code> ä½œç”¨ï¼Œå……å½“ &lt;code>PV&lt;/code> çš„æ¨¡æ¿ï¼Œåªè¦åŒå±äºä¸€ä¸ª &lt;code>StorageClass&lt;/code> çš„ &lt;code>PV&lt;/code> å’Œ &lt;code>PVC&lt;/code>ï¼Œæ‰å¯ä»¥ç»‘å®šåœ¨ä¸€èµ·ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://pinkhello.me/%E5%9B%9E%E6%9C%9BK8S/pvc-pv.png" alt="KubernetesæŒä¹…åŒ–å­˜å‚¨çš„åŸç†">
&lt;img src="https://pinkhello.me/%E5%9B%9E%E6%9C%9BK8S/CSI.png" alt="KubernetesæŒä¹…åŒ–å­˜å‚¨çš„é€šè¿‡CSIæ’ä»¶æ“ä½œåŸç†">&lt;/p>
&lt;ul>
&lt;li>&lt;code>Driver Registrar&lt;/code> ç»„ä»¶è´Ÿè´£å°†æ’ä»¶æ³¨å†Œåˆ° &lt;code>kubelet&lt;/code> é˜¶æ®µï¼Œè¯·æ±‚&lt;code>CSI&lt;/code>æ’ä»¶çš„ &lt;code>IdentityæœåŠ¡&lt;/code> è·å–æ’ä»¶ä¿¡æ¯&lt;/li>
&lt;li>&lt;code>External Provisioner&lt;/code> ç»„ä»¶ &lt;code>Provision é˜¶æ®µ&lt;/code>, &lt;code>External Provisioner&lt;/code> ç›‘å¬ï¼ˆ&lt;code>Watch&lt;/code>ï¼‰äº† &lt;code>APIServer&lt;/code> é‡Œçš„ &lt;code>PVCå¯¹è±¡&lt;/code>ã€‚å½“ä¸€ä¸ª &lt;code>PVC&lt;/code> è¢«åˆ›å»ºæ—¶ï¼Œå®ƒå°±ä¼šè°ƒç”¨ &lt;code>CSI Controller&lt;/code> çš„ &lt;code>CreateVolume&lt;/code> æ–¹æ³•ï¼Œä¸ºä½ åˆ›å»ºå¯¹åº” &lt;code>PV&lt;/code>&lt;/li>
&lt;li>&lt;code>External Attacher&lt;/code> ç»„ä»¶è´Ÿè´£æ­£æ˜¯ &amp;ldquo;&lt;code>Attach é˜¶æ®µ&lt;/code>&amp;rdquo;, å®ƒç›‘å¬äº† &lt;code>APIServer&lt;/code> é‡Œçš„ &lt;code>VolumeAttachment å¯¹è±¡&lt;/code>çš„å˜åŒ–, &lt;code>VolumeAttachment å¯¹è±¡&lt;/code>æ˜¯ &lt;code>Kubernetes&lt;/code> ç¡®è®¤ä¸€ä¸ª &lt;code>Volume&lt;/code> å¯ä»¥è¿›å…¥ &lt;code>Attach é˜¶æ®µ&lt;/code> çš„é‡è¦æ ‡å¿—&lt;/li>
&lt;/ul>
- https://pinkhello.me/posts/22-%E5%9B%9E%E6%9C%9Bk8s-%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8/ - PinkHello, All Rights Reserved</description></item><item><title>å›æœ›K8S å®¹å™¨ç¼–æ’ä¸Kubernetesä½œä¸šç®¡ç†</title><link>https://pinkhello.me/posts/20-%E5%9B%9E%E6%9C%9Bk8s-%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92%E4%B8%8Ekubernetes%E4%BD%9C%E4%B8%9A%E7%AE%A1%E7%90%86/</link><pubDate>Sun, 16 Feb 2020 22:48:35 +0800</pubDate><guid>https://pinkhello.me/posts/20-%E5%9B%9E%E6%9C%9Bk8s-%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92%E4%B8%8Ekubernetes%E4%BD%9C%E4%B8%9A%E7%AE%A1%E7%90%86/</guid><description>PinkHello https://pinkhello.me/posts/20-%E5%9B%9E%E6%9C%9Bk8s-%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92%E4%B8%8Ekubernetes%E4%BD%9C%E4%B8%9A%E7%AE%A1%E7%90%86/ -&lt;h1 id="pod">Pod&lt;/h1>
&lt;p>&lt;code>pod&lt;/code> æ˜¯ &lt;code>Kubernetes&lt;/code> é¡¹ç›®çš„æœ€å°çš„ API å¯¹è±¡ï¼ŒåŸå­è°ƒåº¦å•ä½.&lt;/p>
&lt;p>å‡è®¾ &amp;ldquo;å®¹å™¨çš„æœ¬è´¨æ˜¯è¿›ç¨‹&amp;rdquo;ï¼Œå®¹å™¨é•œåƒå°±æ˜¯ exe å®‰è£…åŒ…, kubernetes æ˜¯æ“ä½œç³»ç»Ÿ&lt;/p>
&lt;p>&lt;code>Pod&lt;/code> æœ€é‡è¦çš„ä¸€ä¸ªäº‹å®æ˜¯ä¸€ä¸ªé€»è¾‘æ¦‚å¿µã€‚å®ƒå¯¹äº &lt;code>Kubernetes&lt;/code> æœ€æ ¸å¿ƒçš„æ„ä¹‰æ˜¯ &lt;code>å®¹å™¨è®¾è®¡æ¨¡å¼&lt;/code>ã€‚&lt;code>Kubernetes&lt;/code> çœŸæ­£å¤„ç†çš„è¿˜æ˜¯å®¿ä¸»æœºä¸Šæ“ä½œç³»ç»Ÿä¸Šçš„ &lt;code>Linux&lt;/code> å®¹å™¨çš„ &lt;code>Namespace&lt;/code> å’Œ &lt;code>Cgroups&lt;/code>ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ‰€è°“çš„ &lt;code>Pod&lt;/code> è¾¹ç•Œå’Œéš”ç¦»ç¯å¢ƒã€‚&lt;/p>
&lt;p>&lt;code>Pod&lt;/code> å…¶å®æ˜¯ä¸€ç»„å…±äº«äº†æŸäº›èµ„æºçš„å®¹å™¨ã€‚&lt;code>Pod&lt;/code> é‡Œé¢æ‰€æœ‰çš„å®¹å™¨ï¼Œå…±äº«çš„åŒä¸€ä¸ª &lt;code>Network Namespace&lt;/code>ï¼Œå¹¶ä¸”å¯ä»¥å£°æ˜å…±äº«åŒä¸€ä¸ª &lt;code>Volume&lt;/code>.&lt;/p>
&lt;p>&lt;code>Kubernetes&lt;/code> é¡¹ç›®å†…éƒ¨ï¼Œ&lt;code>Pod&lt;/code> å®ç°éœ€è¦ä½¿ç”¨ä¸€ä¸ªä¸­é—´å®¹å™¨ï¼Œè¿™ä¸ªå®¹å™¨å«åš &lt;code>Infra&lt;/code> å®¹å™¨ï¼Œåœ¨ &lt;code>Pod&lt;/code> ä¸­ï¼Œ&lt;code>Infra&lt;/code> å®¹å™¨æ°¸è¿œéƒ½æ˜¯ç¬¬ä¸€ä¸ªè¢«åˆ›å»ºçš„å®¹å™¨ï¼Œè€Œå…¶ä»–ç”¨æˆ·å®šä¹‰çš„å®¹å™¨ï¼Œåˆ™é€šè¿‡ &lt;code>Join Network Namespace&lt;/code> çš„æ–¹å¼ï¼Œä¸ &lt;code>Infra&lt;/code> å®¹å™¨å…³è”åœ¨ä¸€èµ·ã€‚&lt;/p>
&lt;h2 id="sidecar">&lt;code>sidecar&lt;/code>&lt;/h2>
&lt;h3 id="å…¸å‹çš„ä¾‹å­war-åŒ…å’Œ-web-æœåŠ¡å™¨">å…¸å‹çš„ä¾‹å­ï¼šWAR åŒ…å’Œ Web æœåŠ¡å™¨&lt;/h3>
&lt;p>&lt;code>POD&lt;/code>åï¼Œå°† &lt;code>WAR&lt;/code> åŒ…å’Œ &lt;code>Tomcat&lt;/code> åˆ†åˆ«åšæˆé•œåƒï¼Œå¯ä»¥æŠŠä»–ä»¬å®¹å™¨ç»“åˆåœ¨ä¸€èµ·&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#008b45;text-decoration:underline">---&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Pod&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>javaweb-2&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#228b22"># å¯åŠ¨ååšäº†ä¸€ä»¶äº‹ æŠŠåº”ç”¨çš„WARåŒ…æ‹·è´åˆ° /appç›®å½•ä¸­ï¼Œåé€€å‡º&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">initContainers&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">image&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>sample-war:v2&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>war&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">command&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>[&lt;span style="color:#cd5555">&amp;#34;cp&amp;#34;&lt;/span>,&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;/sample.war&amp;#34;&lt;/span>,&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;/app&amp;#34;&lt;/span>]&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">volumeMounts&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">mountPath&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>/app&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>app-volume&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">containers&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">image&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>tomcat:7.0&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>tomcat&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">command&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>[&lt;span style="color:#cd5555">&amp;#34;sh&amp;#34;&lt;/span>,&lt;span style="color:#cd5555">&amp;#34;-c&amp;#34;&lt;/span>,&lt;span style="color:#cd5555">&amp;#34;/root/apache-tomcat-7.0.42-v2/bin/start.sh&amp;#34;&lt;/span>]&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">volumeMounts&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">mountPath&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>/root/apache-tomcat-7.0.42-v2/webapps&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>app-volume&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">ports&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">containerPort&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">8080&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">hostPort&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">8001&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">volumes&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>app-volume&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">emptyDir&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>{}&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#008b45;text-decoration:underline">...&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ª&lt;code>POD&lt;/code>ä¸­ï¼Œå®šä¹‰äº†ä¸¤ä¸ªå®¹å™¨ï¼Œç¬¬ä¸€ä¸ªå®¹å™¨é•œåƒ&lt;code> sample-war:v2&lt;/code>ï¼Œç¬¬äºŒä¸ªå®¹å™¨é•œåƒæ˜¯ &lt;code>Tomcat&lt;/code> é•œåƒï¼ŒWaråŒ…å®¹å™¨çš„ç±»å‹ä¸æ˜¯ä¸€ä¸ªæ™®é€šå®¹å™¨ï¼Œæ˜¯ä¸€ä¸ª &lt;code>Init Container&lt;/code> ç±»å‹çš„å®¹å™¨ã€‚&lt;/p>
&lt;p>åœ¨Podä¸­ï¼Œæ‰€æœ‰ &lt;code>Init Container&lt;/code> å®šä¹‰çš„å®¹å™¨ï¼Œéƒ½æ¯” &lt;code>spec.containers&lt;/code> å®šä¹‰çš„ç”¨æˆ·å®¹å™¨å…ˆå¯åŠ¨ã€‚å¹¶ä¸”ï¼Œ &lt;code>Init Container&lt;/code> å®¹å™¨ä¼šæŒ‰é¡ºåºå‡†ä¸€å¯åŠ¨ï¼Œè€Œç›´åˆ°ä»–ä»¬éƒ½å¯åŠ¨å¹¶ä¸”é€€å‡ºäº†ï¼Œç”¨æˆ·å®¹å™¨æ‰ä¼šå¯åŠ¨ã€‚&lt;/p>
&lt;p>è¿™ç§ç»„åˆçš„æ–¹å¼ï¼Œæ­£æ˜¯å®¹å™¨è®¾è®¡æ¨¡å¼é‡Œé¢æœ€å¸¸ç”¨çš„ä¸€ç§æ¨¡å¼ï¼š&lt;code>sidecar&lt;/code>&lt;/p>
&lt;h3 id="å®¹å™¨çš„æ—¥å¿—æ”¶é›†">å®¹å™¨çš„æ—¥å¿—æ”¶é›†&lt;/h3>
&lt;p>åº”ç”¨æŠŠæ—¥å¿—æ–‡ä»¶è¾“å‡ºåˆ°å®¹å™¨çš„ &lt;code>/var/log&lt;/code> ç›®å½•ä¸­ï¼Œ&lt;code>Pod&lt;/code>çš„ &lt;code>Volume&lt;/code> æŒ‚è½½åˆ°åº”ç”¨å®¹å™¨çš„ &lt;code>/var/log&lt;/code> ç›®å½•ä¸Šï¼Œç„¶ååœ¨è¿™ä¸ª &lt;code>Pod&lt;/code> é‡Œçš„è¿è¡Œä¸€ä¸ª &lt;code>sidecar&lt;/code> å®¹å™¨ï¼Œä¹Ÿå£°æ˜æŒ‚è½½åŒä¸€ä¸ª &lt;code>Volume&lt;/code> åˆ°è‡ªå·±çš„ &lt;code>/var/log&lt;/code> ç›®å½•ä¸Šï¼Œ
è¿™æ ·è¿™ä¸ª &lt;code>sidecar&lt;/code> å®¹å™¨åªéœ€è¦åšä¸€ä»¶äº‹ï¼ŒæŠŠè‡ªå·±çš„ &lt;code>/var/log&lt;/code> ç›®å½•ä¸­è¯»å–æ—¥å¿—æ–‡ä»¶ï¼Œè½¬å‘å°±å¯ä»¥äº†ï¼Œå°±æ˜¯ä¸€ä¸ªåŸºæœ¬çš„æ—¥å¿—æ”¶é›†&lt;/p>
&lt;h1 id="pod-å¯¹è±¡çš„åŸºæœ¬æ¦‚å¿µ">&lt;code>Pod&lt;/code> å¯¹è±¡çš„åŸºæœ¬æ¦‚å¿µ&lt;/h1>
&lt;p>&lt;code>Pod&lt;/code> æ˜¯å®¹å™¨ç¯å¢ƒçš„ &lt;code>Kubernetes&lt;/code> çš„åŸºæœ¬å•å…ƒï¼Œè°ƒåº¦ã€ç½‘ç»œã€å­˜å‚¨ã€ä»¥åŠå®‰å…¨ç›¸å…³çš„ç†Ÿæ‚‰ï¼Œéƒ½æ˜¯å±äº &lt;code>Pod&lt;/code> çº§åˆ«çš„ã€‚&lt;/p>
&lt;p>&lt;code>Pod&lt;/code> ä¸‹é‡è¦çš„å­—æ®µå’Œå«ä¹‰&lt;/p>
&lt;ul>
&lt;li>&lt;code>NodeSelector&lt;/code> : ç”¨æˆ·å°† &lt;code>Pod&lt;/code> å’Œ &lt;code>Node&lt;/code> ç»‘å®šçš„å­—æ®µ&lt;/li>
&lt;li>&lt;code>NodeName&lt;/code> : ä¸€æ—¦ &lt;code>Pod&lt;/code> çš„è¿™ä¸ªé˜»æ–­è¢«èµ‹å€¼ï¼Œ&lt;code>K8S&lt;/code> ä¼šè®¤ä¸ºè¿™ä¸ª &lt;code>Pod&lt;/code> å·²ç»ç»è¿‡è°ƒåº¦ã€‚&lt;/li>
&lt;li>&lt;code>HostAliases&lt;/code>ï¼šå®šä¹‰äº† &lt;code>Pod&lt;/code> çš„ &lt;code>hosts&lt;/code> æ–‡ä»¶ï¼ˆæ¯”å¦‚ &lt;code>/etc/hosts&lt;/code>ï¼‰é‡Œçš„å†…å®¹&lt;/li>
&lt;/ul>
&lt;p>å‡¡æ˜¯è·Ÿå®¹å™¨çš„ &lt;code>Linux Namespace&lt;/code> ç›¸å…³çš„å±æ€§ï¼Œä¹Ÿä¸€å®šæ˜¯ &lt;code>Pod&lt;/code> çº§åˆ«çš„ã€‚
&lt;code>shareProcessNamespace=true&lt;/code>&lt;/p>
&lt;p>&lt;code>Pod&lt;/code> å¯¹è±¡åœ¨ &lt;code>Kubernetes&lt;/code> ä¸­çš„ç”Ÿå‘½å‘¨æœŸã€‚&lt;code>Pod&lt;/code> ç”Ÿå‘½å‘¨æœŸçš„å˜åŒ–ï¼Œä¸»è¦ä½“ç°åœ¨ &lt;code>Pod API å¯¹è±¡&lt;/code>çš„ &lt;code>Status&lt;/code> éƒ¨åˆ†ï¼Œè¿™æ˜¯å®ƒé™¤äº† &lt;code>Metadata&lt;/code> å’Œ &lt;code>Spec&lt;/code> ä¹‹å¤–çš„ç¬¬ä¸‰ä¸ªé‡è¦å­—æ®µã€‚å…¶ä¸­ï¼Œ&lt;code>pod.status.phase&lt;/code>ï¼Œå°±æ˜¯ &lt;code>Pod&lt;/code> çš„å½“å‰çŠ¶æ€ï¼Œ
å®ƒæœ‰å¦‚ä¸‹å‡ ç§å¯èƒ½çš„æƒ…å†µï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>Pending&lt;/code>ã€‚è¿™ä¸ªçŠ¶æ€æ„å‘³ç€ï¼Œ&lt;code>Pod&lt;/code> çš„ &lt;code>YAML&lt;/code> æ–‡ä»¶å·²ç»æäº¤ç»™äº† &lt;code>Kubernetes&lt;/code>ï¼Œ&lt;code>API&lt;/code> å¯¹è±¡å·²ç»è¢«åˆ›å»ºå¹¶ä¿å­˜åœ¨ &lt;code>Etcd&lt;/code> å½“ä¸­ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ª &lt;code>Pod&lt;/code> é‡Œæœ‰äº›å®¹å™¨å› ä¸ºæŸç§åŸå› è€Œä¸èƒ½è¢«é¡ºåˆ©åˆ›å»ºã€‚æ¯”å¦‚ï¼Œè°ƒåº¦ä¸æˆåŠŸã€‚&lt;/li>
&lt;li>&lt;code>Running&lt;/code>ã€‚è¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œ&lt;code>Pod&lt;/code> å·²ç»è°ƒåº¦æˆåŠŸï¼Œè·Ÿä¸€ä¸ªå…·ä½“çš„èŠ‚ç‚¹ç»‘å®šã€‚å®ƒåŒ…å«çš„å®¹å™¨éƒ½å·²ç»åˆ›å»ºæˆåŠŸï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œä¸­ã€‚&lt;/li>
&lt;li>&lt;code>Succeeded&lt;/code>ã€‚è¿™ä¸ªçŠ¶æ€æ„å‘³ç€ï¼Œ&lt;code>Pod&lt;/code> é‡Œçš„æ‰€æœ‰å®¹å™¨éƒ½æ­£å¸¸è¿è¡Œå®Œæ¯•ï¼Œå¹¶ä¸”å·²ç»é€€å‡ºäº†ã€‚è¿™ç§æƒ…å†µåœ¨è¿è¡Œä¸€æ¬¡æ€§ä»»åŠ¡æ—¶æœ€ä¸ºå¸¸è§ã€‚&lt;/li>
&lt;li>&lt;code>Failed&lt;/code>ã€‚è¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œ&lt;code>Pod&lt;/code> é‡Œè‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨ä»¥ä¸æ­£å¸¸çš„çŠ¶æ€ï¼ˆé 0 çš„è¿”å›ç ï¼‰é€€å‡ºã€‚è¿™ä¸ªçŠ¶æ€çš„å‡ºç°ï¼Œæ„å‘³ç€ä½ å¾—æƒ³åŠæ³• &lt;code>Debug&lt;/code> è¿™ä¸ªå®¹å™¨çš„åº”ç”¨ï¼Œæ¯”å¦‚æŸ¥çœ‹ &lt;code>Pod&lt;/code> çš„ &lt;code>Events&lt;/code> å’Œæ—¥å¿—ã€‚&lt;/li>
&lt;li>&lt;code>Unknown&lt;/code>ã€‚è¿™æ˜¯ä¸€ä¸ªå¼‚å¸¸çŠ¶æ€ï¼Œæ„å‘³ç€ &lt;code>Pod&lt;/code> çš„çŠ¶æ€ä¸èƒ½æŒç»­åœ°è¢« &lt;code>kubelet&lt;/code> æ±‡æŠ¥ç»™ &lt;code>kube-apiserver&lt;/code>ï¼Œè¿™å¾ˆæœ‰å¯èƒ½æ˜¯ä¸»ä»èŠ‚ç‚¹ï¼ˆ&lt;code>Master&lt;/code> å’Œ &lt;code>Kubelet&lt;/code>ï¼‰é—´çš„é€šä¿¡å‡ºç°äº†é—®é¢˜ã€‚&lt;/li>
&lt;/ul>
&lt;h1 id="kubernetes-å…¶ä»–å¯¹è±¡-volume">&lt;code>Kubernetes&lt;/code> å…¶ä»–å¯¹è±¡ &lt;code>Volume&lt;/code>&lt;/h1>
&lt;p>&lt;code>Kubernetes&lt;/code> æ”¯æŒçš„ &lt;code>Project Volume&lt;/code> ä¸€å…±æœ‰å››ç§:&lt;/p>
&lt;ul>
&lt;li>&lt;code>Secret&lt;/code> : æŠŠ Pod æƒ³è¦è®¿é—®çš„åŠ å¯†æ•°æ®ï¼Œå­˜æ”¾åˆ° &lt;code>Etcd&lt;/code> ä¸­ï¼Œç„¶åé€šè¿‡åœ¨ Pod çš„å®¹å™¨é‡ŒæŒ‚è½½ Volume çš„æ–¹å¼ã€‚&lt;/li>
&lt;li>&lt;code>ConfigMap&lt;/code> : ä¿å­˜çš„æ˜¯ä¸éœ€è¦åŠ å¯†çš„ã€åº”ç”¨æ‰€éœ€çš„é…ç½®ä¿¡æ¯ã€‚è€Œ &lt;code>ConfigMap&lt;/code> çš„ç”¨æ³•å‡ ä¹ä¸ &lt;code>Secret&lt;/code> å®Œå…¨ç›¸åŒï¼šä½ å¯ä»¥ä½¿ç”¨ &lt;code>kubectl create configmap&lt;/code> ä»æ–‡ä»¶æˆ–è€…ç›®å½•åˆ›å»º &lt;code>ConfigMap&lt;/code>ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç¼–å†™ &lt;code>ConfigMap&lt;/code> å¯¹è±¡çš„ &lt;code>YAML&lt;/code> æ–‡ä»¶ã€‚&lt;/li>
&lt;li>&lt;code>Downward API&lt;/code> : è®© Pod é‡Œçš„å®¹å™¨èƒ½å¤Ÿç›´æ¥è·å–åˆ°è¿™ä¸ª&lt;code> Pod API&lt;/code> å¯¹è±¡æœ¬èº«çš„ä¿¡æ¯ã€‚
&lt;blockquote>
&lt;p>ä¸€å®šæ˜¯ Pod é‡Œçš„å®¹å™¨è¿›ç¨‹å¯åŠ¨ä¹‹å‰å°±èƒ½å¤Ÿç¡®å®šä¸‹æ¥çš„ä¿¡æ¯ã€‚è€Œå¦‚æœä½ æƒ³è¦è·å– Pod å®¹å™¨è¿è¡Œåæ‰ä¼šå‡ºç°çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼Œå®¹å™¨è¿›ç¨‹çš„ &lt;code>PID&lt;/code>ï¼Œé‚£å°±è‚¯å®šä¸èƒ½ä½¿ç”¨ &lt;code>Downward API&lt;/code> äº†ï¼Œè€Œåº”è¯¥è€ƒè™‘åœ¨ &lt;code>Pod&lt;/code> é‡Œå®šä¹‰ä¸€ä¸ª &lt;code>sidecar&lt;/code> å®¹å™¨ã€‚&lt;/p>
&lt;/blockquote>
&lt;/li>
&lt;li>&lt;code>ServiceAccountToken&lt;/code> : è¿™ç§æŠŠ &lt;code>Kubernetes&lt;/code> å®¢æˆ·ç«¯ä»¥å®¹å™¨çš„æ–¹å¼è¿è¡Œåœ¨é›†ç¾¤é‡Œï¼Œç„¶åä½¿ç”¨ &lt;code>default Service Account&lt;/code> è‡ªåŠ¨æˆæƒçš„æ–¹å¼ï¼Œè¢«ç§°ä½œâ€œInClusterConfigâ€.&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#008b45;text-decoration:underline">---&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Secret&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>mysecret&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">type&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Opaque&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">data&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">user&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>YWRtaW4=&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">pass&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>MWYyZDFlMmU2N2Rm&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#008b45;text-decoration:underline">...&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&amp;gt; kubectl create secret
&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="å®¹å™¨çš„å¥åº·æ£€æŸ¥å’Œæ¢å¤æœºåˆ¶">å®¹å™¨çš„å¥åº·æ£€æŸ¥å’Œæ¢å¤æœºåˆ¶&lt;/h1>
&lt;p>&lt;code>Pod&lt;/code> å®¹å™¨å®šä¹‰äº†ä¸€ä¸ªå¥åº·æ£€æŸ¥çš„&amp;quot;æ¢é’ˆ&amp;quot;ï¼ˆProbeï¼‰, è¿™æ ·kubeletå°±ä¼šæ ¹æ®è¿™ä¸ª probe è¿”å›çš„å€¼å†³å®šè¿™ä¸ªå®¹å™¨çš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯ç›´æ¥ä»¥å®¹å™¨é•œåƒååˆ†è¿è¡Œæ¥ä½œä¸ºä¾æ®ã€‚ç”Ÿäº§ç¯å¢ƒä¿è¯åº”ç”¨å¥åº·å­˜æ´»çš„é‡è¦æ‰‹æ®µã€‚&lt;/p>
&lt;p>&lt;code>Pod&lt;/code> æ¢å¤æœºåˆ¶ restartPolicy, å®ƒæ˜¯ Pod çš„ Spec éƒ¨åˆ†çš„ä¸€ä¸ªæ ‡å‡†å­—æ®µï¼ˆ&lt;code>pod.spec.restartPolicy&lt;/code>ï¼‰ï¼Œé»˜è®¤å€¼æ˜¯ &lt;code>Always&lt;/code>ï¼Œå³ï¼šä»»ä½•æ—¶å€™è¿™ä¸ªå®¹å™¨å‘ç”Ÿäº†å¼‚å¸¸ï¼Œå®ƒä¸€å®šä¼šè¢«é‡æ–°åˆ›å»ºã€‚&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>pod&lt;/code> æ¢å¤ï¼Œæ°¸è¿œåªå‘ç”Ÿåœ¨å½“å‰èŠ‚ç‚¹ï¼Œè€Œä¸ä¼šè·‘åˆ°åˆ«çš„èŠ‚ç‚¹ä¸Šå»ã€‚ï¼ˆä¸ä¼šå‘ç”Ÿæ•…éšœè½¬ç§»ï¼‰éœ€è¦è½¬ç§»çš„éœ€è¦åˆ‡æ¢åˆ° &lt;code>Deployment&lt;/code> è¿™æ ·çš„æ§åˆ¶å™¨æ¥ç®¡ç†&lt;code>POD &lt;/code>&lt;/p>
&lt;/blockquote>
&lt;p>ä½ è¿˜å¯ä»¥é€šè¿‡è®¾ç½® &lt;code>restartPolicy&lt;/code>ï¼Œæ”¹å˜ &lt;code>Pod&lt;/code> çš„æ¢å¤ç­–ç•¥ã€‚é™¤äº† &lt;code>Always&lt;/code>ï¼Œå®ƒè¿˜æœ‰ &lt;code>OnFailure&lt;/code> å’Œ &lt;code>Never&lt;/code> ä¸¤ç§æƒ…å†µï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>Always&lt;/code>ï¼šåœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œåªè¦å®¹å™¨ä¸åœ¨è¿è¡ŒçŠ¶æ€ï¼Œå°±è‡ªåŠ¨é‡å¯å®¹å™¨ï¼›&lt;/li>
&lt;li>&lt;code>OnFailure&lt;/code>: åªåœ¨å®¹å™¨ å¼‚å¸¸æ—¶æ‰è‡ªåŠ¨é‡å¯å®¹å™¨ï¼›&lt;/li>
&lt;li>&lt;code>Never&lt;/code>: ä»æ¥ä¸é‡å¯å®¹å™¨ã€‚&lt;/li>
&lt;/ul>
&lt;h1 id="ç¼–æ’å…¶å®å¾ˆç®€å•-æ§åˆ¶å™¨æ¨¡å‹">ç¼–æ’å…¶å®å¾ˆç®€å•-&amp;ldquo;æ§åˆ¶å™¨&amp;quot;æ¨¡å‹&lt;/h1>
&lt;p>å‰é¢å·²ç»çŸ¥é“ &lt;code>POD&lt;/code> æ˜¯ä¸€ä¸ªå¤æ‚çš„&lt;code>APIå¯¹è±¡&lt;/code>ï¼Œå®é™…ä¹Ÿæ˜¯å¯¹å®¹å™¨çš„è¿›ä¸€æ­¥æŠ½è±¡å’Œå°è£…ï¼›ä¹Ÿå°±æ˜¯è¯´&lt;code>Podå¯¹è±¡&lt;/code>æ˜¯å®¹å™¨çš„å‡çº§ç‰ˆ,å®ƒå¯¹å®¹å™¨çš„ç»„åˆï¼Œæ·»åŠ äº†å¾ˆå¤šçš„å±æ€§å’Œå­—æ®µã€‚&lt;/p>
&lt;p>&lt;code>Kubernetes&lt;/code>æ“ä½œ&lt;code>POD&lt;/code>æ˜¯ä¾èµ–æ§åˆ¶å™¨(Controller)å®Œæˆçš„ã€‚å°±æ˜¯ kube-controller-manager ç»„ä»¶&lt;/p>
&lt;p>é€šè¿‡æŸ¥çœ‹ &lt;code>https://github.com/kubernetes/kubernetes/tree/master/pkg/controller&lt;/code> æºä»£ç ä¸‹èƒ½çœ‹è§è¿™äº›ç›®å½•&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">deployment/ job/ podautoscaler/ cloud/ disruption/ namespace/
replicaset/ serviceaccount/ volume/cronjob/ garbagecollector/ nodelifecycle/
replication/ statefulset/ daemon/...
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™äº›æ¯ä¸ªç›®å½•éƒ½æ˜¯ä¸€ç§ç±»å‹çš„ &lt;code>controller&lt;/code>,å„è‡ªè´Ÿè´£æŸç§ç¼–æ’åŠŸèƒ½ã€‚&lt;/p>
&lt;p>æ§åˆ¶å¾ªç¯ï¼ˆcontrol loopï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">
&lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> {
å®é™…çŠ¶æ€ := è·å–é›†ç¾¤ä¸­å¯¹è±¡Xçš„å®é™…çŠ¶æ€&lt;span style="color:#a61717;background-color:#e3d2d2">ï¼ˆ&lt;/span>Actual State&lt;span style="color:#a61717;background-color:#e3d2d2">ï¼‰&lt;/span>
æœŸæœ›çŠ¶æ€ := è·å–é›†ç¾¤ä¸­å¯¹è±¡Xçš„æœŸæœ›çŠ¶æ€&lt;span style="color:#a61717;background-color:#e3d2d2">ï¼ˆ&lt;/span>Desired State&lt;span style="color:#a61717;background-color:#e3d2d2">ï¼‰&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> å®é™…çŠ¶æ€ == æœŸæœ›çŠ¶æ€{
ä»€ä¹ˆéƒ½ä¸åš
} &lt;span style="color:#8b008b;font-weight:bold">else&lt;/span> {
æ‰§è¡Œç¼–æ’åŠ¨ä½œ&lt;span style="color:#a61717;background-color:#e3d2d2">ï¼Œ&lt;/span>å°†å®é™…çŠ¶æ€è°ƒæ•´ä¸ºæœŸæœ›çŠ¶æ€
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…·ä½“å®ç°æ—¶å€™ï¼Œ&lt;code>å®é™…çŠ¶æ€&lt;/code>æ¥è‡ªäº&lt;code>Kubernetes&lt;/code> é›†ç¾¤æœ¬èº«ï¼Œ&lt;code>æœŸæœ›çŠ¶æ€&lt;/code>æ¥è‡ªäºç”¨æˆ·æäº¤çš„ &lt;code>YAML&lt;/code> æ–‡ä»¶ã€‚&lt;/p>
&lt;blockquote>
&lt;p>æ¯”å¦‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>Deploymentæ§åˆ¶å™¨&lt;/code>ä»&lt;code>Etcd&lt;/code>ä¸­è·å–åˆ°ç›®æ ‡æ ‡ç­¾çš„ &lt;code>POD&lt;/code>ï¼Œç„¶åç»Ÿè®¡ä»–ä»¬çš„æ•°é‡ï¼Œè¿™æ˜¯å®é™…çŠ¶æ€ï¼›&lt;/li>
&lt;li>&lt;code>Deploymentå¯¹è±¡&lt;/code>çš„ &lt;code>Replicas&lt;/code> å­—æ®µçš„å€¼æ˜¯æœŸæœ›çŠ¶æ€ï¼›&lt;/li>
&lt;li>&lt;code>Deploymentæ§åˆ¶å™¨&lt;/code>å°†ä¸¤ä¸ªçŠ¶æ€åšæ¯”è¾ƒï¼Œç„¶åæ ¹æ®æ¯”è¾ƒç»“æœï¼Œç¡®å®šåˆ›å»º&lt;code>POD&lt;/code>è¿˜æ˜¯åˆ é™¤å·²ç»å­˜åœ¨çš„&lt;code>POD&lt;/code>&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>è¿™ä¸ªæ“ä½œå«åšåè°ƒï¼ˆ&lt;code>Reconcile&lt;/code>ï¼‰å³ æ§åˆ¶å¾ªç¯&lt;/p>
&lt;blockquote>
&lt;p>ä¸ºä»€ä¹ˆæ˜¯å¾ªç¯ï¼Œå› ä¸ºäº‹ä»¶å¾€å¾€æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œå¦‚æœæ“ä½œå¤±è´¥æ¯”è¾ƒéš¾å¤„ç†ï¼Œä½†æ˜¯æ§åˆ¶å™¨å¾ªç¯ä¸€ç›´å°è¯•ï¼Œæ›´ç¬¦åˆ Kubernetes å£°æ˜å¼APIï¼Œæœ€ç»ˆè¾¾æˆä¸€è‡´ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>&lt;img src="https://pinkhello.me/%E5%9B%9E%E6%9C%9BK8S/deployment.png" alt="deploymentç»“æ„">&lt;/p>
&lt;p>ä¸ŠåŠéƒ¨åˆ†çš„æ§åˆ¶å™¨å®šä¹‰ï¼ˆåŒ…å«æœŸæœ›çŠ¶æ€ï¼‰ï¼Œä¸‹é¢çš„éƒ¨åˆ†è¢«æ§åˆ¶å¯¹è±¡çš„æ¨¡æ¿ç»„æˆçš„ã€‚&lt;/p>
&lt;h1 id="ä½œä¸šå‰¯æœ¬å’Œæ°´å¹³æ‰©å±•">ä½œä¸šå‰¯æœ¬å’Œæ°´å¹³æ‰©å±•&lt;/h1>
&lt;h2 id="pod-çš„æ°´å¹³æ‰©å±•--æ”¶ç¼©horizontal-scaling-outin">Pod çš„â€œæ°´å¹³æ‰©å±• / æ”¶ç¼©â€ï¼ˆhorizontal scaling out/inï¼‰&lt;/h2>
&lt;p>å¦‚æœæˆ‘ä»¬æ›´æ–°äº† &lt;code>Deployment&lt;/code> çš„ &lt;code>Pod&lt;/code> æ¨¡æ¿ï¼ˆå‡å¦‚æ›´æ–°äº†å®¹å™¨é•œåƒï¼‰ï¼Œé‚£ä¹ˆ &lt;code>Deployment&lt;/code> éœ€è¦éµå¾ªä¸€ç§ &amp;ldquo;æ»šåŠ¨æ›´æ–°&amp;rdquo;ï¼ˆ&lt;code>rolling update&lt;/code>ï¼‰çš„æ–¹å¼æ¥å‡çº§ç°æœ‰çš„å®¹å™¨ã€‚è¿™ä¹Ÿæ˜¯ &lt;code>kubernetes&lt;/code> é‡è¦çš„æ¦‚å¿µï¼ˆAPIå¯¹è±¡ï¼‰ï¼š&lt;code>ReplicaSet&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>apps/v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>ReplicaSet&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>nginx-set&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>nginx&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">replicas&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">3&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">selector&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">matchLabels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>nginx&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">template&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>nginx&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">containers&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>nginx&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">image&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>nginx:1.7.9&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸€ä¸ª &lt;code>ReplicaSet&lt;/code>å¯¹è±¡ï¼Œç”± å‰¯æœ¬æ•°ç›®çš„å®šä¹‰å’Œä¸€ä¸ªPodæ¨¡æ¿ç»„æˆçš„ã€‚å®ƒå…¶å®æ˜¯ &lt;code>Deployment&lt;/code> çš„å­é›†ã€‚è€Œä¸”ï¼Œ&lt;code>Deploymentæ§åˆ¶å™¨&lt;/code>æ“ä½œçš„æ­£æ˜¯ &lt;code>ReplicaSet&lt;/code> å¯¹è±¡ï¼Œè€Œä¸æ˜¯&lt;code>Podå¯¹è±¡&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">kubectl scale
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://pinkhello.me/%E5%9B%9E%E6%9C%9BK8S/replicaset.jpg" alt="ReplicaSetç»“æ„">&lt;/p>
&lt;h2 id="æ»šåŠ¨æ›´æ–°">æ»šåŠ¨æ›´æ–°&lt;/h2>
&lt;p>å°†ä¸€ä¸ªé›†ç¾¤ä¸­æ­£åœ¨è¿è¡Œçš„å¤šä¸ª &lt;code>Pod&lt;/code> ç‰ˆæœ¬ï¼Œäº¤æ›¿åœ°é€ä¸€å‡çº§çš„è¿‡ç¨‹ï¼Œå°±æ˜¯â€œæ»šåŠ¨æ›´æ–°â€ã€‚&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>ä¾èµ– &lt;code>health check&lt;/code> æœºåˆ¶&lt;/li>
&lt;li>ä¿è¯æœåŠ¡çš„è¿ç»­æ€§&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>&lt;img src="https://pinkhello.me/%E5%9B%9E%E6%9C%9BK8S/deployment-replicaset-pod.jpg" alt="DeploymentReplicaSet">&lt;/p>
&lt;p>&lt;code>Deployment&lt;/code> å®é™…ä¸Šæ˜¯ä¸€ä¸ªä¸¤å±‚æ§åˆ¶å™¨ã€‚é¦–å…ˆï¼Œå®ƒé€šè¿‡ &lt;code>ReplicaSet&lt;/code> çš„ä¸ªæ•°æ¥æè¿°åº”ç”¨çš„ç‰ˆæœ¬ï¼›ç„¶åï¼Œå®ƒå†é€šè¿‡ &lt;code>ReplicaSet&lt;/code> çš„å±æ€§ï¼ˆæ¯”å¦‚ &lt;code>replicas&lt;/code> çš„å€¼ï¼‰ï¼Œæ¥ä¿è¯ &lt;code>Pod&lt;/code> çš„å‰¯æœ¬æ•°é‡ã€‚&lt;/p>
&lt;h1 id="æ·±å…¥ç†è§£statefulset">æ·±å…¥ç†è§£StatefulSet&lt;/h1>
&lt;ul>
&lt;li>æ‹“æ‰‘çŠ¶æ€ï¼šåº”ç”¨é—´ä¸å®Œå…¨å¯¹ç­‰ï¼Œéœ€è¦è°å…ˆå¯åŠ¨ï¼Œè°åå¯åŠ¨ï¼Œå¿…é¡»æŒ‰ç…§æŸäº›é¡ºåºæ¥å¯åŠ¨ã€‚ï¼ˆåœ¨&lt;code>Pod&lt;/code>åˆ é™¤å’Œå†åˆ›å»ºä¸­ä¿æŒç¨³å®šï¼‰&lt;/li>
&lt;li>å­˜å‚¨çŠ¶æ€ï¼šå¤šä¸ªå®ä¾‹ç»‘å®šäº†ä¸åŒçš„å­˜å‚¨æ•°æ®ï¼Œä¸€ä¸ªæ•°æ®åº“åº”ç”¨çš„å¤šä¸ªå­˜å‚¨å®ä¾‹&lt;/li>
&lt;/ul>
&lt;h2 id="æ‹“æ‰‘çŠ¶æ€">æ‹“æ‰‘çŠ¶æ€&lt;/h2>
&lt;p>StatefulSet æ ¸å¿ƒåŠŸèƒ½ï¼šé€šè¿‡æŸç§æ–¹å¼çºªå½•è¿™äº›çŠ¶æ€ï¼Œç­‰PODè¢«é‡æ–°åˆ›å»ºæ—¶å€™ï¼Œèƒ½å¤Ÿä¸ºæ–°çš„PODæ¢å¤çŠ¶æ€ã€‚&lt;/p>
&lt;p>Headless Service&lt;/p>
&lt;p>Service æ˜¯ Kubernetes é¡¹ç›®ä¸­ç”¨æ¥å°†ä¸€ç»„ Pod æš´éœ²ç»™å¤–ç•Œè®¿é—®çš„ä¸€ç§æœºåˆ¶ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ª &lt;code>Deployment&lt;/code> æœ‰ &lt;code>3&lt;/code> ä¸ª &lt;code>Pod&lt;/code>ï¼Œé‚£ä¹ˆæˆ‘å°±å¯ä»¥å®šä¹‰ä¸€ä¸ª &lt;code>Service&lt;/code>ã€‚ç„¶åï¼Œç”¨æˆ·åªè¦èƒ½è®¿é—®åˆ°è¿™ä¸ª &lt;code>Service&lt;/code>ï¼Œå®ƒå°±èƒ½è®¿é—®åˆ°æŸä¸ªå…·ä½“çš„ &lt;code>Pod&lt;/code>ã€‚&lt;/p>
&lt;ul>
&lt;li>ç¬¬ä¸€ç§æ–¹å¼ï¼Œæ˜¯ä»¥ &lt;code>Service&lt;/code> çš„ &lt;code>VIP&lt;/code>ï¼ˆ&lt;code>Virtual IP&lt;/code>ï¼Œå³ï¼šè™šæ‹Ÿ IPï¼‰æ–¹å¼ã€‚&lt;/li>
&lt;li>ç¬¬äºŒç§æ–¹å¼ï¼Œå°±æ˜¯ä»¥ &lt;code>Service&lt;/code> çš„ &lt;code>DNS&lt;/code> æ–¹å¼, æ¯”å¦‚ åªè¦æˆ‘è®¿é—®â€œ&lt;code>my-svc.my-namespace.svc.cluster.local&lt;/code>â€è¿™æ¡ DNS è®°å½•ï¼Œå°±å¯ä»¥è®¿é—®åˆ°åå« &lt;code>my-svc&lt;/code> çš„ &lt;code>Service&lt;/code> æ‰€ä»£ç†çš„æŸä¸€ä¸ª &lt;code>Pod&lt;/code>ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;code>Service DNS&lt;/code> ä¸‹ä¸¤ç§å¤„ç†æ–¹æ³•&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>Normal Service&lt;/code>ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½ è®¿é—®â€œmy-svc.my-namespace.svc.cluster.localâ€è§£æåˆ°çš„ï¼Œæ­£æ˜¯ my-svc è¿™ä¸ª Service çš„ VIPï¼Œåé¢çš„æµç¨‹å°±è·Ÿ VIP æ–¹å¼ä¸€è‡´äº†ã€‚
&lt;code>Headless Service&lt;/code>ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½ è®¿é—®â€œmy-svc.my-namespace.svc.cluster.localâ€è§£æåˆ°çš„ï¼Œç›´æ¥å°±æ˜¯ my-svc ä»£ç†çš„æŸä¸€ä¸ª Pod çš„ IP åœ°å€ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„åŒºåˆ«åœ¨äºï¼ŒHeadless Service ä¸éœ€è¦åˆ†é…ä¸€ä¸ª VIPï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥ä»¥ DNS è®°å½•çš„æ–¹å¼è§£æå‡ºè¢«ä»£ç† Pod çš„ IP åœ°å€ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>Headless Service Yaml&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Service&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>nginx&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>nginx&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">ports&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">port&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">80&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>web&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">clusterIP&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>None&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">selector&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>nginx&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>StatefulSet Yaml&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>apps/v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>StatefulSet&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>web&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># å¤šäº†è¿™ä¸ª ServiceName å°±æ˜¯å‘Šè¯‰ StatefulSet æ§åˆ¶å™¨ï¼Œåœ¨æ‰§è¡Œæ§åˆ¶å¾ªç¯ï¼ˆControl Loopï¼‰çš„æ—¶å€™ï¼Œè¯·ä½¿ç”¨ nginx è¿™ä¸ª Headless Service æ¥ä¿è¯ Pod çš„â€œå¯è§£æèº«ä»½â€ã€‚&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">serviceName&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;nginx&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">replicas&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">2&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">selector&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">matchLabels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>nginx&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">template&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>nginx&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">containers&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>nginx&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">image&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>nginx:1.9.1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">ports&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">containerPort&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">80&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>web&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ï¼Œå¯¹äºâ€œæœ‰çŠ¶æ€åº”ç”¨â€å®ä¾‹çš„è®¿é—®ï¼Œä½ å¿…é¡»ä½¿ç”¨ &lt;code>DNS è®°å½•&lt;/code>æˆ–è€… &lt;code>hostname&lt;/code> çš„æ–¹å¼ï¼Œè€Œç»ä¸åº”è¯¥ç›´æ¥è®¿é—®è¿™äº› &lt;code>Pod&lt;/code> çš„ IP åœ°å€ã€‚&lt;/p>
&lt;h2 id="å­˜å‚¨çŠ¶æ€">å­˜å‚¨çŠ¶æ€&lt;/h2>
&lt;p>&lt;code>StatefulSet&lt;/code> å­˜å‚¨çŠ¶æ€çš„ç®¡ç†æœºåˆ¶ï¼Œä¸»è¦ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªå«åš &lt;code>Persistent Volume Claim&lt;/code> åŠŸèƒ½ã€‚&lt;/p>
&lt;p>è¦åœ¨ä¸€ä¸ª Pod é‡Œé¢å£°æ˜ Volumeï¼Œåªè¦åœ¨ Pod é‡ŒåŠ ä¸Š &lt;code>spec.volumes&lt;/code> å­—æ®µï¼Œç„¶åå°±å¯ä»¥åœ¨è¿™ä¸ªå­—æ®µé‡Œé¢å®šä¹‰ä¸€ä¸ªå…·ä½“çš„ç±»å‹çš„ &lt;code>Volume&lt;/code>ã€‚æ¯”å¦‚ &lt;code>hostPath&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;code>Kubernetes&lt;/code> é¡¹ç›®å¼•å…¥äº†ä¸€ç»„å«ä½œ &lt;code>Persistent Volume Claim&lt;/code>ï¼ˆPVCï¼‰å’Œ &lt;code>Persistent Volume&lt;/code>ï¼ˆPVï¼‰çš„ API å¯¹è±¡ï¼Œå¤§å¤§é™ä½äº†ç”¨æˆ·å£°æ˜å’Œä½¿ç”¨æŒä¹…åŒ– &lt;code>Volume&lt;/code> çš„é—¨æ§›ã€‚&lt;/p>
&lt;p>ä½¿ç”¨PVCçš„ä¸¤æ­¥ï¼š&lt;/p>
&lt;ul>
&lt;li>å®šä¹‰ä¸€ä¸ª &lt;code>PVC&lt;/code>ï¼Œå£°æ˜æƒ³è¦çš„ &lt;code>Volume&lt;/code> å±æ€§&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>PersistentVolumeClaim&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>pv-claim&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">accessModes&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- ReadWriteOnce&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># æŒ‚è½½æ–¹å¼ï¼šå¯è¯»å†™ï¼Œå¹¶ä¸”åªèƒ½è¢«æŒ‚è½½åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œéå¤šä¸ªèŠ‚ç‚¹å…±äº«&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">resources&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">requests&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">storage&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>1Gi &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22">#å­˜å‚¨å¤§å°&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>åœ¨åº”ç”¨ &lt;code>POD&lt;/code> ä¸­ï¼Œä½¿ç”¨è¿™ä¸ª &lt;code>PVC&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Pod&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>pv-pod&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">containers&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>pv-container&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">image&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>nginx&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">ports&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">containerPort&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">80&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;http-server&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">volumeMounts&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">mountPath&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;/usr/share/nginx/html&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>pv-storage&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">volumes&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>pv-storage&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">persistentVolumeClaim&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">claimName&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>pv-claim&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># æŒ‡å®šä¸Šé¢çš„PVCçš„åå­—&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»ä¸Šé¢æ¥çœ‹ï¼Œè¿™ä¸ª &lt;code>Volume&lt;/code> åˆä»ä½•è€Œæ¥å‘¢ï¼Ÿï¼ˆè¿ç»´äººå‘˜ç»´æŠ¤çš„ &lt;code>PV&lt;/code>ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#228b22"># è¿™ä¸ª PV å¯¹è±¡çš„ spec.rbd å­—æ®µï¼Œæ­£æ˜¯æˆ‘ä»¬å‰é¢ä»‹ç»è¿‡çš„ Ceph RBD Volume çš„è¯¦ç»†å®šä¹‰ã€‚è€Œä¸”ï¼Œå®ƒè¿˜å£°æ˜äº†è¿™ä¸ª PV çš„å®¹é‡æ˜¯ 10 GiBã€‚è¿™æ ·ï¼ŒKubernetes å°±ä¼šä¸ºæˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ PVC å¯¹è±¡ç»‘å®šè¿™ä¸ª PV&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>PersistentVolume&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>pv-volume&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">type&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>local&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">capacity&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">storage&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>10Gi&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">accessModes&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- ReadWriteOnce&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">rbd&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">monitors&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># ä½¿ç”¨ kubectl get pods -n rook-ceph æŸ¥çœ‹ rook-ceph-mon- å¼€å¤´çš„ POD IP å³å¯å¾—ä¸‹é¢çš„åˆ—è¡¨&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#cd5555">&amp;#39;10.16.154.78:6789&amp;#39;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#cd5555">&amp;#39;10.16.154.82:6789&amp;#39;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#cd5555">&amp;#39;10.16.154.83:6789&amp;#39;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">pool&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kube&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">image&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>foo&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">fsType&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>ext4&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">readOnly&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">user&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>admin&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">keyring&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>/etc/ceph/keyring&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰€ä»¥ &lt;code>Kubernetes&lt;/code> ä¸­çš„ &lt;code>PVC&lt;/code> å’Œ &lt;code>PV&lt;/code> çš„è®¾è®¡ï¼Œç±»ä¼¼äº &amp;ldquo;æ¥å£&amp;rdquo; å’Œ &amp;ldquo;å®ç°&amp;rdquo; çš„æ€æƒ³ï¼Œè¿™ç§è§£è€¦ï¼Œé¿å…äº†æš´éœ²ç³»ç»Ÿæ›´å¤šçš„ç»†èŠ‚ï¼Œä¹Ÿæ˜¯èŒè´£çš„åˆ†ç¦»ï¼Œæ›´å®¹æ˜“å®šä½é—®é¢˜&lt;/p>
&lt;h2 id="statefulset-çš„å·¥ä½œåŸç†">StatefulSet çš„å·¥ä½œåŸç†&lt;/h2>
&lt;ul>
&lt;li>&lt;code>StatefulSet&lt;/code> æ§åˆ¶å™¨ç›´æ¥ç®¡ç†çš„æ˜¯ &lt;code>POD&lt;/code>&lt;/li>
&lt;li>&lt;code>Kubernetes&lt;/code> é€šè¿‡ &lt;code>Headless Service&lt;/code> ä¸ºè¿™äº›æœ‰ç¼–å·çš„ &lt;code>POD&lt;/code>ã€‚åœ¨ &lt;code>DNS&lt;/code> æœåŠ¡å™¨ä¼—ç”ŸæˆåŒæ ·å¸¦æœ‰ç¼–å·çš„ &lt;code>DNSçºªå½•&lt;/code>ã€‚åªè¦ &lt;code>StatefulSet&lt;/code> èƒ½å¤Ÿä¿è¯è¿™äº› &lt;code>POD&lt;/code> çš„åå­—ç¼–å·ä¸å˜ï¼Œç±»ä¼¼ &amp;ldquo;&lt;code>web-0.default.svc.cluster.local&lt;/code>&amp;rdquo; è¿™æ ·çš„ &lt;code>DNSçºªå½•&lt;/code> å°±ä¸ä¼šå˜ï¼Œè€Œè¿™æ¡çºªå½•è§£æå‡ºæ¥çš„&lt;code>POD&lt;/code>çš„&lt;code>IP&lt;/code>åœ°å€ï¼Œä¼šéšç€&lt;code>åç«¯çš„PODåˆ é™¤å’Œå†åˆ›å»º&lt;/code>è€Œæ›´æ–°ã€‚&lt;/li>
&lt;li>&lt;code>StatefulSet&lt;/code> è¿˜ä¸ºæ¯ä¸ª &lt;code>POD&lt;/code> åˆ†é…å¹¶åˆ›å»ºä¸€ä¸ªåŒæ ·ç¼–å·çš„ &lt;code>PVC&lt;/code>ï¼Œè¿™æ · &lt;code>Kubernetes&lt;/code> å¯ä»¥é€šè¿‡ &lt;code>Persistent Volume&lt;/code> æœºåˆ¶ä¸ºè¿™ä¸ª &lt;code>PVC&lt;/code> ç»‘å®šå¯¹åº”çš„ &lt;code>PV&lt;/code>ï¼Œä¿è¯ä¸€ä¸ª&lt;code>POD&lt;/code>éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ &lt;code>Volume&lt;/code>ï¼ˆå³ä½¿&lt;code>POD&lt;/code>è¢«åˆ é™¤ï¼Œä½†æ˜¯å¯¹åº”çš„ &lt;code>PVC&lt;/code> å’Œ &lt;code>PV&lt;/code> ä¿ç•™ä¸‹æ¥ï¼Œé‡æ–°åˆ›å»º&lt;code>POD&lt;/code>çš„æ—¶å€™ï¼Œè¿˜ä¼šæ‰¾å›æ¥ï¼Œæ•°æ®è¿˜å­˜åœ¨ï¼‰&lt;/li>
&lt;/ul>
&lt;h1 id="å®¹å™¨åŒ–å®ˆæŠ¤è¿›ç¨‹çš„æ„ä¹‰-daemonset">å®¹å™¨åŒ–å®ˆæŠ¤è¿›ç¨‹çš„æ„ä¹‰ DaemonSet&lt;/h1>
&lt;p>&lt;code>DaemonSet&lt;/code> ä¸»è¦çš„ä½œç”¨: åœ¨&lt;code>Kubernetes&lt;/code>é›†ç¾¤é‡Œè¿è¡Œä¸€ä¸ª &lt;code>Daemon Pod&lt;/code>,è¿™ä¸ª&lt;code>Pod&lt;/code>ä¸‰ä¸ªç‰¹å¾&lt;/p>
&lt;ul>
&lt;li>æ¯ä¸ª&lt;code>Kubernetes&lt;/code>èŠ‚ç‚¹éƒ½ä¼šè¿è¡Œä¸€ä¸ªè¿™æ ·çš„&lt;code>POD&lt;/code>&lt;/li>
&lt;li>æ¯ä¸ªèŠ‚ç‚¹ä¸Šåªæœ‰ä¸€ä¸ªè¿™æ ·çš„ &lt;code>Pod&lt;/code> å®ä¾‹&lt;/li>
&lt;li>å½“æœ‰æ–°çš„èŠ‚ç‚¹åŠ å…¥ &lt;code>Kuberntes&lt;/code> é›†ç¾¤åï¼Œè¯¥ &lt;code>Pod&lt;/code> ä¼šè‡ªåŠ¨çš„åœ¨æ–°çš„èŠ‚ç‚¹ä¸Šè¢«åˆ›å»ºå‡ºæ¥ï¼Œè€Œå½“æ—§èŠ‚ç‚¹è¢«åˆ é™¤å, å®ƒä¸Šé¢çš„ Pod ä¹Ÿä¼šç›¸åº”åœ°è¢«å›æ”¶æ‰ã€‚&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>egï¼š&lt;/p>
&lt;ul>
&lt;li>ç½‘ç»œæ’ä»¶çš„ Agent ç»„ä»¶ï¼Œå¿…é¡»è¿è¡Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œç”¨æ¥å¤„ç†å®¹å™¨çš„ç½‘ç»œ&lt;/li>
&lt;li>å­˜å‚¨æ’ä»¶ Agent ç»„ä»¶ï¼Œå¿…é¡»è¿è¡Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œç”¨æ¥æŒ‚è½½è¿œç¨‹å­˜å‚¨ç›®å½•ï¼Œæ“ä½œå®¹å™¨çš„ Volume ç›®å½•&lt;/li>
&lt;li>ç›‘æ§ç»„ä»¶ ä»¥åŠ æ—¥å¿—ç»„ä»¶ï¼Œä¹Ÿæ˜¯ä¸€æ ·ï¼Œè´Ÿè´£èŠ‚ç‚¹çš„ç›‘æ§ä¿¡æ¯å’Œæ—¥å¿—æ”¶é›†&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>è·Ÿå…¶ä»–ç¼–æ’ä¸ä¸€æ ·ï¼ŒDaemonSet å¼€å§‹è¿è¡Œçš„æ—¶æœºï¼Œå¾ˆå¤šæ—¶å€™æ¯”æ•´ä¸ª Kubernetes é›†ç¾¤å‡ºç°çš„è¿˜è¦æ—©ã€‚æ¯”å¦‚å®¹å™¨ç½‘ç»œç»„ä»¶ï¼Œåœ¨æ‰€æœ‰çš„ WorkerèŠ‚ç‚¹çŠ¶æ€éƒ½æ˜¯ NotReadyã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#228b22"># fluentd-elasticsearch é•œåƒPODï¼Œ é€šè¿‡ Fluentd å°† Docker å®¹å™¨æ—¥å¿—è½¬å‘åˆ° ES å†…ã€‚&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>apps/v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>DaemonSet&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>fluentd-elasticsearch&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">namespace&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kube-system&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">k8s-app&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>fluentd-logging&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">selector&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">matchLabels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>fluentd-elasticsearch&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">template&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>fluentd-elasticsearch&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">tolerations&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">key&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>node-role.kubernetes.io/master&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">effect&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>NoSchedule&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">containers&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>fluentd-elasticsearch&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">image&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>k8s.gcr.io/fluentd-elasticsearch:1.20&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">resources&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">limits&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">memory&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>200Mi&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">requests&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">cpu&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>100m&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">memory&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>200Mi&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># æŒ‚è½½äº†ä¸¤ä¸ªhostPathç±»å‹ çš„ Volume &lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">volumeMounts&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>varlog&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">mountPath&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>/var/log&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># Docker å®¹å™¨é‡Œåº”ç”¨çš„æ—¥å¿—ï¼Œé»˜è®¤ä¼šä¿å­˜åœ¨å®¿ä¸»æœºçš„ /var/lib/docker/containers/{{. å®¹å™¨ ID}}/{{. å®¹å™¨ ID}}-json.log æ–‡ä»¶é‡Œï¼Œæ‰€ä»¥è¿™ä¸ªç›®å½•æ­£æ˜¯ fluentd çš„æœé›†ç›®æ ‡ &lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>varlibdockercontainers&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">mountPath&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>/var/lib/docker/containers&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">readOnly&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">terminationGracePeriodSeconds&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">30&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">volumes&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>varlog&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">hostPath&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">path&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>/var/log&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>varlibdockercontainers&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">hostPath&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">path&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>/var/lib/docker/containers&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>DaemonSet Controller&lt;/code>ï¼Œé¦–å…ˆä» &lt;code>Etcd&lt;/code> é‡Œè·å–æ‰€æœ‰çš„ &lt;code>Node&lt;/code> åˆ—è¡¨ï¼Œç„¶åéå†æ‰€æœ‰çš„ &lt;code>Node&lt;/code>ã€‚è¿™æ—¶å°±ä¼šå»æ£€æŸ¥è¿™ä¸ª&lt;code>Node&lt;/code>ä¸Šæ˜¯ä¸æ˜¯å·²ç»å­˜åœ¨æºå¸¦äº† &lt;code>name=fluentd-elasticsearch&lt;/code> çš„ &lt;code>POD&lt;/code> åœ¨è¿è¡Œäº†&lt;/p>
&lt;ul>
&lt;li>æ²¡æœ‰è¿™ä¸ªPODï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ POD&lt;/li>
&lt;li>æœ‰è¿™ç§PODï¼Œæ•°é‡ &amp;gt; 1, åˆ é™¤å¤šä½™çš„&lt;/li>
&lt;li>æ­£å¥½ä¸€ä¸ªï¼ŒèŠ‚ç‚¹æ­£å¸¸&lt;/li>
&lt;/ul>
&lt;p>&lt;code>DaemonSet&lt;/code> ä¼šè‡ªåŠ¨åŠ ä¸Š &lt;code>tolerations&lt;/code>å­—æ®µ&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Pod&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>with-toleration&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># â€œå®¹å¿â€æ‰€æœ‰è¢«æ ‡è®°ä¸º unschedulableâ€œæ±¡ç‚¹â€çš„ Nodeï¼›â€œå®¹å¿â€çš„æ•ˆæœæ˜¯å…è®¸è°ƒåº¦ã€‚&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">tolerations&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">key&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>node.kubernetes.io/unschedulable&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">operator&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Exists&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">effect&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>NoSchedule&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¢«æ ‡è®°äº† unschedulableâ€œæ±¡ç‚¹â€çš„ Nodeï¼Œæ˜¯ä¸ä¼šæœ‰ä»»ä½• Pod è¢«è°ƒåº¦ä¸Šå»çš„ï¼ˆeffect: NoScheduleï¼‰ã€‚å¯æ˜¯ï¼ŒDaemonSet è‡ªåŠ¨åœ°ç»™è¢«ç®¡ç†çš„ Pod åŠ ä¸Šäº†è¿™ä¸ªç‰¹æ®Šçš„ Tolerationï¼Œå°±ä½¿å¾—è¿™äº› Pod å¯ä»¥å¿½ç•¥è¿™ä¸ªé™åˆ¶ï¼Œç»§è€Œä¿è¯æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½ä¼šè¢«è°ƒåº¦ä¸€ä¸ª Podã€‚å½“ç„¶ï¼Œå¦‚æœè¿™ä¸ªèŠ‚ç‚¹æœ‰æ•…éšœçš„è¯ï¼Œè¿™ä¸ª Pod å¯èƒ½ä¼šå¯åŠ¨å¤±è´¥ï¼Œè€Œ DaemonSet åˆ™ä¼šå§‹ç»ˆå°è¯•ä¸‹å»ï¼Œç›´åˆ° Pod å¯åŠ¨æˆåŠŸã€‚&lt;/p>
&lt;h1 id="ç¦»çº¿ä¸šåŠ¡-job-ä¸-cronjob">ç¦»çº¿ä¸šåŠ¡ Job ä¸ CronJob&lt;/h1>
&lt;p>åƒåœ¨çº¿ä¸šåŠ¡è¯¸å¦‚åº”ç”¨ä¸€ç±»çš„ï¼ŒæŠ½ç¦»äº†æè¿°ç¦»çº¿ä¸šåŠ¡çš„APIå¯¹è±¡ï¼šJob&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>batch/v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Job&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>pi&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">template&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">containers&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>pi&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">image&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>resouer/ubuntu-bc &lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">command&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>[&lt;span style="color:#cd5555">&amp;#34;sh&amp;#34;&lt;/span>,&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;-c&amp;#34;&lt;/span>,&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;echo &amp;#39;scale=10000; 4*a(1)&amp;#39; | bc -l &amp;#34;&lt;/span>]&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">restartPolicy&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Never&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">backoffLimit&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#b452cd">4&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">
$ kubectl describe jobs/pi
Name: pi
Namespace: default
Selector: controller-uid=c2db599a-2c9d-11e6-b324-0209dc45a495
Labels: controller-uid=c2db599a-2c9d-11e6-b324-0209dc45a495
job-name=pi
Annotations: &amp;lt;none&amp;gt;
Parallelism: &lt;span style="color:#b452cd">1&lt;/span>
Completions: &lt;span style="color:#b452cd">1&lt;/span>
..
Pods Statuses: &lt;span style="color:#b452cd">0&lt;/span> Running / &lt;span style="color:#b452cd">1&lt;/span> Succeeded / &lt;span style="color:#b452cd">0&lt;/span> Failed
Pod Template:
Labels: controller-uid=c2db599a-2c9d-11e6-b324-0209dc45a495
job-name=pi
Containers:
...
Volumes: &amp;lt;none&amp;gt;
Events:
FirstSeen LastSeen Count From SubobjectPath Type Reason Message
--------- -------- ----- ---- ------------- -------- ------ -------
1m 1m &lt;span style="color:#b452cd">1&lt;/span> {job-controller } Normal SuccessfulCreate Created pod: pi-rq5rl
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ª Job å¯¹è±¡åœ¨åˆ›å»ºåï¼Œå®ƒçš„ Pod æ¨¡æ¿ï¼Œè¢«è‡ªåŠ¨åŠ ä¸Šäº†ä¸€ä¸ª controller-uid=&amp;lt; ä¸€ä¸ªéšæœºå­—ç¬¦ä¸² &amp;gt; è¿™æ ·çš„ Labelã€‚è€Œè¿™ä¸ª Job å¯¹è±¡æœ¬èº«ï¼Œåˆ™è¢«è‡ªåŠ¨åŠ ä¸Šäº†è¿™ä¸ª Label å¯¹åº”çš„ Selectorï¼Œä»è€Œ ä¿è¯äº† Job ä¸å®ƒæ‰€ç®¡ç†çš„ Pod ä¹‹é—´çš„åŒ¹é…å…³ç³»ã€‚è€Œ Job Controller ä¹‹æ‰€ä»¥è¦ä½¿ç”¨è¿™ç§æºå¸¦äº† UID çš„ Labelï¼Œå°±æ˜¯ä¸ºäº†é¿å…ä¸åŒ Job å¯¹è±¡æ‰€ç®¡ç†çš„ Pod å‘ç”Ÿé‡åˆã€‚&lt;/p>
&lt;p>å¦‚æœä½œä¸šå¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ&lt;/p>
&lt;p>å®šä¹‰äº† restartPolicy=Neverï¼Œé‚£ä¹ˆç¦»çº¿ä½œä¸šå¤±è´¥å Job Controller å°±ä¼šä¸æ–­åœ°å°è¯•åˆ›å»ºä¸€ä¸ªæ–° Pod
æˆ‘ä»¬å°±åœ¨ Job å¯¹è±¡çš„ spec.backoffLimit å­—æ®µé‡Œå®šä¹‰äº†é‡è¯•æ¬¡æ•°ä¸º 4ï¼ˆå³ï¼ŒbackoffLimit=4ï¼‰ï¼Œè€Œè¿™ä¸ªå­—æ®µçš„é»˜è®¤å€¼æ˜¯ 6ã€‚
å®šä¹‰çš„ restartPolicy=OnFailureï¼Œé‚£ä¹ˆç¦»çº¿ä½œä¸šå¤±è´¥åï¼ŒJob Controller å°±ä¸ä¼šå»å°è¯•åˆ›å»ºæ–°çš„ Podã€‚ä½†æ˜¯ï¼Œå®ƒä¼šä¸æ–­åœ°å°è¯•é‡å¯ Pod é‡Œçš„å®¹å™¨&lt;/p>
&lt;p>Job å¯¹è±¡ä¸­ï¼Œå¹¶è¡Œä½œä¸šçš„æ§åˆ¶æ–¹æ³•&lt;/p>
&lt;ul>
&lt;li>1ã€spec.parallelismï¼Œå®ƒå®šä¹‰çš„æ˜¯ä¸€ä¸ª Job åœ¨ä»»æ„æ—¶é—´æœ€å¤šå¯ä»¥å¯åŠ¨å¤šå°‘ä¸ª Pod åŒæ—¶è¿è¡Œï¼›&lt;/li>
&lt;li>2ã€spec.completionsï¼Œå®ƒå®šä¹‰çš„æ˜¯ Job è‡³å°‘è¦å®Œæˆçš„ Pod æ•°ç›®ï¼Œå³ Job çš„æœ€å°å®Œæˆæ•°ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="å¸¸ç”¨çš„ä½¿ç”¨-jobå¯¹è±¡çš„æ–¹æ³•">å¸¸ç”¨çš„ä½¿ç”¨ Jobå¯¹è±¡çš„æ–¹æ³•&lt;/h2>
&lt;ul>
&lt;li>å¤–éƒ¨ç®¡ç†å™¨ + Jobæ¨¡æ¿ ï¼ˆsedï¼‰&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>batch/v1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Job&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># å¸¦éå†æ›¿æ¢&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>process-item-$ITEM&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">jobgroup&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>jobexample&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">template&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>jobexample&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">labels&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">jobgroup&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>jobexample&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">containers&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>c&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">image&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>busybox&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">command&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>[&lt;span style="color:#cd5555">&amp;#34;sh&amp;#34;&lt;/span>,&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;-c&amp;#34;&lt;/span>,&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;echo Processing item $ITEM &amp;amp;&amp;amp; sleep 5&amp;#34;&lt;/span>]&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">restartPolicy&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>Never&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>
&lt;p>æ‹¥æœ‰å›ºå®šä»»åŠ¡æ•°ç›®çš„å¹¶è¡ŒJob&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æŒ‡å®šå¹¶è¡Œåº¦ï¼ˆparallelismï¼‰ï¼Œä½†ä¸è®¾ç½®å›ºå®šçš„ completions çš„å€¼ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="cronjob-å¯¹è±¡">CronJob å¯¹è±¡&lt;/h2>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>batch/v1beta1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>CronJob&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">metadata&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>hello&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># cron &lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">schedule&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;*/1 * * * *&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">jobTemplate&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">template&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">spec&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">containers&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#8b008b;font-weight:bold">name&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>hello&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">image&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>busybox&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">args&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- /bin/sh&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- -c&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- date; echo Hello from the Kubernetes cluster&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">restartPolicy&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>OnFailure&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>CronJob æ˜¯ä¸“é—¨ç®¡ç† Job å¯¹è±¡çš„æ§åˆ¶å…¶ã€‚åªä¸è¿‡å®ƒçš„åˆ›å»ºå’Œåˆ é™¤Jobä¾æ®æ˜¯æ ¹æ®
schedule å­—æ®µæ¥å®šä¹‰çš„ã€‚&lt;/p>
&lt;p>åœ¨ å®šæ—¶ä»»åŠ¡çš„æ—¶å€™ï¼Œå¯èƒ½æœ‰ä»»åŠ¡æœªæ‰§è¡Œå®Œæ¯•ï¼Œå°±ä¸‹é¢çš„Podå¯åŠ¨&lt;/p>
&lt;ul>
&lt;li>concurrencyPolicy=Allowï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤æƒ…å†µï¼Œè¿™æ„å‘³ç€è¿™äº› Job å¯ä»¥åŒæ—¶å­˜åœ¨ï¼›&lt;/li>
&lt;li>concurrencyPolicy=Forbidï¼Œè¿™æ„å‘³ç€ä¸ä¼šåˆ›å»ºæ–°çš„ Podï¼Œè¯¥åˆ›å»ºå‘¨æœŸè¢«è·³è¿‡ï¼›&lt;/li>
&lt;li>concurrencyPolicy=Replaceï¼Œè¿™æ„å‘³ç€æ–°äº§ç”Ÿçš„ Job ä¼šæ›¿æ¢æ—§çš„ã€æ²¡æœ‰æ‰§è¡Œå®Œçš„ Jobã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#228b22"># startingDeadlineSeconds=200ï¼Œæ„å‘³ç€åœ¨è¿‡å» 200 s é‡Œï¼Œå¦‚æœ miss çš„æ•°ç›®è¾¾åˆ°äº† 100 æ¬¡ï¼Œé‚£ä¹ˆè¿™ä¸ª Job å°±ä¸ä¼šè¢«åˆ›å»ºæ‰§è¡Œäº†&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>spec.startingDeadlineSeconds æ—¶é—´çª—å£&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>- https://pinkhello.me/posts/20-%E5%9B%9E%E6%9C%9Bk8s-%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92%E4%B8%8Ekubernetes%E4%BD%9C%E4%B8%9A%E7%AE%A1%E7%90%86/ - PinkHello, All Rights Reserved</description></item><item><title>å›æœ›K8S Kubernetesæ‹¼å›¾</title><link>https://pinkhello.me/posts/19-%E5%9B%9E%E6%9C%9Bk8s-kubernetes%E6%8B%BC%E5%9B%BE/</link><pubDate>Sun, 16 Feb 2020 20:57:38 +0800</pubDate><guid>https://pinkhello.me/posts/19-%E5%9B%9E%E6%9C%9Bk8s-kubernetes%E6%8B%BC%E5%9B%BE/</guid><description>PinkHello https://pinkhello.me/posts/19-%E5%9B%9E%E6%9C%9Bk8s-kubernetes%E6%8B%BC%E5%9B%BE/ -&lt;h1 id="kubernetes-å®‰è£…">&lt;code>kubernetes&lt;/code> å®‰è£…&lt;/h1>
&lt;h2 id="all-èŠ‚ç‚¹å®‰è£…-docker-å’Œ-kubeadm">all èŠ‚ç‚¹å®‰è£… &lt;code>Docker&lt;/code> å’Œ &lt;code>Kubeadm&lt;/code>&lt;/h2>
&lt;p>æ‰€æœ‰èŠ‚ç‚¹ &lt;code>root&lt;/code> ç”¨æˆ·ä¸‹æ“ä½œ&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&amp;gt; curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -
&amp;gt; cat &lt;span style="color:#cd5555">&amp;lt;&amp;lt;EOF &amp;gt; /etc/apt/sources.list.d/kubernetes.list
&lt;/span>&lt;span style="color:#cd5555">deb http://apt.kubernetes.io/ kubernetes-xenial main
&lt;/span>&lt;span style="color:#cd5555">EOF&lt;/span>
&amp;gt; apt-get update
&lt;span style="color:#228b22"># è¿™ä¸€æ­¥å®‰è£…çš„æ—¶å€™ kubeadm å’Œ kubeletã€kubectlã€kubernetes-cni éƒ½ä¼šè‡ªåŠ¨å®‰è£…å®Œæ¯•&lt;/span>
&amp;gt; apt-get install -y docker.io kubeadm
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>æç¤ºï¼šå¦‚æœ &lt;code>apt.kubernetes.io&lt;/code> å› ä¸ºç½‘ç»œé—®é¢˜è®¿é—®ä¸åˆ°ï¼Œå¯ä»¥æ¢æˆä¸­ç§‘å¤§çš„ &lt;code>Ubuntu&lt;/code> é•œåƒæº deb &lt;a href="http://mirrors.ustc.edu.cn/kubernetes/apt">http://mirrors.ustc.edu.cn/kubernetes/apt&lt;/a> kubernetes-xenial mainã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="éƒ¨ç½²-kubernetes-master">éƒ¨ç½² &lt;code>Kubernetes&lt;/code> &lt;code>Master&lt;/code>&lt;/h2>
&lt;p>å£°æ˜ä¸€ä¸ª &lt;code>kubeadm.yaml&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="color:#008b45;text-decoration:underline">---&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>kubeadm.k8s.io/v1alpha1&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kind&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>MasterConfiguration&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">controllerManagerExtraArgs&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#228b22"># é…ç½®äº†è‡ªå®šä¹‰è‡ªåŠ¨æ°´å¹³æ‰©å±•&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">horizontal-pod-autoscaler-use-rest-clients&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;true&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">horizontal-pod-autoscaler-sync-period&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;10s&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">node-monitor-grace-period&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;10s&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">apiServerExtraArgs&lt;/span>:&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#8b008b;font-weight:bold">runtime-config&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;api/all=true&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#228b22"># kubeadm éƒ¨ç½²çš„ kubernetes çš„ç‰ˆæœ¬&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">kubernetesVersion&lt;/span>:&lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#cd5555">&amp;#34;stable-1.11&amp;#34;&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>Â·Â·Â·&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤ï¼Œå®Œæˆ &lt;code>kubernetes&lt;/code> &lt;code>master&lt;/code> éƒ¨ç½²ï¼Œè¿™å›ç”Ÿæˆä¸€è¡ŒæŒ‡ä»¤&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&amp;gt; kubeadm init --config kubeadm.yaml
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">kubeadm join 10.168.0.2:6443 --token 00bwbx.uvnaa2ewjflwu1ry --discovery-token-ca-cert-hash sha256:00eb62a2a6020f94132e3fe1ab721349bbcd3e9b94da9654cfe15f2985ebd711
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ª &lt;code>kubeadm join&lt;/code> å‘½ä»¤, ç”¨æ¥ç»™è¿™ä¸ª &lt;code>Master&lt;/code> èŠ‚ç‚¹æ·»åŠ æ›´å¤šçš„ &lt;code>Worker&lt;/code> èŠ‚ç‚¹.&lt;/p>
&lt;p>å¦å¤– &lt;code>kubeadm&lt;/code> ä¼šæç¤ºæˆ‘ä»¬ç¬¬ä¸€æ¬¡ä½¿ç”¨ &lt;code>kubernetes&lt;/code> é›†ç¾¤æ‰€éœ€è¦çš„é…ç½®å‘½ä»¤:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&amp;gt; mkdir -p &lt;span style="color:#00688b">$HOME&lt;/span>/.kube
&amp;gt; sudo cp -i /etc/kubernetes/admin.conf &lt;span style="color:#00688b">$HOME&lt;/span>/.kube/config
&amp;gt; sudo chown &lt;span style="color:#8b008b;font-weight:bold">$(&lt;/span>id -u&lt;span style="color:#8b008b;font-weight:bold">)&lt;/span>:&lt;span style="color:#8b008b;font-weight:bold">$(&lt;/span>id -g&lt;span style="color:#8b008b;font-weight:bold">)&lt;/span> &lt;span style="color:#00688b">$HOME&lt;/span>/.kube/config
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å› ä¸º &lt;code>Kubernetes&lt;/code> é›†ç¾¤é»˜è®¤éœ€è¦åŠ å¯†æ–¹å¼è®¿é—®ï¼Œæ‰€ä»¥ï¼Œéœ€è¦å°†åˆšåˆšéƒ¨ç½²ç”Ÿæˆçš„ &lt;code>kubernetes&lt;/code> é›†ç¾¤å®‰å…¨é…ç½®æ–‡ä»¶ï¼Œä¿å­˜åˆ°å½“å‰ç”¨æˆ·çš„ &lt;code>.kube&lt;/code> ç›®å½•ä¸‹, &lt;code>kubectl&lt;/code> é»˜è®¤ä¼šä½¿ç”¨è¿™ä¸ªç›®å½•ä¸‹çš„æˆæƒä¿¡æ¯è¿›è¡Œè®¿é—®&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&lt;span style="color:#228b22">#æŸ¥çœ‹kubernetesé›†ç¾¤çš„èŠ‚ç‚¹çŠ¶æ€&lt;/span>
&amp;gt; kubectl get nodes
NAME STATUS ROLES AGE VERSION
master NotReady master 1d v1.11.1
&lt;span style="color:#228b22"># NotReady å› ä¸ºè¿˜æ²¡æœ‰éƒ¨ç½²ä»»ä½•ç½‘ç»œæ’ä»¶&lt;/span>
&amp;gt; kubectl describe node master
...
Conditions:
...
Ready False ... KubeletNotReady runtime network not ready: &lt;span style="color:#00688b">NetworkReady&lt;/span>=&lt;span style="color:#658b00">false&lt;/span> reason:NetworkPluginNotReady message:docker: network plugin is not ready: cni config uninitialized
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&amp;gt; kubectl get pods -n kube-system
NAME READY STATUS RESTARTS AGE
coredns-78fcdf6894-j9s52 0/1 Pending &lt;span style="color:#b452cd">0&lt;/span> 1h
coredns-78fcdf6894-jm4wf 0/1 Pending &lt;span style="color:#b452cd">0&lt;/span> 1h
etcd-master 1/1 Running &lt;span style="color:#b452cd">0&lt;/span> 2s
kube-apiserver-master 1/1 Running &lt;span style="color:#b452cd">0&lt;/span> 1s
kube-controller-manager-master 0/1 Pending &lt;span style="color:#b452cd">0&lt;/span> 1s
kube-proxy-xbd47 1/1 NodeLost &lt;span style="color:#b452cd">0&lt;/span> 1h
kube-scheduler-master 1/1 Running &lt;span style="color:#b452cd">0&lt;/span> 1s
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="éƒ¨ç½²-å®¹å™¨ç½‘ç»œæ’ä»¶">éƒ¨ç½² å®¹å™¨ç½‘ç»œæ’ä»¶&lt;/h2>
&lt;p>åœ¨ &lt;code>kubernetes&lt;/code> å†…éƒ¨é‡Œé¢ &lt;code>ä¸€åˆ‡çš†å®¹å™¨&lt;/code> è®¾è®¡æ–¹å¼ï¼Œéƒ¨ç½²ç½‘ç»œæ’ä»¶éå¸¸ç®€å•,ä»¥ &lt;code>Weave&lt;/code> ä¸ºä¾‹å­&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&amp;gt; kubectl apply -f https://git.io/weave-kube-1.6
&lt;/code>&lt;/pre>&lt;/div>&lt;p>éƒ¨ç½²å®Œæ¯•å, é€šè¿‡ &lt;code>kubectl get&lt;/code> æ£€æŸ¥ &lt;code>POD&lt;/code> çŠ¶æ€&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&amp;gt; kubectl get pods -n kube-system
NAME READY STATUS RESTARTS AGE
coredns-78fcdf6894-j9s52 1/1 Running &lt;span style="color:#b452cd">0&lt;/span> 1d
coredns-78fcdf6894-jm4wf 1/1 Running &lt;span style="color:#b452cd">0&lt;/span> 1d
etcd-master 1/1 Running &lt;span style="color:#b452cd">0&lt;/span> 9s
kube-apiserver-master 1/1 Running &lt;span style="color:#b452cd">0&lt;/span> 9s
kube-controller-manager-master 1/1 Running &lt;span style="color:#b452cd">0&lt;/span> 9s
kube-proxy-xbd47 1/1 Running &lt;span style="color:#b452cd">0&lt;/span> 1d
kube-scheduler-master 1/1 Running &lt;span style="color:#b452cd">0&lt;/span> 9s
weave-net-cmk27 2/2 Running &lt;span style="color:#b452cd">0&lt;/span> 19s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è€Œåˆšåˆšéƒ¨ç½²çš„ &lt;code>Weave&lt;/code> ç½‘ç»œæ’ä»¶åˆ™åœ¨ &lt;code>kube-system&lt;/code> ä¸‹é¢æ–°å»ºäº†ä¸€ä¸ªåå« &lt;code>weave-net-cmk27&lt;/code> çš„ &lt;code>Pod&lt;/code>ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™äº› &lt;code>Pod&lt;/code> å°±æ˜¯å®¹å™¨ç½‘ç»œæ’ä»¶åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„æ§åˆ¶ç»„ä»¶ã€‚&lt;/p>
&lt;p>&lt;code>Kubernetes&lt;/code> çš„æ”¯æŒçš„å®¹å™¨ç½‘ç»œæ’ä»¶ï¼Œä½¿ç”¨çš„ &lt;code>CNI&lt;/code> çš„é€šç”¨æ¥å£ï¼Œå½“å‰å¼€æºçš„å®¹å™¨ç½‘ç»œæ’ä»¶æœ‰&lt;/p>
&lt;ul>
&lt;li>&lt;code>Flannel&lt;/code> è¿™ä¸ªé‡‡ç”¨åº”è¯¥æ¯”è¾ƒå¤šçš„&lt;/li>
&lt;li>&lt;code>Calico&lt;/code>&lt;/li>
&lt;li>&lt;code>Canal&lt;/code>&lt;/li>
&lt;li>&lt;code>Romana&lt;/code>&lt;/li>
&lt;/ul>
&lt;h2 id="éƒ¨ç½²-kubernetes-worker">éƒ¨ç½² &lt;code>Kubernetes&lt;/code> &lt;code>Worker&lt;/code>&lt;/h2>
&lt;p>&lt;code>Worker&lt;/code> èŠ‚ç‚¹çš„éƒ¨ç½² å’Œ &lt;code>Master&lt;/code> èŠ‚ç‚¹çš„è¿è¡Œçš„ç¨‹åºå‡ ä¹ç›¸åŒ, éƒ½è¿è¡Œè¿™ &lt;code>kubelet&lt;/code> ç»„ä»¶ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ &lt;code>kubelet&lt;/code> å¯åŠ¨åï¼Œ&lt;code>Master&lt;/code> èŠ‚ç‚¹éœ€è¦è‡ªåŠ¨è¿è¡Œ &lt;code>kube-apiserver&lt;/code>ï¼Œ&lt;code>kube-scheduler&lt;/code>ï¼Œ&lt;code>kube-controller-manager&lt;/code> ä¸‰ä¸ª &lt;code>Pod&lt;/code>&lt;/p>
&lt;p>æ‰§è¡Œéƒ¨ç½²&lt;code>Master&lt;/code>æ—¶å€™ç”Ÿæˆçš„ &lt;code>kubeadm join&lt;/code> æŒ‡ä»¤&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&amp;gt; kubeadm join 10.168.0.2:6443 --token 00bwbx.uvnaa2ewjflwu1ry --discovery-token-ca-cert-hash sha256:00eb62a2a6020f94132e3fe1ab721349bbcd3e9b94da9654cfe15f2985ebd711
&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡ &lt;code>Taint/Toleration&lt;/code> è°ƒæ•´ &lt;code>Master&lt;/code> æ‰§è¡Œ &lt;code>Pod&lt;/code> çš„ç­–ç•¥&lt;/p>
&lt;blockquote>
&lt;p>é»˜è®¤æƒ…å†µä¸‹ &lt;code>Master&lt;/code> èŠ‚ç‚¹æ˜¯ä¸å…è®¸è¿è¡Œç”¨æˆ· &lt;code>Pod&lt;/code> çš„ã€‚è€Œ &lt;code>Kubernetes&lt;/code> åšåˆ°è¿™ä¸€ç‚¹ï¼Œä¾é çš„æ˜¯ &lt;code>Kubernetes&lt;/code> çš„ Taint/Toleration æœºåˆ¶ã€‚&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>å®ƒçš„åŸç†éå¸¸ç®€å•ï¼šä¸€æ—¦æŸä¸ªèŠ‚ç‚¹è¢«åŠ ä¸Šäº†ä¸€ä¸ª Taintï¼Œå³è¢«â€œæ‰“ä¸Šäº†æ±¡ç‚¹â€ï¼Œé‚£ä¹ˆæ‰€æœ‰ Pod å°±éƒ½ä¸èƒ½åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œå› ä¸º Kubernetes çš„ Pod éƒ½æœ‰â€œæ´ç™–â€ã€‚é™¤éï¼Œæœ‰ä¸ªåˆ«çš„ Pod å£°æ˜è‡ªå·±èƒ½â€œå®¹å¿â€è¿™ä¸ªâ€œæ±¡ç‚¹â€ï¼Œå³å£°æ˜äº† Tolerationï¼Œå®ƒæ‰å¯ä»¥åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œã€‚å…¶ä¸­ï¼Œä¸ºèŠ‚ç‚¹æ‰“ä¸Šâ€œæ±¡ç‚¹â€ï¼ˆTaintï¼‰çš„å‘½ä»¤æ˜¯ï¼škubectl taint nodes node1 foo=bar:NoSchedule&lt;/p>
&lt;/blockquote>
&lt;p>é»˜è®¤æƒ…å†µä¸‹ &lt;code>Master&lt;/code> èŠ‚ç‚¹æ˜¯ä¸å…è®¸è¿è¡Œç”¨æˆ· &lt;code>Pod&lt;/code> çš„, å¯ä»¥é€šè¿‡ &lt;code>kubectl describe&lt;/code> æ£€æŸ¥ä¸€ä¸‹ &lt;code>Master&lt;/code> èŠ‚ç‚¹çš„ &lt;code>Taint&lt;/code> å­—æ®µ&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&amp;gt; kubectl describe node master
Name: master
Roles: master
Taints: node-role.kubernetes.io/master:NoSchedule
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œ&lt;code>Master&lt;/code> èŠ‚ç‚¹é»˜è®¤è¢«åŠ ä¸Šäº† &lt;code>node-role.kubernetes.io/master:NoSchedule&lt;/code> è¿™æ ·ä¸€ä¸ªâ€œæ±¡ç‚¹â€ï¼Œå…¶ä¸­â€œé”®â€æ˜¯ &lt;code>node-role.kubernetes.io/master&lt;/code>ï¼Œè€Œæ²¡æœ‰æä¾›â€œå€¼â€ã€‚&lt;/p>
&lt;p>å½“ç„¶ï¼Œå¦‚æœä½ å°±æ˜¯æƒ³è¦ä¸€ä¸ªå•èŠ‚ç‚¹çš„ &lt;code>Kubernetes&lt;/code>ï¼Œåˆ é™¤è¿™ä¸ª &lt;code>Taint&lt;/code> æ‰æ˜¯æ­£ç¡®çš„é€‰æ‹©ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&lt;span style="color:#228b22"># â€œnode-role.kubernetes.io/masterâ€è¿™ä¸ªé”®åé¢åŠ ä¸Šäº†ä¸€ä¸ªçŸ­æ¨ªçº¿â€œ-â€ï¼Œè¿™ä¸ªæ ¼å¼å°±æ„å‘³ç€ç§»é™¤æ‰€æœ‰ä»¥â€œnode-role.kubernetes.io/masterâ€ä¸ºé”®çš„ Taintã€‚&lt;/span>
&amp;gt; kubectl taint nodes --all node-role.kubernetes.io/master-
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="éƒ¨ç½²-dashboard-å¯è§†åŒ–æ’ä»¶">éƒ¨ç½² &lt;code>Dashboard&lt;/code> å¯è§†åŒ–æ’ä»¶&lt;/h2>
&lt;p>&lt;code>Web&lt;/code> é¡µé¢å±•ç¤ºä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ–¹é¢ï¼Œèƒ½å¯è§†åŒ–çš„æŸ¥çœ‹é›†ç¾¤çš„å„ç§ä¿¡æ¯&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&amp;gt; kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-rc6/aio/deploy/recommended.yaml
&amp;gt; kubectl get pods -n kube-system
kubernetes-dashboard-6948bdb78-f67xk 1/1 Running &lt;span style="color:#b452cd">0&lt;/span> 1m
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Dashboard&lt;/code> é¡¹ç›®éƒ¨ç½²å®Œæˆåï¼Œé»˜è®¤åªèƒ½é€šè¿‡ &lt;code>Proxy&lt;/code> çš„æ–¹å¼åœ¨æœ¬åœ°è®¿é—®&lt;/p>
&lt;h2 id="éƒ¨ç½²-å®¹å™¨å­˜å‚¨æ’ä»¶">éƒ¨ç½² å®¹å™¨å­˜å‚¨æ’ä»¶&lt;/h2>
&lt;p>&lt;code>Kubernetes&lt;/code> æ¾è€¦åˆçš„è®¾è®¡ï¼Œæ‰€ä»¥ç»å¤§å¤šæ•°å­˜å‚¨é¡¹ç›®éƒ½å¯ä»¥ä¸º &lt;code>Kubernetes&lt;/code> æä¾›æŒä¹…åŒ–å­˜å‚¨èƒ½åŠ›.&lt;/p>
&lt;ul>
&lt;li>&lt;code>Ceph&lt;/code>&lt;/li>
&lt;li>&lt;code>GlusterFS&lt;/code>&lt;/li>
&lt;li>&lt;code>NFS&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>Rook&lt;/code> æ’ä»¶æ˜¯åŸºäº &lt;code>Ceph&lt;/code> çš„ &lt;code>Kubernetes&lt;/code> å­˜å‚¨æ’ä»¶ï¼Œ&lt;code>Rook&lt;/code> åœ¨è‡ªå·±çš„å®ç°ä¸­åŠ å…¥äº†æ°´å¹³æ‰©å±•ã€è¿ç§»ã€ç¾å¤‡ã€ç›‘æ§ç­‰å¤§é‡çš„ä¼ä¸šçº§åŠŸèƒ½ï¼Œè¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ï¼Œå¯ä»¥åº”ç”¨åœ¨ç”Ÿäº§ä¸Šçš„å®¹å™¨å­˜å‚¨æ’ä»¶&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&amp;gt; kubectl apply -f https://raw.githubusercontent.com/rook/rook/master/cluster/examples/kubernetes/ceph/common.yaml
&amp;gt; kubectl apply -f https://raw.githubusercontent.com/rook/rook/master/cluster/examples/kubernetes/ceph/operator.yaml
&amp;gt; kubectl apply -f https://raw.githubusercontent.com/rook/rook/master/cluster/examples/kubernetes/ceph/cluster.yaml
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨éƒ¨ç½²å®Œæˆåï¼Œä½ å°±å¯ä»¥çœ‹åˆ° &lt;code>Rook&lt;/code> é¡¹ç›®ä¼šå°†è‡ªå·±çš„ &lt;code>Pod&lt;/code> æ”¾ç½®åœ¨ç”±å®ƒè‡ªå·±ç®¡ç†çš„ä¸¤ä¸ª &lt;code>Namespace&lt;/code> å½“ä¸­ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&amp;gt; kubectl get pods -n rook-ceph-system
NAME READY STATUS RESTARTS AGE
rook-ceph-agent-7cv62 1/1 Running &lt;span style="color:#b452cd">0&lt;/span> 15s
rook-ceph-operator-78d498c68c-7fj72 1/1 Running &lt;span style="color:#b452cd">0&lt;/span> 44s
rook-discover-2ctcv 1/1 Running &lt;span style="color:#b452cd">0&lt;/span> 15s
&amp;gt; kubectl get pods -n rook-ceph
NAME READY STATUS RESTARTS AGE
rook-ceph-mon0-kxnzh 1/1 Running &lt;span style="color:#b452cd">0&lt;/span> 13s
rook-ceph-mon1-7dn2t 1/1 Running &lt;span style="color:#b452cd">0&lt;/span> 2s
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·ï¼Œä¸€ä¸ªåŸºäº &lt;code>Rook&lt;/code> æŒä¹…åŒ–å­˜å‚¨é›†ç¾¤å°±ä»¥å®¹å™¨çš„æ–¹å¼è¿è¡Œèµ·æ¥äº†ï¼Œè€Œæ¥ä¸‹æ¥åœ¨ &lt;code>Kubernetes&lt;/code> é¡¹ç›®ä¸Šåˆ›å»ºçš„æ‰€æœ‰ &lt;code>Pod&lt;/code> å°±èƒ½å¤Ÿé€šè¿‡ &lt;code>Persistent Volume&lt;/code>ï¼ˆPVï¼‰å’Œ &lt;code>Persistent Volume Claim&lt;/code>ï¼ˆPVCï¼‰çš„æ–¹å¼ï¼Œåœ¨å®¹å™¨é‡ŒæŒ‚è½½ç”± &lt;code>Ceph&lt;/code> æä¾›çš„æ•°æ®å·äº†ã€‚&lt;/p>
- https://pinkhello.me/posts/19-%E5%9B%9E%E6%9C%9Bk8s-kubernetes%E6%8B%BC%E5%9B%BE/ - PinkHello, All Rights Reserved</description></item></channel></rss>