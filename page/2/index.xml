<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>PinkHello</title><link>https://pinkhello.me/</link><description>Recent content on PinkHello</description><generator>Hugo -- gohugo.io</generator><language>zh</language><copyright>PinkHello, All Rights Reserved</copyright><lastBuildDate>Sun, 21 Mar 2021 23:10:20 +0800</lastBuildDate><atom:link href="https://pinkhello.me/index.xml" rel="self" type="application/rss+xml"/><item><title>12 èŠèŠè™è Chat</title><link>https://pinkhello.me/posts/12-%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0chat/</link><pubDate>Wed, 10 Feb 2021 09:10:14 +0800</pubDate><guid>https://pinkhello.me/posts/12-%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0chat/</guid><description>PinkHello https://pinkhello.me/posts/12-%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0chat/ -&lt;hr>
&lt;p>title: è€å¸æœºèŠèŠBatChat
date: 2021-01-31 21:37:07
tags:&lt;/p>
&lt;ul>
&lt;li>BatChat/åŠ å¯†èŠå¤©&lt;/li>
&lt;/ul>
&lt;hr>
&lt;!-- raw HTML omitted -->
&lt;p>ä»Šå¤©ï¼Œåœ¨æµè§ˆ&lt;code>å°ä¼—è½¯ä»¶&lt;/code>çš„æ—¶å€™ï¼Œçªç„¶çœ‹è§ä¸€ä¸ªæ—©æœŸå°ç¼–çš„æ¨å¹¿ï½ï½ï½è™è APPï¼Œè”æƒ³åˆ°ä¹‹å‰æ–°é—»ä¸­çœ‹åˆ°çš„æœ‰ä¸ªè´©å–ä¸ªäººä¿¡æ¯çš„äººè¯´åœ¨è™è APPä¸Šï¼Œå‹¾èµ·äº†æˆ‘çš„å¥½å¥‡å¿ƒï¼Œä½œä¸ºä¸€ä¸ªç¨‹åºğŸ¶ï¼Œé»˜é»˜çš„æƒ³æ¢ç©¶ä¸€ä¸‹è¿™ä¸ªè™è APPç©çš„ä»€ä¹ˆå¥—è·¯ã€‚&lt;/p>
&lt;h1 id="ä»€ä¹ˆæ˜¯è™è batchat">ä»€ä¹ˆæ˜¯è™è ï¼ˆBatChatï¼‰&lt;/h1>
&lt;p>ä¸€æ¬¾å…è´¹çš„ç«¯åˆ°ç«¯åŠ å¯†çš„è™è APPï¼Œéšæ—¶ç•…èŠï¼
åº”ç”¨ IOSã€Android
&lt;a href="https://batchat.com">https://batchat.com&lt;/a>&lt;/p>
&lt;h1 id="å®ƒçš„ç‰¹æ€§">å®ƒçš„ç‰¹æ€§&lt;/h1>
&lt;ul>
&lt;li>å®‰å…¨ ï½œ ç•…èŠæ—¶ã€ç«¯åˆ°ç«¯åŠ å¯†ï¼ˆæ‰€æœ‰æ¶ˆæ¯ç»è¿‡ç«¯åˆ°ç«¯åŠ å¯†ï¼Œä»»ä½•èŠå¤©è®°å½•ä¸è¿›è¡Œäº‘å­˜å‚¨ï¼Œè®©ä½ çš„ä¿¡æ¯æƒ³è±¡ä¸­æ›´å®‰å…¨ï¼‰&lt;/li>
&lt;li>éšç§ ï½œ ç•…èŠæ—¶ã€åŒå‘æ’¤å›ï¼ˆèŠå¤©è®°å½•ä¸€é”®åŒå‘æ’¤å›ï¼ŒåŒæ—¶åˆ é™¤ä½ å’Œå¯¹æ–¹è®¾å¤‡ä¸Šæ‰€æœ‰çš„èŠå¤©è®°å½•ï¼Œæ’¤å›æ•°æ®å¤šæ¬¡è¦†ç›–åˆ é™¤ã€ä¸å¯æ¢å¤ã€ä¿è¯åŒæ–¹çš„éšç§å®‰å…¨ï¼‰&lt;/li>
&lt;li>åŒ¿åç¾¤èŠ ï½œ å¼€å¯åŒ¿åç¾¤èŠï¼Œç¾¤é‡Œé¢çš„æ¯ä¸€ä¸ªæˆå‘˜éƒ½å¯ä»¥&amp;quot;å˜èº«&amp;quot;ï¼Œéšè—çœŸå®èº«ä»½ï¼Œç¾¤å†…ä¸å—èº«ä»½çº¦æŸ&lt;/li>
&lt;/ul>
&lt;h1 id="ä»€ä¹ˆæ˜¯ç«¯åˆ°ç«¯åŠ å¯†">ä»€ä¹ˆæ˜¯ç«¯åˆ°ç«¯åŠ å¯†ï¼Ÿ&lt;/h1>
&lt;p>ç«¯åˆ°ç«¯åŠ å¯†æ˜¯åœ¨æºç»“ç‚¹å’Œç›®çš„ç»“ç‚¹ä¸­å¯¹ä¼ é€çš„æ•°æ®è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼Œ å› æ­¤æ•°æ®çš„å®‰å…¨æ€§ä¸ä¼šå› ä¸­é—´ç»“ç‚¹çš„ä¸å¯é è€Œå—åˆ°å½±å“ã€‚&lt;code> è™è APPçš„æ‰€æœ‰æ•°æ®éƒ½é€šè¿‡ç”¨æˆ·ç«¯ç”Ÿæˆçš„ç§é’¥è¿›è¡ŒåŠ å¯†åå†å‘é€ï¼Œä»»ä½•ç¬¬ä¸‰æ–¹åŒ…æ‹¬å¼€å‘è€…éƒ½ä¸èƒ½è§£å¼€æ­¤æ•°æ®&lt;/code>.&lt;/p>
&lt;h1 id="è™è appé‡‡ç”¨çš„å®‰å…¨å±‚çº§">è™è APPé‡‡ç”¨çš„å®‰å…¨å±‚çº§ï¼Ÿ&lt;/h1>
&lt;ul>
&lt;li>
&lt;p>é€šé“åŠ å¯†
é€šé“åŠ å¯†ä¸­é‡‡ç”¨äº†å“ªäº›åŠ å¯†ç®—æ³•ï¼Ÿ
é€šé“åŠ å¯†ä¸­ä½¿ç”¨åˆ°çš„ RSA, ECDHE, AES256_CBC, SHA256, SHA1ç­‰ç­‰(å¦‚ä¸‹å›¾)ã€‚&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E9%80%9A%E9%81%93%E5%8A%A0%E5%AF%86.png" alt="é€šé“åŠ å¯†">
æ­¥éª¤:&lt;/p>
&lt;ul>
&lt;li>(1. å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å…ˆäº§ç”Ÿéšæœºæ•°&lt;/li>
&lt;li>(2. æœåŠ¡å™¨ä¸‹å‘éšæœºæ•°ã€‚&lt;/li>
&lt;li>(3. å®¢æˆ·ç«¯ç”¨ RSA å¯¹å®¢æˆ·ç«¯éšæœºæ•°è¿›è¡ŒåŠ å¯†ï¼Œå¹¶å‘é€ç»™æœåŠ¡å™¨ã€‚&lt;/li>
&lt;li>(4. æœåŠ¡å™¨ç”¨ RSA è§£å¯†å®¢æˆ·ç«¯éšæœºæ•°ï¼ˆä½¿ç”¨ RSA çš„ç›®çš„æ˜¯é˜²æ­¢ä¸­é—´äººæ”»å‡»ï¼‰ã€‚&lt;/li>
&lt;li>(5. å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨ç”¨è‡ªå·±çš„éšæœºæ•°åŠ ä¸Šå¯¹æ–¹çš„éšæœºæ•°ç”Ÿæˆä¸´æ—¶å¯†é’¥ TempKey å’Œä¸´æ—¶åç§»é‡ TempIV (æ­¤æ—¶åŒæ–¹å‡æŒæœ‰ç›¸åŒçš„ TempKeyå’ŒTempIV)ã€‚&lt;/li>
&lt;li>(6. å®¢æˆ·ç«¯æœåŠ¡å™¨å‡ä½¿ç”¨ ECDHE ç”Ÿæˆå„è‡ªçš„å…¬ç§é’¥å¯¹ã€‚&lt;/li>
&lt;li>(7. å®¢æˆ·ç«¯ç”¨ TempKey, TempIV å¯¹è‡ªå·±çš„ ECDHE å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œå¹¶å°†å¯†æ–‡å‘é€ç»™æœåŠ¡å™¨ã€‚&lt;/li>
&lt;li>(8. æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„ ECDHE å…¬é’¥å¯†æ–‡ï¼Œå¹¶è§£å¯†ã€‚&lt;/li>
&lt;li>(9. æœåŠ¡å™¨ä½¿ç”¨ TempKey, TempIV å¯¹è‡ªå·±çš„ ECDHE å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œå¹¶ä½¿ç”¨ RSA å¯¹ ECDHEã€‚&lt;/li>
&lt;li>(10. æœåŠ¡å™¨ä½¿ç”¨ ECDHE ç®—æ³•ï¼Œä½¿ç”¨å®¢æˆ·ç«¯ ECDHE å…¬é’¥æ˜æ–‡+æœåŠ¡å™¨ ECDHE ç§é’¥æ˜æ–‡ç”ŸæˆShareKeyã€‚&lt;/li>
&lt;li>(11. å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„ ECDHE å…¬é’¥å¯†æ–‡å’Œç­¾åï¼Œç„¶åè¿›è¡Œè§£å¯†å’ŒéªŒè¯ç­¾åï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œå°±ä½¿ç”¨å®¢æˆ·ç«¯ ECDHE ç§é’¥æ˜æ–‡+æœåŠ¡å™¨ECDHE å…¬é’¥æ˜æ–‡ç”Ÿæˆ ShareKeyã€‚&lt;/li>
&lt;li>(12. æœåŠ¡å™¨åˆå§‹åŒ–å„ä¸ªå‚æ•°ï¼Œä¸‹å‘ç»™å®¢æˆ·ç«¯,å‚æ•°åŒ…å«ï¼š
&lt;ul>
&lt;li>
&lt;p>AuthKeyIDï¼š æœåŠ¡å™¨éšæœºç”Ÿæˆçš„å®¢æˆ·ç«¯ä¸´æ—¶æ ‡è¯†ç¬¦&lt;/p>
&lt;/li>
&lt;li>
&lt;p>MsgKeyï¼š ç”± ShareKey, AuthkeyID, MsgID, SessionID, Salt, SeqNo ä»¥åŠçœŸå®çš„æ¶ˆæ¯å†…å®¹ç›¸åŠ åè¿›è¡Œ Sha256 åçš„å€¼&lt;/p>
&lt;blockquote>
&lt;p>æœ¬å‚æ•°ç”¨äºï¼š&lt;/p>
&lt;blockquote>
&lt;p>(a. è¿›è¡Œé˜²æ­¢æ•°æ®ç¯¡æ”¹çš„éªŒè¯&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>(b. ä¸ ShareKey ä¸€èµ·ä½¿ç”¨ï¼Œç”Ÿæˆ Aes256 key, IVï¼Œç”¨æ¥å¯¹å„æ¡æ¶ˆæ¯è¿›è¡ŒåŠ å¯†ã€‚&lt;/p>
&lt;/blockquote>
&lt;/blockquote>
&lt;/li>
&lt;li>
&lt;p>MsgIDï¼šæ—¶é—´ç›¸å…³çš„æ¶ˆæ¯ IDï¼Œç”¨äºé˜²æ­¢é‡æ”¾å’Œå»é‡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>SessionIDï¼šæ¯æ¬¡ç™»å½•å”¯ä¸€çš„ä¼šè¯ IDã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Saltï¼šæ¯æ¬¡ç™»å½•å”¯ä¸€çš„ç›å€¼ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>SeqNoï¼šç”¨äºé˜²æ­¢é‡æ”¾ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>(13. åç»­æ¯æ¡æ¶ˆæ¯å‡ä¼šæœ‰ä¸åŒçš„ MsgID, SessionID, Salt, SeqNo å’ŒçœŸå®çš„æ¶ˆæ¯å†…å®¹ï¼›è¿™äº›å˜åŒ–çš„å€¼ä¼šå¯¼è‡´ MsgKey æ¯æ¬¡éƒ½ä¸åŒã€‚ è¿™ä¸ªæ¯æ¬¡éƒ½ ä¸åŒçš„ MsgKey åŠ ä¸Š ShareKey å¯ä»¥ä¸ºæ¯ä¸€æ¡æ¶ˆæ¯ç”Ÿæˆå¯¹åº”çš„ 32 å­—èŠ‚å¯†é’¥å’Œåç§»é‡ã€‚&lt;/li>
&lt;li>(14. ShareKey ä¼šè¿‡æœŸï¼Œè¿‡æœŸåéœ€è¦é‡æ–°è¿›è¡Œå¯†é’¥åå•†ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å†…å®¹åŠ å¯†&lt;/p>
&lt;ul>
&lt;li>(1. ç”¨æˆ·ç”Ÿæˆ ECDHE å…¬ç§é’¥ï¼Œä¿å­˜åœ¨æœ¬åœ°ã€‚&lt;/li>
&lt;li>(2. å°†å…¬é’¥å‘é€åˆ°æœåŠ¡å™¨ï¼Œç§é’¥ä¿å­˜åœ¨æœ¬åœ°ã€‚&lt;/li>
&lt;li>(3. ç”¨æˆ·ç™»å½•ï¼Œè·å–æ‰€æœ‰å¥½å‹ä¿¡æ¯çš„æ›´æ–°ï¼ŒåŒ…å«æ¯ä¸ªå¥½å‹çš„å…¬é’¥ã€‚&lt;/li>
&lt;li>(4. å‘é€æ¶ˆæ¯ï¼Œå’Œæ¥æ”¶æ¶ˆæ¯æ—¶å‡é‡‡ç”¨è‡ªå·±çš„ç§é’¥+å¯¹æ–¹çš„å…¬é’¥ç”Ÿæˆ ShareKeyã€‚&lt;/li>
&lt;li>(5. ä½¿ç”¨ ShareKey ç”Ÿæˆ AES256 çš„å¯†é’¥ï¼Œè¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://pinkhello.me/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86.png" alt="å†…å®¹åŠ å¯†">&lt;/p>
&lt;p>è™è  åŒæ£˜è½®ç®—æ³• å¦‚ä¸‹ï¼š
Alice(A)å‘é€çš„æ¶ˆæ¯ä¼ é€äº†å¥¹çš„æ–°å…¬é’¥ã€‚ æœ€ç»ˆï¼ŒBob(B)å°†æ”¶åˆ°ä»¥ä¸‹æ¶ˆæ¯ä¹‹ä¸€ï¼Œå¹¶æ‰§è¡Œç¬¬äºŒä¸ªDHæ£˜è½®æ­¥éª¤ï¼› åœ¨æ¯ä¸ªDHæ£˜è½®æ­¥éª¤ä¸­ç”Ÿæˆçš„DH è¾“å‡ºç”¨äºå¯¼å‡ºæ–°çš„å‘é€å’Œæ¥æ”¶é“¾å¯†é’¥ã€‚å½“å„æ–¹è½®æµæ‰§è¡ŒDHæ£˜è½®æ­¥éª¤æ—¶ï¼Œä»–ä»¬è½®æµå¼•å…¥æ–°çš„å‘é€é“¾ï¼Œä¾æ­¤ç±»æ¨ã€‚&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E5%8F%8C%E6%A3%98%E8%BD%AE%E7%AE%97%E6%B3%95.png" alt="åŒæ£˜è½®ç®—æ³•">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æœåŠ¡å™¨æ•°æ®åº“å®‰å…¨&lt;/p>
&lt;ul>
&lt;li>(1. æ•°æ®åº“æœ‰ç­¾åå­—æ®µã€‚&lt;/li>
&lt;li>(2. æœåŠ¡å™¨ä¸Šç”Ÿæˆ ECDSA å…¬ç§é’¥ã€‚&lt;/li>
&lt;li>(3. æœåŠ¡å™¨ä»£ç ä¸­å¯¹æ•°æ®åº“æ•æ„Ÿå­—æ®µï¼Œæ¯”å¦‚ï¼špassword, userID, friend ç­‰åšå¢åˆ æ”¹æ“ä½œæ—¶å‡é€šè¿‡ ECDSA ç”Ÿæˆç­¾åï¼Œå¹¶æ›´æ–°åˆ°ç­¾åå­—æ®µã€‚&lt;/li>
&lt;li>(4. æœåŠ¡å™¨ä»£ç å¯¹ password, userID, friend ç­‰æ•°æ®è¿›è¡Œè¯»å–ï¼Œåˆ¤æ–­ç­‰æ“ä½œæ—¶è¿›è¡Œ ECDSAéªŒè¯ç­¾åï¼Œåªæœ‰é€šè¿‡éªŒè¯æ‰èƒ½è¿›è¡Œåç»­æµç¨‹ï¼Œå¦åˆ™ ç»™å®¢æˆ·ç«¯æŠ¥é”™ã€‚&lt;/li>
&lt;li>(5. æœåŠ¡ç«¯ç¨‹åºè¿›è¡ŒåŠ å¯†å’Œç­¾åä¿æŠ¤ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h1 id="å¥½äº†ä¸Šé¢çš„éƒ½æ˜¯æ‘˜è‡ª-batchat-å®˜ç½‘ä»‹ç»ç°åœ¨è¿›å…¥æ­£é¢˜">å¥½äº†ï¼Œä¸Šé¢çš„éƒ½æ˜¯æ‘˜è‡ª BatChat å®˜ç½‘ä»‹ç»ï¼ç°åœ¨è¿›å…¥æ­£é¢˜ï¼&lt;/h1>
&lt;p>å…ˆæ¥ä¸€ä¸ªé‡ç£…&lt;/p>
&lt;blockquote>
&lt;p>ã€Šç½‘ç»œå®‰å…¨æ³•ã€‹ ç¬¬äºŒåä¸€æ¡è§„å®šï¼Œç½‘ç»œè¿è¥è€…åº”å½“æŒ‰ç…§ç½‘ç»œå®‰å…¨ç­‰çº§ä¿æŠ¤åˆ¶åº¦çš„è¦æ±‚,å±¥è¡Œå®‰å…¨ä¿æŠ¤ä¹‰åŠ¡,ä¿éšœç½‘ç»œå…å—å¹²æ‰°ã€ç ´åæˆ–è€…æœªç»æˆæƒçš„è®¿é—®,é˜²æ­¢ç½‘ç»œæ•°æ®æ³„éœ²æˆ–è€…è¢«çªƒå–ã€ç¯¡æ”¹ã€‚ç½‘ç»œè¿è¥è€…çš„å®‰å…¨ä¹‰åŠ¡åŒ…æ‹¬é‡‡å–ç›‘æµ‹ã€è®°å½•ç½‘ç»œè¿è¡ŒçŠ¶æ€ã€ç½‘ç»œå®‰å…¨äº‹ä»¶çš„æŠ€æœ¯æªæ–½,å¹¶æŒ‰ç…§è§„å®šç•™å­˜ç›¸å…³çš„ç½‘ç»œæ—¥å¿—ä¸å°‘äºå…­ä¸ªæœˆã€‚&lt;/p>
&lt;/blockquote>
&lt;p>å˜¿å˜¿ ï¼ŒæŒ‰ç…§å°å¼Ÿçš„ç†è§£ï¼Œ&lt;code>BatChat&lt;/code> å·ç§°ç«¯åˆ°ç«¯åŠ å¯†ï¼Œé‚£ä¹ˆä¿¡æ¯åŠ å¯†å’Œå›½å†…å¤‡æ¡ˆæ˜æ˜¾å†²çªäº†ï¼Œæ‰€ä»¥è¦ä¹ˆè¿™å…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯å‡çš„ï¼Œè¦ä¹ˆå°±æ˜¯åœ¨è¿&lt;code>æ³•&lt;/code>çš„è¾¹ç¼˜ç–¯ç‹‚è¯•æ¢ã€‚&lt;/p>
&lt;p>æ­£å› ä¸ºçœ‹åˆ°è¿™äº›ï¼Œæ‰€ä»¥å°å¼Ÿé»˜é»˜çš„ &lt;code>Download&lt;/code> äº†ä¸‹æ¥, ç„¶åé»˜é»˜çš„ &lt;code>Install&lt;/code>, ç„¶åé»˜é»˜çš„æ³¨å†Œç™»å½•è¿›å…¥äº† ğŸ˜¯ ğŸ’ ï½ï½ï½ï½&lt;/p>
&lt;p>è¿›å…¥æ˜¯åŸºç¡€TabåŠŸèƒ½èœå•&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/app-%E6%88%91%E7%9A%84.png" alt="app">&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/app-%E8%81%94%E7%B3%BB%E4%BA%BA.jpeg" alt="app">&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/app-%E8%9D%99%E8%9D%A0%E6%88%91%E7%9A%84.png" alt="app">&lt;/p>
&lt;p>è¿›å…¥ç¬é—´çš„å†…å®¹ï¼Œæˆ‘å‘µå‘µå’¯ï½ï½&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E7%9E%AC%E9%97%B4-%E8%BF%9D%E8%A7%84.jpeg" alt="app">&lt;/p>
&lt;p>æœ‰æ²¡æœ‰çœ‹å‡ºæ¥ä»€ä¹ˆï¼Œäººè„¸è¯†åˆ«è‡ªåŠ¨è¯†åˆ«é€ å‡ï¼ˆé»‘ç°äº§ä¸šé“¾ï¼‰&lt;/p>
&lt;p>ä¸‹é¢æ˜¯æˆ‘çš„ä¸€äº›æˆªå›¾ï¼Œä½ ä»¬è‡ªå·±çœ‹å’¯&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ ‡ç­¾æœç´¢ ç‚¹å‡»æ¢ä¸€ç»„ï¼Œè¿™æ˜¯å®˜æ–¹çš„æ¨èçš„ã€‚&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E6%A0%87%E7%AD%BE%E6%90%9C%E7%B4%A21.jpeg" alt="æ ‡ç­¾">&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E6%A0%87%E7%AD%BE%E6%90%9C%E7%B4%A22.jpeg" alt="æ ‡ç­¾">&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E6%A0%87%E7%AD%BE%E6%90%9C%E7%B4%A23.jpeg" alt="æ ‡ç­¾">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æœç´¢æ•æ„Ÿè¯ç¾¤&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E7%BE%A4%E6%90%9C%E7%B4%A2%E6%94%AF%E4%BB%98.jpeg" alt="ç¾¤æœç´¢">&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E7%BE%A4%E6%90%9C%E7%B4%A2%E7%A6%8F%E5%88%A9.jpeg" alt="ç¾¤æœç´¢">&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E7%BE%A4%E6%90%9C%E7%B4%A2%E8%8F%A0%E8%8F%9C%E5%A4%9A.jpeg" alt="ç¾¤æœç´¢">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æˆ‘é»˜é»˜çš„åŠ äº†ä¸€ä¸ªçœ‹ä¼¼æ­£å¸¸çš„ç¾¤ï¼Œè¿›ç¾¤åæˆ‘é£åŒ–äº†ï¼ï¼ï¼ï¼&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E7%BE%A4%E8%BF%9D%E8%A7%84%E5%86%85%E5%AE%B91.jpeg" alt="è¿›ç¾¤ä¿¡æ¯">&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E7%BE%A4%E8%BF%9D%E8%A7%84%E5%86%85%E5%AE%B92.jpeg" alt="è¿›ç¾¤ä¿¡æ¯">&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E8%BF%9D%E8%A7%84%E7%BE%A4%E5%86%85%E5%AE%B95.png" alt="è¿›ç¾¤ä¿¡æ¯">&lt;/p>
&lt;p>ä¸‹é¢æ˜¯é˜²éª—å®˜æ–¹ç¾¤é‡Œçš„&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0Chat/%E5%AE%A3%E4%BC%A0%E7%BE%A4%E8%BF%9D%E8%A7%843.jpeg" alt="è¿›ç¾¤ä¿¡æ¯">&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h1 id="å¥½äº†æ€»ç»“ä¸€ä¸‹batchat">å¥½äº†ï¼Œæ€»ç»“ä¸€ä¸‹BatChatï¼&lt;/h1>
&lt;p>è™è APPèšåˆäº†å“ªäº›äººï¼Ÿ&lt;/p>
&lt;ul>
&lt;li>ç»å¤§éƒ¨åˆ†é»‘ç°äº§ä¸šé“¾ä¸Šä¸‹æ¸¸äººå‘˜ï¼&lt;/li>
&lt;li>æå°éƒ¨åˆ†å°é²œçš„å°ç™½&lt;/li>
&lt;li>å½“ç„¶å› ä¸ºé™Œç”ŸäººèŠå¤©ï¼Œæˆ‘èƒ½è¿›å…¥çš„åªæœ‰ç¾¤æœç´¢ï¼Œåº”è¯¥è¿˜æœ‰æ›´æ·±çš„ã€‚&lt;/li>
&lt;/ul>
&lt;p>å½“ç„¶ä¸ªäººè®¤ä¸ºï¼Œæ­¤å¹³å°ç«Ÿç„¶èƒ½è¿è¡Œåˆ°ç°åœ¨ï¼Œåé¢æƒ³è±¡çš„ç©ºé—´å¾ˆå¤§å•Š&lt;/p>
&lt;p>è¡¥ä¸ªåˆ€ï¼ŒçŸ¥ä¹ä¸“æ  &lt;a href="https://zhuanlan.zhihu.com/p/158261618">https://zhuanlan.zhihu.com/p/158261618&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>è¿™å°¼ç›å°±æ˜¯ä¸ºé»‘ç°äº§ä¸šæ­å»ºèšåˆå¹³å°å•Šï¼è™½è¯´ä½ ä¸æƒ³ï¼Œä½†æ˜¯å°±å®£ä¼ çš„ç«¯åˆ°ç«¯åŠ å¯†ä»¥åŠæ¶ˆæ¯æ’¤å›ï¼Œè¿™ä¸ªä¸æ­£æ˜¯ä»–ä»¬åœ¨æ„çš„ä¹ˆï¼Ÿ
å½“ç„¶æŸè…¾ä¹Ÿå®£ç§°ä¸å­˜å‚¨**å•¥çš„ï¼Ÿä½ ä¿¡ï¼Ÿ&lt;/p>
&lt;/blockquote>
&lt;p>ç°åœ¨æˆ‘è¦éƒ‘é‡å£°æ˜ï¼šæˆ‘é»˜é»˜çš„åˆ é™¤äº†æ­¤æ¬¾APPï¼ï¼ï¼&lt;/p>
- https://pinkhello.me/posts/12-%E8%81%8A%E8%81%8A%E8%9D%99%E8%9D%A0chat/ - PinkHello, All Rights Reserved</description></item><item><title>11 å‡ ä¸ªå…³äºkafkaçš„çŸ¥è¯†ç‚¹</title><link>https://pinkhello.me/posts/11-%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/</link><pubDate>Wed, 10 Feb 2021 08:55:19 +0800</pubDate><guid>https://pinkhello.me/posts/11-%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/</guid><description>PinkHello https://pinkhello.me/posts/11-%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/ -&lt;h1 id="è®¤è¯†kafka">è®¤è¯†kafka&lt;/h1>
&lt;p>&lt;code>Kafka&lt;/code> æ˜¯åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿï¼Œ &lt;code>Apache&lt;/code> çš„å­é¡¹ç›®ã€‚æ ‡è¯­ä¹Ÿå˜äº†&amp;quot;åˆ†å¸ƒå¼æµå¹³å°&amp;quot;ï¼Œ
ä¸ä¼ ç»Ÿçš„æ¶ˆæ¯ç³»ç»Ÿä¸åŒç‚¹åœ¨äº&lt;/p>
&lt;ul>
&lt;li>åˆ†å¸ƒå¼çš„ï¼Œæ˜“äºæ‰©å±•&lt;/li>
&lt;li>ä¸ºå‘å¸ƒå’Œè®¢é˜…æä¾›äº†é«˜åå&lt;/li>
&lt;li>æ”¯æŒå¤šè®¢é˜…è€…ï¼Œåœ¨å¤±è´¥çš„æ—¶å€™èƒ½è‡ªåŠ¨å¹³è¡¡æ¶ˆè´¹è€…&lt;/li>
&lt;li>æ¶ˆæ¯çš„æŒä¹…åŒ–&lt;/li>
&lt;/ul>
&lt;h1 id="kafka-çš„æ¶æ„">&lt;code>kafka&lt;/code> çš„æ¶æ„&lt;/h1>
&lt;p>å‡ ç‚¹ï¼Ÿ&lt;/p>
&lt;ul>
&lt;li>&lt;code>Kafka&lt;/code> çš„ &lt;code>Topic&lt;/code> å’Œ &lt;code>Partition&lt;/code> å†…éƒ¨å¦‚ä½•å­˜å‚¨ï¼Ÿ&lt;/li>
&lt;li>ä¸ä¼ ç»Ÿçš„æ¶ˆæ¯ç³»ç»Ÿç›¸æ¯”ï¼Œ &lt;code>Kafka&lt;/code> æ¶ˆè´¹æ¨¡å‹æœ‰å•¥ä¼˜ç‚¹ï¼Ÿ&lt;/li>
&lt;li>&lt;code>Kafka&lt;/code> æ˜¯å¦‚ä½•å®ç°åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨å’Œæ•°æ®çš„è¯»å–ï¼Ÿ&lt;/li>
&lt;/ul>
&lt;h2 id="kafka-æ¶æ„">&lt;code>Kafka&lt;/code> æ¶æ„&lt;/h2>
&lt;p>ä¸€ä¸ª &lt;code>Kafka&lt;/code> é›†ç¾¤ï¼Œå¤šä¸ª &lt;code>Producer&lt;/code> ï¼Œå¤šä¸ª &lt;code>Consumer&lt;/code> ï¼Œå¤šä¸ª &lt;code>Broker&lt;/code> ï¼Œ é€‰ä¸¾ &lt;code>Leader&lt;/code> ä»¥åŠåœ¨ &lt;code>Consumer Group&lt;/code> å‘ç”Ÿå˜åŒ–æ—¶è¿›è¡Œ &lt;code>reblance&lt;/code> ã€‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>Broker&lt;/code> æ¶ˆæ¯ä¸­é—´ä»¶çš„å¤„ç†èŠ‚ç‚¹ï¼Œä¸€ä¸ª &lt;code>Kafka&lt;/code> èŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ª &lt;code>Broker&lt;/code> ï¼Œ ä¸€ä¸ªæˆ–è€…å¤šä¸ª &lt;code>Broker&lt;/code> ç»„æˆ &lt;code>Kafka&lt;/code> é›†ç¾¤&lt;/li>
&lt;li>&lt;code>Topic&lt;/code> &lt;code>Kafka&lt;/code> æ ¹æ® &lt;code>Topic&lt;/code> å¯¹ &lt;code>Message&lt;/code> è¿›è¡Œå½’ç±»ï¼Œå‘å¸ƒåˆ° &lt;code>Kafka&lt;/code> çš„æ¯æ¡ &lt;code>Message&lt;/code> éƒ½è¦æŒ‡å®š &lt;code>Topic&lt;/code>&lt;/li>
&lt;li>&lt;code>Producer&lt;/code> å‘ &lt;code>Broker&lt;/code> å‘ç”Ÿ &lt;code>message&lt;/code>&lt;/li>
&lt;li>&lt;code>Consumer&lt;/code> ä» &lt;code>Broker&lt;/code> è¯»å– &lt;code>message&lt;/code>&lt;/li>
&lt;li>&lt;code>Consumer Group&lt;/code> æ¯ä¸ª Consumer å±äºç‰¹å®šçš„ Groupï¼Œä¸€ä¸ª Message å¯ä»¥å‘é€ç»™ä¸åŒçš„ &lt;code>Consumer Group&lt;/code> ï¼Œä½†æ˜¯åŒä¸€ä¸ª &lt;code>Group&lt;/code> ä¸‹çš„åªæœ‰ä¸€ä¸ª &lt;code>Consumer&lt;/code> èƒ½æ¶ˆè´¹è¯¥ &lt;code>Message&lt;/code>&lt;/li>
&lt;li>&lt;code>Partition&lt;/code> ç‰©ç†æ¦‚å¿µï¼Œä¸€ä¸ª &lt;code>Topic&lt;/code> ä¸‹å¯ä»¥åˆ†ä¸ºå¤šä¸ª &lt;code>Partition&lt;/code>, æ¯ä¸ª &lt;code>Partition&lt;/code> ä¸‹æ˜¯æœ‰åºçš„ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://pinkhello.me/%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/kafka-%E6%A1%86%E6%9E%B6%E5%9B%BE.jpeg" alt="kafka æ¡†æ¶å›¾">
&lt;img src="https://pinkhello.me/%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/kafka-%E6%95%B0%E6%8D%AE%E6%B5%81%E5%90%91.png" alt="kafka æ•°æ®æµå‘">&lt;/p>
&lt;p>ä¸‹é¢æ¥è®²è¿° ä¸Šé¢ä¸ºé—®é¢˜å•Š&lt;/p>
&lt;h2 id="kafka-çš„-topic-å’Œ-partition-å†…éƒ¨å¦‚ä½•å­˜å‚¨">&lt;code>Kafka&lt;/code> çš„ &lt;code>Topic&lt;/code> å’Œ &lt;code>Partition&lt;/code> å†…éƒ¨å¦‚ä½•å­˜å‚¨?&lt;/h2>
&lt;p>&lt;code>Kafka&lt;/code> ä¸ºæ¯ä¸ª &lt;code>Topic&lt;/code> ç»´æŠ¤äº†åˆ†åŒºï¼ˆ &lt;code>Partition&lt;/code> ï¼‰çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ¯ä¸ª &lt;code>Partition&lt;/code> åœ¨ &lt;code>kafka&lt;/code> å­˜å‚¨å±‚ä¸º &lt;code>Append Log&lt;/code>ã€‚ä»»ä½•å‘å¸ƒåˆ°æ­¤ &lt;code>Partition&lt;/code> çš„æ¶ˆæ¯éƒ½ä¼šè¢«è¿½åŠ åˆ° &lt;code>Log&lt;/code> æ–‡ä»¶å°¾éƒ¨ã€‚
åœ¨æ¯ä¸ª &lt;code>Partition&lt;/code> æ¯ä¸ªæ¶ˆæ¯æ˜¯æŒ‰ç…§ &lt;code>Timeline&lt;/code> åˆ†é…åˆ°ä¸€ä¸ªå•è°ƒé€’å¢çš„é¡ºåºç¼–å·çš„ï¼Œå°±æ˜¯æˆ‘ä»¬è¯´çš„ &lt;code>Offset&lt;/code>, &lt;code>Offset&lt;/code> æ˜¯ä¸€ä¸ª &lt;code>long&lt;/code> å‹çš„æ•°å­—ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ª &lt;code>Offset&lt;/code> ç¡®å®šä¸€æ¡åœ¨è¯¥ &lt;code>Partition&lt;/code> ä¸‹çš„å”¯ä¸€æ¶ˆæ¯ã€‚&lt;/p>
&lt;p>è¿™æ ·å°±æœ‰ä¸ªç‰¹æ€§ï¼š &lt;code>Partition&lt;/code> ä¸‹æœ‰åº, &lt;code>Topic&lt;/code> ä¸‹æ— æ³•ä¿è¯æœ‰åºã€‚&lt;/p>
&lt;p>é‚£ä¹ˆï¼Œé—®é¢˜æ¥äº†ï¼Ÿè¿™äº› &lt;code>Message&lt;/code> å¦‚ä½•å‘é€åˆ°å„ä¸ª &lt;code>Partition&lt;/code> çš„å‘¢ï¼Ÿå¦‚ä½•æŒ‡å®šçš„å‘¢ï¼Ÿ&lt;/p>
&lt;ul>
&lt;li>å‘é€è‡³å“ªä¸ª &lt;code>Partition&lt;/code> æ˜¯ç”± ç”Ÿäº§è€…å†³å®šçš„ã€‚&lt;/li>
&lt;li>å¦‚æœæ²¡æœ‰ &lt;code>Key&lt;/code> å€¼ï¼Œåˆ™è½®è¯¢å‘é€&lt;/li>
&lt;li>å¦‚æœæœ‰ &lt;code>key&lt;/code> å€¼ï¼Œå¯¹ &lt;code>key&lt;/code> å€¼è¿›è¡Œ &lt;code>Hash&lt;/code> ï¼Œç„¶åå¯¹åˆ†åŒºæ•°é‡å–ä½™ï¼Œä¿è¯åŒä¸€ä¸ª &lt;code>Key&lt;/code> å€¼çš„ä¼šè·¯ç”±åˆ°åŒä¸€ä¸ª &lt;code>Partition&lt;/code> ã€‚å¦‚æœæƒ³é˜Ÿåˆ—å¼ºé¡ºåºä¸€è‡´ï¼Œå¯ä»¥è®©æ‰€æœ‰çš„æ¶ˆæ¯è®¾ç½®ä¸ºåŒä¸€ä¸ª &lt;code>Key&lt;/code> ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸ä¼ ç»Ÿçš„æ¶ˆæ¯ç³»ç»Ÿç›¸æ¯”-kafka-æ¶ˆè´¹æ¨¡å‹æœ‰å•¥ä¼˜ç‚¹">ä¸ä¼ ç»Ÿçš„æ¶ˆæ¯ç³»ç»Ÿç›¸æ¯”ï¼Œ &lt;code>Kafka&lt;/code> æ¶ˆè´¹æ¨¡å‹æœ‰å•¥ä¼˜ç‚¹ï¼Ÿ&lt;/h2>
&lt;h3 id="kafka-consumer-æ¶ˆè´¹æ¨¡å‹">&lt;code>Kafka Consumer&lt;/code> æ¶ˆè´¹æ¨¡å‹&lt;/h3>
&lt;p>æ¶ˆæ¯ç”± &lt;code>producer&lt;/code> å‘é€åˆ° &lt;code>Kafka&lt;/code> é›†ç¾¤åï¼Œè¢« &lt;code>Consumer&lt;/code> æ¶ˆè´¹ï¼Œä¸€èˆ¬æ¥è¯´æˆ‘ä»¬çš„æ¶ˆè´¹æ¨¡å‹æœ‰ä¸¤ç§ï¼š &lt;code>Push&lt;/code> æ¨é€æ¨¡å‹ å’Œ &lt;code>Pull&lt;/code> æ‹‰å–æ¨¡å‹&lt;/p>
&lt;p>&lt;code>Push&lt;/code> æ¨é€æ¨¡å‹ï¼š&lt;/p>
&lt;blockquote>
&lt;p>æ¶ˆæ¯ &lt;code>Broker&lt;/code> è®°å½•æ¶ˆè´¹çŠ¶æ€ã€‚æ¶ˆæ¯ &lt;code>Broker&lt;/code> å°†æ¶ˆæ¯æ¨é€ç»™æ¶ˆè´¹è€…åï¼Œè®°å½•è¿™æ¡æ¶ˆæ¯å·²ç»è¢«æ¶ˆè´¹ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼æ— æ³•å¾ˆå¥½çš„ä¿è¯æ¶ˆè´¹å¤„ç†çš„è¯­ä¹‰ã€‚
æ¶ˆæ¯æ¨é€å®Œæˆåï¼Œæ¶ˆè´¹è€…æŒ‚æ‰æˆ–è€…çº¿ç¨‹ Hang ä½ ï¼Œæˆ–è€…ç½‘ç»œåŸå› æœªæ”¶åˆ°ï¼Œä½†æ˜¯ æ¶ˆæ¯ &lt;code>Broker&lt;/code> å°†å…¶æ ‡è®°ä¸ºå·²æ¶ˆè´¹ï¼Œè¿™ä¸ªæ¶ˆæ¯å°†æ°¸è¿œä¸¢å¤±äº†ã€‚
ä¹Ÿå°±æ˜¯è¯´ï¼Œé‡‡ç”¨ &lt;code>Push&lt;/code> ï¼Œæ¶ˆæ¯æ¶ˆè´¹å®Œå…¨ä¾èµ– æ¶ˆæ¯ &lt;code>Broker&lt;/code> æ§åˆ¶ï¼Œä¸€æ—¦ &lt;code>Consumer&lt;/code> å‘ç”Ÿé˜»å¡ï¼Œä¼šå‡ºç°é—®é¢˜ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>&lt;code>Pull&lt;/code> æ‹‰å–æ¨¡å‹ï¼š&lt;/p>
&lt;blockquote>
&lt;p>ç”± &lt;code>Consumer&lt;/code> æ§åˆ¶ &lt;code>Speed&lt;/code> ï¼Œä»¥åŠæ¶ˆè´¹ &lt;code>Offset&lt;/code> ï¼Œ &lt;code>Consumer&lt;/code> å¯ä»¥æŒ‰ç…§ä»»æ„çš„åç§»é‡è¿›è¡Œ &lt;code>Consumer&lt;/code>
&lt;code>Consumer&lt;/code> å¯ä»¥å›æ”¾å·²ç»æ¶ˆè´¹è¿‡çš„æ¶ˆæ¯ï¼Œè¿›è¡Œé‡æ–°å¤„ç†æˆ–è€…æ¶ˆè´¹æœ€è¿‘çš„æ¶ˆæ¯&lt;/p>
&lt;/blockquote>
&lt;h3 id="kafka-çš„ç½‘ç»œæ¨¡å‹">&lt;code>Kafka&lt;/code> çš„ç½‘ç»œæ¨¡å‹&lt;/h3>
&lt;p>&lt;code>Kafka Client&lt;/code> å•çº¿ç¨‹ &lt;code>Selector&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/kafka-client-selector.png" alt="kafka å•çº¿ç¨‹æ¨¡å‹">&lt;/p>
&lt;blockquote>
&lt;p>å¹¶å‘é“¾æ¥æ•°ç›®å°ï¼Œé€»è¾‘ç®€å•ï¼Œæ•°æ®é‡å°ã€‚åœ¨ &lt;code>Kafka Consumer&lt;/code> å’Œ &lt;code>Kafka Producer&lt;/code> éƒ½æ˜¯é‡‡ç”¨çš„ å•çº¿ç¨‹æ¨¡å‹ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>&lt;code>kafka Server&lt;/code> å¤šçº¿ç¨‹ &lt;code>Selector&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/kafka-server-selector.png" alt="kafka å¤šçº¿ç¨‹æ¨¡å‹">&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>Acceptor&lt;/code> è¿è¡Œäºä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ï¼Œå¯¹äºè¯»å–æ“ä½œçš„çº¿ç¨‹æ± ä¸­çº¿ç¨‹éƒ½æ˜¯åœ¨ &lt;code>selector&lt;/code> æ³¨å†Œ &lt;code>Op_Read&lt;/code> äº‹ä»¶ï¼Œè´Ÿè´£æœåŠ¡ç«¯è¯»å–è¯·æ±‚ã€‚
æˆåŠŸè¯»å–åï¼Œå°†è¯·æ±‚æ”¾å…¥ &lt;code>Message Queue&lt;/code> å…±äº«é˜Ÿåˆ—ä¸­ï¼Œç„¶ååœ¨ å†™æ“ä½œçš„çº¿ç¨‹æ± ä¸­ï¼Œå–å‡ºè¿™ä¸ªè¯·æ±‚ï¼Œå¯¹å…¶è¿›è¡Œé€»è¾‘å¤„ç†ã€‚
å³ä½¿æŸä¸ªçº¿ç¨‹é˜»å¡äº†ï¼Œåé¢è¿˜æœ‰åç»­çš„çº¿ç¨‹ä» &lt;code>Message Queue&lt;/code> å…±äº«é˜Ÿåˆ—é‡Œé¢è·å–è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚
å†™çº¿ç¨‹å¤„ç†å®Œé€»è¾‘åï¼Œç”±äºæ³¨å†Œäº† &lt;code>Op_Write&lt;/code> äº‹ä»¶ï¼Œè¿˜éœ€è¦å‘é€å“åº”ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="kafka-æ˜¯å¦‚ä½•å®ç°åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨å’Œæ•°æ®çš„è¯»å–">&lt;code>Kafka&lt;/code> æ˜¯å¦‚ä½•å®ç°åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨å’Œæ•°æ®çš„è¯»å–ï¼Ÿ&lt;/h2>
&lt;h3 id="kafka-é«˜å¯é çš„åˆ†å¸ƒå¼å­˜å‚¨æ¨¡å‹">&lt;code>Kafka&lt;/code> é«˜å¯é çš„åˆ†å¸ƒå¼å­˜å‚¨æ¨¡å‹&lt;/h3>
&lt;p>ä¸»è¦ä¾é  å‰¯æœ¬ æœºåˆ¶ï¼Œæœ‰äº†å‰¯æœ¬æœºåˆ¶ï¼Œæœºå™¨å®•æœºï¼Œä¹Ÿä¼šæ¢å¤ã€‚&lt;/p>
&lt;h3 id="kafka-é«˜æ€§èƒ½æ—¥å¿—å­˜å‚¨">&lt;code>Kafka&lt;/code> é«˜æ€§èƒ½æ—¥å¿—å­˜å‚¨&lt;/h3>
&lt;p>&lt;img src="https://pinkhello.me/%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/kafka-segement.png" alt="kafka é«˜æ€§èƒ½æ—¥å¿—å­˜å‚¨">
&lt;img src="https://pinkhello.me/%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/kafka-append-log.png" alt="kafka é«˜æ€§èƒ½æ—¥å¿—å­˜å‚¨">&lt;/p>
&lt;p>&lt;code>Kafka&lt;/code> çš„ä¸€ä¸ª &lt;code>Topic&lt;/code> ä¸‹çš„æ‰€æœ‰çš„ &lt;code>Message&lt;/code> éƒ½æ˜¯ä»¥ &lt;code>Partition&lt;/code> çš„æ–¹å¼ï¼Œåˆ†å¸ƒå¼å­˜å‚¨åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šã€‚&lt;/p>
&lt;p>åŒæ—¶åœ¨ kafka æœºå™¨ä¸Šï¼Œæ¯ä¸ª &lt;code>Partition&lt;/code> éƒ½ä¼šå¯¹åº”ä¸€ä¸ªæ—¥å¿—ç›®å½•ï¼Œåœ¨ç›®å½•ä¸‹é¢ä¼šå¯¹åº”å¯¹æ­Œ æ—¥å¿—åˆ†æ®µï¼ˆ&lt;code>LogSegment&lt;/code>ï¼‰ã€‚
LogSegment ç»„æˆ &amp;ldquo;.index&amp;rdquo; ä¸ &amp;ldquo;.log&amp;rdquo; , åˆ†åˆ«è¡¨ç¤º &lt;code>segment&lt;/code> ç´¢å¼•æ–‡ä»¶ å’Œ æ•°æ®æ–‡ä»¶ã€‚
ä¸¤ä¸ªæ–‡ä»¶çš„å‘½åè§„åˆ™: &lt;code>partition&lt;/code> å…¨å±€çš„ç¬¬ä¸€ä¸ª &lt;code>segment&lt;/code> ä» 0 å¼€å§‹ï¼Œåç»­çš„æ¯ä¸ª &lt;code>Segment&lt;/code> æ–‡ä»¶åä¸ºä¸Šä¸€ä¸ª &lt;code>Segment&lt;/code> æ–‡ä»¶æœ€åä¸€æ¡æ¶ˆæ¯çš„ &lt;code>offset&lt;/code> å€¼ã€‚
æ•°å€¼ä¸º 64 ä½ï¼Œ 20 ä½æ•°å­—å­—ç¬¦é•¿åº¦ï¼Œæ²¡æœ‰æ•°å­—ç”¨ 0 å¡«å……ã€‚&lt;/p>
&lt;p>å‡å¦‚æœ‰ 1000 æ¡æ¶ˆæ¯ï¼Œæ¯ä¸ª &lt;code>LogSegment&lt;/code> çš„å¤§å°ä¸º 100ï¼Œé‚£ä¹ˆå±•ç° 900-1000 çš„ç´¢å¼• å’Œ Logï¼š
&lt;img src="https://pinkhello.me/%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/kafka-log.jpg" alt="kafka LogSegment">&lt;/p>
&lt;p>&lt;code>kafka&lt;/code> æ¶ˆæ¯æ•°æ®é‡æ‰“ï¼Œé‡‡ç”¨çš„æ˜¯ &lt;code>ç¨€ç–ç´¢å¼•&lt;/code> çš„æ–¹å¼ï¼ŒåŠ å¿«åæŸ¥è¯¢é€Ÿåº¦ã€‚&lt;/p>
&lt;p>å¦‚ä½•è¯»å–æ•°æ®ï¼Ÿ å¦‚æœæˆ‘ä»¬è¦è¯»å–ç¬¬ 911 æ¡æ•°æ®&lt;/p>
&lt;ul>
&lt;li>å…ˆæ‰¾åˆ°å®ƒå±äºå“ªä¸ªæ®µï¼Ÿ äºŒåˆ†æ³•æŸ¥æ‰¾å±äºæ–‡ä»¶ï¼Œæ‰¾åˆ° 0000900.index å’Œ 0000900.log ä¹‹å&lt;/li>
&lt;li>å»ç´¢å¼•æ–‡ä»¶ 0000900.index æŸ¥æ‰¾ (911-900)=11 è¿™ä¸ªç´¢å¼• æˆ–è€… å°äº11 æœ€è¿‘çš„ç´¢å¼•&lt;/li>
&lt;li>åé¢é€šè¿‡ äºŒåˆ†æ³•æˆ‘ä»¬æ‰¾åˆ°ç´¢å¼• [10,1367]&lt;/li>
&lt;li>ç„¶åé€šè¿‡è¿™æ¡ç´¢å¼•çš„ç‰©ç†ä½ç½® 1367ï¼Œå¼€å§‹å¾€åæ‰¾ï¼ŒçŸ¥é“æ‰¾åˆ° ç¬¬ 911 æ¡æ•°æ®&lt;/li>
&lt;/ul>
&lt;p>&lt;code>ä¸ºä»€ä¹ˆåˆ†åŒºï¼Ÿåªæœ‰ä¸€ä¸ªåˆ†åŒºä¸è¡Œä¹ˆï¼Ÿåˆ†åŒºæ˜¯ä¸ºäº†å¹²å•¥ï¼Ÿé‚£ä¹ˆæ—¥å¿—ä¸ºä»€ä¹ˆè¦åˆ†æ®µå‘¢ï¼Ÿ&lt;/code>&lt;/p>
&lt;h2 id="kafka-çš„å‰¯æœ¬æœºåˆ¶">&lt;code>Kafka&lt;/code> çš„å‰¯æœ¬æœºåˆ¶&lt;/h2>
&lt;p>&lt;code>Kafka&lt;/code> å‰¯æœ¬æœºåˆ¶ä¸º å¤šä¸ªèŠ‚ç‚¹å¯¹å…¶ä»–æœåŠ¡ç«¯èŠ‚ç‚¹çš„ä¸»é¢˜åˆ†åŒºçš„æ—¥å¿—è¿›è¡Œå¤åˆ¶ã€‚å½“é›†ç¾¤æŸä¸ªèŠ‚ç‚¹å‡ºç°é—®é¢˜ï¼Œè®¿é—®è¯¥æ•…éšœèŠ‚ç‚¹çš„è¯·æ±‚å¯ä»¥è¢«è½¬ç§»åˆ°å…¶ä»–æ­£å¸¸çš„èŠ‚ç‚¹ï¼ˆè¿‡ç¨‹è„š &lt;code>reblance&lt;/code> ï¼‰&lt;/p>
&lt;p>&lt;code>kafka&lt;/code> çš„æ¯ä¸ª &lt;code>Topic&lt;/code> çš„æ¯ä¸ª &lt;code>Partition&lt;/code> éƒ½æœ‰ä¸€ä¸ª ä¸»å‰¯æœ¬ä»¥åŠ &lt;code>0-n&lt;/code> ä¸ªå‰¯æœ¬ï¼Œå‰¯æœ¬ä¿æŒä¸ä¸»å‰¯æœ¬çš„æ•°æ®åŒæ­¥ï¼Œå½“ ä¸»å‰¯æœ¬ å‡ºç°æ•…éšœæ—¶ä¼šè¢«æ›¿ä»£ã€‚&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/kafka-partition-replicas.png" alt="kafka é«˜æ€§èƒ½å‰¯æœ¬æœºåˆ¶">&lt;/p>
&lt;p>åœ¨ &lt;code>kafka&lt;/code> ä¸­ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„å‰¯æœ¬éƒ½è¢«æ‹¿æ¥ä»£æ›¿ä¸»å‰¯æœ¬çš„ï¼Œæ‰€ä»¥åœ¨ &lt;code>kafka&lt;/code> çš„ &lt;code>leader&lt;/code> èŠ‚ç‚¹ä¸­ç»´æŠ¤è€…ä¸€ä¸ª &lt;code>ISRï¼ˆIn Sync Replicasï¼‰&lt;/code>é›†åˆ
&lt;code>ISR (In Sync Replicas)&lt;/code> å‰¯æœ¬ &lt;code>follower&lt;/code> åŒæ­¥é˜Ÿåˆ—, ç»´æŠ¤ç€æœ‰èµ„æ ¼çš„ &lt;code>follower&lt;/code> çš„èŠ‚ç‚¹&lt;/p>
&lt;ul>
&lt;li>å‰¯æœ¬çš„æ‰€æœ‰èŠ‚ç‚¹å¿…é¡»å’Œ &lt;code>ZK&lt;/code> ä¿æŒé“¾æ¥&lt;/li>
&lt;li>åœ¨åŒæ­¥è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªå‰¯æœ¬ä¸èƒ½è½åä¸»å‰¯æœ¬å¤ªå¤š(å³å‰¯æœ¬æœ€åä¸€æ¡æ¶ˆæ¯çš„ &lt;code>offset&lt;/code> å’Œ &lt;code>leader&lt;/code> å‰¯æœ¬çš„æœ€å¥½ä¸€æ¡æ¶ˆæ¯çš„ &lt;code>offset&lt;/code> ä¹‹é—´çš„å·®å€¼ä¸èƒ½è¶…è¿‡é˜ˆå€¼)
(&lt;code>replica.lag.max.messages&lt;/code>)&lt;/li>
&lt;/ul>
&lt;p>&lt;code>ARï¼ˆAssigned Replicasï¼‰&lt;/code>æ ‡è®°å‰¯æœ¬çš„å…¨é›† ï¼Œ&lt;code>OSR&lt;/code> è¡¨ç¤ºè½åè¢«å‰”é™¤çš„å‰¯æœ¬é›†åˆ&lt;/p>
&lt;p>ISR = leader + æ²¡æœ‰è½åå¤ªå¤šçš„å‰¯æœ¬
AR = OSR + ISR&lt;/p>
&lt;p>&lt;code>HW &amp;amp; LEO&lt;/code>
&lt;code>Follower&lt;/code> å‰¯æœ¬åŒæ­¥è¿‡ç¨‹ä¸­ï¼Œä¸¤ä¸ªæ¦‚å¿µ &lt;code>HW&lt;/code> &lt;code>HighWatermark&lt;/code> å’Œ &lt;code>LEO&lt;/code> &lt;code>Log End Offset&lt;/code>ï¼Œä¸ &lt;code>ISR&lt;/code> ç´§å¯†ç›¸å…³ã€‚&lt;/p>
&lt;p>&lt;code>HW&lt;/code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ &lt;code>Offset&lt;/code> ï¼Œå½“ &lt;code>Consumer&lt;/code> å¤„ç†æ¶ˆæ¯çš„æ—¶å€™ï¼Œåªèƒ½ &lt;code>Pull&lt;/code> åˆ° &lt;code>HW&lt;/code> ä¹‹å‰çš„æ¶ˆæ¯ï¼Œ &lt;code>HW&lt;/code> ä¹‹åçš„æ¶ˆæ¯å¯¹ &lt;code>Consumer&lt;/code> ä¸å¯è§ã€‚
ä¹Ÿå°±æ˜¯è¯´ &lt;code>Partition&lt;/code> å¯¹åº”çš„ ISR ä¸­æœ€å°çš„ &lt;code>LEO&lt;/code> ä½œä¸º &lt;code>HW&lt;/code> ï¼Œ &lt;code>Consumer&lt;/code> æœ€å¤šåªèƒ½æ¶ˆè´¹åˆ° &lt;code>HW&lt;/code> æ‰€åœ¨çš„ä½ç½®ï¼Œæ¯ä¸ª &lt;code>Replica&lt;/code> éƒ½æœ‰ &lt;code>HW&lt;/code> ï¼Œ
&lt;code>leader&lt;/code> å’Œ &lt;code>follower&lt;/code> å„è‡ªç»´æŠ¤æ›´æ–°è‡ªå·±çš„ &lt;code>HW&lt;/code> çš„çŠ¶æ€ï¼Œå¯¹äº &lt;code>Leader&lt;/code> æ–°å†™å…¥çš„æ¶ˆæ¯ï¼Œ &lt;code>Consumer&lt;/code> ä¸èƒ½ç«‹åˆ»æ¶ˆè´¹ï¼Œ &lt;code>Leader&lt;/code> ä¼šç­‰å¾…
è¯¥æ¶ˆæ¯è¢«æ‰€æœ‰çš„ &lt;code>ISR&lt;/code> ä¸­çš„ &lt;code>Replicas&lt;/code> åŒæ­¥æ›´æ–° &lt;code>HW&lt;/code> ï¼Œæ­¤æ—¶æ¶ˆæ¯æ‰èƒ½è¢« &lt;code>Consumer&lt;/code> æ¶ˆè´¹ï¼Œè¿™æ ·ä¿è¯äº†å¦‚æœ &lt;code>Leader&lt;/code> å‰¯æœ¬æŸåï¼Œ
è¯¥æ¶ˆæ¯ä»ç„¶å¯ä»¥ä»æ–°é€‰ä¸¾çš„ &lt;code>Leader&lt;/code> è·å–ã€‚&lt;/p>
&lt;p>&lt;code>LEO&lt;/code> æ˜¯æ‰€æœ‰å‰¯éƒ½ä¼šæœ‰çš„ä¸€ä¸ª &lt;code>offset&lt;/code> æ ‡è®°ï¼Œå®ƒæŒ‡å‘è¿½åŠ åˆ°å½“å‰å‰¯æœ¬çš„æœ€åä¸€ä¸ªæ¶ˆæ¯çš„ &lt;code>offset&lt;/code> ï¼Œå½“ç”Ÿäº§è€…å‘ &lt;code>Leader&lt;/code> å‰¯æœ¬è¿½åŠ æ¶ˆæ¯æ—¶å€™ï¼Œ &lt;code>Leader&lt;/code> å‰¯æœ¬çš„ &lt;code>LEO&lt;/code> æ ‡è®°å°±ä¼šé€’å¢ï¼›
å½“ &lt;code>follower&lt;/code> å‰¯æœ¬æˆåŠŸä» &lt;code>leader&lt;/code> å‰¯æœ¬ &lt;code>pull&lt;/code> æ¶ˆæ¯å¹¶æ›´æ–°åˆ°æœ¬åœ°çš„æ—¶å€™ï¼Œ &lt;code>follower&lt;/code> å‰¯æœ¬ä¹Ÿä¼šå¢è‚Œ&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>producer&lt;/code> å‘ &lt;code>leader&lt;/code> å‘é€æ¶ˆæ¯ï¼Œå¯ä»¥é€šè¿‡ &lt;code>request.required.acks&lt;/code> å‚æ•°æ¥è®¾ç½®æ•°æ®å¯é æ€§çº§åˆ«ï¼š&lt;/p>
&lt;ul>
&lt;li>1 é»˜è®¤ï¼Œ &lt;code>producer&lt;/code> åœ¨ &lt;code>ISR&lt;/code> ä¸­çš„ &lt;code>leader&lt;/code> å·²æˆåŠŸæ”¶åˆ°æ•°æ®å¹¶å¾—åˆ°ç¡®è®¤åå‘é€ä¸‹ä¸€æ¡ &lt;code>Message&lt;/code> ã€‚å¦‚æœ &lt;code>Leader&lt;/code> å®•æœºï¼Œä¼šä¸¢å¤±æ•°æ®&lt;/li>
&lt;li>0 &lt;code>producer&lt;/code> æ— éœ€ç­‰å¾…ï¼Œç»§ç»­å‘é€ä¸‹ä¸€æ‰¹æ¶ˆæ¯ï¼Œæ•ˆç‡é«˜ï¼Œä½†æ˜¯æ•°æ®å¯é æ€§ä½&lt;/li>
&lt;li>-1 &lt;code>producer&lt;/code> éœ€è¦ç­‰å¾… &lt;code>ISR&lt;/code> ä¸­æ‰€ä»¥çš„ &lt;code>follower&lt;/code> éƒ½ç¡®è®¤æ¥æ”¶åˆ°æ•°æ®æ‰ç®—å‘é€å®Œæˆã€‚å¯é æ€§é«˜ï¼Œä½†æ˜¯æ²¡æœ‰ä¹Ÿä¸èƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œæ¯”å¦‚ &lt;code>ISR&lt;/code> é‡Œåªæœ‰ &lt;code>leader&lt;/code> ï¼ˆå…¶ä»–èŠ‚ç‚¹å’Œ &lt;code>ZK&lt;/code> æ–­é“¾ï¼Œæˆ–è€…æ²¡æœ‰è¿½ä¸Šï¼‰ï¼Œè¿™æ ·å°±å˜æˆäº† &lt;code>acks=1&lt;/code> çš„æƒ…å†µ&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h1 id="kafka-åˆ°åº•ä¼šä¸ä¼šä¸¢æ¶ˆæ¯">&lt;code>kafka&lt;/code> åˆ°åº•ä¼šä¸ä¼šä¸¢æ¶ˆæ¯&lt;/h1>
&lt;p>ä¸€ä¸ªæ¶ˆæ¯çš„æµè½¬&lt;/p>
&lt;ul>
&lt;li>&lt;code>Producer&lt;/code> å‘é€ç»™ &lt;code>Kafka Broker&lt;/code>&lt;/li>
&lt;li>&lt;code>kafka Broker&lt;/code> æ¶ˆæ¯åŒæ­¥å’ŒæŒä¹…åŒ–&lt;/li>
&lt;li>&lt;code>Kafka Brokder&lt;/code> å°†æ¶ˆæ¯ä¼ é€’ç»™æ¶ˆè´¹è€…&lt;/li>
&lt;/ul>
&lt;h1 id="å¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨-kafka-consumer">å¦‚ä½•ä¼˜é›…çš„ä½¿ç”¨ Kafka Consumer&lt;/h1>
&lt;p>æ³¨æ„ç‚¹ç­‰ç­‰&amp;hellip;..&lt;/p>
&lt;h1 id="kafka-producer-æµç¨‹è¯¦ç»†">&lt;code>kafka Producer&lt;/code> æµç¨‹è¯¦ç»†&lt;/h1>
&lt;p>&lt;img src="https://pinkhello.me/%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/kafka-producer-flow.png" alt="kafkaProduceræµç¨‹è§£è¯»">
&lt;img src="https://pinkhello.me/%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/kafka-meta-get.png" alt="kafka è·å–å…ƒæ•°æ®">&lt;/p>
- https://pinkhello.me/posts/11-%E5%87%A0%E4%B8%AA%E5%85%B3%E4%BA%8Ekafka%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9/ - PinkHello, All Rights Reserved</description></item><item><title>10 å¤šåŸŸåä¸‹çš„SSH</title><link>https://pinkhello.me/posts/10-%E5%A4%9A%E5%9F%9F%E5%90%8D%E4%B8%8B%E7%9A%84ssh/</link><pubDate>Wed, 10 Feb 2021 08:52:57 +0800</pubDate><guid>https://pinkhello.me/posts/10-%E5%A4%9A%E5%9F%9F%E5%90%8D%E4%B8%8B%E7%9A%84ssh/</guid><description>PinkHello https://pinkhello.me/posts/10-%E5%A4%9A%E5%9F%9F%E5%90%8D%E4%B8%8B%E7%9A%84ssh/ -&lt;h1 id="å‰è¨€">å‰è¨€&lt;/h1>
&lt;p>æœ‰æ—¶å€™æˆ‘ä»¬ï¼Œæœ‰å¤šä¸ª git è´¦å·ï¼ˆGitlabã€GitHubï¼‰ï¼Œè¿™æ—¶å€™å¦‚æœæ˜¯åŒä¸€ä¸ªè´¦å·ï¼ˆé‚®ç®±æ³¨å†Œï¼‰ï¼Œé‚£ä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœä¸æ˜¯ç›¸åŒçš„è´¦å·å‘¢ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ SSH KEY åšå…å¯†ç™»å½•æ—¶å€™ï¼Œå¤´ç—›äº†ã€‚&lt;/p>
&lt;p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦é’ˆå¯¹ä¸åŒçš„è´¦å·ï¼Œç”Ÿæˆä¸åŒçš„ SSH Keyï¼Œå¹¶ä¸”é…ç½®ä¸åŒçš„åŸŸåä½¿ç”¨ä¸åŒçš„Key&lt;/p>
&lt;h1 id="ç”Ÿæˆä¸€ä¸ª-ssh-key">ç”Ÿæˆä¸€ä¸ª SSH KEY&lt;/h1>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">ssh-keygen -t rsa -C &lt;span style="color:#cd5555">&amp;#34;username@email.com&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;blockquote>
&lt;p>ä¸€è·¯ Enterï¼Œå¹¶ä¸”åœ¨ç”Ÿæˆæ—¶å€™æŒ‡å®šåå­—ï¼Œï¼ˆä¸æŒ‡å®šåå­—ä¼šä½¿ç”¨é»˜è®¤çš„ï¼‰å¾—åˆ°&lt;/p>
&lt;/blockquote>
&lt;/blockquote>
&lt;pre>&lt;code>id_rsa # ç§é’¥
id_rsa.pub # å…¬é’¥
&lt;/code>&lt;/pre>&lt;h1 id="é‡å¤ä¸Šä¸€ä¸ªæ­¥éª¤ç”Ÿæˆå¤šä¸ª-ç§é’¥å’Œå…¬é’¥">é‡å¤ä¸Šä¸€ä¸ªæ­¥éª¤ï¼Œç”Ÿæˆå¤šä¸ª ç§é’¥å’Œå…¬é’¥&lt;/h1>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">github_id_rsa
github_id_rsa.pub
gitlab_id_rsa
gitlab_id_rsa.pub
&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="é…ç½®ç›¸åº”çš„åŸŸåå¯¹åº”çš„-ssh-key">é…ç½®ç›¸åº”çš„åŸŸåå¯¹åº”çš„ SSH-KEY&lt;/h1>
&lt;ul>
&lt;li>æœ¬åœ°ç›®å½• &lt;code>~/.ssh/&lt;/code> ä¸‹ï¼ŒæŸ¥é˜…æœ‰æ²¡æœ‰ &lt;code>config&lt;/code> æ–‡ä»¶, ä¸å­˜åœ¨å°±æ–°å»º &lt;code>config&lt;/code> æ–‡ä»¶&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">Host github
HostName github.com
User UserName
PreferredAuthentications publickey
IdentityFile ~/.ssh/github_id_rsa
Host gitlab
HostName gitlab.com
User UserName
PreferredAuthentications publickey
IdentityFile ~/.ssh/gitlab_id_rsa
&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="å°†å¯†é’¥æ·»åŠ è¿›å…¥--ssh-agent-ä¸­">å°†å¯†é’¥æ·»åŠ è¿›å…¥ SSH-AGENT ä¸­&lt;/h1>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">ssh-add ~/.ssh/github_id_rsa
ssh-add ~/.ssh/gitlab_id_rsa
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŸ¥çœ‹å¯†é’¥&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">ssh-add -l
&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="å°†ç”Ÿæˆçš„-å…¬é’¥-åŠ å…¥åˆ°å¯¹åº”çš„ç½‘ç«™é‡Œé¢-ssh-key-é…ç½®">å°†ç”Ÿæˆçš„ å…¬é’¥ åŠ å…¥åˆ°å¯¹åº”çš„ç½‘ç«™é‡Œé¢ SSH KEY é…ç½®&lt;/h1>
&lt;p>ä¸‹é¢å°±å¯ä»¥ä½¿ç”¨ &lt;code>git clone git@github.com/****&lt;/code> &lt;code>git clone git@gitlab.com/****&lt;/code>&lt;/p>
&lt;h1 id="å…³äº-mac-ä¸‹-æ¯æ¬¡å¼€æœº-éœ€è¦é‡æ–°-ssh-add-è§£å†³åŠæ³•">å…³äº Mac ä¸‹ æ¯æ¬¡å¼€æœº éœ€è¦é‡æ–° ssh-add è§£å†³åŠæ³•&lt;/h1>
&lt;ul>
&lt;li>æ·»åŠ è‡ªå¯åŠ¨ç¨‹åº&lt;/li>
&lt;li>è¯´ä¸€ä¸ªç®€å•çš„ï¼Œå°† ssh-add ~/.ssh/**id_rsa æ·»åŠ åˆ° .*shrc æ–‡ä»¶é‡Œé¢å»&lt;/li>
&lt;/ul>
- https://pinkhello.me/posts/10-%E5%A4%9A%E5%9F%9F%E5%90%8D%E4%B8%8B%E7%9A%84ssh/ - PinkHello, All Rights Reserved</description></item><item><title>09 ä½¿ç”¨githookç»Ÿä¸€codestyle</title><link>https://pinkhello.me/posts/09-%E4%BD%BF%E7%94%A8githook%E7%BB%9F%E4%B8%80codestyle/</link><pubDate>Wed, 10 Feb 2021 08:46:52 +0800</pubDate><guid>https://pinkhello.me/posts/09-%E4%BD%BF%E7%94%A8githook%E7%BB%9F%E4%B8%80codestyle/</guid><description>PinkHello https://pinkhello.me/posts/09-%E4%BD%BF%E7%94%A8githook%E7%BB%9F%E4%B8%80codestyle/ -&lt;h1 id="gradle-ä¼˜åŒ–">gradle ä¼˜åŒ–&lt;/h1>
&lt;ul>
&lt;li>build æŒ‡å®š -g cache ç¼“å­˜&lt;/li>
&lt;/ul>
&lt;h1 id="checkstyle-å®è·µ">checkstyle å®è·µ&lt;/h1>
&lt;ul>
&lt;li>åŸºç¡€é•œåƒåŒ…å« &lt;code>checkstyle.xml&lt;/code> æˆ–è€… æ”¾åˆ°è¿œç¨‹å…¶ä»–å¯è¢«æ‹‰å–åˆ°çš„å­˜å‚¨ä»‹è´¨ ï¼Œé˜²æ­¢é¡¹ç›®æˆå‘˜æ”¹åŠ¨&lt;/li>
&lt;li>&lt;code>gitlab-ci&lt;/code> &lt;code>beforeScript&lt;/code> æ ‡ç­¾æ‰§è¡Œå‘½ä»¤ &lt;code>copy /checkstyle.xml&lt;/code> è¿›å…¥é¡¹ç›®ï¼Œ(è¦†ç›–é¡¹ç›®ä¸­å­˜åœ¨çš„).&lt;/li>
&lt;li>&lt;code>gradle&lt;/code> ç¼–è¯‘çš„è¯ å°† &lt;code>maven-publish.gradle&lt;/code> &lt;code>repos.gradle&lt;/code> &lt;code>checkstyle.gradle&lt;/code>(&lt;code>checkstyle&lt;/code> æ’ä»¶é…ç½® ç‰ˆæœ¬ä»¥åŠ &lt;code>configFile&lt;/code>) æŠ½å‡ºæ”¾åˆ°å…¬å…±çš„åœ°æ–¹ï¼Œé˜²æ­¢é¡¹ç›®å›¢é˜Ÿæˆå‘˜æ”¹çš„.&lt;/li>
&lt;li>&lt;code>maven&lt;/code> çš„è¯ï¼Œå¯ä»¥åœ¨å…¬å…±çš„é¡¶çº§ç»§æ‰¿ &lt;code>pom&lt;/code> é‡Œé¢æŒ‡å®šå˜é‡&lt;code>checkstyle.config.location&lt;/code>. &lt;code>mvn checkstyle -Dcheckstyle.config.location=checkstyle.xml&lt;/code>&lt;/li>
&lt;/ul>
&lt;h1 id="git-hook-å®è·µ">git hook å®è·µ&lt;/h1>
&lt;p>æ¯ä¸ªé¡¹ç›®é‡Œé¢ &lt;code>.git/hooks&lt;/code> é‡Œé¢æœ‰å¾ˆå¤šçš„ &lt;code>hook&lt;/code> æ¨¡æ¿&lt;/p>
&lt;p>å®¢æˆ·ç«¯é’©å­åŒ…æ‹¬:&lt;code>pre-commit&lt;/code>ã€&lt;code>prepare-commit-msg&lt;/code>ã€&lt;code>commit-msg&lt;/code>ã€&lt;code>post-commit&lt;/code>ç­‰ï¼Œä¸»è¦ç”¨äºæ§åˆ¶å®¢æˆ·ç«¯gitçš„æäº¤å·¥ä½œæµã€‚&lt;/p>
&lt;p>æœåŠ¡ç«¯é’©å­ï¼š&lt;code>pre-receive&lt;/code>ã€&lt;code>post-receive&lt;/code>ã€&lt;code>update&lt;/code>ï¼Œä¸»è¦åœ¨æœåŠ¡ç«¯æ¥æ”¶æäº¤å¯¹è±¡æ—¶ã€æ¨é€åˆ°æœåŠ¡å™¨ä¹‹å‰è°ƒç”¨ã€‚&lt;/p>
&lt;p>ä»Šå¤©å®è·µçš„æ˜¯ å®¢æˆ·ç«¯é’©å­ï¼Œä¼˜åŒ–å‡å°‘ä¸ç¬¦åˆè§„èŒƒæˆ–è€…ä½è´¨é‡ä»£ç è¿›å…¥ &lt;code>gitflow&lt;/code> æµç¨‹.&lt;/p>
&lt;p>&lt;code>pre-commit&lt;/code> å’Œ &lt;code>commit-msg&lt;/code> æ˜¯ä»Šå¤©çš„ä¸»è§’ï¼Œ&lt;code>pre-commit&lt;/code> æ‰§è¡Œä¸ &lt;code>git add&lt;/code> ä¹‹åï¼Œåœ¨è¿›è¡Œ &lt;code>git commit&lt;/code> ä¹‹å‰è¿›è¡Œçš„æ“ä½œ.
å¯ä»¥ç”¨æ¥è¿›è¡Œ &lt;code>code check&lt;/code> &lt;code>code lint&lt;/code> ç­‰ç­‰, &lt;code>commit-msg&lt;/code> æ‰§è¡Œä¸ &lt;code>git commit&lt;/code> å¸¸ç”¨äºè¡¥å…¨ &lt;code>git commit message&lt;/code> &lt;code>check msg&lt;/code> ç­‰ç­‰
å½“ç„¶è¿˜æœ‰å…¶ä»–éªšæ“ä½œçš„åŠŸèƒ½ï¼Œå¯ä»¥é€šçŸ¥ï¼Œç­‰ç­‰ï¼Œåšå¤šç§è‡ªåŠ¨åŒ–&lt;/p>
&lt;p>ç›®å½•ç»“æ„&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yml" data-lang="yml">project&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>- .git/..ç­‰ç­‰&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>- git_hooks&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>-- pre-commit &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># pre-commit action&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>-- commit-msg &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># commit-msg action&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>-- init.sh &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># åˆå§‹åŒ–è„šæœ¬&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>pre-commit&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&lt;span style="color:#1e889b">#!/bin/bash
&lt;/span>&lt;span style="color:#1e889b">&lt;/span>&lt;span style="color:#00688b">workPath&lt;/span>=&lt;span style="color:#8b008b;font-weight:bold">$(&lt;/span>&lt;span style="color:#658b00">pwd&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">)&lt;/span>
&lt;span style="color:#00688b">CHECK_DIR&lt;/span>=&lt;span style="color:#cd5555">${&lt;/span>&lt;span style="color:#00688b">workPath&lt;/span>&lt;span style="color:#cd5555">}&lt;/span>/checks
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> [ ! -d &lt;span style="color:#00688b">$CHECK_DIR&lt;/span> ]
&lt;span style="color:#8b008b;font-weight:bold">then&lt;/span>
mkdir &lt;span style="color:#00688b">$CHECK_DIR&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">fi&lt;/span>
&lt;span style="color:#00688b">DOWNLOAD_PATH&lt;/span>=&lt;span style="color:#cd5555">&amp;#34;http://{download.path}/checkstyle&amp;#34;&lt;/span>
&lt;span style="color:#00688b">CONFIG_CHECK_JAR&lt;/span>=&lt;span style="color:#00688b">$CHECK_DIR&lt;/span>/checkstyle.jar;
&lt;span style="color:#00688b">CONFIG_CHECK_FILE&lt;/span>=&lt;span style="color:#00688b">$CHECK_DIR&lt;/span>/checkstyle.xml;
&lt;span style="color:#00688b">CONFIG_ERROR_FILE&lt;/span>=&lt;span style="color:#00688b">$CHECK_DIR&lt;/span>/checkstyle_errors.xml;
&lt;span style="color:#00688b">CONFIG_ERROR_REPORT_FILE&lt;/span>=&lt;span style="color:#00688b">$CHECK_DIR&lt;/span>/checkstyle_report.xml;
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> [ ! -f &lt;span style="color:#00688b">$CONFIG_CHECK_JAR&lt;/span> ]
&lt;span style="color:#8b008b;font-weight:bold">then&lt;/span>
curl -o &lt;span style="color:#00688b">$CONFIG_CHECK_JAR&lt;/span> &lt;span style="color:#00688b">$DOWNLOAD_PATH&lt;/span>/checkstyle-8.8-all.jar || true;
&lt;span style="color:#8b008b;font-weight:bold">fi&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> [ ! -f &lt;span style="color:#00688b">$CONFIG_CHECK_FILE&lt;/span> ]
&lt;span style="color:#8b008b;font-weight:bold">then&lt;/span>
curl -o &lt;span style="color:#00688b">$CONFIG_CHECK_FILE&lt;/span> &lt;span style="color:#00688b">$DOWNLOAD_PATH&lt;/span>/checkstyle.xml || true;
&lt;span style="color:#8b008b;font-weight:bold">fi&lt;/span>
&lt;span style="color:#00688b">javafiles&lt;/span>=&lt;span style="color:#cd5555">`&lt;/span>git diff --cached --name-only | grep &lt;span style="color:#cd5555">&amp;#39;\.java&amp;#39;&lt;/span>&lt;span style="color:#cd5555">`&lt;/span>;
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#00688b">$javafiles&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> [ -f &lt;span style="color:#00688b">$CONFIG_ERROR_FILE&lt;/span> ]
&lt;span style="color:#8b008b;font-weight:bold">then&lt;/span>
rm &lt;span style="color:#00688b">$CONFIG_ERROR_FILE&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">fi&lt;/span>
&lt;span style="color:#00688b">CHECK_CMD&lt;/span>=&lt;span style="color:#cd5555">&amp;#34;java -cp &lt;/span>&lt;span style="color:#00688b">$CONFIG_CHECK_JAR&lt;/span>&lt;span style="color:#cd5555"> com.puppycrawl.tools.checkstyle.Main -c &lt;/span>&lt;span style="color:#00688b">$CONFIG_CHECK_FILE&lt;/span>&lt;span style="color:#cd5555"> &lt;/span>&lt;span style="color:#00688b">$javafiles&lt;/span>&lt;span style="color:#cd5555"> -f xml -o &lt;/span>&lt;span style="color:#00688b">$CONFIG_ERROR_FILE&lt;/span>&lt;span style="color:#cd5555">&amp;#34;&lt;/span>;
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#cd5555">&amp;#34;&lt;/span>&lt;span style="color:#00688b">$CHECK_CMD&lt;/span>&lt;span style="color:#cd5555">&amp;#34;&lt;/span>;
&lt;span style="color:#00688b">$CHECK_CMD&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> [ -f &lt;span style="color:#00688b">$CONFIG_ERROR_FILE&lt;/span> ]
&lt;span style="color:#8b008b;font-weight:bold">then&lt;/span>
&lt;span style="color:#00688b">errorResponse&lt;/span>=&lt;span style="color:#cd5555">`&lt;/span>cat &lt;span style="color:#00688b">$CONFIG_ERROR_FILE&lt;/span> | grep &lt;span style="color:#cd5555">\&amp;lt;&lt;/span>error|head -n 1&lt;span style="color:#cd5555">`&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> [[ &lt;span style="color:#00688b">$errorResponse&lt;/span> == *&lt;span style="color:#cd5555">&amp;#34;error&amp;#34;&lt;/span>* ]]
&lt;span style="color:#8b008b;font-weight:bold">then&lt;/span>
awk &lt;span style="color:#cd5555">&amp;#39;{print;} NR == 1 { print &amp;#34;&amp;lt;?xml-stylesheet xmlns=\&amp;#34;http://www.w3.org/1999/xhtml\&amp;#34; href=\&amp;#34;checkstyle-simple.xsl\&amp;#34; type=\&amp;#34;text/xsl\&amp;#34;?&amp;gt;&amp;#34;}&amp;#39;&lt;/span> &lt;span style="color:#00688b">$CONFIG_ERROR_FILE&lt;/span> &amp;gt; &lt;span style="color:#00688b">$CONFIG_ERROR_REPORT_FILE&lt;/span>;
&lt;span style="color:#658b00">echo&lt;/span> -e &lt;span style="color:#cd5555">&amp;#34;Check your code. Open by Safari or Chrome ( --allow-file-access-from-files ): &lt;/span>&lt;span style="color:#00688b">$CONFIG_ERROR_REPORT_FILE&lt;/span>&lt;span style="color:#cd5555">&amp;#34;&lt;/span>;
open &lt;span style="color:#00688b">$CONFIG_ERROR_REPORT_FILE&lt;/span>
&lt;span style="color:#658b00">exit&lt;/span> &lt;span style="color:#b452cd">1&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">fi&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">fi&lt;/span>
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#cd5555">&amp;#34;check pass! pre_commit successfully!&amp;#34;&lt;/span>;
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>commit-msg&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&lt;span style="color:#1e889b">#!/bin/sh
&lt;/span>&lt;span style="color:#1e889b">&lt;/span>&lt;span style="color:#228b22"># append CL message ä¿¡æ¯ï¼ˆåŠ å…¥ä½œè€… ä¾‹å­ï¼‰&lt;/span>
&lt;span style="color:#228b22">#name=[PinkHello]&lt;/span>
&lt;span style="color:#228b22">#commit=&amp;#34;$name $(cat $1)&amp;#34;&lt;/span>
&lt;span style="color:#228b22">#echo &amp;#34;$commit&amp;#34; &amp;gt; &amp;#34;$1&amp;#34;&lt;/span>
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#00688b">$commit&lt;/span>
&lt;span style="color:#00688b">commit&lt;/span>=&lt;span style="color:#cd5555">`&lt;/span>cat &lt;span style="color:#00688b">$1&lt;/span>&lt;span style="color:#cd5555">`&lt;/span>
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#cd5555">&amp;#34;&lt;/span>&lt;span style="color:#00688b">$commit&lt;/span>&lt;span style="color:#cd5555">&amp;#34;&lt;/span> &amp;gt; &lt;span style="color:#cd5555">&amp;#34;&lt;/span>&lt;span style="color:#00688b">$1&lt;/span>&lt;span style="color:#cd5555">&amp;#34;&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> [[ &lt;span style="color:#00688b">$commit&lt;/span> =~ ^([A-Z]+)-([0-9]+):.*|(Merge.*)|(Revert.*)|(Other.*) ]]
&lt;span style="color:#8b008b;font-weight:bold">then&lt;/span>
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#cd5555">&amp;#34;commit successful!&amp;#34;&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">else&lt;/span>
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#cd5555">&amp;#34;\033 Error: the commit message must start with JIRA ticket number \033&amp;#34;&lt;/span>
&lt;span style="color:#658b00">exit&lt;/span> &lt;span style="color:#b452cd">1&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">fi&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>init.sh&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&lt;span style="color:#1e889b">#!/bin/sh
&lt;/span>&lt;span style="color:#1e889b">&lt;/span>&lt;span style="color:#228b22"># å½“å‰ç›®å½•&lt;/span>
&lt;span style="color:#00688b">workPath&lt;/span>=&lt;span style="color:#8b008b;font-weight:bold">$(&lt;/span>&lt;span style="color:#658b00">pwd&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">)&lt;/span>
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#cd5555">&amp;#34;å½“å‰åˆå§‹åŒ–ç›®å½•&lt;/span>&lt;span style="color:#00688b">$workPath&lt;/span>&lt;span style="color:#cd5555">&amp;#34;&lt;/span>
&lt;span style="color:#228b22"># é“¾æ¥åˆ° .git hooks ç›®å½•é‡Œé¢&lt;/span>
ln -s -f &lt;span style="color:#00688b">$workPath&lt;/span>/pre-commit &lt;span style="color:#00688b">$workPath&lt;/span>/../.git/hooks/pre-commit
ln -s -f &lt;span style="color:#00688b">$workPath&lt;/span>/commit-msg &lt;span style="color:#00688b">$workPath&lt;/span>/../.git/hooks/commit-msg
&lt;span style="color:#658b00">echo&lt;/span> &lt;span style="color:#cd5555">&amp;#34;ln pre-commit commit-msg.....success.&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="google-cr-mr-è§„èŒƒ">google CR MR è§„èŒƒ&lt;/h1>
&lt;p>&lt;a href="https://github.com/google/eng-practices">https://github.com/google/eng-practices&lt;/a>&lt;/p>
&lt;p>&lt;code>CL&lt;/code> è§„èŒƒï¼š&lt;/p>
&lt;ul>
&lt;li>æäº¤æ–°çš„ &lt;code>subject&lt;/code> ï¼Œæ‰æœ‰ç¥ˆä½¿å¥ï¼Œä¸€ä¸ªå‘½ä»¤çš„å½¢å¼è¨€ç®€æ„èµ…çš„è¡¨è¾¾è¿™æ¬¡è¦æ”¹å˜çš„ä»€ä¹ˆï¼Œå¦‚éœ€è¦è¯¦ç»†ä¸Šä¸‹æ–‡ï¼Œå…³è” &lt;code>ticket&lt;/code>ï¼Œåœ¨ &lt;code>body&lt;/code> ä¸­è¯´æ˜&lt;/li>
&lt;li>ç®€åŒ– &lt;code>cl&lt;/code> ï¼Œå°½å¯èƒ½å°ï¼Œä¸è¦ç§¯æ”’ä¸€å † &lt;code>change&lt;/code> ï¼Œä¸€æ¬¡æ€§æäº¤ï¼Œç„¶åå†ä¸€æ¬¡æ€§ &lt;code>MR&lt;/code> ï¼ŒåŠ å¤§äº† &lt;code>review&lt;/code> é£é™©ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;code>MR&lt;/code> è§„èŒƒ&lt;/p>
&lt;ul>
&lt;li>ç´§æ€¥ &lt;code>MR&lt;/code> é€‚å½“æ”¾æ¾&lt;/li>
&lt;li>&lt;code>MR&lt;/code> ä¸èƒ½å¸¦æœ‰è„¾æ°”ï¼Œç›®çš„æ˜¯åŸºäºé—®é¢˜è®¨è®ºï¼Œè§£å†³é—®é¢˜&lt;/li>
&lt;li>é’ˆå¯¹åšçš„å¥½çš„ç»™äºˆè‚¯å®šå’ŒğŸ‘&lt;/li>
&lt;li>&lt;code>LGTM means look good to me &lt;/code>= æœ•çŸ¥é“äº†ï¼&lt;/li>
&lt;li>&lt;code>MR&lt;/code> å†²çªï¼Œè”ç³»å¿…è¦å¼€å‘è€…ä¸€èµ·å‚ä¸å†³å®šé¿å…å‡ºç°ä»£ç ä¸¢å¤±ä¸é”™è¯¯.&lt;/li>
&lt;/ul>
&lt;p>&lt;code>CR&lt;/code> è§„èŒƒ&lt;/p>
&lt;ul>
&lt;li>é€Ÿåº¦å¯ä»¥ç­æ€ä¸€åˆ‡æŠ±æ€¨ï¼Œä¸èƒ½è®© &lt;code>cr&lt;/code> æ—¶é—´è¿‡é•¿&lt;/li>
&lt;li>&lt;code>CR&lt;/code> å‘ç°é—®é¢˜ä¸€å®šè¦è®©å¼€å‘è€…å»ä¿®æ”¹ï¼Œä¸è¦æœ‰ä»¥åå†ä¿®æ”¹çš„æƒ³æ³•ï¼Œè¿™ç§æ–¹å¼å¾€å¾€æ˜¯è®©ç³»ç»Ÿå˜å¾—æ›´å·®çš„åŸå› .&lt;/li>
&lt;/ul>
- https://pinkhello.me/posts/09-%E4%BD%BF%E7%94%A8githook%E7%BB%9F%E4%B8%80codestyle/ - PinkHello, All Rights Reserved</description></item><item><title>08 Gradleå¤šæ¨¡å—é¡¹ç›®æ¨¡æ¿åŒ–</title><link>https://pinkhello.me/posts/08-gradle%E5%A4%9A%E6%A8%A1%E5%9D%97%E9%A1%B9%E7%9B%AE%E6%A8%A1%E6%9D%BF%E5%8C%96/</link><pubDate>Wed, 10 Feb 2021 08:43:21 +0800</pubDate><guid>https://pinkhello.me/posts/08-gradle%E5%A4%9A%E6%A8%A1%E5%9D%97%E9%A1%B9%E7%9B%AE%E6%A8%A1%E6%9D%BF%E5%8C%96/</guid><description>PinkHello https://pinkhello.me/posts/08-gradle%E5%A4%9A%E6%A8%A1%E5%9D%97%E9%A1%B9%E7%9B%AE%E6%A8%A1%E6%9D%BF%E5%8C%96/ -&lt;h2 id="å‰è¨€">å‰è¨€&lt;/h2>
&lt;p>Maven å†—ä½™ï¼Œ Gradle ç®€å•è½»ä¾¿
å…¬å¸åŸæœ‰çš„ CI/CD æµç¨‹ï¼Œå€ŸåŠ© Maven æ’ä»¶ build Docker Image,æ”¹ä¸ºåŸç”Ÿ Docker Runner åŸå§‹æ„å»º&lt;/p>
&lt;h2 id="1å¤šæ¨¡å—é¡¹ç›®">1ã€å¤šæ¨¡å—é¡¹ç›®&lt;/h2>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-yaml" data-lang="yaml">project&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- app&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- src/main/[java|resources] | src/test/[java|resources] &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># classpath&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- Dockerfile &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># Dockerfile&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- build.gradle &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># APP æ¨¡å— gradle é…ç½®&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- sdk &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># SDK æ¨¡å— å¯æœ‰å¯æ— &lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- src/main/java&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- build.gradle &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># SDK çš„ gradle é…ç½®&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- deploy &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># delpoy é¡¹ç›® æ³¨æ„ checkstyle ç›¸å…³é…ç½®åœ¨è¿™é‡Œé¢&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- checkstyle/**&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- &lt;span style="color:#1e889b">**.yml&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- build.gradle &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># é¡¹ç›®é¡¶çº§ gradleé…ç½®&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- gradle&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- wrapper/** &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># gradle é…ç½®ä¿¡æ¯&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- check.gradle &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># pmd &amp;amp; checkstyle&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- repo.gradle &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># ä»“åº“å®šä¹‰&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb">&lt;/span>&lt;span style="color:#228b22"># test.gradle æ”¾è¿™å„¿ï¼Œå°±æ²¡æœ‰é«˜äº®äº† =&amp;gt; æš‚æ—¶ç»´æŠ¤åœ¨ é¡¶å±‚çš„ build.gradle ä¸­ï¼Œå•ç‹¬ç»´æŠ¤ï¼Œä¸è¦å’Œå…¶ä»–é…ç½®æ··åœ¨ä¸€èµ·ã€‚&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- settings.gradle &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># é…ç½®&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- versions-prod.gradle &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># ç‰ˆæœ¬å®šä¹‰&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- versions-dev.gradle &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># ç‰ˆæœ¬å®šä¹‰&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- .gitignore &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># gitå¿½ç•¥æ–‡ä»¶&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;span style="color:#bbb"> &lt;/span>- .gitlab-ci.yml &lt;span style="color:#bbb"> &lt;/span>&lt;span style="color:#228b22"># CI/CD&lt;/span>&lt;span style="color:#bbb">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="2project-ä¸‹å„ä¸ªgradleæ–‡ä»¶">2ã€Project ä¸‹å„ä¸ªgradleæ–‡ä»¶&lt;/h2>
&lt;p>Project/versions.gradle å¯ä»¥ç»Ÿä¸€ç‰ˆæœ¬ç®¡ç†&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-groovy" data-lang="groovy">&lt;span style="color:#228b22">//start step
&lt;/span>&lt;span style="color:#228b22">&lt;/span>&lt;span style="color:#00688b;font-weight:bold">def&lt;/span> versions = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> Expando()
&lt;span style="color:#00688b;font-weight:bold">def&lt;/span> deps = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> Expando()
ext.&lt;span style="color:#658b00">versions&lt;/span> = versions
ext.&lt;span style="color:#658b00">deps&lt;/span> = deps
&lt;span style="color:#228b22">//set versions
&lt;/span>&lt;span style="color:#228b22">&lt;/span>versions.&lt;span style="color:#658b00">springboot&lt;/span> = &lt;span style="color:#cd5555">&amp;#34;2.1.16.RELEASE&amp;#34;&lt;/span>
versions.&lt;span style="color:#658b00">mysql&lt;/span> = &lt;span style="color:#cd5555">&amp;#34;8.0.16&amp;#34;&lt;/span>
versions.&lt;span style="color:#658b00">guava&lt;/span> = &lt;span style="color:#cd5555">&amp;#34;25.1-jre&amp;#34;&lt;/span>
versions.&lt;span style="color:#658b00">httpclient&lt;/span> = &lt;span style="color:#cd5555">&amp;#34;4.5.9&amp;#34;&lt;/span>
versions.&lt;span style="color:#658b00">okhttp3&lt;/span> = &lt;span style="color:#cd5555">&amp;#34;3.8.1&amp;#34;&lt;/span>
versions.&lt;span style="color:#658b00">apm&lt;/span> = &lt;span style="color:#cd5555">&amp;#34;1.7.0&amp;#34;&lt;/span>
versions.&lt;span style="color:#658b00">kotlin&lt;/span> = &lt;span style="color:#cd5555">&amp;#34;1.4.10&amp;#34;&lt;/span>
&lt;span style="color:#228b22">//set dependencies
&lt;/span>&lt;span style="color:#228b22">&lt;/span>
&lt;span style="color:#228b22">// åŸºç¡€å¼€æºåŒ…
&lt;/span>&lt;span style="color:#228b22">&lt;/span>deps.&lt;span style="color:#658b00">mysql&lt;/span> = &lt;span style="color:#cd5555">&amp;#34;mysql:mysql-connector-java:${versions.mysql}&amp;#34;&lt;/span>
deps.&lt;span style="color:#658b00">guava&lt;/span> = &lt;span style="color:#cd5555">&amp;#34;com.google.guava:guava:${versions.guava}&amp;#34;&lt;/span>
deps.&lt;span style="color:#658b00">okhttp3&lt;/span> = &lt;span style="color:#cd5555">&amp;#34;com.squareup.okhttp3:okhttp:${versions.okhttp3}&amp;#34;&lt;/span>
deps.&lt;span style="color:#658b00">apm&lt;/span> = &lt;span style="color:#cd5555">&amp;#34;co.elastic.apm:apm-agent-attach:${versions.apm}&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Project/settings.gradle æ ¹é…ç½®æ–‡ä»¶ï¼Œbuild å¿«ä¸å¿«å…¨é å®ƒ&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-groovy" data-lang="groovy">&lt;span style="color:#228b22">//é…ç½®æ’ä»¶èµ°å›½å†…ä»£ç†
&lt;/span>&lt;span style="color:#228b22">&lt;/span>pluginManagement {
repositories {
maven {
url &lt;span style="color:#cd5555">&amp;#39;https://maven.aliyun.com/repository/gradle-plugin&amp;#39;&lt;/span>
}
gradlePluginPortal()
}
}
rootProject.&lt;span style="color:#658b00">name&lt;/span> = &lt;span style="color:#cd5555">&amp;#39;project-name&amp;#39;&lt;/span>
include &lt;span style="color:#cd5555">&amp;#39;:app&amp;#39;&lt;/span>
include &lt;span style="color:#cd5555">&amp;#39;:sdk&amp;#39;&lt;/span> &lt;span style="color:#228b22">// æ²¡æœ‰SDKæ¨¡å—çš„åŒ–ä¸éœ€è¦è¿™ä¸ª
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Project/build.gradle&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-groovy" data-lang="groovy">buildscript {
ext {
kotlinVersion = &lt;span style="color:#cd5555">&amp;#34;1.4.10&amp;#34;&lt;/span>
springBootVersion = &lt;span style="color:#cd5555">&amp;#39;2.1.16.RELEASE&amp;#39;&lt;/span>
springBootGradleVersion = &lt;span style="color:#cd5555">&amp;#39;2.3.3.RELEASE&amp;#39;&lt;/span>
}
}
plugins {
id &lt;span style="color:#cd5555">&amp;#34;java&amp;#34;&lt;/span>
id &lt;span style="color:#cd5555">&amp;#34;pmd&amp;#34;&lt;/span>
id &lt;span style="color:#cd5555">&amp;#34;checkstyle&amp;#34;&lt;/span>
id &lt;span style="color:#cd5555">&amp;#34;maven-publish&amp;#34;&lt;/span>
id &lt;span style="color:#cd5555">&amp;#34;org.jetbrains.kotlin.jvm&amp;#34;&lt;/span> version &lt;span style="color:#cd5555">&amp;#34;$kotlinVersion&amp;#34;&lt;/span>
id &lt;span style="color:#cd5555">&amp;#34;org.jetbrains.kotlin.plugin.spring&amp;#34;&lt;/span> version &lt;span style="color:#cd5555">&amp;#34;$kotlinVersion&amp;#34;&lt;/span>
id &lt;span style="color:#cd5555">&amp;#34;org.springframework.boot&amp;#34;&lt;/span> version &lt;span style="color:#cd5555">&amp;#34;$springBootVersion&amp;#34;&lt;/span>
id &lt;span style="color:#cd5555">&amp;#34;io.spring.dependency-management&amp;#34;&lt;/span> version &lt;span style="color:#cd5555">&amp;#34;1.0.9.RELEASE&amp;#34;&lt;/span>
}
apply from: file(&lt;span style="color:#cd5555">&amp;#34;versions.gradle&amp;#34;&lt;/span>)
&lt;span style="color:#228b22">// ä¸ºäº†ä¸€å¦‚ä¸åŒçš„ç‰ˆæœ¬ç¯å¢ƒä¸‹çš„ä»£ç é…ç½®
&lt;/span>&lt;span style="color:#228b22">&lt;/span>&lt;span style="color:#00688b;font-weight:bold">def&lt;/span> env = System.&lt;span style="color:#658b00">getProperty&lt;/span>(&lt;span style="color:#cd5555">&amp;#39;env&amp;#39;&lt;/span>) ?: &lt;span style="color:#cd5555">&amp;#39;dev&amp;#39;&lt;/span>
apply from: &lt;span style="color:#cd5555">&amp;#34;${rootDir}/versions-${env}.gradle&amp;#34;&lt;/span>
allprojects {
&lt;span style="color:#228b22">// é…ç½® group
&lt;/span>&lt;span style="color:#228b22">&lt;/span> group &lt;span style="color:#cd5555">&amp;#34;com.XXX.XXX&amp;#34;&lt;/span>
&lt;span style="color:#228b22">//é…ç½®ç‰ˆæœ¬
&lt;/span>&lt;span style="color:#228b22">&lt;/span> version = findProperty &lt;span style="color:#cd5555">&amp;#39;version&amp;#39;&lt;/span> ?: &lt;span style="color:#cd5555">&amp;#39;1.0.0-SNAPSHOT&amp;#39;&lt;/span>
bootJar {
enabled = &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>
}
apply plugin: &lt;span style="color:#cd5555">&amp;#34;java&amp;#34;&lt;/span>
apply plugin: &lt;span style="color:#cd5555">&amp;#34;idea&amp;#34;&lt;/span>
apply plugin: &lt;span style="color:#cd5555">&amp;#34;maven-publish&amp;#34;&lt;/span>
apply plugin: &lt;span style="color:#cd5555">&amp;#34;org.jetbrains.kotlin.jvm&amp;#34;&lt;/span>
apply plugin: &lt;span style="color:#cd5555">&amp;#34;kotlin-spring&amp;#34;&lt;/span>
apply plugin: &lt;span style="color:#cd5555">&amp;#34;org.springframework.boot&amp;#34;&lt;/span>
apply plugin: &lt;span style="color:#cd5555">&amp;#34;io.spring.dependency-management&amp;#34;&lt;/span>
apply plugin: &lt;span style="color:#cd5555">&amp;#39;jacoco&amp;#39;&lt;/span>
&lt;span style="color:#228b22">//å‡å¦‚ ä½ çš„ mapper.xml æˆ–è€… grovvy å†™åœ¨ src/main/java ï¼Œæ‰“åŒ…éœ€è¦å¤„ç†åˆ° éœ€è¦åŠ å…¥çš„resourcesï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#228b22">// å½“ç„¶å¦‚æœ ä½ çš„ mapper.xml ç›´æ¥åœ¨ src/main/resources é‡Œé¢ ä¸éœ€è¦å¤„ç†ï¼Œå¯ä»¥ç›´æ¥åˆ é™¤
&lt;/span>&lt;span style="color:#228b22">&lt;/span> processResources {
from(&lt;span style="color:#cd5555">&amp;#39;src/main/java&amp;#39;&lt;/span>) {
include &lt;span style="color:#cd5555">&amp;#39;**/*.xml&amp;#39;&lt;/span>
include &lt;span style="color:#cd5555">&amp;#39;**/*.groovy&amp;#39;&lt;/span>
}
}
}
&lt;span style="color:#228b22">// apply from: file(&amp;#34;gradle/repo.gradle&amp;#34;)
&lt;/span>&lt;span style="color:#228b22">// apply from: file(&amp;#34;gradle/check.gradle&amp;#34;)
&lt;/span>&lt;span style="color:#228b22">// apply from: file(&amp;#34;gradle/maven-publish.gradle&amp;#34;)
&lt;/span>&lt;span style="color:#228b22">&lt;/span>apply from: &lt;span style="color:#cd5555">&amp;#39;https://${DownloadPath}/gradle/check-style.gradle&amp;#39;&lt;/span>
apply from: &lt;span style="color:#cd5555">&amp;#39;https://${DownloadPath}/gradle/maven-repo.gradle&amp;#39;&lt;/span>
apply from: &lt;span style="color:#cd5555">&amp;#39;https://${DownloadPath}/gradle/maven-publish.gradle&amp;#39;&lt;/span>
subprojects {
configurations {
provided
}
sourceSets.&lt;span style="color:#658b00">main&lt;/span>.&lt;span style="color:#658b00">compileClasspath&lt;/span> += configurations.&lt;span style="color:#658b00">provided&lt;/span>
sourceSets.&lt;span style="color:#658b00">test&lt;/span>.&lt;span style="color:#658b00">compileClasspath&lt;/span> += configurations.&lt;span style="color:#658b00">provided&lt;/span>
sourceSets.&lt;span style="color:#658b00">test&lt;/span>.&lt;span style="color:#658b00">runtimeClasspath&lt;/span> += configurations.&lt;span style="color:#658b00">provided&lt;/span>
tasks.&lt;span style="color:#658b00">withType&lt;/span>(JavaCompile) {
options.&lt;span style="color:#658b00">encoding&lt;/span> = &lt;span style="color:#cd5555">&amp;#39;UTF-8&amp;#39;&lt;/span>
}
task &lt;span style="color:#008b45">sourceJar&lt;/span>(type: Jar) {
from sourceSets.&lt;span style="color:#658b00">main&lt;/span>.&lt;span style="color:#658b00">allJava&lt;/span>
classifier &lt;span style="color:#cd5555">&amp;#34;sources&amp;#34;&lt;/span>
}
task &lt;span style="color:#008b45">javadocJar&lt;/span>(type: Jar, dependsOn: javadoc) {
from javadoc.&lt;span style="color:#658b00">destinationDir&lt;/span>
}
dependencies {
implementation &lt;span style="color:#cd5555">&amp;#34;com.google.guava:guava:$versions.guava&amp;#34;&lt;/span>
compileOnly &lt;span style="color:#cd5555">&amp;#39;org.projectlombok:lombok:1.18.4&amp;#39;&lt;/span>
annotationProcessor &lt;span style="color:#cd5555">&amp;#39;org.projectlombok:lombok:1.18.4&amp;#39;&lt;/span>
testCompileOnly &lt;span style="color:#cd5555">&amp;#39;org.projectlombok:lombok:1.18.4&amp;#39;&lt;/span>
testAnnotationProcessor &lt;span style="color:#cd5555">&amp;#39;org.projectlombok:lombok:1.18.4&amp;#39;&lt;/span>
testImplementation &lt;span style="color:#cd5555">&amp;#34;org.springframework.boot:spring-boot-starter-test:$springBootVersion&amp;#34;&lt;/span>
testImplementation &lt;span style="color:#cd5555">&amp;#34;org.mockito:mockito-core:2.23.4&amp;#34;&lt;/span>
testImplementation &lt;span style="color:#cd5555">&amp;#39;junit:junit:4.13&amp;#39;&lt;/span>
&lt;span style="color:#228b22">// h2
&lt;/span>&lt;span style="color:#228b22">&lt;/span> testImplementation &lt;span style="color:#cd5555">&amp;#34;com.h2database:h2:1.4.200&amp;#34;&lt;/span>
&lt;span style="color:#228b22">// redis memery
&lt;/span>&lt;span style="color:#228b22">&lt;/span> testImplementation &lt;span style="color:#cd5555">&amp;#34;com.github.kstyrc:embedded-redis:0.6&amp;#34;&lt;/span>
}
&lt;span style="color:#228b22">// jacoco report
&lt;/span>&lt;span style="color:#228b22">&lt;/span> jacocoTestReport {
reports {
xml.&lt;span style="color:#658b00">enabled&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>
html.&lt;span style="color:#658b00">enabled&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>
}
}
check.&lt;span style="color:#658b00">dependsOn&lt;/span> jacocoTestReport
}
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-groovy" data-lang="groovy">
allprojects {
apply plugin: &lt;span style="color:#cd5555">&amp;#39;maven-publish&amp;#39;&lt;/span>
publishing {
task &lt;span style="color:#008b45">sourceJar&lt;/span>(type: Jar) {
from sourceSets.&lt;span style="color:#658b00">main&lt;/span>.&lt;span style="color:#658b00">allJava&lt;/span>
classifier &lt;span style="color:#cd5555">&amp;#34;sources&amp;#34;&lt;/span>
}
publications {
mavenSnapshots(MavenPublication) {
groupId project.&lt;span style="color:#658b00">group&lt;/span>
artifactId project.&lt;span style="color:#658b00">name&lt;/span>
version project.&lt;span style="color:#658b00">version&lt;/span>
from components.&lt;span style="color:#658b00">java&lt;/span>
artifact sourceJar
ext.&lt;span style="color:#658b00">repo&lt;/span> = &lt;span style="color:#cd5555">&amp;#39;Dev&amp;#39;&lt;/span>
}
mavenRelease(MavenPublication) {
groupId project.&lt;span style="color:#658b00">group&lt;/span>
artifactId project.&lt;span style="color:#658b00">name&lt;/span>
version project.&lt;span style="color:#658b00">version&lt;/span>
from components.&lt;span style="color:#658b00">java&lt;/span>
artifact sourceJar
ext.&lt;span style="color:#658b00">repo&lt;/span> = &lt;span style="color:#cd5555">&amp;#39;Prod&amp;#39;&lt;/span>
}
}
repositories {
maven {
name &lt;span style="color:#cd5555">&amp;#39;Dev&amp;#39;&lt;/span>
url &lt;span style="color:#cd5555">&amp;#34;${NEXUS_URL}/repository/maven-snapshots/&amp;#34;&lt;/span>
authentication {
header(HttpHeaderAuthentication)
}
credentials(HttpHeaderCredentials) {
name &lt;span style="color:#cd5555">&amp;#34;Authorization&amp;#34;&lt;/span>
value &lt;span style="color:#cd5555">&amp;#34;Basic ${NEXUS_CAS_HEADER}&amp;#34;&lt;/span>
}
}
maven {
name &lt;span style="color:#cd5555">&amp;#39;Prod&amp;#39;&lt;/span>
url &lt;span style="color:#cd5555">&amp;#34;${NEXUS_URL}/repository/maven-releases/&amp;#34;&lt;/span>
}
}
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Project/gradle/repo.gradle æŒ‡å®šç§æœ‰ä»“åº“åœ°å€ä»¥åŠéªŒè¯æ–¹å¼&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-groovy" data-lang="groovy">buildscript {
repositories {
mavenLocal()
maven {
url &lt;span style="color:#cd5555">&amp;#34;${NEXUS_URL}/repository/maven-releases/&amp;#34;&lt;/span>
authentication {
header(HttpHeaderAuthentication)
}
credentials(HttpHeaderCredentials) {
name &lt;span style="color:#cd5555">&amp;#34;Authorization&amp;#34;&lt;/span>
value &lt;span style="color:#cd5555">&amp;#34;Basic ${NEXUS_CAS_HEADER}&amp;#34;&lt;/span>
}
}
maven {
url &lt;span style="color:#cd5555">&amp;#34;${NEXUS_URL}/repository/maven-snapshots/&amp;#34;&lt;/span>
authentication {
header(HttpHeaderAuthentication)
}
credentials(HttpHeaderCredentials) {
name &lt;span style="color:#cd5555">&amp;#34;Authorization&amp;#34;&lt;/span>
value &lt;span style="color:#cd5555">&amp;#34;Basic ${NEXUS_CAS_HEADER}&amp;#34;&lt;/span>
}
}
maven {
url &lt;span style="color:#cd5555">&amp;#34;${NEXUS_URL}/repository/maven-public/&amp;#34;&lt;/span>
authentication {
header(HttpHeaderAuthentication)
}
credentials(HttpHeaderCredentials) {
name &lt;span style="color:#cd5555">&amp;#34;Authorization&amp;#34;&lt;/span>
value &lt;span style="color:#cd5555">&amp;#34;Basic ${NEXUS_CAS_HEADER}&amp;#34;&lt;/span>
}
}
maven { url &lt;span style="color:#cd5555">&amp;#34;https://maven.aliyun.com/nexus/content/groups/public/&amp;#34;&lt;/span> }
maven { url &lt;span style="color:#cd5555">&amp;#34;https://repo.spring.io/milestone&amp;#34;&lt;/span> }
maven { url &lt;span style="color:#cd5555">&amp;#34;https://oss.sonatype.org/content/repositories/snapshots/&amp;#34;&lt;/span> }
}
}
allprojects {
repositories {
mavenLocal()
maven {
url &lt;span style="color:#cd5555">&amp;#34;${NEXUS_URL}/repository/maven-releases/&amp;#34;&lt;/span>
authentication {
header(HttpHeaderAuthentication)
}
credentials(HttpHeaderCredentials) {
name &lt;span style="color:#cd5555">&amp;#34;Authorization&amp;#34;&lt;/span>
value &lt;span style="color:#cd5555">&amp;#34;Basic ${NEXUS_CAS_HEADER}&amp;#34;&lt;/span>
}
}
maven {
url &lt;span style="color:#cd5555">&amp;#34;${NEXUS_URL}/repository/maven-snapshots/&amp;#34;&lt;/span>
authentication {
header(HttpHeaderAuthentication)
}
credentials(HttpHeaderCredentials) {
name &lt;span style="color:#cd5555">&amp;#34;Authorization&amp;#34;&lt;/span>
value &lt;span style="color:#cd5555">&amp;#34;Basic ${NEXUS_CAS_HEADER}&amp;#34;&lt;/span>
}
}
maven {
url &lt;span style="color:#cd5555">&amp;#34;${NEXUS_URL}/repository/maven-public/&amp;#34;&lt;/span>
authentication {
header(HttpHeaderAuthentication)
}
credentials(HttpHeaderCredentials) {
name &lt;span style="color:#cd5555">&amp;#34;Authorization&amp;#34;&lt;/span>
value &lt;span style="color:#cd5555">&amp;#34;Basic ${NEXUS_CAS_HEADER}&amp;#34;&lt;/span>
}
}
maven { url &lt;span style="color:#cd5555">&amp;#34;https://maven.aliyun.com/nexus/content/groups/public/&amp;#34;&lt;/span> }
maven { url &lt;span style="color:#cd5555">&amp;#34;https://repo.spring.io/milestone&amp;#34;&lt;/span> }
maven { url &lt;span style="color:#cd5555">&amp;#34;https://oss.sonatype.org/content/repositories/snapshots/&amp;#34;&lt;/span> }
}
}
subprojects {
repositories {
mavenLocal()
maven {
url &lt;span style="color:#cd5555">&amp;#34;${NEXUS_URL}/repository/maven-releases/&amp;#34;&lt;/span>
authentication {
header(HttpHeaderAuthentication)
}
credentials(HttpHeaderCredentials) {
name &lt;span style="color:#cd5555">&amp;#34;Authorization&amp;#34;&lt;/span>
value &lt;span style="color:#cd5555">&amp;#34;Basic ${NEXUS_CAS_HEADER}&amp;#34;&lt;/span>
}
}
maven {
url &lt;span style="color:#cd5555">&amp;#34;${NEXUS_URL}/repository/maven-snapshots/&amp;#34;&lt;/span>
authentication {
header(HttpHeaderAuthentication)
}
credentials(HttpHeaderCredentials) {
name &lt;span style="color:#cd5555">&amp;#34;Authorization&amp;#34;&lt;/span>
value &lt;span style="color:#cd5555">&amp;#34;Basic ${NEXUS_CAS_HEADER}&amp;#34;&lt;/span>
}
}
maven {
url &lt;span style="color:#cd5555">&amp;#34;${NEXUS_URL}/repository/maven-public/&amp;#34;&lt;/span>
authentication {
header(HttpHeaderAuthentication)
}
credentials(HttpHeaderCredentials) {
name &lt;span style="color:#cd5555">&amp;#34;Authorization&amp;#34;&lt;/span>
value &lt;span style="color:#cd5555">&amp;#34;Basic ${NEXUS_CAS_HEADER}&amp;#34;&lt;/span>
}
}
maven { url &lt;span style="color:#cd5555">&amp;#34;https://maven.aliyun.com/nexus/content/groups/public/&amp;#34;&lt;/span> }
maven { url &lt;span style="color:#cd5555">&amp;#34;https://repo.spring.io/milestone&amp;#34;&lt;/span> }
maven { url &lt;span style="color:#cd5555">&amp;#34;https://oss.sonatype.org/content/repositories/snapshots/&amp;#34;&lt;/span> }
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Project/gradle/check.gradle&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-groovy" data-lang="groovy">subprojects {
apply plugin: &lt;span style="color:#cd5555">&amp;#39;checkstyle&amp;#39;&lt;/span>
checkstyle {
configFile = rootProject.&lt;span style="color:#658b00">file&lt;/span>(&lt;span style="color:#cd5555">&amp;#39;deploy/checkstyle/checkstyle.xml&amp;#39;&lt;/span>)
showViolations = &lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>
&lt;span style="color:#228b22">// ignoreFailures = true
&lt;/span>&lt;span style="color:#228b22">&lt;/span>
}
&lt;span style="color:#228b22">//å¯ä»¥æŒ‡å®šæ’æŸ¥
&lt;/span>&lt;span style="color:#228b22">&lt;/span> checkstyleMain {
exclude &lt;span style="color:#cd5555">&amp;#34;**/*.groovy&amp;#34;&lt;/span>
}
apply plugin: &lt;span style="color:#cd5555">&amp;#39;pmd&amp;#39;&lt;/span>
dependencies {
pmd &lt;span style="color:#cd5555">&amp;#34;com.alibaba.p3c:p3c-pmd:2.0.0&amp;#34;&lt;/span>
}
pmd {
consoleOutput = &lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>
ruleSets = [
&lt;span style="color:#cd5555">&amp;#34;java-ali-comment&amp;#34;&lt;/span>,
&lt;span style="color:#cd5555">&amp;#34;java-ali-concurrent&amp;#34;&lt;/span>,
&lt;span style="color:#cd5555">&amp;#34;java-ali-constant&amp;#34;&lt;/span>,
&lt;span style="color:#cd5555">&amp;#34;java-ali-exception&amp;#34;&lt;/span>,
&lt;span style="color:#cd5555">&amp;#34;java-ali-flowcontrol&amp;#34;&lt;/span>,
&lt;span style="color:#cd5555">&amp;#34;java-ali-naming&amp;#34;&lt;/span>,
&lt;span style="color:#cd5555">&amp;#34;java-ali-oop&amp;#34;&lt;/span>,
&lt;span style="color:#cd5555">&amp;#34;java-ali-orm&amp;#34;&lt;/span>,
&lt;span style="color:#cd5555">&amp;#34;java-ali-other&amp;#34;&lt;/span>,
&lt;span style="color:#cd5555">&amp;#34;java-ali-set&amp;#34;&lt;/span>
]
incrementalAnalysis = &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>
}
pmdMain {
exclude &lt;span style="color:#cd5555">&amp;#34;**/exclude_package/**&amp;#34;&lt;/span>
}
}
test.&lt;span style="color:#658b00">mustRunAfter&lt;/span> checkstyleMain, checkstyleTest
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Project/sdk/build.gradle&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-groovy" data-lang="groovy">apply from: file(&lt;span style="color:#cd5555">&amp;#34;$rootDir/versions.gradle&amp;#34;&lt;/span>)
jar {
enabled = &lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>
}
bootJar {
enabled = &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>
}
dependencies {
implementation &lt;span style="color:#cd5555">&amp;#39;org.springframework.cloud:spring-cloud-starter-openfeign:2.1.0.RELEASE&amp;#39;&lt;/span>
......
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Project/app/build.gradle&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-groovy" data-lang="groovy">apply from: file(&lt;span style="color:#cd5555">&amp;#34;$rootDir/versions.gradle&amp;#34;&lt;/span>)
bootJar {
enabled = &lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>
}
jar {
enabled = &lt;span style="color:#8b008b;font-weight:bold">false&lt;/span>
}
dependencies {
implementation deps.&lt;span style="color:#658b00">springboot&lt;/span>.&lt;span style="color:#658b00">starter&lt;/span>
implementation deps.&lt;span style="color:#658b00">springboot&lt;/span>.&lt;span style="color:#658b00">starter_web&lt;/span>
implementation deps.&lt;span style="color:#658b00">mysql&lt;/span>
implementation deps.&lt;span style="color:#658b00">myabtis&lt;/span>.&lt;span style="color:#658b00">myabtis&lt;/span>
implementation deps.&lt;span style="color:#658b00">myabtis&lt;/span>.&lt;span style="color:#658b00">starter&lt;/span>
implementation &lt;span style="color:#cd5555">&amp;#39;org.springframework.boot:spring-boot-starter-amqp:2.1.2.RELEASE&amp;#39;&lt;/span>
implementation &lt;span style="color:#cd5555">&amp;#34;org.springframework.cloud:spring-cloud-starter-openfeign:2.1.0.RELEASE&amp;#34;&lt;/span>
implementation &lt;span style="color:#cd5555">&amp;#39;com.zaxxer:HikariCP:3.4.1&amp;#39;&lt;/span>
implementation &lt;span style="color:#cd5555">&amp;#39;com.baomidou:mybatis-plus:2.2.0&amp;#39;&lt;/span>
implementation &lt;span style="color:#cd5555">&amp;#39;com.github.pagehelper:pagehelper:5.1.2&amp;#39;&lt;/span>
implementation &lt;span style="color:#cd5555">&amp;#39;org.mongodb:mongo-java-driver:3.8.0&amp;#39;&lt;/span>
...... &lt;span style="color:#228b22">//å‰©ä½™æ˜ å°„ä¾èµ–
&lt;/span>&lt;span style="color:#228b22">&lt;/span>}
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="3-dockerfile-æ³¨æ„-add-æ–‡ä»¶è·¯å¾„">3ã€ Dockerfile æ³¨æ„ ADD æ–‡ä»¶è·¯å¾„&lt;/h2>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-dockerfile" data-lang="dockerfile">&lt;span style="color:#8b008b;font-weight:bold">FROM&lt;/span>&lt;span style="color:#cd5555"> {HARBOR_HOST}/BaseImage&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">ADD&lt;/span> ./build/libs/app.jar /app.jar&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;span style="color:#a61717;background-color:#e3d2d2">&lt;/span>.... å…¶ä»–é…ç½®&lt;span style="color:#a61717;background-color:#e3d2d2">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="4project-ä¸‹æ·»åŠ -gradleproperties-æ³¨æ„åœ¨-gitignore-é‡Œé¢æ·»åŠ ä¸Šå®ƒä¸è¦ä¼ é€’åˆ°å…¬å¼€æœåŠ¡å™¨æ˜¯ä½ çš„å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯">4ã€Project/ ä¸‹æ·»åŠ  gradle.properties, æ³¨æ„åœ¨ .gitignore é‡Œé¢æ·»åŠ ä¸Šå®ƒï¼Œä¸è¦ä¼ é€’åˆ°å…¬å¼€æœåŠ¡å™¨ï¼Œæ˜¯ä½ çš„å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯&lt;/h2>
&lt;pre>&lt;code class="language-properties" data-lang="properties"># Nexus ä»“åº“åœ°å€
NEXUS_URL=https://nexus-url
# æŒ‡å®šä¸ºä½ è‡ªå·±çš„mavençš„ç”¨æˆ·é…ç½® settings.xml é‡Œé¢çš„ä½ çš„é…ç½®
NEXUS_CAS_HEADER=XXXXXXX
# gradle daemon
org.gradle.daemon=true
# ç¦ç”¨Gradle 6.x ç‰ˆæœ¬ SHA-256å’ŒSHA-512æ ¡éªŒå’Œçš„å‘å¸ƒ
# https://juejin.im/post/6844904101126553614
systemProp.org.gradle.internal.publish.checksums.insecure=true
&lt;/code>&lt;/pre>&lt;h2 id="5gitlab-ci-æ¨¡æ¿åŒ–ä¸‹æ¬¡åˆ†äº«">5ã€gitlab-ci æ¨¡æ¿åŒ–ï¼Œä¸‹æ¬¡åˆ†äº«~~~~&lt;/h2>
- https://pinkhello.me/posts/08-gradle%E5%A4%9A%E6%A8%A1%E5%9D%97%E9%A1%B9%E7%9B%AE%E6%A8%A1%E6%9D%BF%E5%8C%96/ - PinkHello, All Rights Reserved</description></item><item><title>07 Fabricä½¿ç”¨</title><link>https://pinkhello.me/posts/07-fabric%E4%BD%BF%E7%94%A8/</link><pubDate>Wed, 10 Feb 2021 08:40:46 +0800</pubDate><guid>https://pinkhello.me/posts/07-fabric%E4%BD%BF%E7%94%A8/</guid><description>PinkHello https://pinkhello.me/posts/07-fabric%E4%BD%BF%E7%94%A8/ -&lt;h2 id="docker-åŠ å…¥systemctlç¯å¢ƒå¹¶å¯åŠ¨docker">docker åŠ å…¥systemctlç¯å¢ƒå¹¶å¯åŠ¨docker&lt;/h2>
&lt;p>å¿«é€Ÿå®‰è£…docker&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">curl -sSL https://get.daocloud.io/docker | sh
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">systemctl &lt;span style="color:#658b00">enable&lt;/span> docker
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">systemctl start docker
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="docker-compose-å®‰è£…">docker-compose å®‰è£…&lt;/h2>
&lt;p>èµ°å¤–ç½‘æˆ–è€… &lt;code>github&lt;/code> å¤ªæ…¢,å¯ä»¥ä½¿ç”¨å†…éƒ¨åŠ é€Ÿ&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash"> curl -L &lt;span style="color:#cd5555">&amp;#34;https://github.com/docker/compose/releases/download/X.XX.X/docker-compose-&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">$(&lt;/span>uname -s&lt;span style="color:#8b008b;font-weight:bold">)&lt;/span>&lt;span style="color:#cd5555">-&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">$(&lt;/span>uname -m&lt;span style="color:#8b008b;font-weight:bold">)&lt;/span>&lt;span style="color:#cd5555">&amp;#34;&lt;/span> -o /usr/local/bin/docker-compose
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash"> curl -L https://get.daocloud.io/docker/compose/releases/download/1.26.2/docker-compose-&lt;span style="color:#cd5555">`&lt;/span>uname -s&lt;span style="color:#cd5555">`&lt;/span>-&lt;span style="color:#cd5555">`&lt;/span>uname -m&lt;span style="color:#cd5555">`&lt;/span> &amp;gt; /usr/local/bin/docker-compose
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="fabric-è‡ªåŠ¨è¿ç»´">fabric è‡ªåŠ¨è¿ç»´&lt;/h2>
&lt;h3 id="python-è™šæ‹Ÿç¯å¢ƒå®‰è£…">python è™šæ‹Ÿç¯å¢ƒå®‰è£…&lt;/h3>
&lt;p>&lt;a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1019273143120480">å‚è€ƒ&lt;/a>&lt;/p>
&lt;p>åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒ&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#658b00">cd&lt;/span> ç›®æ ‡ç›®å½•
virtualenv --no-site-packages venv
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#658b00">source&lt;/span> venv/bin/activate
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="python-pip-å®‰è£…-fabric">python pip å®‰è£… Fabric&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">pip install fabric3
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="python-pip-å¯¼å‡ºä¾èµ–">python pip å¯¼å‡ºä¾èµ–&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">pip freeze &amp;gt; requirements.txt
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å…¶ä»–python-pip-å¯¼å…¥å®‰è£…">å…¶ä»–python pip å¯¼å…¥å®‰è£…&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">pip install -r requirements.txt
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="fabric-æ–‡æ¡£-fabfiles-æ–‡æ¡£httpsfabric-chsreadthedocsiozh_cnchsusagefabfileshtml">&lt;a href="https://fabric-chs.readthedocs.io/zh_CN/chs/usage/fabfiles.html">Fabric æ–‡æ¡£ fabfiles æ–‡æ¡£&lt;/a>&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#228b22"># encoding=utf-8&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">from&lt;/span> &lt;span style="color:#008b45;text-decoration:underline">fabric.api&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">import&lt;/span> *
&lt;span style="color:#8b008b;font-weight:bold">from&lt;/span> &lt;span style="color:#008b45;text-decoration:underline">fabric.context_managers&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">import&lt;/span> *
env.user = &lt;span style="color:#cd5555">&amp;#39;root&amp;#39;&lt;/span>
env.gateway = &lt;span style="color:#cd5555">&amp;#39;192.168.1.118&amp;#39;&lt;/span>
env.hosts = [&lt;span style="color:#cd5555">&amp;#39;10.10.2.6&amp;#39;&lt;/span>,&lt;span style="color:#cd5555">&amp;#39;10.10.2.7&amp;#39;&lt;/span>]
env.passwords = {
&lt;span style="color:#cd5555">&amp;#39;root@10.10.2.6:22&amp;#39;&lt;/span>:&lt;span style="color:#cd5555">&amp;#39;PASSWORD_2&amp;#39;&lt;/span>,
&lt;span style="color:#cd5555">&amp;#39;root@10.10.2.7:22&amp;#39;&lt;/span>:&lt;span style="color:#cd5555">&amp;#39;PASSWORD_2&amp;#39;&lt;/span>,
&lt;span style="color:#cd5555">&amp;#39;root@192.168.1.118:22&amp;#39;&lt;/span>:&lt;span style="color:#cd5555">&amp;#39;PASSWORD_1&amp;#39;&lt;/span>
}
jump_server = &lt;span style="color:#cd5555">&amp;#39;jump_server&amp;#39;&lt;/span>
astra_server = &lt;span style="color:#cd5555">&amp;#39;astra_server&amp;#39;&lt;/span>
&lt;span style="color:#228b22"># æŒ‡å®š role è§’è‰²ç»„&lt;/span>
env.roledefs= {
jump_server: [&lt;span style="color:#cd5555">&amp;#39;192.168.1.118&amp;#39;&lt;/span>],
astra_server: [&lt;span style="color:#cd5555">&amp;#39;10.10.2.6&amp;#39;&lt;/span>,&lt;span style="color:#cd5555">&amp;#39;10.10.2.7&amp;#39;&lt;/span>]
}
&lt;span style="color:#228b22"># æµ‹è¯•&lt;/span>
&lt;span style="color:#707a7c">@task&lt;/span>
&lt;span style="color:#707a7c">@roles&lt;/span>(jump_server)
&lt;span style="color:#8b008b;font-weight:bold">def&lt;/span> &lt;span style="color:#008b45">test&lt;/span>():
run(&lt;span style="color:#cd5555">&amp;#39;ls -la &amp;amp;&amp;amp; pwd&amp;#39;&lt;/span>)
&lt;span style="color:#228b22"># ç™»å½•ç§æœ‰ä»“åº“&lt;/span>
&lt;span style="color:#707a7c">@task&lt;/span>
&lt;span style="color:#707a7c">@roles&lt;/span>(astra_server)
&lt;span style="color:#8b008b;font-weight:bold">def&lt;/span> &lt;span style="color:#008b45">docker_login&lt;/span>():
run(&lt;span style="color:#cd5555">&amp;#39;docker login -u USERNAME -p PASSWORD docker-registery.xxx.com&amp;#39;&lt;/span>)
&lt;span style="color:#228b22"># æµ‹è¯•&lt;/span>
&lt;span style="color:#707a7c">@task&lt;/span>
&lt;span style="color:#707a7c">@roles&lt;/span>(astra_server)
&lt;span style="color:#8b008b;font-weight:bold">def&lt;/span> &lt;span style="color:#008b45">docker_ps&lt;/span>():
run(&lt;span style="color:#cd5555">&amp;#39;docker ps&amp;#39;&lt;/span>)
&lt;span style="color:#228b22"># ä¸Šä¼ docker-compose&lt;/span>
&lt;span style="color:#707a7c">@task&lt;/span>
&lt;span style="color:#707a7c">@roles&lt;/span>(astra_server)
&lt;span style="color:#8b008b;font-weight:bold">def&lt;/span> &lt;span style="color:#008b45">put_docker_compose&lt;/span>():
&lt;span style="color:#228b22"># ä¸Šä¼ å¤±è´¥ï¼Œç…§æ ·å¾€ä¸‹æ‰§è¡Œ with settings(warn_only=True)&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">with&lt;/span> settings(warn_only=True):
result = put(&lt;span style="color:#cd5555">&amp;#39;deploy/prod/docker-compose.yml&amp;#39;&lt;/span>,&lt;span style="color:#cd5555">&amp;#39;~/docker-compose.yml&amp;#39;&lt;/span>)
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> result.failed:
abort(&lt;span style="color:#cd5555">&amp;#39;Aborting file put task!&amp;#39;&lt;/span>)
&lt;span style="color:#228b22"># é‡æ–°docker-composeéƒ¨ç½²&lt;/span>
&lt;span style="color:#707a7c">@task&lt;/span>
&lt;span style="color:#707a7c">@roles&lt;/span>(astra_server)
&lt;span style="color:#8b008b;font-weight:bold">def&lt;/span> &lt;span style="color:#008b45">restart_docker_compose&lt;/span>():
run(&lt;span style="color:#cd5555">&amp;#39;docker-compose stop &amp;amp;&amp;amp; docker-compose up -d&amp;#39;&lt;/span>)
&lt;span style="color:#707a7c">@task&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">def&lt;/span> &lt;span style="color:#008b45">deploy&lt;/span>():
docker_login()
docker_ps()
put_docker_compose()
restart_docker_compose()
&lt;/code>&lt;/pre>&lt;/div>- https://pinkhello.me/posts/07-fabric%E4%BD%BF%E7%94%A8/ - PinkHello, All Rights Reserved</description></item><item><title>06 é«˜æ€§èƒ½é˜Ÿåˆ—Disruptor</title><link>https://pinkhello.me/posts/06-%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97disruptor/</link><pubDate>Wed, 10 Feb 2021 08:35:29 +0800</pubDate><guid>https://pinkhello.me/posts/06-%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97disruptor/</guid><description>PinkHello https://pinkhello.me/posts/06-%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97disruptor/ -&lt;h1 id="èƒŒæ™¯">èƒŒæ™¯&lt;/h1>
&lt;p>&lt;code>Disruptor&lt;/code> æ˜¯ å¤–æ±‡äº¤æ˜“å…¬å¸&lt;code>LMAX&lt;/code>å¼€å‘çš„é«˜æ€§èƒ½é˜Ÿåˆ—ã€ç ”å‘æ˜¯ä¸ºäº†è§£å†³å†…å­˜é˜Ÿåˆ—å»¶è¿Ÿé—®é¢˜ã€‚
&lt;code>Disruptor&lt;/code> ä¸€èˆ¬ç”¨äºçº¿ç¨‹é—´çš„æ¶ˆæ¯ä¼ é€’ã€‚
&lt;a href="http://lmax-exchange.github.io/disruptor/">Disruptor GitHub åœ°å€&lt;/a>&lt;/p>
&lt;h1 id="disruptor-ä»‹ç»">&lt;code>Disruptor&lt;/code> ä»‹ç»&lt;/h1>
&lt;p>ç†è§£ &lt;code>Disruptor&lt;/code> æœ€å¥½çš„æ–¹å¼ï¼Œé€‰æ‹©ä¸€ä¸ªæœ€æ¥è¿‘ç†Ÿæ‚‰çš„æ ·æœ¬è¿›è¡Œæ¯”è¾ƒã€‚åœ¨è¿™ä¸ªå‰æä¸‹ï¼Œå¯ä»¥é€‰æ‹© &lt;code>Java&lt;/code> ä¸­çš„ &lt;code>BlockingQueue&lt;/code>.
å’Œé˜Ÿåˆ—ç›¸ä¼¼ï¼Œ&lt;code>Disruptor&lt;/code> ä¹Ÿæ˜¯åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ä¸åŒçš„çº¿ç¨‹ä¹‹é—´è¿›è¡Œä¼ é€’æ•°æ®çš„ï¼ˆä¾‹å¦‚æ¶ˆæ¯æˆ–è€…äº‹ä»¶ï¼‰ï¼ŒåŒæ—¶ &lt;code>Disruptor&lt;/code> æä¾›äº†ä¸€äº›å°†å…³é”®åŠŸèƒ½å’Œé˜Ÿåˆ—åˆ†å¼€çš„ç‰¹æ€§ï¼š&lt;/p>
&lt;ul>
&lt;li>å‘æ¶ˆè´¹è€…å‘é€å¤šæ’­äº‹ä»¶&lt;/li>
&lt;li>æ¶ˆæ¯è€…ä¾èµ–å…³ç³»å›¾&lt;/li>
&lt;li>é¢„å…ˆä¸ºäº‹ä»¶åˆ†é…å†…å­˜&lt;/li>
&lt;li>å¯é€‰çš„ï¼ˆæ— é”ï¼‰&lt;/li>
&lt;/ul>
&lt;h1 id="disruptor-æ ¸å¿ƒæ¦‚å¿µ">&lt;code>Disruptor&lt;/code> æ ¸å¿ƒæ¦‚å¿µ&lt;/h1>
&lt;p>åœ¨æˆ‘ä»¬ç†è§£&lt;code>Disruptor&lt;/code>å¦‚ä½•å·¥ä½œä¹‹å‰ï¼Œäº†è§£ä¸‹æ ¸å¿ƒæ¦‚å¿µ&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/RingBuffer.java">Ring Buffer&lt;/a>
ç¯å½¢æ•°ç»„è®¾è®¡ï¼Œä¸ºäº†é¿å…åƒåœ¾å›æ”¶ï¼Œé‡‡ç”¨çš„æ•°ç»„ç»“æ„ï¼Œä»3.0å¼€å§‹ï¼Œç¯å½¢ç¼“å†²åŒºä¸»è¦å­˜å‚¨å’Œæ›´æ–°åœ¨&lt;code>Disruptor&lt;/code>ä¸­ç§»åŠ¨çš„æ•°æ®ï¼ˆäº‹ä»¶ï¼‰&lt;/li>
&lt;li>&lt;a href="https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/Sequence.java">Sequence&lt;/a>
&lt;code>Disruptor&lt;/code> æ¯ä¸ªæ¶ˆè´¹è€…(&lt;code>EventProcessor&lt;/code>)ç»´æŠ¤ä¸€ä¸ª &lt;code>Sequence&lt;/code>ï¼Œå¹¶å‘çš„å¤§å¤šæ•°ä»£ç éƒ½ä¾èµ– &lt;code>Sequence&lt;/code> å€¼çš„æ”¹åŠ¨ï¼Œæ‰€ä»¥ &lt;code>Sequence&lt;/code> æ”¯æŒ &lt;code>AtomicLong&lt;/code> çš„å¤§éƒ¨åˆ†ä¹Ÿè¡Œ, å”¯ä¸€ä¸åŒçš„æ˜¯ &lt;code>Sequence&lt;/code> åŒ…å«é¢å¤–çš„åŠŸèƒ½æ¥é˜»æ­¢&lt;code>Sequence&lt;/code>å’Œå…¶ä»–å€¼ä¹‹é—´çš„ä¼ªå…±äº«(&lt;code>false sharing&lt;/code>)&lt;/li>
&lt;li>&lt;a href="https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/Sequencer.java">Sequencer&lt;/a>&lt;br>
&lt;code>Disruptor&lt;/code> æ ¸å¿ƒé€»è¾‘, ä¸¤ä¸ªå®ç°: å•ç”Ÿäº§è€…å’Œå¤šç”Ÿäº§è€…ã€‚ä»–ä»¬å®ç°äº†ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ä¹‹é—´çš„å¿«é€Ÿä¼ é€’çš„å¹¶å‘ç®—æ³•ã€‚&lt;/li>
&lt;li>&lt;a href="https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/SequenceBarrier.java">Sequence Barrier&lt;/a>
ç”± &lt;code>Sequencer&lt;/code> ç”Ÿæˆï¼ŒåŒ…å«æ­¤ &lt;code>Sequencer&lt;/code> å‘å¸ƒçš„ &lt;code>Sequence&lt;/code> æŒ‡é’ˆä»¥åŠä¾èµ–çš„å…¶ä»–æ¶ˆè´¹è€…çš„ &lt;code>Sequence&lt;/code>ã€‚åŒ…å«äº†æ¶ˆè´¹è€…æ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨çš„äº‹ä»¶çš„ä»£ç ã€‚&lt;/li>
&lt;li>&lt;a href="https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/WaitStrategy.java">Wait Strategy&lt;/a>
æ¶ˆè´¹è€…ç­‰å¾…äº‹ä»¶çš„ç­–ç•¥ï¼Œè¿™ä¸ªäº‹ä»¶ç”±ç”Ÿäº§è€…æ”¾å…¥ï¼Œå†³å®šäº†æ¶ˆè´¹è€…æ€ä¹ˆç­‰å¾…ç”Ÿäº§è€…å°†äº‹ä»¶æ”¾å…¥ &lt;code>Disruptor&lt;/code>&lt;/li>
&lt;li>Event ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ä¼ é€’çš„äº‹ä»¶ï¼Œå®Œå…¨ç”±ç”¨æˆ·å®šä¹‰&lt;/li>
&lt;li>&lt;a href="https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/EventProcessor.java">EventProcessor&lt;/a>
å¤„ç†äº‹ä»¶çš„ä¸»è¦å¾ªç¯ï¼ˆ&lt;code>main event loop&lt;/code>ï¼‰ï¼ŒåŒ…å«äº†ä¸€ä¸ª &lt;code>Sequeuece&lt;/code>. æœ‰ä¸€ä¸ªå…·ä½“çš„å®ç°ç±» &lt;code>BatchEventProcessor&lt;/code>&lt;/li>
&lt;li>&lt;a href="https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/EventHandler.java">EventHandler&lt;/a>
ç”¨æˆ·å®ç°çš„æ¥å£ï¼Œä»£è¡¨ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚å¤„ç†äº‹ä»¶ã€‚&lt;/li>
&lt;li>Producer ç”Ÿäº§è€…ã€å…ˆè·å¾—å ä½ï¼Œç„¶åæäº¤äº‹ä»¶ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://pinkhello.me/%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97-Disruptor/Disruptor%E8%AE%BE%E8%AE%A1%E7%BB%84%E4%BB%B6%E5%9B%BE.jpg" alt="Disruptorè®¾è®¡ç»„ä»¶å›¾">&lt;/p>
&lt;ul>
&lt;li>
&lt;p>äº‹ä»¶å¹¿æ’­(&lt;code>Multicast Events&lt;/code>)&lt;/p>
&lt;p>äº‹ä»¶å¹¿æ’­æ˜¯ &lt;code>Disruptor&lt;/code> ä¸ &lt;code>Queue&lt;/code> æœ€å¤§çš„åŒºåˆ«ï¼Œå½“ä½ æœ‰å¤šä¸ªæ¶ˆè´¹è€…ç›‘å¬ä¸€ä¸ª &lt;code>Disruptor&lt;/code>, æ‰€æœ‰çš„äº‹ä»¶å°†ä¼šå‘å¸ƒåˆ°è¿™ä¸ªæ‰€æœ‰çš„æ¶ˆè´¹è€…ã€‚
&lt;code>Disruptor&lt;/code> è¿™ä¸€ç‰¹æ€§è¢«ç”¨æ¥éœ€è¦å¯¹åŒä¸€æ•°æ®è¿›è¡Œå¤šä¸ªå¹¶è¡Œæ“ä½œçš„æƒ…å†µã€‚
å¦‚åœ¨LMAXç³»ç»Ÿä¸­æœ‰ä¸‰ä¸ªæ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œï¼šæ—¥å¿—ï¼ˆå°†æ•°æ®æŒä¹…åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼‰ï¼Œå¤åˆ¶ï¼ˆå°†æ•°æ®å‘é€åˆ°å…¶ä»–çš„æœºå™¨ä¸Šï¼Œä»¥ç¡®ä¿å­˜åœ¨æ•°æ®è¿œç¨‹å‰¯æœ¬ï¼‰ï¼Œä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚
ä¹Ÿå¯ä»¥ä½¿ç”¨&lt;code>WokrerPool&lt;/code>æ¥å¹¶è¡Œå¤„ç†ä¸åŒçš„äº‹ä»¶ã€‚&lt;/p>
&lt;p>å¦‚ä¸Šå›¾ã€‚å¯ä»¥çœ‹åˆ°æœ‰3ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºæ­£åœ¨ä¾¦å¬&lt;code>Disrupto&lt;/code>rï¼ˆ&lt;code>JournalConsumer&lt;/code>ï¼Œ&lt;code>ReplicationConsumer&lt;/code> å’Œ &lt;code>ApplicationConsumer&lt;/code>ï¼‰ï¼Œ
è¿™äº›äº‹ä»¶å¤„ç†ç¨‹åºä¸­çš„æ¯ä¸ªå°†æ¥æ”¶&lt;code>Disruptor&lt;/code>ä¸­æ‰€æœ‰å¯ç”¨çš„æ¶ˆæ¯ï¼ˆæŒ‰ç›¸åŒé¡ºåºï¼‰ã€‚è¿™å…è®¸è¿™äº›æ¶ˆè´¹è€…ä¸­çš„æ¯ä¸€ä¸ªå¹¶è¡Œå·¥ä½œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ¶ˆè´¹è€…ä¾èµ–å…³ç³»å›¾(&lt;code>Consumer Dependency Graph&lt;/code>)&lt;/p>
&lt;p>ä¸ºäº†æ”¯æŒå®ç°ä¸šåŠ¡å¹¶è¡Œå¤„ç†æµç¨‹ï¼Œ&lt;code>Disruptor&lt;/code> æä¾›äº†å¤šä¸ªæ¶ˆè´¹è€…ä¹‹é—´çš„åä½œåŠŸèƒ½ã€‚å›åˆ°ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°† &lt;code>journalling&lt;/code> å’Œ &lt;code>replication&lt;/code> æ¶ˆè´¹å®Œæˆä»–ä»¬çš„ä¸šåŠ¡ï¼Œåå†ç»§ç»­æ‰§è¡Œä¸šåŠ¡é€»è¾‘æµç¨‹ã€‚
æˆ‘ä»¬ç§°å‘¼è¿™ä¸ªåŠŸèƒ½ä¸º &lt;code>gating&lt;/code> , &lt;code>gating&lt;/code> å‘ç”Ÿåœ¨ä¸¤ç§åœºæ™¯ä¸‹:&lt;/p>
&lt;ul>
&lt;li>ç¡®ä¿ &lt;code>Producer&lt;/code> ä¸èƒ½è¿è¡Œè¶…è¿‡ &lt;code>Consumer&lt;/code> ï¼Œå¯ä»¥é€šå¤šè°ƒç”¨ &lt;code>RingBuffer.addGatingConsumers()&lt;/code> æ¥å¢åŠ ç›¸å…³çš„æ¶ˆè´¹è€…æ¥å®Œæˆ&lt;/li>
&lt;li>ä¹‹å‰æ‰€è¯´çš„åœºæ™¯ï¼Œé€šè¿‡å¿…é¡»å…ˆå®Œæˆçš„&lt;code>Consumer&lt;/code> çš„ &lt;code>Sequence&lt;/code>çš„&lt;code>SequenceBarrier&lt;/code>æ¥å®ç°ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>äº‹ä»¶é¢„åˆ†é…(&lt;code>Event Preallocation&lt;/code>)&lt;/p>
&lt;p>&lt;code>Disruptor&lt;/code> çš„ä¸€ä¸ªç›®æ ‡å°±æ˜¯åœ¨ä½å»¶æ—¶ç¯å¢ƒä¸‹ï¼Œå‡å°‘æˆ–å¼‚å¸¸å†…å­˜çš„å ç”¨ã€‚ï¼ˆåœ¨JAVAç¯å¢ƒä¸‹ï¼Œéœ€è¦è¾ƒå°‘GCåœé¡¿çš„æ¬¡æ•°ï¼‰ï¼ˆC/C++ç¯å¢ƒä¸‹ï¼Œå¤§é‡çš„å†…å­˜åˆ†é…ä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯é€‰æ‹©çš„æ— é”(&lt;code>Optionally Lock-free&lt;/code>)&lt;/p>
&lt;p>æ— é”çš„ &lt;code>Disruptor&lt;/code> çš„ä½å»¶è¿Ÿçš„æ— é”çš„ç‰¹æ€§å®ç°ç»†èŠ‚æ˜¯éƒ½æ˜¯åŸºäº å†…å­˜å±éšœ å’Œ CAS æ“ä½œå®ç°çš„ï¼Œåªæœ‰ä¸€ä¸ªåœºæ™¯ &lt;code>BlockingWaitStrategy&lt;/code> ä¸­ä½¿ç”¨çš„ &lt;code>Lock&lt;/code>
æ˜¯ä¸ºäº†ä½¿ç”¨ &lt;code>Lock&lt;/code> é‡Œé¢çš„ &lt;code>Condition&lt;/code>, æ–¹ä¾¿æ¶ˆè´¹è€…çº¿ç¨‹è¢« &lt;code>Park&lt;/code> æ—¶å€™ç­‰å¾…æ–°çš„äº‹ä»¶æ¥è§¦å‘ã€‚è®¸å¤šä½å»¶è¿Ÿç³»ç»Ÿä½¿ç”¨è‡ªæ—‹ï¼ˆ&lt;code>busy-wait&lt;/code>ï¼‰æ¥é¿å…ä½¿ç”¨ &lt;code>Condition&lt;/code>é€ æˆçš„æŠ–åŠ¨
ç„¶è€Œï¼Œå¤ªå¤šçš„ &lt;code>busy-wait&lt;/code> ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œç‰¹åˆ«åœ¨CPUèµ„æºå—é™çš„æƒ…å†µä¸‹ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h1 id="disruptor-å‡ ä¸ªæ ¸å¿ƒçš„è®¾è®¡">&lt;code>Disruptor&lt;/code> å‡ ä¸ªæ ¸å¿ƒçš„è®¾è®¡&lt;/h1>
&lt;h2 id="sequence-è®¾è®¡">&lt;code>Sequence&lt;/code> è®¾è®¡&lt;/h2>
&lt;p>&lt;img src="https://pinkhello.me/%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97-Disruptor/Sequence.jpg" alt="Sequence è®¾è®¡">&lt;/p>
&lt;p>Sequence çœŸæ­£è®¡æ•°æ˜¯ &lt;code>value&lt;/code> é‡‡ç”¨ç¼“å†²è¡Œé˜²æ­¢ &lt;code>false sharing&lt;/code>ã€‚åœ¨&lt;code>value&lt;/code>çš„å‰åæœ‰7ä¸ª &lt;code>long&lt;/code> å‹çš„å¡«å……å€¼ï¼Œåš&lt;code>CPU cache line&lt;/code>å¡«å……é˜²æ­¢ä¼ªå…±äº«ã€‚&lt;/p>
&lt;h2 id="ringbuffer-è®¾è®¡">&lt;code>RingBuffer&lt;/code> è®¾è®¡&lt;/h2>
&lt;p>&lt;img src="https://pinkhello.me/%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97-Disruptor/RingBuffer.jpg" alt="RingBuffer è®¾è®¡">&lt;/p>
&lt;p>&lt;code>RingBuffer&lt;/code> æ˜¯ä¸€ä¸ªç¯ï¼ˆé¦–å°¾ç›¸æ¥ï¼‰ï¼Œå¯ä»¥ç”¨ä½œä¸åŒçš„ä¸Šä¸‹æ–‡ï¼ˆçº¿ç¨‹ï¼‰é—´ä¼ é€’æ•°æ®çš„ &lt;code>Buffer&lt;/code>ç¯å½¢è®¾è®¡ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸ªåæ ‡ï¼Œå–å¾—å…ƒç´ é€šè¿‡å–modæ“ä½œã€‚
æ˜¯æ•°ç»„è®¾è®¡ã€éé“¾è¡¨ã€‚&lt;/p>
&lt;p>ä¸€èˆ¬æ˜¯&lt;code>2^N&lt;/code>æ¬¡æ–¹ï¼Œè¿™æ · sequence &amp;amp; (array length - 1 ) = array indexã€‚å“ˆå¸ŒMapä¹Ÿæ˜¯è¿™ç§ä½è¿ç®—åšçš„ã€‚&lt;/p>
&lt;p>&lt;code>RingBuffer&lt;/code> ç‰¹ç‚¹&lt;/p>
&lt;ul>
&lt;li>æ•°ç»„å®ç°ã€å¿«é€Ÿè®¿é—®&lt;/li>
&lt;li>å…ƒç´ æ˜¯è¦†ç›–å¼çš„ï¼Œä¸ä¸»åŠ¨æ¸…é™¤&lt;/li>
&lt;li>ç¥å¥‡çš„ç¼“å­˜è¡Œï¼ˆç¼“å­˜æ˜¯ç”±ç¼“å­˜è¡Œç»„æˆçš„ï¼Œé€šå¸¸64ä¸ªå­—èŠ‚ã€ä¸€ä¸ªJAVA long ç±»å‹ 8 å­—èŠ‚ï¼‰&lt;/li>
&lt;/ul>
&lt;h2 id="æ¶ˆè´¹è€…ä¾èµ–è®¾è®¡">æ¶ˆè´¹è€…ä¾èµ–è®¾è®¡&lt;/h2>
&lt;h2 id="ç¼“å­˜å†…å­˜åŠ è½½è¿‡ç¨‹">ç¼“å­˜å†…å­˜åŠ è½½è¿‡ç¨‹&lt;/h2>
&lt;p>&lt;img src="https://pinkhello.me/%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97-Disruptor/cache-line-1.jpg" alt="ç¼“å­˜åŠ è½½è¿‡ç¨‹">
&lt;img src="https://pinkhello.me/%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97-Disruptor/cache-line-2.jpg" alt="ç¼“å­˜åŠ è½½è¿‡ç¨‹">
&lt;img src="https://pinkhello.me/%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97-Disruptor/cache-line-3.jpg" alt="ç¼“å­˜åŠ è½½è¿‡ç¨‹">&lt;/p>
&lt;p>&lt;a href="https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/RingBuffer.java">ç¥å¥‡çš„è§£å†³æ–¹å¼&amp;mdash;&amp;ndash; ç¼“å­˜è¡Œå¡«å……&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">long&lt;/span> p1, p2, p3, p4, p5, p6, p7; &lt;span style="color:#228b22">// cache line padding
&lt;/span>&lt;span style="color:#228b22">&lt;/span>&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">volatile&lt;/span> &lt;span style="color:#00688b;font-weight:bold">long&lt;/span> cursor = INITIAL_CURSOR_VALUE;
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">long&lt;/span> p8, p9, p10, p11, p12, p13, p14; &lt;span style="color:#228b22">// cache line padding
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="disruptor-ä½¿ç”¨demo">&lt;code>Disruptor&lt;/code> ä½¿ç”¨Demo&lt;/h1>
&lt;p>&lt;code>TransactionOrder&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">TransactionOrder&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> String id;
&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> &lt;span style="color:#00688b;font-weight:bold">double&lt;/span> price;
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>TransactionHandler&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">TransactionHandler&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">implements&lt;/span> EventHandler&amp;lt;TransactionOrder&amp;gt;, WorkHandler&amp;lt;TransactionOrder&amp;gt; {
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">onEvent&lt;/span>(TransactionOrder transactionOrder, &lt;span style="color:#00688b;font-weight:bold">long&lt;/span> sequence, &lt;span style="color:#00688b;font-weight:bold">boolean&lt;/span> endOfBatch) &lt;span style="color:#8b008b;font-weight:bold">throws&lt;/span> Exception {
&lt;span style="color:#8b008b;font-weight:bold">this&lt;/span>.&lt;span style="color:#658b00">onEvent&lt;/span>(transactionOrder);
}
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">onEvent&lt;/span>(TransactionOrder transactionOrder) &lt;span style="color:#8b008b;font-weight:bold">throws&lt;/span> Exception {
&lt;span style="color:#228b22">//å…·ä½“çš„æ¶ˆè´¹é€»è¾‘
&lt;/span>&lt;span style="color:#228b22">&lt;/span> transactionOrder.&lt;span style="color:#658b00">setId&lt;/span>(UUID.&lt;span style="color:#658b00">randomUUID&lt;/span>().&lt;span style="color:#658b00">toString&lt;/span>());
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Demo1&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">Demo1&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">main&lt;/span>(String[] args) &lt;span style="color:#8b008b;font-weight:bold">throws&lt;/span> ExecutionException, InterruptedException {
&lt;span style="color:#00688b;font-weight:bold">int&lt;/span> BUFFER_SIZE = 1024;
&lt;span style="color:#00688b;font-weight:bold">int&lt;/span> THREAD_NUM = 4;
&lt;span style="color:#228b22">//createSingleProducer åˆ›å»ºå•ç”Ÿäº§è€…çš„ RingBuffer
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">final&lt;/span> RingBuffer&amp;lt;TransactionOrder&amp;gt; ringBuffer =
RingBuffer.&lt;span style="color:#658b00">createSingleProducer&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> EventFactory&amp;lt;TransactionOrder&amp;gt;() {
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> TransactionOrder &lt;span style="color:#008b45">newInstance&lt;/span>() {
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> TransactionOrder();
}
}, BUFFER_SIZE, &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> YieldingWaitStrategy());
&lt;span style="color:#228b22">//åˆ›å»ºçº¿ç¨‹æ± 
&lt;/span>&lt;span style="color:#228b22">&lt;/span> ExecutorService service = Executors.&lt;span style="color:#658b00">newFixedThreadPool&lt;/span>(THREAD_NUM);
&lt;span style="color:#228b22">//åˆ›å»º SequenceBarrier
&lt;/span>&lt;span style="color:#228b22">&lt;/span> SequenceBarrier sequenceBarrier = ringBuffer.&lt;span style="color:#658b00">newBarrier&lt;/span>();
&lt;span style="color:#228b22">//åˆ›å»ºæ¶ˆæ¯å¤„ç†å™¨
&lt;/span>&lt;span style="color:#228b22">&lt;/span> BatchEventProcessor&amp;lt;TransactionOrder&amp;gt; eventProcessor =
&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> BatchEventProcessor&amp;lt;TransactionOrder&amp;gt;(ringBuffer, sequenceBarrier, &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> TransactionHandler());
&lt;span style="color:#228b22">//è¿™ä¸€éƒ¨åˆ†æ˜¯è®© RingBufferæ ¹æ®æ¶ˆè´¹è€…çŠ¶æ€è¿›è¡Œgating, åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…çš„è¯å¯ä»¥çœç•¥
&lt;/span>&lt;span style="color:#228b22">&lt;/span> ringBuffer.&lt;span style="color:#658b00">addGatingSequences&lt;/span>(eventProcessor.&lt;span style="color:#658b00">getSequence&lt;/span>());
&lt;span style="color:#228b22">//æŠŠæ¶ˆæ¯å¤„ç†å™¨æäº¤åˆ°çº¿ç¨‹æ± 
&lt;/span>&lt;span style="color:#228b22">&lt;/span> service.&lt;span style="color:#658b00">submit&lt;/span>(eventProcessor);
Future&amp;lt;?&amp;gt; future = service.&lt;span style="color:#658b00">submit&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> Callable&amp;lt;Void&amp;gt;() {
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> Void &lt;span style="color:#008b45">call&lt;/span>() &lt;span style="color:#8b008b;font-weight:bold">throws&lt;/span> Exception {
&lt;span style="color:#00688b;font-weight:bold">long&lt;/span> seq;
&lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> (&lt;span style="color:#00688b;font-weight:bold">int&lt;/span> i = 0; i&amp;lt;10000; i++) {
seq = ringBuffer.&lt;span style="color:#658b00">next&lt;/span>(); &lt;span style="color:#228b22">//ringbuffer çš„ä¸€ä¸ªå¯ç”¨åŒºå—
&lt;/span>&lt;span style="color:#228b22">&lt;/span> ringBuffer.&lt;span style="color:#658b00">get&lt;/span>(seq).&lt;span style="color:#658b00">setPrice&lt;/span>(Math.&lt;span style="color:#658b00">random&lt;/span>() *9999); &lt;span style="color:#228b22">// ç»™è¿™ä¸ªåŒºå—æ”¾å…¥æ•°æ®
&lt;/span>&lt;span style="color:#228b22">&lt;/span> ringBuffer.&lt;span style="color:#658b00">publish&lt;/span>(seq); &lt;span style="color:#228b22">//å‘å¸ƒæ•°æ®ä½¿å¾— consumer å¯ä»¥è·å–è¯¥æ•°æ®
&lt;/span>&lt;span style="color:#228b22">&lt;/span> }
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">null&lt;/span>;
}
});
future.&lt;span style="color:#658b00">get&lt;/span>(); &lt;span style="color:#228b22">//ç­‰å¾…ç”Ÿäº§è€…ç»“æŸ
&lt;/span>&lt;span style="color:#228b22">&lt;/span>
eventProcessor.&lt;span style="color:#658b00">halt&lt;/span>(); &lt;span style="color:#228b22">//é€šçŸ¥äº‹ä»¶
&lt;/span>&lt;span style="color:#228b22">&lt;/span>
service.&lt;span style="color:#658b00">shutdown&lt;/span>(); &lt;span style="color:#228b22">//ç»ˆæ­¢çº¿ç¨‹
&lt;/span>&lt;span style="color:#228b22">&lt;/span>
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Demo2&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">Demo2&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">main&lt;/span>(String[] args) {
&lt;span style="color:#00688b;font-weight:bold">int&lt;/span> BUFFER_SIZE = 1024;
&lt;span style="color:#00688b;font-weight:bold">int&lt;/span> THREAD_NUM = 4;
EventFactory&amp;lt;TransactionOrder&amp;gt; eventFactory = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> EventFactory&amp;lt;TransactionOrder&amp;gt;() {
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> TransactionOrder &lt;span style="color:#008b45">newInstance&lt;/span>() {
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> TransactionOrder();
}
};
RingBuffer&amp;lt;TransactionOrder&amp;gt; ringBuffer = RingBuffer.&lt;span style="color:#658b00">createSingleProducer&lt;/span>(eventFactory, BUFFER_SIZE);
SequenceBarrier sequenceBarrier = ringBuffer.&lt;span style="color:#658b00">newBarrier&lt;/span>();
ExecutorService service = Executors.&lt;span style="color:#658b00">newFixedThreadPool&lt;/span>(THREAD_NUM);
WorkHandler&amp;lt;TransactionOrder&amp;gt; workHandler = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> TransactionHandler();
WorkerPool&amp;lt;TransactionOrder&amp;gt; workerPool =
&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> WorkerPool&amp;lt;TransactionOrder&amp;gt;(ringBuffer, sequenceBarrier, &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> IgnoreExceptionHandler(),
workHandler);
&lt;span style="color:#228b22">//åºåˆ—åè°ƒè€…
&lt;/span>&lt;span style="color:#228b22">&lt;/span> ringBuffer.&lt;span style="color:#658b00">addGatingSequences&lt;/span>(workerPool.&lt;span style="color:#658b00">getWorkerSequences&lt;/span>());
workerPool.&lt;span style="color:#658b00">start&lt;/span>(service);
&lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> (&lt;span style="color:#00688b;font-weight:bold">int&lt;/span> i=0; i&amp;lt;8; i++) {
&lt;span style="color:#00688b;font-weight:bold">long&lt;/span> seq = ringBuffer.&lt;span style="color:#658b00">next&lt;/span>();
ringBuffer.&lt;span style="color:#658b00">get&lt;/span>(seq).&lt;span style="color:#658b00">setPrice&lt;/span>(Math.&lt;span style="color:#658b00">random&lt;/span>() * 9999);
ringBuffer.&lt;span style="color:#658b00">publish&lt;/span>(seq);
}
workerPool.&lt;span style="color:#658b00">halt&lt;/span>();
service.&lt;span style="color:#658b00">shutdown&lt;/span>();
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Demo3&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">Demo3&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">main&lt;/span>(String[] args) &lt;span style="color:#8b008b;font-weight:bold">throws&lt;/span> InterruptedException {
&lt;span style="color:#00688b;font-weight:bold">long&lt;/span> start = System.&lt;span style="color:#658b00">currentTimeMillis&lt;/span>();
&lt;span style="color:#00688b;font-weight:bold">int&lt;/span> BUFFER_SIZE = 1024;
&lt;span style="color:#00688b;font-weight:bold">int&lt;/span> THREAD_NUM = 4;
ExecutorService service = Executors.&lt;span style="color:#658b00">newFixedThreadPool&lt;/span>(THREAD_NUM);
Disruptor&amp;lt;TransactionOrder&amp;gt; disruptor = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> Disruptor&amp;lt;TransactionOrder&amp;gt;(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> EventFactory&amp;lt;TransactionOrder&amp;gt;() {
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> TransactionOrder &lt;span style="color:#008b45">newInstance&lt;/span>() {
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> TransactionOrder();
}
}, BUFFER_SIZE, service, ProducerType.&lt;span style="color:#658b00">SINGLE&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> BusySpinWaitStrategy());
&lt;span style="color:#228b22">/**
&lt;/span>&lt;span style="color:#228b22"> * è±å½¢æ“ä½œ
&lt;/span>&lt;span style="color:#228b22"> */&lt;/span>
&lt;span style="color:#228b22">//ä½¿ç”¨ disruptor åˆ›å»ºæ¶ˆè´¹ç»„ C1 ä¸ C2
&lt;/span>&lt;span style="color:#228b22">&lt;/span> EventHandlerGroup&amp;lt;TransactionOrder&amp;gt; eventHandlerGroup =
disruptor.&lt;span style="color:#658b00">handleEventsWith&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> TransactionHandler(), &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> TransactionVasConsumer());
&lt;span style="color:#228b22">//C3
&lt;/span>&lt;span style="color:#228b22">&lt;/span> TransactionJmsNotifyHandler jmsNotifyHandler = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> TransactionJmsNotifyHandler();
&lt;span style="color:#228b22">//å£°æ˜åœ¨ C1 å’Œ C2 å®Œäº‹å æ‰§è¡Œ JMSæ¶ˆæ¯å‘é€æ“ä½œï¼ˆC3ï¼‰
&lt;/span>&lt;span style="color:#228b22">&lt;/span> eventHandlerGroup.&lt;span style="color:#658b00">then&lt;/span>(jmsNotifyHandler);
&lt;span style="color:#228b22">/**
&lt;/span>&lt;span style="color:#228b22"> * é¡ºåºæ‰§è¡Œ
&lt;/span>&lt;span style="color:#228b22"> */&lt;/span>
&lt;span style="color:#228b22">// disruptor.handleEventsWith(new TransactionHandler())
&lt;/span>&lt;span style="color:#228b22">// .then(new TransactionVasConsumer())
&lt;/span>&lt;span style="color:#228b22">// .then(new TransactionJmsNotifyHandler());
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#228b22">/**
&lt;/span>&lt;span style="color:#228b22"> * å…­è¾¹å½¢æ“ä½œ
&lt;/span>&lt;span style="color:#228b22"> */&lt;/span>
&lt;span style="color:#228b22">// TransactionHandler h1 = new TransactionHandler();
&lt;/span>&lt;span style="color:#228b22">// TransactionHandler h2 = new TransactionHandler();
&lt;/span>&lt;span style="color:#228b22">// TransactionHandler h3 = new TransactionHandler();
&lt;/span>&lt;span style="color:#228b22">// TransactionHandler h4 = new TransactionHandler();
&lt;/span>&lt;span style="color:#228b22">// TransactionHandler h5 = new TransactionHandler();
&lt;/span>&lt;span style="color:#228b22">// TransactionHandler h6 = new TransactionHandler();
&lt;/span>&lt;span style="color:#228b22">// disruptor.handleEventsWith(h1, h2);
&lt;/span>&lt;span style="color:#228b22">// disruptor.after(h1).handleEventsWith(h4);
&lt;/span>&lt;span style="color:#228b22">// disruptor.after(h2).handleEventsWith(h5);
&lt;/span>&lt;span style="color:#228b22">// disruptor.after(h4, h5).handleEventsWith(h3);
&lt;/span>&lt;span style="color:#228b22">&lt;/span>
&lt;span style="color:#228b22">//å¯åŠ¨
&lt;/span>&lt;span style="color:#228b22">&lt;/span> disruptor.&lt;span style="color:#658b00">start&lt;/span>();
CountDownLatch latch = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> CountDownLatch(1);
&lt;span style="color:#228b22">//ç”Ÿäº§è€…å‡†å¤‡
&lt;/span>&lt;span style="color:#228b22">&lt;/span> service.&lt;span style="color:#658b00">submit&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> TransactionPubllisher(disruptor, latch));
latch.&lt;span style="color:#658b00">await&lt;/span>(); &lt;span style="color:#228b22">//ç­‰å¾…ç”Ÿäº§è€…å®Œäº‹
&lt;/span>&lt;span style="color:#228b22">&lt;/span>
disruptor.&lt;span style="color:#658b00">shutdown&lt;/span>();
service.&lt;span style="color:#658b00">shutdown&lt;/span>();
System.&lt;span style="color:#658b00">out&lt;/span>.&lt;span style="color:#658b00">println&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;æ€»è€—æ—¶:&amp;#34;&lt;/span>+ (System.&lt;span style="color:#658b00">currentTimeMillis&lt;/span>() - start));
}
}
&lt;/code>&lt;/pre>&lt;/div>- https://pinkhello.me/posts/06-%E9%AB%98%E6%80%A7%E8%83%BD%E9%98%9F%E5%88%97disruptor/ - PinkHello, All Rights Reserved</description></item><item><title>05 OAuth2.0 é‚£ç‚¹äº‹</title><link>https://pinkhello.me/posts/05-oauth2.0%E9%82%A3%E7%82%B9%E4%BA%8B/</link><pubDate>Wed, 10 Feb 2021 08:32:02 +0800</pubDate><guid>https://pinkhello.me/posts/05-oauth2.0%E9%82%A3%E7%82%B9%E4%BA%8B/</guid><description>PinkHello https://pinkhello.me/posts/05-oauth2.0%E9%82%A3%E7%82%B9%E4%BA%8B/ -&lt;h2 id="oauth20-æ˜¯ä»€ä¹ˆ">&lt;code>OAuth2.0&lt;/code> æ˜¯ä»€ä¹ˆ?&lt;/h2>
&lt;p>&lt;code>OAuth2.0&lt;/code> Framework RFC 6749 [https://tools.ietf.org/html/rfc6749]&lt;/p>
&lt;p>&lt;code>OAuth&lt;/code> å°±æ˜¯ä¸€ç§æˆæƒæœºåˆ¶ï¼Œå®ƒä»‹äºå®¢æˆ·ç«¯ä¸èµ„æºæ‰€æœ‰è€…çš„æˆæƒå±‚ï¼Œä¸ºäº†åˆ†ç¦»ä¸åŒçš„è§’è‰²ã€‚
åœ¨èµ„æºæ‰€æœ‰è€…åŒæ„å¹¶å‘å®¢æˆ·ç«¯é¢å‘ä»¤ç‰Œåï¼Œå®¢æˆ·ç«¯æºå¸¦ä»¤ç‰Œå¯ä»¥è®¿é—®éƒ¨åˆ†æˆ–å…¨éƒ¨èµ„æºã€‚&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->OAuth2.0&lt;!-- raw HTML omitted --> æ˜¯&lt;!-- raw HTML omitted -->OAuth&lt;!-- raw HTML omitted --> åè®®çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œä¸º&lt;!-- raw HTML omitted -->2.0&lt;!-- raw HTML omitted -->ç‰ˆæœ¬ã€‚æœ‰æ„æ€çš„æ˜¯ &lt;!-- raw HTML omitted -->2.0&lt;!-- raw HTML omitted --> ä¸ &lt;!-- raw HTML omitted -->1.0&lt;!-- raw HTML omitted --> å¹¶ä¸å…¼å®¹ã€‚&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h2 id="oauth20-æˆæƒæ–¹å¼">&lt;code>OAuth2.0&lt;/code> æˆæƒæ–¹å¼&lt;/h2>
&lt;p>è·å–æˆæƒçš„è¿‡ç¨‹&lt;/p>
&lt;ul>
&lt;li>æˆæƒç (&lt;!-- raw HTML omitted -->authorization-code&lt;!-- raw HTML omitted -->)&lt;/li>
&lt;li>éšè—å¼(&lt;!-- raw HTML omitted -->implicit&lt;!-- raw HTML omitted -->)&lt;/li>
&lt;li>å¯†ç (&lt;!-- raw HTML omitted -->password&lt;!-- raw HTML omitted -->)&lt;/li>
&lt;li>å®¢æˆ·ç«¯å‡­è¯(&lt;!-- raw HTML omitted -->client credentials&lt;!-- raw HTML omitted -->)&lt;/li>
&lt;/ul>
&lt;p>ä¸ç®¡å“ªç§æ–¹å¼ï¼Œéƒ½éœ€è¦åœ¨ç¬¬ä¸‰æ–¹åº”ç”¨ç”³è¯·ä»¤ç‰Œä¹‹å‰ï¼Œéœ€è¦åœ¨ç³»ç»Ÿä¸­ç”³è¯·èº«ä»½å”¯ä¸€æ ‡è¯†: å®¢æˆ·ç«¯ID &lt;!-- raw HTML omitted -->Client ID&lt;!-- raw HTML omitted --> å’Œ å®¢æˆ·ç«¯ç§˜é’¥ &lt;!-- raw HTML omitted -->Client Secret&lt;!-- raw HTML omitted -->.
è¿™æ ·èƒ½ç¡®ä¿Tokenä¸è¢«æ¶æ„ä½¿ç”¨ã€‚&lt;/p>
&lt;p>æˆæƒé‡è¦çš„å‚æ•°å’ŒæŒ‡æ ‡:&lt;/p>
&lt;ul>
&lt;li>&lt;!-- raw HTML omitted -->response_type&lt;!-- raw HTML omitted --> å“åº”ç±»å‹: &lt;!-- raw HTML omitted -->code&lt;!-- raw HTML omitted -->(è¦æ±‚è¿”å›æˆæƒç ),&lt;!-- raw HTML omitted -->token&lt;!-- raw HTML omitted -->(è¦æ±‚è¿”å›æˆæƒToken)&lt;/li>
&lt;li>&lt;!-- raw HTML omitted -->client_id&lt;!-- raw HTML omitted --> å®¢æˆ·ç«¯èº«ä»½æ ‡è¯†&lt;/li>
&lt;li>&lt;!-- raw HTML omitted -->client_secret&lt;!-- raw HTML omitted --> å®¢æˆ·ç«¯ç§˜é’¥&lt;/li>
&lt;li>&lt;!-- raw HTML omitted -->redirect_uri&lt;!-- raw HTML omitted --> é‡å®šå‘åœ°å€&lt;/li>
&lt;li>&lt;!-- raw HTML omitted -->scope&lt;!-- raw HTML omitted --> æˆæƒèŒƒå›´, &lt;!-- raw HTML omitted -->read&lt;!-- raw HTML omitted --> åªè¯»æƒé™, &lt;!-- raw HTML omitted -->all&lt;!-- raw HTML omitted --> å…¨éƒ¨æƒé™&lt;/li>
&lt;li>&lt;!-- raw HTML omitted -->grant_type&lt;!-- raw HTML omitted --> æˆæƒæ–¹å¼ &lt;!-- raw HTML omitted -->authorization_code&lt;!-- raw HTML omitted -->(æˆæƒç )ã€&lt;!-- raw HTML omitted -->password&lt;!-- raw HTML omitted -->(å¯†ç )ã€&lt;!-- raw HTML omitted -->client_credentials&lt;!-- raw HTML omitted -->
(å‡­è¯)ã€&lt;!-- raw HTML omitted -->refresh_token&lt;!-- raw HTML omitted -->(æ›´æ–°ä»¤ç‰Œ)&lt;/li>
&lt;li>&lt;!-- raw HTML omitted -->state&lt;!-- raw HTML omitted --> åº”ç”¨ç¨‹åºä¼ é€’çš„ä¸€ä¸ªéšæœºæ•°ï¼Œé˜²æ­¢ &lt;!-- raw HTML omitted -->CSRF&lt;!-- raw HTML omitted --> æ”»å‡»&lt;/li>
&lt;/ul>
&lt;h3 id="æˆæƒç httpswwwoauthcomoauth2-serversaccess-tokensauthorization-code-request-authorization-code-request">&lt;a href="https://www.oauth.com/oauth2-servers/access-tokens/authorization-code-request/" title="authorization-code-request">æˆæƒç &lt;/a>&lt;/h3>
&lt;p>åœ¨è®¿é—®ç¬¬ä¸‰æ–¹åº”ç”¨å…ˆç”³è¯·ä¸€ä¸ªæˆæƒç ï¼Œç„¶åå†ç”¨æˆæƒç è·å–ä»¤ç‰Œ.è¿™ç§æ–¹å¼ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æµç¨‹ï¼Œå®‰å…¨æ€§ä¹Ÿæ˜¯æœ€é«˜çš„ï¼Œé€‚ç”¨äºæœ‰åç«¯çš„&lt;!-- raw HTML omitted -->Web&lt;!-- raw HTML omitted -->åº”ç”¨ã€‚æˆæƒç é€šè¿‡å‰ç«¯ä¼ é€ï¼Œä»¤ç‰Œå­˜å‚¨åœ¨åç«¯ã€‚æ‰€æœ‰çš„å’Œèµ„æºæœåŠ¡å™¨çš„äº¤äº’éƒ½åœ¨æœåŠ¡ç«¯å®Œæˆï¼Œé¿å…äº†ä»¤ç‰Œçš„æ³„éœ²ã€‚
æˆæƒç å’Œä»¤ç‰Œçš„åœ¨ æµè§ˆå™¨å’Œå®¢æˆ·ç«¯&lt;!-- raw HTML omitted -->WEB&lt;!-- raw HTML omitted -->åº”ç”¨ä»¥åŠèµ„æºæœåŠ¡å™¨çš„äº¤äº’æµç¨‹å¤§è‡´å¦‚ä¸‹:
&lt;img src="https://pinkhello.me/OAuth2-0%E9%82%A3%E7%82%B9%E4%BA%8B/auth_code.png" alt="authorization-code">&lt;/p>
&lt;ul>
&lt;li>1.2.3.4 ç”¨æˆ·é€‰æ‹© &lt;!-- raw HTML omitted -->Google&lt;!-- raw HTML omitted --> ç™»é™† &lt;!-- raw HTML omitted -->yelp.com&lt;!-- raw HTML omitted -->&lt;/li>
&lt;li>3.4 &lt;!-- raw HTML omitted -->Yelp.com&lt;!-- raw HTML omitted --> è¯·æ±‚ç”¨æˆ·æˆæƒ &lt;!-- raw HTML omitted -->Google&lt;!-- raw HTML omitted --> æƒé™&lt;/li>
&lt;li>5.6 ç”¨æˆ·åŒæ„åè¿”å›æˆæƒç 
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;/li>
&lt;li>7.8 &lt;!-- raw HTML omitted -->Yelp.com&lt;!-- raw HTML omitted --> é€šè¿‡æˆæƒç  ä¼šå‘ &lt;!-- raw HTML omitted -->Google&lt;!-- raw HTML omitted -->å‘èµ·è¯·æ±‚&lt;!-- raw HTML omitted -->Token&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;/li>
&lt;li>9 éªŒè¯å¿…è¦å‚æ•°ï¼Œè¿”å› &lt;!-- raw HTML omitted -->Token&lt;!-- raw HTML omitted -->&lt;/li>
&lt;li>10.11 æ“ä½œè¯·æ±‚&lt;/li>
&lt;/ul>
&lt;h3 id="éšè—å¼httpsauth0comblogoauth2-implicit-grant-and-spa-oauth2-implicit-grant-and-spa">&lt;a href="https://auth0.com/blog/oauth2-implicit-grant-and-spa/" title="oauth2-implicit-grant-and-spa">éšè—å¼&lt;/a>&lt;/h3>
&lt;p>&lt;img src="https://pinkhello.me/OAuth2-0%E9%82%A3%E7%82%B9%E4%BA%8B/implicit.png" alt="implicit">&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h3 id="å¯†ç å¼httpswwwoauthcomoauth2-serversaccess-tokenspassword-grant-password-grant">&lt;a href="https://www.oauth.com/oauth2-servers/access-tokens/password-grant/" title="password-grant">å¯†ç å¼&lt;/a>&lt;/h3>
&lt;p>é¡¾åæ€è®®,åœ¨è‡ªå·±çš„ç³»ç»Ÿè¾“å…¥ç¬¬ä¸‰æ–¹ç³»ç»Ÿçš„è´¦å·å¯†ç ,è‡ªå·±çš„ç³»ç»Ÿæ‹¿è´¦å·å¯†ç å»ç”³è¯·ä»¤ç‰Œï¼Œå“åº”é¢˜é‡Œé¢è¿”å›token&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h3 id="å‡­è¯å¼httpswwwoauthcomoauth2-serversaccess-tokensclient-credentials-client-credentials">&lt;a href="https://www.oauth.com/oauth2-servers/access-tokens/client-credentials/" title="client-credentials">å‡­è¯å¼&lt;/a>&lt;/h3>
&lt;p>å‡­è¯å¼å’Œå¯†ç å¾ˆç›¸ä¼¼ï¼Œä¸»è¦ç»™æ²¡æœ‰å‰ç«¯è¾“å…¥çš„é¡¹ç›®æˆ–è€…å‘½ä»¤è¡Œ&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h2 id="ä»¤ç‰Œçš„ä½¿ç”¨å’Œæ›´æ–°">ä»¤ç‰Œçš„ä½¿ç”¨å’Œæ›´æ–°&lt;/h2>
&lt;h3 id="ä»¤ç‰Œçš„ä½¿ç”¨">&lt;a href="">ä»¤ç‰Œçš„ä½¿ç”¨&lt;/a>&lt;/h3>
&lt;p>ä»¤ç‰Œçš„æ‹¿åˆ°äº†ï¼Œå°±å¯ä»¥è°ƒç”¨Googleçš„APIè¿›è¡Œè¯·æ±‚æ•°æ®äº†ï¼Œ
ä¸€èˆ¬è®² Token æ”¾å…¥è¯·æ±‚å¤´ Authorization.&lt;/p>
&lt;h3 id="ä»¤ç‰Œçš„æ›´æ–°httpswwwoauthcomoauth2-serversaccess-tokensrefreshing-access-tokens-refreshing-access-tokens">&lt;a href="https://www.oauth.com/oauth2-servers/access-tokens/refreshing-access-tokens/" title="refreshing-access-tokens">ä»¤ç‰Œçš„æ›´æ–°&lt;/a>&lt;/h3>
&lt;p>&lt;!-- raw HTML omitted -->Token&lt;!-- raw HTML omitted --> æ˜¯æœ‰æ—¶æ•ˆæ€§çš„ï¼Œä¸€æ—¦è¿‡æœŸå°±éœ€è¦é‡æ–°è·å–ï¼Œä½†æ˜¯é‡èµ°ä¸€éæˆæƒæµç¨‹ï¼Œä¸ä»…éº»çƒ¦è€Œä¸”ç”¨æˆ·ä½“éªŒä¹Ÿä¸å¥½ï¼Œé‚£å¦‚ä½•è®©ç”¨æˆ·ä½¿ç”¨çš„ä¼˜é›…å‘¢ï¼Ÿ&lt;/p>
&lt;p>ä¸€èˆ¬åœ¨é¢å‘ä»¤ç‰Œçš„æ—¶å€™ï¼Œé¢å‘ä¸¤ä¸ª&lt;!-- raw HTML omitted -->Token&lt;!-- raw HTML omitted -->, ä¸€ä¸ªæˆæƒ&lt;!-- raw HTML omitted -->Token&lt;!-- raw HTML omitted -->,ä¸€ä¸ª&lt;!-- raw HTML omitted -->Refresh Token&lt;!-- raw HTML omitted -->,
åœ¨æ›´æ–°&lt;!-- raw HTML omitted -->refresh_token&lt;!-- raw HTML omitted -->æ—¶å€™,å°†&lt;!-- raw HTML omitted -->grant_type&lt;!-- raw HTML omitted -->æŒ‡å®šä¸º&lt;!-- raw HTML omitted -->refresh_token&lt;!-- raw HTML omitted -->,
å‚æ•°&lt;!-- raw HTML omitted -->refresh_token&lt;!-- raw HTML omitted -->æ˜¯ç”¨äºæ›´æ–°&lt;!-- raw HTML omitted -->Token&lt;!-- raw HTML omitted -->çš„&lt;!-- raw HTML omitted -->refresh_token&lt;!-- raw HTML omitted -->&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h1 id="æ€»ç»“">æ€»ç»“&lt;/h1>
&lt;h1 id="å®‰åˆ©">å®‰åˆ©&lt;/h1>
&lt;ul>
&lt;li>Client
&lt;ul>
&lt;li>Go &lt;a href="https://godoc.org/golang.org/x/oauth2">https://godoc.org/golang.org/x/oauth2&lt;/a>&lt;/li>
&lt;li>Java
&lt;ul>
&lt;li>&lt;a href="https://spring.io/projects/spring-social/">https://spring.io/projects/spring-social/&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://spring.io/projects/spring-security/">https://spring.io/projects/spring-security/&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Server
&lt;ul>
&lt;li>Go
&lt;ul>
&lt;li>&lt;a href="https://github.com/go-oauth2/oauth2">https://github.com/go-oauth2/oauth2&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/zalando/gin-oauth2">https://github.com/zalando/gin-oauth2&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Java &lt;a href="https://github.com/zalando/tokens">https://github.com/zalando/tokens&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>å‚è€ƒ&lt;/p>
&lt;ul>
&lt;li>jsonwebtoken.io &lt;a href="https://www.jsonwebtoken.io/">https://www.jsonwebtoken.io/&lt;/a>&lt;/li>
&lt;li>oauth.net &lt;a href="https://oauth.net/2/">https://oauth.net/2/&lt;/a>&lt;/li>
&lt;li>aliyun.com
&lt;ul>
&lt;li>&lt;a href="https://help.aliyun.com/document_detail/32144.html?spm=5176.87240.400427.53.32fa4614S88B0N">https://help.aliyun.com/document_detail/32144.html?spm=5176.87240.400427.53.32fa4614S88B0N&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://help.aliyun.com/document_detail/32008.html?spm=a2c4g.11186623.6.780.40435837SXpbPT">https://help.aliyun.com/document_detail/32008.html?spm=a2c4g.11186623.6.780.40435837SXpbPT&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://help.aliyun.com/document_detail/32026.html?spm=a2c4g.11186623.6.856.20b1c06dgVW6Ri">https://help.aliyun.com/document_detail/32026.html?spm=a2c4g.11186623.6.856.20b1c06dgVW6Ri&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
- https://pinkhello.me/posts/05-oauth2.0%E9%82%A3%E7%82%B9%E4%BA%8B/ - PinkHello, All Rights Reserved</description></item><item><title>04 å¦‚ä½•æ„å»ºä¸€ä¸ªç®€å•çš„RPCè°ƒç”¨</title><link>https://pinkhello.me/posts/04-%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84rpc%E8%B0%83%E7%94%A8/</link><pubDate>Wed, 10 Feb 2021 08:24:19 +0800</pubDate><guid>https://pinkhello.me/posts/04-%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84rpc%E8%B0%83%E7%94%A8/</guid><description>PinkHello https://pinkhello.me/posts/04-%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84rpc%E8%B0%83%E7%94%A8/ -&lt;p>1ã€ä»€ä¹ˆå«RPC?&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>&lt;img src="https://pinkhello.me/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/RPC%E8%B0%83%E7%94%A8%E6%9C%8D%E5%8A%A1%E8%BF%87%E7%A8%8B.jpg" alt="RPCè°ƒç”¨æœåŠ¡è¿‡ç¨‹">&lt;/p>
&lt;p>RPCæ„æˆ&lt;/p>
&lt;ul>
&lt;li>RPC Consumer&lt;/li>
&lt;li>RPC Provider&lt;/li>
&lt;li>ConfigServer&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>1ã€&lt;code>Provider&lt;/code> å¯åŠ¨ &lt;code>ConfigServer&lt;/code> æ³¨å†ŒæœåŠ¡&lt;/li>
&lt;li>2ã€&lt;code>Consumer&lt;/code> å¯åŠ¨ &lt;code>ConfigServer&lt;/code> è®¢é˜…æœåŠ¡ï¼Œ&lt;/li>
&lt;li>3ã€å‘èµ·è°ƒç”¨ &lt;code>Consumer&lt;/code> &amp;mdash;&amp;gt; &lt;code>Provider&lt;/code>&lt;/li>
&lt;li>4ã€å“åº”è°ƒç”¨ &lt;code>Consumer&lt;/code> &amp;lt;&amp;mdash; &lt;code>Provider&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>2ã€ä»€ä¹ˆæ˜¯ &lt;code>Netty&lt;/code> ? &lt;a href="https://netty.io/">https://netty.io/&lt;/a>&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>&lt;img src="https://pinkhello.me/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/netty%E6%A1%86%E6%9E%B6%E5%9B%BE.png" alt="nettyæ¡†æ¶å›¾">&lt;/p>
&lt;p>3ã€ç°æœ‰çš„å¼€æºçš„é¡¹ç›®æ˜¯å¦ä½¿ç”¨äº† &lt;code>Netty&lt;/code> ?&lt;/p>
&lt;ul>
&lt;li>Dubbo&lt;/li>
&lt;li>Grpc&lt;/li>
&lt;li>Spark&lt;/li>
&lt;li>&amp;hellip;.&lt;/li>
&lt;/ul>
&lt;p>4ã€&lt;code>RPC Provider&lt;/code> å¯åŠ¨&lt;/p>
&lt;ul>
&lt;li>&lt;code>Netty Server&lt;/code> æ–¹å¼å¯åŠ¨&lt;/li>
&lt;li>&lt;code>Rpc&lt;/code> æœåŠ¡çš„æ³¨å†Œ
&lt;img src="https://pinkhello.me/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/RPC%E4%B8%8ENetty%E7%BB%93%E5%90%88Provider%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B.png" alt="RPCä¸Nettyç»“åˆProviderè°ƒç”¨è¿‡ç¨‹">&lt;/li>
&lt;/ul>
&lt;p>5ã€&lt;code>RPC Consumer&lt;/code> å¯åŠ¨&lt;/p>
&lt;ul>
&lt;li>&lt;code>Netty Client&lt;/code> æ–¹å¼å¯åŠ¨&lt;/li>
&lt;li>&lt;code>RPC&lt;/code> æ³›åŒ–è°ƒç”¨ã€é€šè¿‡å­—èŠ‚ç åŸºäºåå°„æ¥å®ç°è¿œç¨‹è°ƒåº¦&lt;/li>
&lt;li>&lt;code>Consumer&lt;/code> æœåŠ¡è®¢é˜…&lt;/li>
&lt;li>å¯åŠ¨æ—¶å»ºç«‹é•¿è¿æ¥
&lt;img src="https://pinkhello.me/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/RPC%E4%B8%8ENetty%E7%BB%93%E5%90%88Consumer%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B.png" alt="RPCä¸Nettyç»“åˆConsumerè°ƒç”¨è¿‡ç¨‹">&lt;/li>
&lt;/ul>
&lt;p>6ã€ä»ç¬¬å››å¯ä»¥çœ‹å‡ºï¼Œå¤šä¸ª &lt;code>Provider&lt;/code> æ˜¯ç”±ä¸€ä¸ª &lt;code>NettyServer&lt;/code> æä¾›çš„ï¼Œé€šè¿‡ &lt;code>HandlerMap&lt;/code> æ˜ å°„æ‰¾åˆ°å¯¹åº”çš„ &lt;code>Ioc Bean&lt;/code>ï¼Œå®ŒæˆæœåŠ¡è°ƒç”¨&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">æœåŠ¡ç«¯
EventLoopGroup bossGroup = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> NioEventLoopGroup(1);
EventLoopGroup workerGroup = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> NioEventLoopGroup();
&lt;span style="color:#8b008b;font-weight:bold">try&lt;/span> {
ServerBootstrap b = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> ServerBootstrap();
b.&lt;span style="color:#658b00">group&lt;/span>(bossGroup, workerGroup)
.&lt;span style="color:#658b00">channel&lt;/span>(NioServerSocketChannel.&lt;span style="color:#658b00">class&lt;/span>)
.&lt;span style="color:#658b00">option&lt;/span>(ChannelOption.&lt;span style="color:#658b00">SO_BACKLOG&lt;/span>, 100)
.&lt;span style="color:#658b00">handler&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> LoggingHandler(LogLevel.&lt;span style="color:#658b00">INFO&lt;/span>))
.&lt;span style="color:#658b00">childHandler&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> ChannelInitializer&amp;lt;SocketChannel&amp;gt;() {
&lt;span style="color:#707a7c">@Override&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">initChannel&lt;/span>(SocketChannel ch) &lt;span style="color:#8b008b;font-weight:bold">throws&lt;/span> Exception {
ChannelPipeline p = ch.&lt;span style="color:#658b00">pipeline&lt;/span>();
p.&lt;span style="color:#658b00">addLast&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> RpcEncoder(RpcRequest.&lt;span style="color:#658b00">class&lt;/span>));
p.&lt;span style="color:#658b00">addLast&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> RpcDecoder(RpcResponse.&lt;span style="color:#658b00">class&lt;/span>));
p.&lt;span style="color:#658b00">addLast&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> RpcHandler());
}});
&lt;span style="color:#228b22">// Start the server.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> ChannelFuture f = b.&lt;span style="color:#658b00">bind&lt;/span>(PORT).&lt;span style="color:#658b00">sync&lt;/span>();
&lt;span style="color:#228b22">// Wait until the server socket is closed.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> f.&lt;span style="color:#658b00">channel&lt;/span>().&lt;span style="color:#658b00">closeFuture&lt;/span>().&lt;span style="color:#658b00">sync&lt;/span>();
} &lt;span style="color:#8b008b;font-weight:bold">finally&lt;/span> {
&lt;span style="color:#228b22">// Shut down all event loops to terminate all threads.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> bossGroup.&lt;span style="color:#658b00">shutdownGracefully&lt;/span>();
workerGroup.&lt;span style="color:#658b00">shutdownGracefully&lt;/span>();
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://pinkhello.me/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/Netty%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E5%AE%A2%E6%88%B7%E7%AB%AFTCP%E9%93%BE%E6%8E%A5%E4%B8%8A%E7%9A%84%E8%AF%B7%E6%B1%82.jpg" alt="Nettyå¦‚ä½•å¤„ç†å®¢æˆ·ç«¯TCPé“¾æ¥ä¸Šçš„è¯·æ±‚">&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/NettyReactor%E5%B7%A5%E4%BD%9C%E6%A1%86%E6%9E%B6%E5%9B%BE.jpg" alt="NettyReactorå·¥ä½œæ¡†æ¶å›¾">&lt;/p>
&lt;ul>
&lt;li>&lt;code>BossGroup&lt;/code> -&amp;gt; å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚&lt;/li>
&lt;li>&lt;code>EventGroup&lt;/code> â€”&amp;gt; å¤„ç†IO &lt;code>Read/Write&lt;/code> æ“ä½œã€æ‰§è¡Œä»»åŠ¡ç³»ç»ŸTaskã€å®šæ—¶ä»»åŠ¡&lt;/li>
&lt;li>&lt;code>ChildChannelHandler&lt;/code> æ–¹å¼æ˜¯å¯¹ &lt;code>ChannelPipeline&lt;/code> çš„è®¾ç½®ã€&lt;/li>
&lt;li>&lt;code>ChannelPipeline&lt;/code> æ˜¯ç›¸å½“äºä»»åŠ¡é“¾çš„æ¨¡å¼, æ˜¯ä¸€ä¸² &lt;code>ChannelHandler&lt;/code> çš„å®ä¾‹&lt;/li>
&lt;li>&lt;code>ChannelHandlerContext&lt;/code> æ˜¯ &lt;code>ChannelPipeline&lt;/code> å’Œ &lt;code>ChannelHandler&lt;/code> çš„å…³ç³»&lt;/li>
&lt;li>æ¯ä¸ªé“¾æ¥å¯¹äº &lt;code>Sever&lt;/code> ç«¯éƒ½ä¼šåˆ›å»ºä¸€ä¸ª &lt;code>Channel&lt;/code> ï¼Œå¯ä»¥å°† &lt;code>Channel&lt;/code> ç†è§£ä¸º &lt;code>Connection&lt;/code> ï¼ˆå…¶å®çœŸæ­£çš„æ˜¯ &lt;code>Connection&lt;/code> å±äº &lt;code>Channel&lt;/code> çš„ä¸€éƒ¨åˆ†ï¼‰&lt;/li>
&lt;li>æ¯ä¸ª &lt;code>Channel&lt;/code> éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„å”¯ä¸€çš„ &lt;code>ChannelPipeline&lt;/code> æ“ä½œï¼Œå¯¹äºå…¶ä»–çš„ &lt;code>Channel&lt;/code> çš„ &lt;code>ChannelPipeline&lt;/code> æ˜¯éš”ç¦»çš„&lt;/li>
&lt;li>&lt;code>RPC Handler&lt;/code> æ˜¯æˆ‘ä»¬å¯¹äºè‡ªå·±çš„æ‰¾å¯» &lt;code>RPC&lt;/code> æœåŠ¡å¤„ç†çš„ &lt;code>Handler&lt;/code> å®ç°&lt;/li>
&lt;li>&lt;code>RPC Encoder&lt;/code> æ˜¯æˆ‘ä»¬å¯¹äºè‡ªå·±çš„æ‰¾å¯» &lt;code>RPC&lt;/code> åºåˆ—åŒ–çš„ç¼–ç çš„ &lt;code>Handler&lt;/code> å®ç°&lt;/li>
&lt;li>&lt;code>RPC Decoder&lt;/code> æ˜¯æˆ‘ä»¬å¯¹äºè‡ªå·±çš„æ‰¾å¯» &lt;code>RPC&lt;/code> åºåˆ—åŒ–çš„è§£ç çš„ &lt;code>Handler&lt;/code> å®ç°&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">å®¢æˆ·ç«¯
EventLoopGroup group = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> NioEventLoopGroup();
&lt;span style="color:#8b008b;font-weight:bold">try&lt;/span> {
Bootstrap b = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> Bootstrap();
b.&lt;span style="color:#658b00">group&lt;/span>(group)
.&lt;span style="color:#658b00">channel&lt;/span>(NioSocketChannel.&lt;span style="color:#658b00">class&lt;/span>)
.&lt;span style="color:#658b00">option&lt;/span>(ChannelOption.&lt;span style="color:#658b00">TCP_NODELAY&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>)
.&lt;span style="color:#658b00">handler&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> ChannelInitializer&amp;lt;SocketChannel&amp;gt;() {
&lt;span style="color:#707a7c">@Override&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">initChannel&lt;/span>(SocketChannel ch) &lt;span style="color:#8b008b;font-weight:bold">throws&lt;/span> Exception {
ChannelPipeline p = ch.&lt;span style="color:#658b00">pipeline&lt;/span>();
p.&lt;span style="color:#658b00">addLast&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> RpcEncoder(RpcResponse.&lt;span style="color:#658b00">class&lt;/span>));
p.&lt;span style="color:#658b00">addLast&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> RpcDecoder(RpcRequest.&lt;span style="color:#658b00">class&lt;/span>));
p.&lt;span style="color:#658b00">addLast&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> RpcClientHandler());
}});
&lt;span style="color:#228b22">// Start the client.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> ChannelFuture f = b.&lt;span style="color:#658b00">connect&lt;/span>(HOST, PORT).&lt;span style="color:#658b00">sync&lt;/span>();
&lt;span style="color:#228b22">// Wait until the connection is closed.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> f.&lt;span style="color:#658b00">channel&lt;/span>().&lt;span style="color:#658b00">closeFuture&lt;/span>().&lt;span style="color:#658b00">sync&lt;/span>();
} &lt;span style="color:#8b008b;font-weight:bold">finally&lt;/span> {
&lt;span style="color:#228b22">// Shut down the event loop to terminate all threads.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> group.&lt;span style="color:#658b00">shutdownGracefully&lt;/span>();
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>7ã€&lt;code>RPC&lt;/code> åºåˆ—åŒ–&lt;/p>
&lt;ul>
&lt;li>äºŒè¿›åˆ¶æ•°æ®&lt;/li>
&lt;li>Hessian&lt;/li>
&lt;li>Avro&lt;/li>
&lt;li>ProtoBuffer (Protobuf)&lt;/li>
&lt;li>JSON&lt;/li>
&lt;li>XML&lt;/li>
&lt;/ul>
&lt;p>8ã€å…³äº &lt;code>RPC&lt;/code> çš„å®ç°æ€è€ƒä¸æŠ€æœ¯è®¨è®º&lt;/p>
&lt;ul>
&lt;li>ä¸šåŠ¡æ–¹æ³•ã€å› ä¸ºæ˜¯æ”¶åˆ°è¯·æ±‚æ¶ˆæ¯è€Œè§¦å‘çš„åç»­åŠ¨ä½œè°ƒç”¨ï¼Œä¸åšé¢å¤–è®¾ç½®ï¼Œè‚¯å®šæ˜¯ä½¿ç”¨çš„ &lt;code>WorkGroup&lt;/code> é‡Œé¢çš„çº¿ç¨‹æ“ä½œçš„ã€‚
è€Œä½œä¸ºä¸šåŠ¡å±‚ï¼Œä¸åº”è¯¥ä¸åº•å±‚å…³è”ï¼Œåº”è¯¥åˆ‡å‰²å¼€æ¥ï¼ŒåŠ¿å¿…ä¼šå¼•å…¥çœŸçš„ä¸šåŠ¡ä¾§çº¿ç¨‹æ± ã€‚
é‚£ä¹ˆå¦‚ä½•å¼•ç”¨ã€æ€ä¹ˆå¼•ç”¨ï¼Ÿ(å…³äº ä¸šåŠ¡çº¿ç¨‹æ±  ä¸ &lt;code>WorkGroup&lt;/code> çš„ &lt;code>EvenLoop&lt;/code> çš„æ€è€ƒ )&lt;/li>
&lt;li>å…³äº &lt;code>RPC&lt;/code> è°ƒç”¨å¤§éƒ¨åˆ†æ˜¯åŒæ­¥çš„è°ƒç”¨ï¼Œè€Œ &lt;code>Netty&lt;/code> åº•å±‚æ˜¯å®Œå…¨å¼‚æ­¥äº‹ä»¶æœºåˆ¶ï¼Œåœ¨RPCæ¡†æ¶å±‚é¢å¦‚ä½•å®ç°åŒæ­¥çš„è°ƒç”¨æ–¹å¼çš„ï¼Ÿ&lt;/li>
&lt;li>åŸºäº &lt;code>TCP&lt;/code> çš„é•¿é“¾æ¥è°ƒç”¨ï¼Œåœ¨ &lt;code>RPC&lt;/code> ä¸Šä½ ä¼šæƒ³åˆ°å…¶ä»–çš„å“ªäº›ä¸œä¸œï¼Ÿ&lt;/li>
&lt;li>åœ¨æ­¤ç¯å¢ƒä¸‹ï¼Œæˆ‘æ²¡æœ‰ä»‹ç» &lt;code>RPC&lt;/code> æœåŠ¡äº IOCå®¹å™¨çš„ç»“åˆï¼Œå¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Œå¦‚ä½•åšåˆ° æ³¨è§£æœºåˆ¶ã€&lt;code>JAVA CONFIG&lt;/code> æœºåˆ¶ã€&lt;code>XML SCHEMA&lt;/code> æœºåˆ¶æ¥åš?
&lt;ul>
&lt;li>GUICE&lt;/li>
&lt;li>SPRING&lt;/li>
&lt;li>SPI&lt;/li>
&lt;li>&amp;hellip;.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
- https://pinkhello.me/posts/04-%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84rpc%E8%B0%83%E7%94%A8/ - PinkHello, All Rights Reserved</description></item><item><title>03 Stringä¸ºä»€ä¹ˆè®¾è®¡æˆfinal</title><link>https://pinkhello.me/posts/03-string%E4%B8%BA%E4%BB%80%E4%B9%88%E8%AE%BE%E8%AE%A1%E6%88%90final/</link><pubDate>Wed, 10 Feb 2021 08:19:51 +0800</pubDate><guid>https://pinkhello.me/posts/03-string%E4%B8%BA%E4%BB%80%E4%B9%88%E8%AE%BE%E8%AE%A1%E6%88%90final/</guid><description>PinkHello https://pinkhello.me/posts/03-string%E4%B8%BA%E4%BB%80%E4%B9%88%E8%AE%BE%E8%AE%A1%E6%88%90final/ -&lt;h1 id="stringæºç å‰–æ">&lt;code>String&lt;/code>æºç å‰–æ&lt;/h1>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">final&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">String&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">implements&lt;/span> java.&lt;span style="color:#658b00">io&lt;/span>.&lt;span style="color:#658b00">Serializable&lt;/span>, Comparable&amp;lt;String&amp;gt;, CharSequence {
&lt;span style="color:#228b22">/** The value is used for character storage. */&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">final&lt;/span> &lt;span style="color:#00688b;font-weight:bold">char&lt;/span> value[];
&lt;span style="color:#228b22">/** Cache the hash code for the string */&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> &lt;span style="color:#00688b;font-weight:bold">int&lt;/span> hash; &lt;span style="color:#228b22">// Default to 0
&lt;/span>&lt;span style="color:#228b22">&lt;/span>
&lt;span style="color:#228b22">/** use serialVersionUID from JDK 1.0.2 for interoperability */&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">final&lt;/span> &lt;span style="color:#00688b;font-weight:bold">long&lt;/span> serialVersionUID = -6849794470754667710L;
&lt;span style="color:#228b22">/**
&lt;/span>&lt;span style="color:#228b22"> * Class String is special cased within the Serialization Stream Protocol.
&lt;/span>&lt;span style="color:#228b22"> *
&lt;/span>&lt;span style="color:#228b22"> * A String instance is written into an ObjectOutputStream according to
&lt;/span>&lt;span style="color:#228b22"> * &amp;lt;a href=&amp;#34;{@docRoot}/../platform/serialization/spec/output.html&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#228b22"> * Object Serialization Specification, Section 6.2, &amp;#34;Stream Elements&amp;#34;&amp;lt;/a&amp;gt;
&lt;/span>&lt;span style="color:#228b22"> */&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">final&lt;/span> ObjectStreamField[] serialPersistentFields =
&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> ObjectStreamField[0];
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>String&lt;/code> å¦‚ä½•ä¿è¯ ä¸å¯å˜çš„å‘¢ï¼Ÿ&lt;/p>
&lt;blockquote>
&lt;p>å­—ç¬¦æ•°ç»„ä½¿ç”¨äº† &lt;code>final&lt;/code> ä¿®é¥°ï¼Œè¿™ä¹Ÿåªæ˜¯è¡¨ç¤ºäº† å­—ç¬¦æ•°ç»„çš„å¼•ç”¨åœ°å€ä¸å¯å˜ï¼Œå¹¶ä¸ä»£è¡¨å†…å®¹ä¸å¯å˜ã€‚
å…¶ä½¿ç”¨ &lt;code>private&lt;/code> ä¿®é¥°ï¼Œå¤–éƒ¨æ²¡æœ‰å…¥å£è¾¾åˆ°å˜åŠ¨ï¼Œä»è€Œä¿è¯äº† String çš„ä¸å¯å˜æ€§&lt;/p>
&lt;/blockquote>
&lt;p>ä¸ºä»€ä¹ˆä¿è¯ &lt;code>String&lt;/code> æ˜¯ &lt;code>final&lt;/code> çš„å‘¢ï¼Ÿç‰¹ç‚¹ï¼š&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>å› ä¸ºåªæœ‰ä¿è¯ &lt;code>String&lt;/code> æ˜¯ &lt;code>final&lt;/code> çš„å‘¢ &lt;strong>åªæœ‰å½“å­—ç¬¦ä¸²ä¸å¯å˜çš„ï¼Œå­—ç¬¦ä¸²æ± æ‰å¯èƒ½å®ç°&lt;/strong>;å­—ç¬¦ä¸²æ± çš„å®ç°å¯ä»¥èŠ‚çœå¾ˆå¤šçš„ &lt;code>Heap&lt;/code>ç©ºé—´ï¼Œå› ä¸ºä¸åŒçš„å­—ç¬¦ä¸²å˜é‡éƒ½æŒ‡å‘æ± ä¸­çš„åŒä¸€ä¸ªå­—ç¬¦ä¸².&lt;/li>
&lt;li>å‡å¦‚å­—ç¬¦ä¸²å¯å˜ï¼Œé‚£ä¹ˆ&lt;code>String&lt;/code> &lt;code>interning&lt;/code> ä¸èƒ½å®ç°ï¼Œé‚£ä¹ˆå˜é‡æ”¹å˜äº†è¿™ä¸ªå­—ç¬¦ä¸²çš„å€¼ï¼Œé‚£ä¹ˆå…¶ä»–æŒ‡å‘è¿™ä¸ªå€¼çš„å˜é‡çš„å€¼ä¹Ÿæ”¹å˜äº†ã€‚ ï¼ˆå®‰å…¨é—®é¢˜æ¥äº†ï¼Œç”¨æˆ·åå¯†ç ï¼Œç«¯å£ã€IPç­‰ï¼‰&lt;/li>
&lt;li>å­—ç¬¦ä¸²ä¸å¯å˜ï¼Œå¤šçº¿ç¨‹å®‰å…¨ï¼ŒåŒä¸€ä¸ªå­—ç¬¦ä¸²å®ä¾‹å¯ä»¥è¢«å¯¹æ­Œçº¿ç¨‹å…±äº«ï¼Œä¸éœ€è¦è€ƒè™‘åŒæ­¥é—®é¢˜&lt;/li>
&lt;li>ä¸Šé¢çœ‹å‡ºï¼Œåœ¨å­—ç¬¦ä¸²ä¸å¯å˜çš„æƒ…å†µä¸‹ï¼Œåˆ›å»ºçš„æ—¶å€™ &lt;code>hashcode&lt;/code>ä¹Ÿè¢«ç¼“å­˜äº†ï¼Œä¸éœ€è¦é‡æ–°è®¡ç®—ã€‚ä¸€éƒ¨åˆ†æ€§èƒ½é—®é¢˜å¯ä»¥å¾ˆå¥½çš„é€‰æ‹©å­—ç¬¦ä¸²&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h1 id="string-åœ¨-jvm-å±‚ç†è§£-æ‹“å±•">&lt;code>String&lt;/code> åœ¨ &lt;code>JVM&lt;/code> å±‚ç†è§£ æ‹“å±•&lt;/h1>
&lt;p>&lt;code>JVM&lt;/code> å±‚é¢æœ‰ è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€å †ã€ç¨‹åºè®¡æ•°å™¨ã€å…ƒæ•°æ®åŒº(æ–¹æ³•åŒº)
&lt;img src="https://pinkhello.me/String%E4%B8%BA%E4%BB%80%E4%B9%88%E8%AE%BE%E8%AE%A1%E6%88%90final%E5%BD%A2%E6%80%81/%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA.png" alt="è¿è¡Œæ—¶æ•°æ®åŒº">&lt;/p>
&lt;ul>
&lt;li>å­—ç¬¦ä¸²åˆ›å»ºå½¢å¼&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">String s1 = &lt;span style="color:#cd5555">&amp;#34;1&amp;#34;&lt;/span>;
String s2 = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> String(&lt;span style="color:#cd5555">&amp;#34;1&amp;#34;&lt;/span>);
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;ul>
&lt;li>ç¼–è¯‘æœŸé—´ &amp;ldquo;1&amp;rdquo; ä½œä¸ºå¸¸é‡è¿›å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆè¿™æ—¶å€™æ˜¯é™æ€å¸¸é‡æ± ï¼‰;&lt;/li>
&lt;li>å½“ç¼–è¯‘ &lt;code>s1&lt;/code> æ—¶å€™ï¼Œå°† &lt;code>s1&lt;/code> æ¨è¿›å±€éƒ¨å˜é‡åŒºï¼ˆæ ˆå¸§å†…éƒ¨ï¼‰; å…ˆåˆ¤æ–­ &amp;ldquo;1&amp;rdquo; åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± åœ¨ä¸åœ¨ï¼Œä¸å­˜åœ¨çš„è¯åˆ›å»ºå¸¸é‡ &amp;ldquo;1&amp;rdquo; åŠ å…¥å¸¸é‡æ± ï¼Œå¹¶ç›´æ¥å°† &lt;code>s1&lt;/code> æŒ‡å‘å­—ç¬¦ä¸²å¸¸é‡æ± çš„å¯¹è±¡ &amp;ldquo;1&amp;rdquo; åœ°å€ï¼›&lt;/li>
&lt;li>å½“ä»£ç è¿è¡Œ &lt;code>s2&lt;/code> æ—¶å€™ï¼Œä½¿ç”¨çš„ &lt;code>new&lt;/code> å­—æ®µï¼Œ&lt;code>JVM&lt;/code> å…ˆæ£€æŸ¥å­—ç¬¦ä¸²å¸¸é‡åœ¨å¸¸é‡æ± å­˜ä¸å­˜åœ¨ï¼Œå¦‚æœå·²ç»å­˜åœ¨ï¼Œç›´æ¥åœ¨å †ä¸­å¤åˆ¶æ”¹å¯¹è±¡çš„å‰¯æœ¬ï¼Œå¹¶ä¸”å°† &lt;code>s2&lt;/code> æŒ‡å‘å †ä¸­çš„åˆšåˆšåˆ›å»ºçš„å¯¹è±¡åœ°å€ã€‚
å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä¼šå®ä¾‹åŒ–è¯¥å­—ç¬¦ä¸² &amp;ldquo;1&amp;rdquo; å¹¶ä¸”å°†å…¶æ”¾åˆ°å¸¸é‡æ± ä¸­ï¼ˆè¿™æ—¶å€™æ˜¯è¿è¡Œæ—¶å¸¸é‡æ± ï¼‰,ç„¶ååœ¨å †ä¸­å¤åˆ¶åˆšåˆšåŠ å…¥å¸¸é‡æ± å¯¹è±¡çš„å‰¯æœ¬åˆ›å»ºå‡ºæ–°çš„å¯¹è±¡ï¼Œå¹¶å°† &lt;code>s2&lt;/code> æŒ‡å‘å®ƒ&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;ul>
&lt;li>&amp;lsquo;+&amp;lsquo;å·è¿æ¥çš„å­—ç¬¦ä¸²&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">String s1 = &lt;span style="color:#cd5555">&amp;#34;1&amp;#34;&lt;/span>+&lt;span style="color:#cd5555">&amp;#34;2&amp;#34;&lt;/span>+&lt;span style="color:#cd5555">&amp;#34;3&amp;#34;&lt;/span>;
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;ul>
&lt;li>ç¼–è¯‘æœŸé—´å°±èƒ½ç¡®å®šï¼Œç›´æ¥ä½œä¸º &amp;ldquo;123&amp;rdquo; çš„å¸¸é‡è¿›å…¥å¸¸é‡æ± ;&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">String s2 = &lt;span style="color:#cd5555">&amp;#34;1&amp;#34;&lt;/span>+&lt;span style="color:#cd5555">&amp;#34;2&amp;#34;&lt;/span>+&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> String(&lt;span style="color:#cd5555">&amp;#34;3&amp;#34;&lt;/span>)+&lt;span style="color:#cd5555">&amp;#34;4&amp;#34;&lt;/span>;
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;ul>
&lt;li>å½“ &amp;lsquo;+&amp;rsquo; ä¸­é—´æœ‰å˜é‡æ—¶å€™ï¼Œä¹Ÿåªèƒ½åœ¨è¿è¡ŒæœŸæ‰èƒ½ç¡®å®šï¼Œä½†æ˜¯åœ¨ç¼–è¯‘æœŸé—´ä¼šå°½é‡çš„å°†å­—ç¬¦ä¸²å¸¸é‡è¿æ¥èµ·æ¥ï¼Œå½¢æˆæ–°çš„å­—ç¬¦ä¸²å¸¸é‡;&lt;/li>
&lt;li>åç¼–è¯‘å &lt;code>String s2 = new StringBuilder(&amp;quot;12&amp;quot;).append(new String(&amp;quot;3&amp;quot;&amp;quot;)).append(&amp;quot;4&amp;quot;).toString()&lt;/code>;&lt;/li>
&lt;li>ä¹Ÿå°±æ˜¯è¯´ç”¨ &amp;lsquo;+&amp;rsquo; è¿æ¥ä¸­é—´æœ‰å˜é‡çš„æ—¶å€™ï¼Œ&amp;ldquo;13&amp;rdquo;, &amp;ldquo;3&amp;rdquo;, &amp;ldquo;4&amp;rdquo; åœ¨å¸¸é‡æ± ä¸­ï¼Œåœ¨å †ä¸­æœ‰ &lt;code>StringBuilder(&amp;quot;1234&amp;quot;)&lt;/code>, &lt;code>String(&amp;quot;4&amp;quot;)&lt;/code>,ä»¥åŠ&lt;code>toString&lt;/code>åäº§ç”Ÿçš„&lt;code>String&lt;/code>å¯¹è±¡&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">String s3 = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> String(&lt;span style="color:#cd5555">&amp;#34;3&amp;#34;&lt;/span>) + &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> String(&lt;span style="color:#cd5555">&amp;#34;3&amp;#34;&lt;/span>);
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;ul>
&lt;li>&amp;ldquo;3&amp;rdquo; åœ¨å¸¸é‡æ± ä¸­ï¼ˆç¼–è¯‘çš„æ—¶å€™ï¼‰&lt;/li>
&lt;li>è¿è¡Œæ—¶ï¼Œåœ¨å †ä¸­äº§ç”Ÿ &amp;ldquo;3&amp;rdquo; çš„å‰¯æœ¬ä¸¤ä¸ª &lt;code>String&lt;/code> å¯¹è±¡ï¼Œå¹¶äº§ç”Ÿ &lt;code>StringBuilder(&amp;quot;11&amp;quot;)&lt;/code> å¯¹è±¡ä»¥åŠ &lt;code>toString&lt;/code> çš„ &lt;code>String&lt;/code> å¯¹è±¡&lt;/li>
&lt;/ul>
&lt;/blockquote>
- https://pinkhello.me/posts/03-string%E4%B8%BA%E4%BB%80%E4%B9%88%E8%AE%BE%E8%AE%A1%E6%88%90final/ - PinkHello, All Rights Reserved</description></item></channel></rss>