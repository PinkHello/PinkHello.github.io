<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>PinkHello</title><link>https://pinkhello.me/</link><description>Recent content on PinkHello</description><generator>Hugo -- gohugo.io</generator><language>zh</language><copyright>PinkHello, All Rights Reserved</copyright><lastBuildDate>Tue, 25 May 2021 19:00:00 +0800</lastBuildDate><atom:link href="https://pinkhello.me/index.xml" rel="self" type="application/rss+xml"/><item><title>04 å¦‚ä½•æ„å»ºä¸€ä¸ªç®€å•çš„RPCè°ƒç”¨</title><link>https://pinkhello.me/posts/04-%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84rpc%E8%B0%83%E7%94%A8/</link><pubDate>Wed, 10 Feb 2021 08:24:19 +0800</pubDate><guid>https://pinkhello.me/posts/04-%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84rpc%E8%B0%83%E7%94%A8/</guid><description>PinkHello https://pinkhello.me/posts/04-%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84rpc%E8%B0%83%E7%94%A8/ -&lt;p>1ã€ä»€ä¹ˆå«RPC?&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>&lt;img src="https://pinkhello.me/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/RPC%E8%B0%83%E7%94%A8%E6%9C%8D%E5%8A%A1%E8%BF%87%E7%A8%8B.jpg" alt="RPCè°ƒç”¨æœåŠ¡è¿‡ç¨‹">&lt;/p>
&lt;p>RPCæ„æˆ&lt;/p>
&lt;ul>
&lt;li>RPC Consumer&lt;/li>
&lt;li>RPC Provider&lt;/li>
&lt;li>ConfigServer&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>1ã€&lt;code>Provider&lt;/code> å¯åŠ¨ &lt;code>ConfigServer&lt;/code> æ³¨å†ŒæœåŠ¡&lt;/li>
&lt;li>2ã€&lt;code>Consumer&lt;/code> å¯åŠ¨ &lt;code>ConfigServer&lt;/code> è®¢é˜…æœåŠ¡ï¼Œ&lt;/li>
&lt;li>3ã€å‘èµ·è°ƒç”¨ &lt;code>Consumer&lt;/code> &amp;mdash;&amp;gt; &lt;code>Provider&lt;/code>&lt;/li>
&lt;li>4ã€å“åº”è°ƒç”¨ &lt;code>Consumer&lt;/code> &amp;lt;&amp;mdash; &lt;code>Provider&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>2ã€ä»€ä¹ˆæ˜¯ &lt;code>Netty&lt;/code> ? &lt;a href="https://netty.io/">https://netty.io/&lt;/a>&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>&lt;img src="https://pinkhello.me/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/netty%E6%A1%86%E6%9E%B6%E5%9B%BE.png" alt="nettyæ¡†æ¶å›¾">&lt;/p>
&lt;p>3ã€ç°æœ‰çš„å¼€æºçš„é¡¹ç›®æ˜¯å¦ä½¿ç”¨äº† &lt;code>Netty&lt;/code> ?&lt;/p>
&lt;ul>
&lt;li>Dubbo&lt;/li>
&lt;li>Grpc&lt;/li>
&lt;li>Spark&lt;/li>
&lt;li>&amp;hellip;.&lt;/li>
&lt;/ul>
&lt;p>4ã€&lt;code>RPC Provider&lt;/code> å¯åŠ¨&lt;/p>
&lt;ul>
&lt;li>&lt;code>Netty Server&lt;/code> æ–¹å¼å¯åŠ¨&lt;/li>
&lt;li>&lt;code>Rpc&lt;/code> æœåŠ¡çš„æ³¨å†Œ
&lt;img src="https://pinkhello.me/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/RPC%E4%B8%8ENetty%E7%BB%93%E5%90%88Provider%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B.png" alt="RPCä¸Nettyç»“åˆProviderè°ƒç”¨è¿‡ç¨‹">&lt;/li>
&lt;/ul>
&lt;p>5ã€&lt;code>RPC Consumer&lt;/code> å¯åŠ¨&lt;/p>
&lt;ul>
&lt;li>&lt;code>Netty Client&lt;/code> æ–¹å¼å¯åŠ¨&lt;/li>
&lt;li>&lt;code>RPC&lt;/code> æ³›åŒ–è°ƒç”¨ã€é€šè¿‡å­—èŠ‚ç åŸºäºåå°„æ¥å®ç°è¿œç¨‹è°ƒåº¦&lt;/li>
&lt;li>&lt;code>Consumer&lt;/code> æœåŠ¡è®¢é˜…&lt;/li>
&lt;li>å¯åŠ¨æ—¶å»ºç«‹é•¿è¿æ¥
&lt;img src="https://pinkhello.me/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/RPC%E4%B8%8ENetty%E7%BB%93%E5%90%88Consumer%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B.png" alt="RPCä¸Nettyç»“åˆConsumerè°ƒç”¨è¿‡ç¨‹">&lt;/li>
&lt;/ul>
&lt;p>6ã€ä»ç¬¬å››å¯ä»¥çœ‹å‡ºï¼Œå¤šä¸ª &lt;code>Provider&lt;/code> æ˜¯ç”±ä¸€ä¸ª &lt;code>NettyServer&lt;/code> æä¾›çš„ï¼Œé€šè¿‡ &lt;code>HandlerMap&lt;/code> æ˜ å°„æ‰¾åˆ°å¯¹åº”çš„ &lt;code>Ioc Bean&lt;/code>ï¼Œå®ŒæˆæœåŠ¡è°ƒç”¨&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">æœåŠ¡ç«¯
EventLoopGroup bossGroup = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> NioEventLoopGroup(1);
EventLoopGroup workerGroup = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> NioEventLoopGroup();
&lt;span style="color:#8b008b;font-weight:bold">try&lt;/span> {
ServerBootstrap b = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> ServerBootstrap();
b.&lt;span style="color:#658b00">group&lt;/span>(bossGroup, workerGroup)
.&lt;span style="color:#658b00">channel&lt;/span>(NioServerSocketChannel.&lt;span style="color:#658b00">class&lt;/span>)
.&lt;span style="color:#658b00">option&lt;/span>(ChannelOption.&lt;span style="color:#658b00">SO_BACKLOG&lt;/span>, 100)
.&lt;span style="color:#658b00">handler&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> LoggingHandler(LogLevel.&lt;span style="color:#658b00">INFO&lt;/span>))
.&lt;span style="color:#658b00">childHandler&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> ChannelInitializer&amp;lt;SocketChannel&amp;gt;() {
&lt;span style="color:#707a7c">@Override&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">initChannel&lt;/span>(SocketChannel ch) &lt;span style="color:#8b008b;font-weight:bold">throws&lt;/span> Exception {
ChannelPipeline p = ch.&lt;span style="color:#658b00">pipeline&lt;/span>();
p.&lt;span style="color:#658b00">addLast&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> RpcEncoder(RpcRequest.&lt;span style="color:#658b00">class&lt;/span>));
p.&lt;span style="color:#658b00">addLast&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> RpcDecoder(RpcResponse.&lt;span style="color:#658b00">class&lt;/span>));
p.&lt;span style="color:#658b00">addLast&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> RpcHandler());
}});
&lt;span style="color:#228b22">// Start the server.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> ChannelFuture f = b.&lt;span style="color:#658b00">bind&lt;/span>(PORT).&lt;span style="color:#658b00">sync&lt;/span>();
&lt;span style="color:#228b22">// Wait until the server socket is closed.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> f.&lt;span style="color:#658b00">channel&lt;/span>().&lt;span style="color:#658b00">closeFuture&lt;/span>().&lt;span style="color:#658b00">sync&lt;/span>();
} &lt;span style="color:#8b008b;font-weight:bold">finally&lt;/span> {
&lt;span style="color:#228b22">// Shut down all event loops to terminate all threads.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> bossGroup.&lt;span style="color:#658b00">shutdownGracefully&lt;/span>();
workerGroup.&lt;span style="color:#658b00">shutdownGracefully&lt;/span>();
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://pinkhello.me/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/Netty%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E5%AE%A2%E6%88%B7%E7%AB%AFTCP%E9%93%BE%E6%8E%A5%E4%B8%8A%E7%9A%84%E8%AF%B7%E6%B1%82.jpg" alt="Nettyå¦‚ä½•å¤„ç†å®¢æˆ·ç«¯TCPé“¾æ¥ä¸Šçš„è¯·æ±‚">&lt;/p>
&lt;p>&lt;img src="https://pinkhello.me/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/NettyReactor%E5%B7%A5%E4%BD%9C%E6%A1%86%E6%9E%B6%E5%9B%BE.jpg" alt="NettyReactorå·¥ä½œæ¡†æ¶å›¾">&lt;/p>
&lt;ul>
&lt;li>&lt;code>BossGroup&lt;/code> -&amp;gt; å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚&lt;/li>
&lt;li>&lt;code>EventGroup&lt;/code> â€”&amp;gt; å¤„ç†IO &lt;code>Read/Write&lt;/code> æ“ä½œã€æ‰§è¡Œä»»åŠ¡ç³»ç»ŸTaskã€å®šæ—¶ä»»åŠ¡&lt;/li>
&lt;li>&lt;code>ChildChannelHandler&lt;/code> æ–¹å¼æ˜¯å¯¹ &lt;code>ChannelPipeline&lt;/code> çš„è®¾ç½®ã€&lt;/li>
&lt;li>&lt;code>ChannelPipeline&lt;/code> æ˜¯ç›¸å½“äºä»»åŠ¡é“¾çš„æ¨¡å¼, æ˜¯ä¸€ä¸² &lt;code>ChannelHandler&lt;/code> çš„å®ä¾‹&lt;/li>
&lt;li>&lt;code>ChannelHandlerContext&lt;/code> æ˜¯ &lt;code>ChannelPipeline&lt;/code> å’Œ &lt;code>ChannelHandler&lt;/code> çš„å…³ç³»&lt;/li>
&lt;li>æ¯ä¸ªé“¾æ¥å¯¹äº &lt;code>Sever&lt;/code> ç«¯éƒ½ä¼šåˆ›å»ºä¸€ä¸ª &lt;code>Channel&lt;/code> ï¼Œå¯ä»¥å°† &lt;code>Channel&lt;/code> ç†è§£ä¸º &lt;code>Connection&lt;/code> ï¼ˆå…¶å®çœŸæ­£çš„æ˜¯ &lt;code>Connection&lt;/code> å±äº &lt;code>Channel&lt;/code> çš„ä¸€éƒ¨åˆ†ï¼‰&lt;/li>
&lt;li>æ¯ä¸ª &lt;code>Channel&lt;/code> éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„å”¯ä¸€çš„ &lt;code>ChannelPipeline&lt;/code> æ“ä½œï¼Œå¯¹äºå…¶ä»–çš„ &lt;code>Channel&lt;/code> çš„ &lt;code>ChannelPipeline&lt;/code> æ˜¯éš”ç¦»çš„&lt;/li>
&lt;li>&lt;code>RPC Handler&lt;/code> æ˜¯æˆ‘ä»¬å¯¹äºè‡ªå·±çš„æ‰¾å¯» &lt;code>RPC&lt;/code> æœåŠ¡å¤„ç†çš„ &lt;code>Handler&lt;/code> å®ç°&lt;/li>
&lt;li>&lt;code>RPC Encoder&lt;/code> æ˜¯æˆ‘ä»¬å¯¹äºè‡ªå·±çš„æ‰¾å¯» &lt;code>RPC&lt;/code> åºåˆ—åŒ–çš„ç¼–ç çš„ &lt;code>Handler&lt;/code> å®ç°&lt;/li>
&lt;li>&lt;code>RPC Decoder&lt;/code> æ˜¯æˆ‘ä»¬å¯¹äºè‡ªå·±çš„æ‰¾å¯» &lt;code>RPC&lt;/code> åºåˆ—åŒ–çš„è§£ç çš„ &lt;code>Handler&lt;/code> å®ç°&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">å®¢æˆ·ç«¯
EventLoopGroup group = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> NioEventLoopGroup();
&lt;span style="color:#8b008b;font-weight:bold">try&lt;/span> {
Bootstrap b = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> Bootstrap();
b.&lt;span style="color:#658b00">group&lt;/span>(group)
.&lt;span style="color:#658b00">channel&lt;/span>(NioSocketChannel.&lt;span style="color:#658b00">class&lt;/span>)
.&lt;span style="color:#658b00">option&lt;/span>(ChannelOption.&lt;span style="color:#658b00">TCP_NODELAY&lt;/span>, &lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>)
.&lt;span style="color:#658b00">handler&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> ChannelInitializer&amp;lt;SocketChannel&amp;gt;() {
&lt;span style="color:#707a7c">@Override&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">initChannel&lt;/span>(SocketChannel ch) &lt;span style="color:#8b008b;font-weight:bold">throws&lt;/span> Exception {
ChannelPipeline p = ch.&lt;span style="color:#658b00">pipeline&lt;/span>();
p.&lt;span style="color:#658b00">addLast&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> RpcEncoder(RpcResponse.&lt;span style="color:#658b00">class&lt;/span>));
p.&lt;span style="color:#658b00">addLast&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> RpcDecoder(RpcRequest.&lt;span style="color:#658b00">class&lt;/span>));
p.&lt;span style="color:#658b00">addLast&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> RpcClientHandler());
}});
&lt;span style="color:#228b22">// Start the client.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> ChannelFuture f = b.&lt;span style="color:#658b00">connect&lt;/span>(HOST, PORT).&lt;span style="color:#658b00">sync&lt;/span>();
&lt;span style="color:#228b22">// Wait until the connection is closed.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> f.&lt;span style="color:#658b00">channel&lt;/span>().&lt;span style="color:#658b00">closeFuture&lt;/span>().&lt;span style="color:#658b00">sync&lt;/span>();
} &lt;span style="color:#8b008b;font-weight:bold">finally&lt;/span> {
&lt;span style="color:#228b22">// Shut down the event loop to terminate all threads.
&lt;/span>&lt;span style="color:#228b22">&lt;/span> group.&lt;span style="color:#658b00">shutdownGracefully&lt;/span>();
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>7ã€&lt;code>RPC&lt;/code> åºåˆ—åŒ–&lt;/p>
&lt;ul>
&lt;li>äºŒè¿›åˆ¶æ•°æ®&lt;/li>
&lt;li>Hessian&lt;/li>
&lt;li>Avro&lt;/li>
&lt;li>ProtoBuffer (Protobuf)&lt;/li>
&lt;li>JSON&lt;/li>
&lt;li>XML&lt;/li>
&lt;/ul>
&lt;p>8ã€å…³äº &lt;code>RPC&lt;/code> çš„å®ç°æ€è€ƒä¸æŠ€æœ¯è®¨è®º&lt;/p>
&lt;ul>
&lt;li>ä¸šåŠ¡æ–¹æ³•ã€å› ä¸ºæ˜¯æ”¶åˆ°è¯·æ±‚æ¶ˆæ¯è€Œè§¦å‘çš„åç»­åŠ¨ä½œè°ƒç”¨ï¼Œä¸åšé¢å¤–è®¾ç½®ï¼Œè‚¯å®šæ˜¯ä½¿ç”¨çš„ &lt;code>WorkGroup&lt;/code> é‡Œé¢çš„çº¿ç¨‹æ“ä½œçš„ã€‚
è€Œä½œä¸ºä¸šåŠ¡å±‚ï¼Œä¸åº”è¯¥ä¸åº•å±‚å…³è”ï¼Œåº”è¯¥åˆ‡å‰²å¼€æ¥ï¼ŒåŠ¿å¿…ä¼šå¼•å…¥çœŸçš„ä¸šåŠ¡ä¾§çº¿ç¨‹æ± ã€‚
é‚£ä¹ˆå¦‚ä½•å¼•ç”¨ã€æ€ä¹ˆå¼•ç”¨ï¼Ÿ(å…³äº ä¸šåŠ¡çº¿ç¨‹æ±  ä¸ &lt;code>WorkGroup&lt;/code> çš„ &lt;code>EvenLoop&lt;/code> çš„æ€è€ƒ )&lt;/li>
&lt;li>å…³äº &lt;code>RPC&lt;/code> è°ƒç”¨å¤§éƒ¨åˆ†æ˜¯åŒæ­¥çš„è°ƒç”¨ï¼Œè€Œ &lt;code>Netty&lt;/code> åº•å±‚æ˜¯å®Œå…¨å¼‚æ­¥äº‹ä»¶æœºåˆ¶ï¼Œåœ¨RPCæ¡†æ¶å±‚é¢å¦‚ä½•å®ç°åŒæ­¥çš„è°ƒç”¨æ–¹å¼çš„ï¼Ÿ&lt;/li>
&lt;li>åŸºäº &lt;code>TCP&lt;/code> çš„é•¿é“¾æ¥è°ƒç”¨ï¼Œåœ¨ &lt;code>RPC&lt;/code> ä¸Šä½ ä¼šæƒ³åˆ°å…¶ä»–çš„å“ªäº›ä¸œä¸œï¼Ÿ&lt;/li>
&lt;li>åœ¨æ­¤ç¯å¢ƒä¸‹ï¼Œæˆ‘æ²¡æœ‰ä»‹ç» &lt;code>RPC&lt;/code> æœåŠ¡äº IOCå®¹å™¨çš„ç»“åˆï¼Œå¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Œå¦‚ä½•åšåˆ° æ³¨è§£æœºåˆ¶ã€&lt;code>JAVA CONFIG&lt;/code> æœºåˆ¶ã€&lt;code>XML SCHEMA&lt;/code> æœºåˆ¶æ¥åš?
&lt;ul>
&lt;li>GUICE&lt;/li>
&lt;li>SPRING&lt;/li>
&lt;li>SPI&lt;/li>
&lt;li>&amp;hellip;.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
- https://pinkhello.me/posts/04-%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84rpc%E8%B0%83%E7%94%A8/ - PinkHello, All Rights Reserved</description></item><item><title>é“¾æ¥</title><link>https://pinkhello.me/links/</link><pubDate>Tue, 09 Feb 2021 10:38:21 +0800</pubDate><guid>https://pinkhello.me/links/</guid><description>PinkHello https://pinkhello.me/links/ -- https://pinkhello.me/links/ - PinkHello, All Rights Reserved</description></item><item><title>å…³äºæˆ‘</title><link>https://pinkhello.me/about/</link><pubDate>Tue, 09 Feb 2021 10:36:43 +0800</pubDate><guid>https://pinkhello.me/about/</guid><description>PinkHello https://pinkhello.me/about/ -&lt;hr>
&lt;h2 id="-ä¸ªäººä»‹ç»">ğŸ‘· ä¸ªäººä»‹ç»&lt;/h2>
&lt;p>PinkHello &lt;img src="https://views.whatilearened.today/views/github/pinkhello/pinkhello.svg" alt="views">&lt;/p>
&lt;p>&lt;img src="https://github-readme-stats.vercel.app/api?username=pinkhello&amp;amp;show_icons=true&amp;amp;theme=vue&amp;amp;hide_border=true&amp;amp;line_height=20&amp;amp;count_private=true" alt="">&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">PinkHello := &amp;amp;Info {
Name: &lt;span style="color:#cd5555">&amp;#34;PinkHello&amp;#34;&lt;/span>,
Occupation: &lt;span style="color:#cd5555">&amp;#34;Full Stack Developer&amp;#34;&lt;/span>,
Email: &lt;span style="color:#cd5555">&amp;#34;lee123lee123@163.com&amp;#34;&lt;/span>,
Wechat: &lt;span style="color:#cd5555">&amp;#34;chess_1&amp;#34;&lt;/span>,
Website: &lt;span style="color:#cd5555">&amp;#34;https://pinkhello.me&amp;#34;&lt;/span>,
Location: &lt;span style="color:#cd5555">&amp;#34;Shanghai China&amp;#34;&lt;/span>
}
&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h2 id="-æŠ€èƒ½">âš¡ æŠ€èƒ½&lt;/h2>
&lt;p>Language&lt;br>
&lt;img src="https://img.shields.io/badge/-Java-black?style=flat-square&amp;amp;logo=Java" alt="Java">
&lt;img src="https://img.shields.io/badge/-Go-black?style=flat-square&amp;amp;logo=Go" alt="Go">
&lt;img src="https://img.shields.io/badge/-Python-black?style=flat-square&amp;amp;logo=Python" alt="Python">
&lt;img src="https://img.shields.io/badge/-JavaScript-black?style=flat-square&amp;amp;logo=JavaScript" alt="JavaScript">&lt;/p>
&lt;p>Framework&lt;br>
&lt;img src="https://img.shields.io/badge/-Vue-000000?style=flat-square&amp;amp;logo=Vue.js" alt="Vue">
&lt;img src="https://img.shields.io/badge/-Spring-black?style=flat-square&amp;amp;logo=Spring" alt="Spring">
&lt;img src="https://img.shields.io/badge/-Spring%20Boot(Cloud)-black?style=flat-square&amp;amp;logo=Spring%20Boot(Cloud)" alt="Spring Boot(Cloud)">
&lt;img src="https://img.shields.io/badge/-Dubbo-black?style=flat-square&amp;amp;logo=Dubbo" alt="Dubbo">
&lt;img src="https://img.shields.io/badge/-Flask-black?style=flat-square&amp;amp;logo=Flask" alt="Flask">
&lt;img src="https://img.shields.io/badge/-Echo-black?style=flat-square&amp;amp;logo=Echo" alt="Echo">
&lt;img src="https://img.shields.io/badge/-Gin-black?style=flat-square&amp;amp;logo=Gin" alt="Gin">
&lt;img src="https://img.shields.io/badge/-Grpc-black?style=flat-square&amp;amp;logo=Grpc" alt="Grpc">&lt;/p>
&lt;p>Tools&lt;br>
&lt;img src="https://img.shields.io/badge/-Redis-black?style=flat-square&amp;amp;logo=Redis" alt="Redis">
&lt;img src="https://img.shields.io/badge/-MySQL-black?style=flat-square&amp;amp;logo=mysql" alt="MySQL">
&lt;img src="https://img.shields.io/badge/-Nginx-black?style=flat-square&amp;amp;logo=Nginx" alt="Nginx">
&lt;img src="https://img.shields.io/badge/-MongoDB-black?style=flat-square&amp;amp;logo=MongoDB" alt="MongoDB">
&lt;img src="https://img.shields.io/badge/-Pulsar-black?style=flat-square&amp;amp;logo=Pulsar" alt="Pulsar">
&lt;img src="https://img.shields.io/badge/-Kafka-black?style=flat-square&amp;amp;logo=Kafka" alt="Kafka">
&lt;img src="https://img.shields.io/badge/-Nsq-black?style=flat-square&amp;amp;logo=Nsq" alt="Nsq">
&lt;img src="https://img.shields.io/badge/-RabbitMQ-black?style=flat-square&amp;amp;logo=RabbitMQ" alt="RabbitMQ">
&lt;img src="https://img.shields.io/badge/-GitHub-181717?style=flat-square&amp;amp;logo=github" alt="GitHub">&lt;/p>
&lt;p>Others&lt;br>
&lt;img src="https://img.shields.io/badge/-Kubernetes-black?style=flat-square&amp;amp;logo=Kubernetes" alt="Kubernetes">
&lt;img src="https://img.shields.io/badge/-Docker-black?style=flat-square&amp;amp;logo=Docker" alt="Docker">
&lt;img src="https://img.shields.io/badge/-Linux-black?style=flat-square&amp;amp;logo=Linux" alt="Linux">
&lt;img src="https://img.shields.io/badge/-Deepin-007CFF?style=flat-square&amp;amp;logo=deepin" alt="Deepin">
&lt;img src="https://img.shields.io/badge/-Centos-262577?style=flat-square&amp;amp;logo=Centos" alt="Centos">
&lt;img src="https://img.shields.io/badge/-Raspberry%20Pi-C51A4A?style=flat-square&amp;amp;logo=Raspberry-Pi" alt="Raspberry Pi">&lt;/p>
&lt;hr>
&lt;h2 id="-ä¸ªäººå¼€æºé¡¹ç›®">ğŸ³ ä¸ªäººå¼€æºé¡¹ç›®&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">é¡¹ç›®&lt;/th>
&lt;th style="text-align:left">æè¿°&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">&lt;a href="https://github.com/PinkHello/GoPush">GoPush&lt;/a>&lt;/td>
&lt;td style="text-align:left">ä¸€ä¸ªå®æ—¶æ¨é€ç»„ä»¶&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;a href="https://github.com/PinkHello/spring-boot-starter-dubbo">spring-boot-starter-dubbo&lt;/a>&lt;/td>
&lt;td style="text-align:left">dubbo-spring-boot-è„šæ‰‹æ¶&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;a href="https://github.com/PinkHello/go-starter">go-starter&lt;/a>&lt;/td>
&lt;td style="text-align:left">GoæœåŠ¡å¼€å‘è„šæ‰‹æ¶&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;hr>
&lt;h2 id="-2021-okr-è¿›åº¦">ğŸš€ 2021 OKR è¿›åº¦&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">åŠ¨ä½œ&lt;/th>
&lt;th style="text-align:left">è¿›åº¦&lt;/th>
&lt;th style="text-align:left">ç›®æ ‡&lt;/th>
&lt;th style="text-align:left">ç¼ºé™·&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">ğŸ‘¯ GoæœåŠ¡å¼€å‘è„šæ‰‹æ¶&lt;/td>
&lt;td style="text-align:left">done&lt;/td>
&lt;td style="text-align:left">&lt;a href="https://github.com/PinkHello/go-starter">go-starter&lt;/a>&lt;/td>
&lt;td style="text-align:left">ut&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">ğŸ’µ GoæœåŠ¡å¼€å‘è„šæ‰‹æ¶å¼€å‘ä¸€ä¸ªç®€å•å‰åç«¯ç³»ç»Ÿ&lt;/td>
&lt;td style="text-align:left">done&lt;/td>
&lt;td style="text-align:left">&lt;a href="http://121.4.242.26">æˆ¿äº§CRMä¿¡æ¯ç³»ç»Ÿ&lt;/a> test/123456&lt;/td>
&lt;td style="text-align:left">-&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">ğŸ³ K8SåŸç†&lt;/td>
&lt;td style="text-align:left">running&lt;/td>
&lt;td style="text-align:left">&lt;a href="https://pinkhello.me/categories/k8s/">K8Såšå®¢æˆæ¡£&lt;/a>&lt;/td>
&lt;td style="text-align:left">-&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">ğŸš€ RocketMQ æºä»£ç é˜…è¯»(Java)&lt;/td>
&lt;td style="text-align:left">running&lt;/td>
&lt;td style="text-align:left">&lt;a href="https://pinkhello.me/categories/rocketmq/">RocketMQåšå®¢æˆæ¡£&lt;/a>&lt;/td>
&lt;td style="text-align:left">-&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">ğŸš€ RocketMQ å®¢æˆ·ç«¯ä»£ç é˜…è¯»(Compare Go/Java)&lt;/td>
&lt;td style="text-align:left">running&lt;/td>
&lt;td style="text-align:left">&lt;a href="https://pinkhello.me/categories/rocketmq/">RocketMQåšå®¢æˆæ¡£&lt;/a>&lt;/td>
&lt;td style="text-align:left">-&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">ğŸ˜„ MySQLå®ç°åŸç†è§£æ&lt;/td>
&lt;td style="text-align:left">prepare&lt;/td>
&lt;td style="text-align:left">åšå®¢æˆæ¡£&lt;/td>
&lt;td style="text-align:left">-&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">ğŸ« æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾&lt;/td>
&lt;td style="text-align:left">prepare&lt;/td>
&lt;td style="text-align:left">åšå®¢æˆæ¡£&lt;/td>
&lt;td style="text-align:left">-&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
- https://pinkhello.me/about/ - PinkHello, All Rights Reserved</description></item><item><title>14 å·¥ä½œçºªå®2020</title><link>https://pinkhello.me/posts/14-%E5%B7%A5%E4%BD%9C%E7%BA%AA%E5%AE%9E2020/</link><pubDate>Mon, 10 Feb 2020 10:00:19 +0800</pubDate><guid>https://pinkhello.me/posts/14-%E5%B7%A5%E4%BD%9C%E7%BA%AA%E5%AE%9E2020/</guid><description>PinkHello https://pinkhello.me/posts/14-%E5%B7%A5%E4%BD%9C%E7%BA%AA%E5%AE%9E2020/ -&lt;h1 id="æ¯æ—¥ä¸€æ€ç¯‡">æ¯æ—¥ä¸€æ€ç¯‡&lt;/h1>
&lt;h2 id="2019-10-12-æ¯æ—¥ä¸€æ€-mysql-walæŠ€æœ¯-å’Œ-ringbuffer-æ€æƒ³å¥½ä¸€è‡´">[2019-10-12 æ¯æ—¥ä¸€æ€] Mysql WALæŠ€æœ¯ å’Œ RingBuffer æ€æƒ³å¥½ä¸€è‡´?&lt;/h2>
&lt;h2 id="2019-10-14-æ¯æ—¥ä¸€æ€-jwt-ç»­ç­¾è¯¥å¦‚ä½•åš">[2019-10-14 æ¯æ—¥ä¸€æ€] JWT ç»­ç­¾è¯¥å¦‚ä½•åš?&lt;/h2>
&lt;h2 id="2019-10-16-æ¯æ—¥ä¸€æ€-tcpip-åè®®å…·ä½“æŒ‡å“ªäº›">[2019-10-16 æ¯æ—¥ä¸€æ€] TCP/IP åè®®å…·ä½“æŒ‡å“ªäº›?&lt;/h2>
&lt;blockquote>
&lt;p>æˆ‘ä»¬éƒ½çŸ¥é“ç½‘ç»œæ˜¯7å±‚æ¨¡å‹ï¼Œåº”è¡¨ä¼šä¼ ç½‘æ•°ç‰©ï¼Œ
ç°åœ¨æˆ‘åªè®¨è®ºåº”ä¼ ç½‘æ•°è¿™4å±‚ã€‚TCP/IPåè®®åº”è¯¥è¢«ç§°ä¸ºTCP/IPæ—ï¼Œ
æˆ‘çš„ç†è§£ä»–ä¸æ˜¯å±äºå•ä¸ªçš„åè®®ç±»å‹ï¼Œæ˜¯ä¸€ä¸ªç»Ÿç§°ï¼ŒçŸ¥é“ç½‘ç»œæ¨¡å‹æ ¸å¿ƒè®¾è®¡æ€æƒ³æ˜¯åˆ†å±‚ï¼Œä¸ºä»€ä¹ˆåˆ†å±‚ï¼Œåˆ†å±‚ä»è®¾è®¡ä¸Šå’Œå®ç°éš¾åº¦ä¸Šéƒ½ç®€å•å¾ˆå¤šï¼Œå“ªä¸€å±‚éœ€è¦ä¿®æ”¹åªéœ€è¦ä¿®æ”¹è¿™ä¸€å±‚ã€‚&lt;/p>
&lt;ul>
&lt;li>åº”ç”¨å±‚ï¼Œåƒæœ€å¸¸è§çš„httpã€ftpã€dnsã€rtspã€rtmpç­‰ç­‰åè®®éƒ½æ˜¯å±äºè¿™ç±»ï¼Œ&lt;/li>
&lt;li>ä¼ è¾“å±‚å‘¢æŒ‰ç…§ä¼ è¾“ç±»å‹åˆåˆ†äº†TCPå’ŒUDP,&lt;/li>
&lt;li>ç½‘ç»œå±‚ï¼Œæ˜¯æ•°æ®åŒ…äº¤äº’çš„å±‚é¢ï¼Œ&lt;/li>
&lt;li>æ•°æ®é“¾è·¯å±‚æ˜¯å¤„ç†ç½‘å¡ã€æ“ä½œç³»ç»Ÿç­‰ç­‰è½¯ç¡¬æŠ½è±¡å‡ºçš„å¯è§éƒ¨åˆ†ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä¸¾ä¸€ä¸ªæ —å­ï¼Œä¸€ä¸ªhttpè¯·æ±‚ï¼Œåœ¨åº”ç”¨å±‚é¢æ˜¯å®Œæ•´çš„ï¼Œåé¢è¢«ä¼ è¾“å±‚ï¼ˆTCPå±‚ï¼‰è¢«åˆ†åŒ…ï¼Œå¹¶æ‰“ä¸Šåºå·æ ‡è®°ï¼Œå†è¿›å…¥ç½‘ç»œå±‚ï¼ˆIPå±‚ï¼‰æ·»åŠ IPé¦–éƒ¨ï¼ˆç›®æ ‡macåœ°å€ç­‰ç­‰ï¼‰ï¼Œ
ä¸‹é¢å°±æ˜¯å¼€å§‹ç–¯ç‹‚çš„å‘é€äº†ï¼Œæ¥æ”¶æ–¹ä¸€æ ·æ˜¯è¿™ä¸ªè¿‡ç¨‹çš„é€†åºã€‚åº”ç”¨å¤„ç†å®Œæˆåé¢çš„å“åº”è¿‡ç¨‹ä¸è¯·æ±‚è¿‡ç¨‹ä¸€æ ·çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚åŒæ—¶å¯ä»¥æ‰©å±•å‡ºL4ä¸L7çš„é—®é¢˜ï¼Œ
å„è‡ªæ˜¯å¦‚ä½•å»å®ç°è´Ÿè½½å‡è¡¡çš„ï¼ŸL4æ˜¯å¯ä»¥çœ‹å‡ºæ˜¯åŸºäºä¼ è¾“å±‚å³TCPå±‚å·¥ä½œï¼ˆé€šè¿‡å‘å¸ƒVIPï¼ˆç¬¬ä¸‰å±‚ï¼‰ä»¥åŠç¬¬å››å±‚ç«¯å£ï¼‰ï¼ŒL7åŸºäºåº”ç”¨å±‚å·¥ä½œï¼ˆç¬¬å››å±‚åŸºç¡€ä¸Š+è€ƒè™‘åº”ç”¨ç‰¹å¾ï¼‰ï¼Œ
æ¯”å¦‚HTTPçš„URLã€å®¢æˆ·ç«¯çš„ç±»åˆ«ã€è¯­è¨€ç±»å‹ç­‰ç­‰ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="2019-10-18-æ¯æ—¥ä¸€æ€ä¸€ç§åœºæ™¯rabbitmq-çš„-exchange-ä¸º-fanout-ç±»å‹ç»‘å®šåˆ°å¤šä¸ªqueue-ä»€ä¹ˆæƒ…å†µä¼šè§¦å‘-rabbitmq-æµæ§å¦‚ä½•è§£å†³">[2019-10-18 æ¯æ—¥ä¸€æ€]ä¸€ç§åœºæ™¯ï¼Œrabbitmq çš„ Exchange ä¸º fanout ç±»å‹ï¼Œç»‘å®šåˆ°å¤šä¸ªqueue, ä»€ä¹ˆæƒ…å†µä¼šè§¦å‘ rabbitmq æµæ§ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ&lt;/h2>
&lt;h2 id="2019-10-22-æ¯æ—¥ä¸€æ€idåºåˆ—ç”Ÿäº§å™¨æ€ä¹ˆå®ç°å‘¢">[2019-10-22 æ¯æ—¥ä¸€æ€]IDåºåˆ—ç”Ÿäº§å™¨æ€ä¹ˆå®ç°å‘¢ï¼Ÿ&lt;/h2>
&lt;blockquote>
&lt;p>uuidç”Ÿæˆ&lt;/p>
&lt;ul>
&lt;li>åŸºäºæ—¶é—´ï¼ˆ60ä½utcæ—¶é—´ å’Œ æ—¶é—´åºåˆ—å€¼14ä½ï¼Œä»¥åŠmacåœ°å€ï¼‰&lt;/li>
&lt;li>åŸºäºåç§°ï¼ˆé’ˆå¯¹å‘½åç©ºé—´dnsã€urlç­‰åˆ†é…ï¼ŒæŠŠåç§°è½¬æˆå­—èŠ‚åºåˆ—ï¼Œå†ç”¨md5æˆ–sha-1ä¸å‘½åç©ºé—´æ ‡è¯†è¿›è¡Œè®¡ç®—ï¼Œäº§ç”Ÿå“ˆå¸Œç»“æœï¼‰&lt;/li>
&lt;li>åŸºäºéšæœºæ•°ï¼ˆå¯†ç å­¦éšæœºæ•°ï¼Œç³»ç»Ÿçš„ç¡¬ç›˜å†…å­˜çº¿ç¨‹å †æ ˆè¿›ç¨‹å¥æŸ„ç­‰sha-1ç”Ÿæˆå“ˆå¸Œç»“æœï¼‰&lt;/li>
&lt;/ul>
&lt;p>snowflakeï¼Œ64bitï¼Œlongå‹ID&lt;/p>
&lt;ul>
&lt;li>IDç”Ÿæˆæ–¹å¼ 1bitï¼ˆä¸ä½¿ç”¨ï¼‰ï¼Œ41bitæ—¶é—´æˆ³ï¼ˆå½“å‰æ¯«ç§’æ•°ã€69å¹´ä¸€è½®å›ï¼‰ï¼Œ10bitæœºå™¨ç ï¼ˆ1024å°ï¼Œ5bitæ•°æ®ä¸­å¿ƒï¼Œ5bitæœºå™¨IDï¼‰ï¼Œ12bitä½œä¸ºæ¯«ç§’å†…åºåˆ—å·ï¼ˆå•æœºç†è®º 409.6w/sï¼‰&lt;/li>
&lt;li>é›ªèŠ±ç®—æ³•ï¼Œå¤šå°æœºå™¨ï¼Œæœ‰å› ä¸ºæ—¶é’Ÿå›æ‹¨å¯¼è‡´çš„IDç”Ÿæˆé—®é¢˜ï¼Œå½“ç„¶å¯ä»¥é€šè¿‡å‘ç”Ÿæ—¶é’Ÿå›æ‹¨åä¸€ä¸ªé˜ˆå€¼ï¼Œåœ¨é˜ˆå€¼å†…åˆ™ä¸å…è®¸äº§ç”Ÿæ–°çš„IDï¼ŒåŒæ­¥é˜»å¡ï¼Œåœ¨é˜ˆå€¼å¤–é‡æ–°è®¾ç½®æœºå™¨IDæ¥è§£å†³&lt;/li>
&lt;li>github.com/baidu/uid-generator æŠ€æœ¯è€é“ç™¾åº¦å¼€æºçš„åŸºäºsnowflakeå®ç°çš„IDç”Ÿæˆå™¨ï¼Œå¯ä»¥å€Ÿé‰´ç ”è¯»ä¸€ä¸‹&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h2 id="2019-11-01-æ¯æ—¥ä¸€æ€æˆ‘ä»¬å¸¸è¯´çš„é™æµæ˜¯ä»€ä¹ˆä¸ºä»€ä¹ˆè¦é™æµé™æµæœ‰å“ªäº›æ–¹å¼">[2019-11-01 æ¯æ—¥ä¸€æ€]æˆ‘ä»¬å¸¸è¯´çš„é™æµæ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦é™æµï¼Ÿé™æµæœ‰å“ªäº›æ–¹å¼ï¼Ÿ&lt;/h2>
&lt;blockquote>
&lt;p>æˆ‘ä»¬å¸¸è¯´çš„é™æµï¼Œé¡¾åæ€ä¹‰å³é™åˆ¶æµé‡. é™åˆ¶ç³»ç»Ÿçš„è¾“å…¥å’Œè¾“å‡º
å¸¸ç”¨çš„é™æµå‘å±•è‡³ä»Šï¼Œæœ‰å››ç§æ–¹å¼&lt;/p>
&lt;ul>
&lt;li>å›ºå®šæ—¶é—´è®¡æ•°å™¨&lt;/li>
&lt;li>æ¼æ¡¶&lt;/li>
&lt;li>ä»¤ç‰Œæ¡¶&lt;/li>
&lt;li>æ»‘åŠ¨çª—å£è®¡æ•°å™¨&lt;/li>
&lt;/ul>
&lt;p>å›ºå®šçª—å£è®¡æ•°å™¨ï¼šä»¥å•ä½æ—¶é—´å†…è¿›å…¥ç³»ç»Ÿï¼ˆç³»ç»Ÿçº§åˆ«ï¼‰æˆ–è€…æŸä¸€ä¸ªå•ä¸€æ¥å£æœåŠ¡ï¼ˆç³»ç»ŸæœåŠ¡çº§åˆ«ï¼‰è¯·æ±‚æ¬¡æ•°ï¼Œåœ¨è¿™ä¸ªå•ä½æ—¶é—´å†…çš„è¶…è¿‡æ¬¡æ•°ï¼Œæ‹’ç»æœåŠ¡æˆ–è€…æ›´æ¢å…¶ä»–æ–¹æ¡ˆï¼ˆé™çº§ã€ç†”æ–­ï¼‰è¾¾åˆ°é™æµç›®çš„ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å¯ä»¥çœ‹å‡ºï¼Œæ˜æ˜¾çš„ç¼ºç‚¹ï¼Œä»æ•´ä½“æ›²çº¿ä¸Šï¼Œæ¯›åˆºç°è±¡éå¸¸ä¸¥é‡ï¼Œå‡è®¾å•ä½æ—¶é—´ 1s å†…é™åˆ¶ 100 æ¬¡ï¼Œåœ¨0-10mså†…æˆ‘å·²ç»è¯·æ±‚è¶…è¿‡100æ¬¡äº†ï¼Œåé¢çš„è¯·æ±‚å…¨éƒ¨æ‹’ç»æˆ–è€…åšå…¶ä»–å¤„ç†äº†ã€‚æ— æ³•æ§åˆ¶å•ä½æ—¶é—´å†…çš„çªå‘æµé‡ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>æ¼æ¡¶: æ¡¶çš„å®¹é‡å›ºå®šï¼Œæ¡¶æµå‡ºçš„é€Ÿç‡æ’å®šã€‚æ¡¶æ»¡åˆ™é™æµã€‚ä¹Ÿæ˜¯æ— æ³•åº”å¯¹çªå‘æµé‡&lt;/p>
&lt;p>ä»¤ç‰Œæ¡¶ï¼š è¿˜æ˜¯æ¡¶çš„æ–¹å¼ï¼Œ æ¡¶ä¸­å­˜æ”¾çš„æ˜¯ token ï¼Œæ ¹æ®é™æµçš„å¤§å°ï¼Œ token ä»¥æ’å®šé€Ÿç‡è¿›å…¥æ¡¶ä¸­ï¼Œè®¾ç½®æ¡¶çš„æœ€å¤§çš„ token å®¹é‡ï¼Œå½“æ¡¶æ»¡æ—¶å€™æ‹’ç»æ–°æ·»åŠ çš„token
ï¼Œæˆ–è€…ç›´æ¥ä¸¢å¼ƒã€‚æ‰€æœ‰è¯·æ±‚è¿›å…¥å…ˆè·å–ä»¤ç‰Œï¼Œå¾—åˆ°ä»¤ç‰Œç»§ç»­ä¸‹é¢çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¤„ç†å®Œæˆåˆ é™¤ tokenã€‚&lt;/p>
&lt;blockquote>
&lt;p>ç›¸æ¯” æ¼æ¡¶ï¼Œ ä¸€å®šç¨‹åº¦ä¸Šå…è®¸çªå‘æµé‡ï¼Œå¹³æ»‘é™æµï¼Œå› ä¸º æ¡¶ ä¸­çš„ token æ˜¯åŒ€é€Ÿæ”¾å…¥çš„ï¼ŒæŠµå¾¡çªå‘æµé‡ã€‚æ¡¶çš„ token æ•°é‡ä¸ä¼šè¶…è¿‡ç»™å®šçš„æœ€å¤§å€¼ã€‚
å‚è€ƒ guava rate limiter&lt;/p>
&lt;/blockquote>
&lt;p>æ»‘åŠ¨çª—å£è®¡æ•°å™¨:(å‚è€ƒSentinelä¸­ä½¿ç”¨çš„é»˜è®¤é™æµæ–¹å¼)
æ˜¯å¯¹å›ºå®šæ—¶é—´çª—å£è®¡æ•°å™¨çš„ä¼˜åŒ–ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³å›ºå®šæ—¶é—´è®¡æ•°å™¨çš„æ— æ³•é¢å¯¹çªå‘æµé‡ï¼Œä½•ä¸ºæ»‘åŠ¨çª—å£å‘¢ï¼Ÿ
å‡è®¾å•ä½æ—¶é—´å®šä½ 1sï¼Œ è®¡æ•°å™¨é™åˆ¶åœ¨ 1000 æ¬¡ï¼Œ å†å°†è€… 1s åˆ’åˆ†ä¸º 100ms ä¸ºä¸€ä¸ªå°æ ¼å­ï¼Œæ€»å…± 10 ä¸ªæ ¼å­ï¼Œ
æ¯ä¸ªæ ¼å­è¿˜æœ‰è®¡æ•°å™¨ï¼Œå½“ä¸€ä¸ªè¯·æ±‚è¿›æ¥ï¼Œåœ¨å¯¹åº”çš„æ—¶é—´æ ¼å­é‡Œé¢çš„è®¡æ•°å™¨ +1 ï¼Œåªè¦æ€»çš„è¿™ä¸ªå•ä½æ—¶é—´å†…æ‰€æœ‰çš„æ—¶é—´æ ¼å­è®¡æ•°å™¨æ€»å’Œå°äº é™åˆ¶æ¬¡æ•°ï¼Œå°±ä¸ä¼šå¯åŠ¨é™æµä½œç”¨ã€‚
å¯ä»¥çœ‹å‡ºæ¥ï¼Œå‡å¦‚æˆ‘çš„åˆ’åˆ†çš„æ ¼å­å¾ˆå°ï¼Œæ»‘åŠ¨çª—å£æ»šåŠ¨å°†æ˜¯è¶Šå¹³æ»‘çš„ã€‚
psï¼š 0.00 - 1.00 æœ‰ 10 ä¸ªæ ¼å­ï¼Œè¿™æ˜¯ä¸€ä¸ªæ»‘åŠ¨çª—å£æœŸï¼Œç„¶å 0.10-1.10æ˜¯ä¸€ä¸ªçª—å£æœŸï¼Œè¿™æ ·è®¡ç®—çš„&lt;/p>
&lt;/blockquote>
&lt;h2 id="2019-11-04-æ¯æ—¥ä¸€æ€-å‡å¦‚mqæ¶ˆæ¯é˜Ÿåˆ—äº§ç”Ÿäº†å †ç§¯å¦‚ä½•æ›´å¿«çš„æ¶ˆè´¹">[2019-11-04 æ¯æ—¥ä¸€æ€] å‡å¦‚MQæ¶ˆæ¯é˜Ÿåˆ—äº§ç”Ÿäº†å †ç§¯ï¼Œå¦‚ä½•æ›´å¿«çš„æ¶ˆè´¹ï¼Ÿ&lt;/h2>
&lt;blockquote>
&lt;p>ä¼šä»å¤šç§é˜Ÿåˆ—å»åˆ†æï¼Œrabbitmqï¼Œkafkaï¼Œrocketmqï¼Œpulsarç­‰å¤šä¸ªæ¶ˆæ¯ä¸­é—´ä»¶å»åˆ†æã€‚
RabbitMqå¾—çœ‹æ˜¯ä»€ä¹ˆæ¨¡å¼ï¼Œå¦‚æœæ˜¯ç”Ÿäº§æ¶ˆè´¹è€…æ¨¡å¼æ˜¯å¯ä»¥çš„ï¼Œå‘å¸ƒè®¢é˜…æ¨¡å¼å°±æ²¡åµç”¨ï¼ŒåŠ ä¸ªè®¢é˜…è€…è€Œå·²ã€‚kafkaçœ‹consumerçš„æ•°é‡å§ï¼Œå¦‚æœå·²ç»å¤§äºç­‰äºpartitionæ•°é‡äº†ï¼ŒåŠ consumerä¹Ÿæ²¡åµç”¨ã€‚pulsar
æ˜¯ä¹Ÿä¸€æ ·å•Šï¼Œæœ‰ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ï¼Œä¹Ÿæœ‰ç‹¬å å’Œå¤±è´¥æ›¿è¡¥æ¨¡å¼ã€‚&lt;/p>
&lt;p>å¯¹çš„ï¼Œå…ˆè¯´kafkaå’ŒRocketMQï¼Œä»–ä»¬éƒ½æ˜¯åŸºäºpartitionçš„å­˜å‚¨æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªsubjectåˆ†ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªpartitionï¼ŒServeræ”¶åˆ°æ¶ˆæ¯åˆ†å‘åˆ°æŸä¸ªpartitionä¸Šï¼Œè€Œconsumer
æ¶ˆè´¹æ—¶å€™æ˜¯ä¸partitionç›¸å¯¹åº”çš„ï¼Œå½“partitionä¸consumeræ•°é‡ç›¸ç­‰æ—¶ï¼Œæ˜¯ä¸€å¯¹ä¸€ï¼Œå½“å°äºæ—¶å€™ï¼Œä¼šæœ‰consumerç©ºé—²ï¼Œå¤§äºæ—¶å€™ï¼Œçœ‹æ•°é‡ï¼Œæœ‰consumer
ä¼šè´Ÿè´£å¤šä¸ªï¼Œæ¯”è¾ƒç¹å¿™ã€‚åœ¨äº§ç”Ÿé˜Ÿåˆ—ç§¯å‹æ—¶å€™ï¼Œè¿™æ—¶å€™æœ€åˆç†çš„åˆ†é…å‡å‹ç­–ç•¥æ˜¯ partitionæ•°é‡å’Œconsumeræ•°é‡æˆå€æ•°å…³ç³»ï¼Œå•ä¸ªå¢åŠ consumer
æ•°é‡å¹¶ä¸èƒ½æœ‰æ•ˆæé«˜æ—¶å€™ï¼Œå¹¶ä¸”å¹¶ä¸èƒ½é©¬ä¸Šæé«˜æ¶ˆè´¹æ•ˆç‡ï¼Œéœ€è¦æ·»åŠ å¯¹åº”çš„partitionæ•°é‡ï¼Œä½†æ˜¯å°±å¸¦æ¥äº†å¦å¤–çš„é—®é¢˜ï¼Œpartitionæ•°é‡å¢åŠ ï¼Œç‰¹åˆ«æ˜¯kafkaï¼Œpartitionèµ„æºæ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡çš„èµ„æºï¼Œå¢åŠ partition
æ•°é‡è¿˜éœ€è¦è€ƒè™‘é›†ç¾¤çš„å¤„ç†èƒ½åŠ›ï¼Œå¦å¤–åœ¨é«˜å³°è¿‡åï¼Œæƒ³è¦consumerç¼©å®¹ä¹Ÿæ¯”è¾ƒéº»çƒ¦å“¦ï¼Œå› ä¸ºpartitionåªèƒ½å¢åŠ ä¸èƒ½å‡å°‘ã€‚&lt;/p>
&lt;p>é’ˆå¯¹partitionå­˜å‚¨æ–¹å¼çš„ï¼Œæ‰©å®¹ç›¸å…³çš„é—®é¢˜ï¼Œå·²ç»å †ç§¯çš„æ¶ˆæ¯æ˜¯ä¸èƒ½å¿«é€Ÿæ¶ˆè´¹çš„ï¼Œå‡è®¾æ˜¯2partitionå¯¹2ä¸ªconsumerï¼Œè¿™æ—¶å€™å¢åŠ partitionå’Œconsumeræ˜¯æ— ç”¨çš„ï¼Œå› ä¸ºå·²ç»å †ç§¯çš„åªèƒ½ç”±è¿™ä¸¤ä¸ªconsumer
æ¶ˆè´¹ï¼Œæ¨ªå‘æ‰©å±•ä¸å¯èƒ½äº†ï¼Œåªèƒ½çºµå‘æ‰©å±•ï¼Œè¿™æ—¶å€™è¦ä¹ˆåªèƒ½æ¥å—å·²ç»å †ç§¯æ…¢æ…¢æ¶ˆè´¹ï¼Œå¹¶ä¸”å°½é‡å‡å°‘å…¥è¿™ä¸¤ä¸ªpartitionçš„æ¶ˆæ¯ï¼Œæˆ–è€…æ‰§è¡Œæ¯”è¾ƒé‡ç‚¹å†å‡è¡¡ç­–ç•¥ï¼&lt;/p>
&lt;/blockquote>
&lt;h2 id="2019-11-18-æ¯æ—¥ä¸€æ€-httpdnsæœ‰å•¥å¥½å¤„-httpdns-ä¸ºä»€ä¹ˆä¸€èˆ¬åªé€‚ç”¨äº-app-æˆ–è€…-cs-æ¶æ„bs-ä¸ºä½•ä¸é€‚ç”¨">[2019-11-18 æ¯æ—¥ä¸€æ€] HttpDNSæœ‰å•¥å¥½å¤„, HttpDNS ä¸ºä»€ä¹ˆä¸€èˆ¬åªé€‚ç”¨äº APP æˆ–è€… C/S æ¶æ„ï¼ŒB/S ä¸ºä½•ä¸é€‚ç”¨?#&lt;/h2>
&lt;blockquote>
&lt;p>HttpDNS æ˜¯åŸºäºHTTPåè®®å‘èµ·æœåŠ¡å™¨Aè®°å½•çš„åœ°å€ï¼Œä¸å­˜åœ¨å‘æœ¬åœ°è¿è¥å•†è¯¢é—® domain è§£æè¿‡ç¨‹
é€‚ç”¨äºAPPæˆ–è€…C/Sæ¶æ„ï¼Œæ˜¯å®ƒçš„ç‰¹æ®Šæ€§å¯¼è‡´çš„ï¼Œ&lt;/p>
&lt;ul>
&lt;li>ä¸€èˆ¬åœ¨ç»ˆç«¯è¿™ç§ä¿¡å·å·®ã€ä¿¡å·ä¸ç¨³å®šä¸‹ï¼Œè¦æƒ³å°½é‡çš„ä»‹ç»äº¤äº’&lt;/li>
&lt;li>è·‘é©¬æœºåˆ¶é€‰å–å°±è¿‘åœ°å€&lt;/li>
&lt;li>SDKåµŒå…¥&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h2 id="2019-12-12-æ¯æ—¥ä¸€æ€æˆ‘ä»¬çŸ¥é“è®¸å¤šé•¿é“¾æ¥æƒ…å†µä¸‹ä¿è¯é“¾æ¥æœ‰æ•ˆå¤§éƒ¨åˆ†æ˜¯é€šè¿‡-tcp-keepalive-ä¸-åº”ç”¨å¿ƒè·³-æ¥ç¡®å®šå„è‡ªçš„å®šä½æ˜¯ä»€ä¹ˆä¸ºä»€ä¹ˆå¤§å¤šæ•°æƒ…å†µä¸‹å¾ˆå¤šimç³»ç»ŸåŒæ—¶ä½¿ç”¨-tcp-keepalive-ä¸-åº”ç”¨å±‚å¿ƒè·³å»ç¡®è®¤-åº”ç”¨å±‚å¿ƒè·³è®¾è®¡ä¸Šæœ‰å•¥è®²ç©¶">[2019-12-12 æ¯æ—¥ä¸€æ€]æˆ‘ä»¬çŸ¥é“è®¸å¤šé•¿é“¾æ¥æƒ…å†µä¸‹ï¼Œä¿è¯é“¾æ¥æœ‰æ•ˆå¤§éƒ¨åˆ†æ˜¯é€šè¿‡ TCP Keepalive ä¸ åº”ç”¨å¿ƒè·³ æ¥ç¡®å®šï¼Œå„è‡ªçš„å®šä½æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆå¤§å¤šæ•°æƒ…å†µä¸‹å¾ˆå¤šIMç³»ç»ŸåŒæ—¶ä½¿ç”¨ TCP Keepalive ä¸ åº”ç”¨å±‚å¿ƒè·³å»ç¡®è®¤ï¼Ÿ åº”ç”¨å±‚å¿ƒè·³è®¾è®¡ä¸Šæœ‰å•¥è®²ç©¶ï¼Ÿ&lt;/h2>
&lt;blockquote>
&lt;p>TCP Keepalive æ˜¯ TCP/IP åè®®è‡ªå¸¦ï¼Œæ— éœ€é¢å¤–çš„å¼€å‘ï¼Œä½†æ˜¯ä¸çµæ´»ï¼Œè€Œä¸”æˆ‘ä»¬ä¸€èˆ¬åœ¨åº”ç”¨å±‚é¢æ˜¯æ— æ³•æ„ŸçŸ¥ã€‚æ›´æ”¹TCP Keepalive ç›¸å…³å‚æ•°éœ€è¦ä¿®æ”¹/etc/sysctl.conf&lt;/p>
&lt;p>åº”ç”¨å±‚å¿ƒè·³æ˜¯ä¸ºäº†ä¿æ´»ï¼Œä¿è¯é“¾æ¥çš„å¯ç”¨æ€§&lt;/p>
&lt;ul>
&lt;li>è¿è¥å•†çš„ç¯å¢ƒï¼Œï¼Œå­˜åœ¨ NAT è¶…æ—¶æ–­é“¾é—®é¢˜&lt;/li>
&lt;li>è®©åº”ç”¨çŸ¥æ™“ç½‘ç»œå¯ç”¨æƒ…å†µï¼Œé…Œæƒ…å¤„ç†æ–­é“¾é‡è¿é—®é¢˜&lt;/li>
&lt;li>å¯ä»¥æœ‰æ•ˆçš„æ±Ÿéƒ½æœåŠ¡ç«¯ä¸ºäº†ç»´æŠ¤æ— æ•ˆé“¾æ¥çš„å¼€é”€&lt;/li>
&lt;/ul>
&lt;p>åº”ç”¨å±‚å¿ƒè·³è®¾è®¡ä¸Š&lt;/p>
&lt;ul>
&lt;li>å›ºå®šé¢‘ç‡ï¼Œé€šå¸¸åªæœ‰è¯·æ±‚å¤´ï¼Œæ¶ˆæ¯ä½“ç©ºåŒ…ï¼ˆåœ¨åˆ¤æ–­è¿™ç±»å¿ƒè·³å¤„ç†æ—¶å€™ï¼Œå®¢æˆ·ç«¯ä¸€èˆ¬è¦åˆ¤æ–­è¶…æ—¶æ—¶é—´å¤§äºå¿ƒè·³é—´éš”ã€å¯èƒ½å­˜åœ¨ç½‘ç»œå»¶è¿Ÿã€‘ï¼‰&lt;/li>
&lt;li>æ™ºèƒ½å¿ƒè·³ï¼Œæ ¹æ®ç½‘ç»œçŠ¶å†µè‡ªåŠ¨è°ƒæ•´å‘é€çš„é¢‘ç‡ï¼Œæ¥é€‚é…å½“å‰ç½‘ç»œæƒ…å†µçš„æœ€ä½³å¿ƒè·³é¢‘ç‡ï¼ˆå„ä¸ªåœ°åŒºå„ä¸ªæœåŠ¡å•† NAT è¶…æ—¶è®¾è®¡ä¸ä¸€æ ·ï¼Œé•¿çš„å¤šè¾¾å‡ ä¸ªå°æ—¶ï¼Œå°‘çš„åªæœ‰å‡ ç§’ï¼‰&lt;/li>
&lt;/ul>
&lt;p>æ™ºèƒ½å¿ƒè·³ï¼Œä¸€èˆ¬é‡‡ç”¨äºŒåˆ†æ³•æ¥é€æ¸é€¼è¿‘æœåŠ¡å•†çš„ NAT è¶…æ—¶è®¾è®¡ã€‚å¿ƒè·³è®¾è®¡ä¸Šä¸ä¼šæ˜¯ç©ºåŒ…ï¼Œè€Œæ˜¯ä¼ è¾“çš„æ˜¯å®¢æˆ·ç«¯çš„å¿ƒè·³é¢‘ç‡æ˜¯å¤šå°‘ã€‚
ï¼ˆå‡è®¾ æœ€å°å€¼ 20 s æœ€å¤§å€¼ 1å°æ—¶ï¼‰===&amp;gt; é€æ¸äºŒåˆ†ä¸‹å»&lt;/p>
&lt;/blockquote>
&lt;h2 id="2019-12-14-æ¯æ—¥ä¸€æ€-å¦‚ä½•åˆ¤æ–­ä»»æ„ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶åœ¨æœåŠ¡ç«¯æ˜¯å¦å­˜åœ¨å‘¢ç½‘ç›˜çš„ç§’ä¼ çš„å®ç°æ€è·¯">[2019-12-14 æ¯æ—¥ä¸€æ€] å¦‚ä½•åˆ¤æ–­ä»»æ„ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶åœ¨æœåŠ¡ç«¯æ˜¯å¦å­˜åœ¨å‘¢ï¼Ÿç½‘ç›˜çš„â€œç§’ä¼ â€çš„å®ç°æ€è·¯ï¼Ÿ&lt;/h2>
&lt;blockquote>
&lt;p>å¯¹æ¯”æ–‡ä»¶ï¼Œç¡®å®æ˜¯ä½¿ç”¨çš„æ–‡ä»¶çš„æå–çš„ç‰¹å¾å€¼ï¼ˆå•é¡¹å“ˆå¸Œç®—æ³•ï¼‰,å“ˆå¸Œç®—æ³•æ˜¯æœ‰å†²çªçš„ï¼Œè™½ç„¶æ¦‚ç‡è¾ƒå°ï¼Œ é‚£ä¹ˆå¦‚ä½•è¿™ç§å†²çªå‘¢ï¼šåœ¨æœåŠ¡ç«¯ï¼Œ
å¯¹è¯¥æ–‡ä»¶è¿›è¡Œä¸åŒçš„å•å‘Hashç®—æ³•ï¼ˆMD5ï¼ŒSHA-1ï¼‰ç­‰ç­‰å¾—åˆ°å¤šä¸ªå€¼ï¼Œä¸€ä¸€å¯¹æ¯”ï¼Œåªæœ‰å…¨éƒ¨ç›¸åŒæ‰è®¤ä¸ºæ˜¯åŒä¸€ä¸ªæ–‡ä»¶ã€‚&lt;/p>
&lt;p>ä¸ºä»€ä¹ˆè¦å“ˆå¸Œï¼Ÿä¸ºäº†å°†ä¸€ä¸ªä¸å®šé•¿ã€ä¸ç¡®å®šçš„ä¸œä¸œ è½¬åŒ–æˆ å›ºå®šé•¿åº¦çš„å›ºåŒ–çš„ç‰¹å¾å€¼ï¼Œå¹¶è¦ä¿è¯å”¯ä¸€æ€§ã€‚&lt;/p>
&lt;/blockquote>
&lt;h1 id="å¡«å‘è®°å½•">å¡«å‘è®°å½•&lt;/h1>
&lt;h2 id="dockerç›¸å…³">dockerç›¸å…³&lt;/h2>
&lt;ul>
&lt;li>dockeré»˜è®¤ç½‘æ¡¥é—®é¢˜&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>æœåŠ¡å™¨é»˜è®¤ç½‘æ¡¥ 172.19.0.0, è€Œ docker ç½‘æ¡¥é»˜è®¤172.17.0.0,
åœ¨å¯åŠ¨å¤šä¸ªçš„dockerå®¹å™¨çš„æ—¶å€™ä¼šå¯¼è‡´åœ°å€å†²çªï¼Œæ¡¥æ¥ç½‘å¡å‡‰ï¼Œ
éœ€è¦æ›´æ”¹docker é»˜è®¤çš„ç½‘æ¡¥åœ°å€&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-markdown" data-lang="markdown"> {
&amp;#34;debug&amp;#34; : true,
&amp;#34;default-address-pools&amp;#34; : [
{
&amp;#34;base&amp;#34; : &amp;#34;172.31.0.0/16&amp;#34;,
&amp;#34;size&amp;#34; : 24
}
]
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ›´æ”¹æˆå’Œä¸»æœºä¸ä¸€æ ·çš„çš„ç½‘æ®µåœ°å€&lt;/p>
&lt;/blockquote>
&lt;h2 id="redisåˆ†å¸ƒå¼é”">redisåˆ†å¸ƒå¼é”&lt;/h2>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">
&lt;span style="color:#8b008b;font-weight:bold">package&lt;/span> &lt;span style="color:#008b45;text-decoration:underline">com.kezaihui.thor.biz.core.adapter.redis.lock&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">import&lt;/span> &lt;span style="color:#008b45;text-decoration:underline">lombok.extern.slf4j.Slf4j&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">import&lt;/span> &lt;span style="color:#008b45;text-decoration:underline">org.springframework.beans.factory.annotation.Autowired&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">import&lt;/span> &lt;span style="color:#008b45;text-decoration:underline">org.springframework.data.redis.core.RedisTemplate&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">import&lt;/span> &lt;span style="color:#008b45;text-decoration:underline">org.springframework.data.redis.core.script.DefaultRedisScript&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">import&lt;/span> &lt;span style="color:#008b45;text-decoration:underline">org.springframework.stereotype.Component&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">import&lt;/span> &lt;span style="color:#008b45;text-decoration:underline">java.util.Collections&lt;/span>;
&lt;span style="color:#228b22">/**
&lt;/span>&lt;span style="color:#228b22"> * RedisTemplateDistributeLockUtil
&lt;/span>&lt;span style="color:#228b22"> */&lt;/span>
&lt;span style="color:#707a7c">@Slf4j&lt;/span>
&lt;span style="color:#707a7c">@Component&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">RedisTemplateDistributeLockUtil&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">final&lt;/span> String LOCK_SCRIPT =
&lt;span style="color:#cd5555">&amp;#34;local key = KEYS[1]; local value = ARGV[1]; if redis.call(&amp;#39;set&amp;#39;, key, value, &amp;#39;NX&amp;#39; ,&amp;#39;PX&amp;#39;, %d) &amp;#34;&lt;/span>
+ &lt;span style="color:#cd5555">&amp;#34;then return 1 else return 0 end&amp;#34;&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">final&lt;/span> String UNLOCK_SCRIPT =
&lt;span style="color:#cd5555">&amp;#34;if redis.call(&amp;#39;get&amp;#39;, KEYS[1]) == ARGV[1] then return redis.call(&amp;#39;del&amp;#39;,KEYS[1]) else return 0 end&amp;#34;&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">final&lt;/span> &lt;span style="color:#00688b;font-weight:bold">int&lt;/span> EXPIRE = 5000;
&lt;span style="color:#707a7c">@Autowired&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> RedisTemplate redisTemplate;
&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> String &lt;span style="color:#008b45">lockExpireScript&lt;/span>(&lt;span style="color:#00688b;font-weight:bold">int&lt;/span> expireMills) {
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> (expireMills &amp;lt;= 0) {
expireMills = EXPIRE;
}
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> String.&lt;span style="color:#658b00">format&lt;/span>(LOCK_SCRIPT, expireMills);
}
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">boolean&lt;/span> &lt;span style="color:#008b45">lock&lt;/span>(String key, String value, &lt;span style="color:#00688b;font-weight:bold">int&lt;/span> expireMills) {
String script = lockExpireScript(expireMills);
DefaultRedisScript&amp;lt;Long&amp;gt; redisScript = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> DefaultRedisScript&amp;lt;&amp;gt;(script, Long.&lt;span style="color:#658b00">class&lt;/span>);
Long execute = (Long) redisTemplate.&lt;span style="color:#658b00">execute&lt;/span>(redisScript, Collections.&lt;span style="color:#658b00">singletonList&lt;/span>(key),
Collections.&lt;span style="color:#658b00">singletonList&lt;/span>(value));
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> execute != &lt;span style="color:#8b008b;font-weight:bold">null&lt;/span> &amp;amp;&amp;amp; execute != 0;
}
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">boolean&lt;/span> &lt;span style="color:#008b45">blockLock&lt;/span>(String key, String value, &lt;span style="color:#00688b;font-weight:bold">int&lt;/span> expireMills) &lt;span style="color:#8b008b;font-weight:bold">throws&lt;/span> DistributeLockTimeoutException {
&lt;span style="color:#228b22">// è¢«é˜»å¡çš„æ—¶é—´è¶…è¿‡5ç§’å°±åœæ­¢è·å–é”
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#00688b;font-weight:bold">int&lt;/span> blockTime = expireMills;
&lt;span style="color:#228b22">// é»˜è®¤çš„é—´éš”æ—¶é—´
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> (; ; ) {
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> (blockTime &amp;gt;= 0) {
String script = lockExpireScript(expireMills);
DefaultRedisScript&amp;lt;Long&amp;gt; redisScript = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> DefaultRedisScript&amp;lt;&amp;gt;(script, Long.&lt;span style="color:#658b00">class&lt;/span>);
Long result = (Long) redisTemplate.&lt;span style="color:#658b00">execute&lt;/span>(redisScript, Collections.&lt;span style="color:#658b00">singletonList&lt;/span>(key), value);
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> (result != &lt;span style="color:#8b008b;font-weight:bold">null&lt;/span> &amp;amp;&amp;amp; result == 1) {
&lt;span style="color:#228b22">// å¾—åˆ°äº†é”
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>;
} &lt;span style="color:#8b008b;font-weight:bold">else&lt;/span> {
blockTime -= 300;
&lt;span style="color:#8b008b;font-weight:bold">try&lt;/span> {
Thread.&lt;span style="color:#658b00">sleep&lt;/span>(300);
} &lt;span style="color:#8b008b;font-weight:bold">catch&lt;/span> (InterruptedException e) {
log.&lt;span style="color:#658b00">error&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;RedisTemplateDistributeLockUtil.blockLock error!&amp;#34;&lt;/span>, e);
}
}
} &lt;span style="color:#8b008b;font-weight:bold">else&lt;/span> {
&lt;span style="color:#228b22">// å·²ç»è¶…æ—¶
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">throw&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> DistributeLockTimeoutException(&lt;span style="color:#cd5555">&amp;#34;Distribute Lock Timeout&amp;#34;&lt;/span>);
}
}
}
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">boolean&lt;/span> &lt;span style="color:#008b45">unlock&lt;/span>(String key, String value) {
String script = UNLOCK_SCRIPT;
DefaultRedisScript&amp;lt;Long&amp;gt; redisScript = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> DefaultRedisScript&amp;lt;&amp;gt;(script, Long.&lt;span style="color:#658b00">class&lt;/span>);
Long execute = (Long) redisTemplate.&lt;span style="color:#658b00">execute&lt;/span>(redisScript, Collections.&lt;span style="color:#658b00">singletonList&lt;/span>(key), value);
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> execute != &lt;span style="color:#8b008b;font-weight:bold">null&lt;/span> &amp;amp;&amp;amp; execute != 0;
}
}
&lt;/code>&lt;/pre>&lt;/div>- https://pinkhello.me/posts/14-%E5%B7%A5%E4%BD%9C%E7%BA%AA%E5%AE%9E2020/ - PinkHello, All Rights Reserved</description></item><item><title>03 Stringä¸ºä»€ä¹ˆè®¾è®¡æˆfinal</title><link>https://pinkhello.me/posts/03-string%E4%B8%BA%E4%BB%80%E4%B9%88%E8%AE%BE%E8%AE%A1%E6%88%90final/</link><pubDate>Sun, 10 Feb 2019 08:19:51 +0800</pubDate><guid>https://pinkhello.me/posts/03-string%E4%B8%BA%E4%BB%80%E4%B9%88%E8%AE%BE%E8%AE%A1%E6%88%90final/</guid><description>PinkHello https://pinkhello.me/posts/03-string%E4%B8%BA%E4%BB%80%E4%B9%88%E8%AE%BE%E8%AE%A1%E6%88%90final/ -&lt;h1 id="stringæºç å‰–æ">&lt;code>String&lt;/code>æºç å‰–æ&lt;/h1>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">final&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">String&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">implements&lt;/span> java.&lt;span style="color:#658b00">io&lt;/span>.&lt;span style="color:#658b00">Serializable&lt;/span>, Comparable&amp;lt;String&amp;gt;, CharSequence {
&lt;span style="color:#228b22">/** The value is used for character storage. */&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">final&lt;/span> &lt;span style="color:#00688b;font-weight:bold">char&lt;/span> value[];
&lt;span style="color:#228b22">/** Cache the hash code for the string */&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> &lt;span style="color:#00688b;font-weight:bold">int&lt;/span> hash; &lt;span style="color:#228b22">// Default to 0
&lt;/span>&lt;span style="color:#228b22">&lt;/span>
&lt;span style="color:#228b22">/** use serialVersionUID from JDK 1.0.2 for interoperability */&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">final&lt;/span> &lt;span style="color:#00688b;font-weight:bold">long&lt;/span> serialVersionUID = -6849794470754667710L;
&lt;span style="color:#228b22">/**
&lt;/span>&lt;span style="color:#228b22"> * Class String is special cased within the Serialization Stream Protocol.
&lt;/span>&lt;span style="color:#228b22"> *
&lt;/span>&lt;span style="color:#228b22"> * A String instance is written into an ObjectOutputStream according to
&lt;/span>&lt;span style="color:#228b22"> * &amp;lt;a href=&amp;#34;{@docRoot}/../platform/serialization/spec/output.html&amp;#34;&amp;gt;
&lt;/span>&lt;span style="color:#228b22"> * Object Serialization Specification, Section 6.2, &amp;#34;Stream Elements&amp;#34;&amp;lt;/a&amp;gt;
&lt;/span>&lt;span style="color:#228b22"> */&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">final&lt;/span> ObjectStreamField[] serialPersistentFields =
&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> ObjectStreamField[0];
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>String&lt;/code> å¦‚ä½•ä¿è¯ ä¸å¯å˜çš„å‘¢ï¼Ÿ&lt;/p>
&lt;blockquote>
&lt;p>å­—ç¬¦æ•°ç»„ä½¿ç”¨äº† &lt;code>final&lt;/code> ä¿®é¥°ï¼Œè¿™ä¹Ÿåªæ˜¯è¡¨ç¤ºäº† å­—ç¬¦æ•°ç»„çš„å¼•ç”¨åœ°å€ä¸å¯å˜ï¼Œå¹¶ä¸ä»£è¡¨å†…å®¹ä¸å¯å˜ã€‚
å…¶ä½¿ç”¨ &lt;code>private&lt;/code> ä¿®é¥°ï¼Œå¤–éƒ¨æ²¡æœ‰å…¥å£è¾¾åˆ°å˜åŠ¨ï¼Œä»è€Œä¿è¯äº† String çš„ä¸å¯å˜æ€§&lt;/p>
&lt;/blockquote>
&lt;p>ä¸ºä»€ä¹ˆä¿è¯ &lt;code>String&lt;/code> æ˜¯ &lt;code>final&lt;/code> çš„å‘¢ï¼Ÿç‰¹ç‚¹ï¼š&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>å› ä¸ºåªæœ‰ä¿è¯ &lt;code>String&lt;/code> æ˜¯ &lt;code>final&lt;/code> çš„å‘¢ &lt;strong>åªæœ‰å½“å­—ç¬¦ä¸²ä¸å¯å˜çš„ï¼Œå­—ç¬¦ä¸²æ± æ‰å¯èƒ½å®ç°&lt;/strong>;å­—ç¬¦ä¸²æ± çš„å®ç°å¯ä»¥èŠ‚çœå¾ˆå¤šçš„ &lt;code>Heap&lt;/code>ç©ºé—´ï¼Œå› ä¸ºä¸åŒçš„å­—ç¬¦ä¸²å˜é‡éƒ½æŒ‡å‘æ± ä¸­çš„åŒä¸€ä¸ªå­—ç¬¦ä¸².&lt;/li>
&lt;li>å‡å¦‚å­—ç¬¦ä¸²å¯å˜ï¼Œé‚£ä¹ˆ&lt;code>String&lt;/code> &lt;code>interning&lt;/code> ä¸èƒ½å®ç°ï¼Œé‚£ä¹ˆå˜é‡æ”¹å˜äº†è¿™ä¸ªå­—ç¬¦ä¸²çš„å€¼ï¼Œé‚£ä¹ˆå…¶ä»–æŒ‡å‘è¿™ä¸ªå€¼çš„å˜é‡çš„å€¼ä¹Ÿæ”¹å˜äº†ã€‚ ï¼ˆå®‰å…¨é—®é¢˜æ¥äº†ï¼Œç”¨æˆ·åå¯†ç ï¼Œç«¯å£ã€IPç­‰ï¼‰&lt;/li>
&lt;li>å­—ç¬¦ä¸²ä¸å¯å˜ï¼Œå¤šçº¿ç¨‹å®‰å…¨ï¼ŒåŒä¸€ä¸ªå­—ç¬¦ä¸²å®ä¾‹å¯ä»¥è¢«å¯¹æ­Œçº¿ç¨‹å…±äº«ï¼Œä¸éœ€è¦è€ƒè™‘åŒæ­¥é—®é¢˜&lt;/li>
&lt;li>ä¸Šé¢çœ‹å‡ºï¼Œåœ¨å­—ç¬¦ä¸²ä¸å¯å˜çš„æƒ…å†µä¸‹ï¼Œåˆ›å»ºçš„æ—¶å€™ &lt;code>hashcode&lt;/code>ä¹Ÿè¢«ç¼“å­˜äº†ï¼Œä¸éœ€è¦é‡æ–°è®¡ç®—ã€‚ä¸€éƒ¨åˆ†æ€§èƒ½é—®é¢˜å¯ä»¥å¾ˆå¥½çš„é€‰æ‹©å­—ç¬¦ä¸²&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h1 id="string-åœ¨-jvm-å±‚ç†è§£-æ‹“å±•">&lt;code>String&lt;/code> åœ¨ &lt;code>JVM&lt;/code> å±‚ç†è§£ æ‹“å±•&lt;/h1>
&lt;p>&lt;code>JVM&lt;/code> å±‚é¢æœ‰ è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€å †ã€ç¨‹åºè®¡æ•°å™¨ã€å…ƒæ•°æ®åŒº(æ–¹æ³•åŒº)
&lt;img src="https://pinkhello.me/String%E4%B8%BA%E4%BB%80%E4%B9%88%E8%AE%BE%E8%AE%A1%E6%88%90final%E5%BD%A2%E6%80%81/%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA.png" alt="è¿è¡Œæ—¶æ•°æ®åŒº">&lt;/p>
&lt;ul>
&lt;li>å­—ç¬¦ä¸²åˆ›å»ºå½¢å¼&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">String s1 = &lt;span style="color:#cd5555">&amp;#34;1&amp;#34;&lt;/span>;
String s2 = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> String(&lt;span style="color:#cd5555">&amp;#34;1&amp;#34;&lt;/span>);
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;ul>
&lt;li>ç¼–è¯‘æœŸé—´ &amp;ldquo;1&amp;rdquo; ä½œä¸ºå¸¸é‡è¿›å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆè¿™æ—¶å€™æ˜¯é™æ€å¸¸é‡æ± ï¼‰;&lt;/li>
&lt;li>å½“ç¼–è¯‘ &lt;code>s1&lt;/code> æ—¶å€™ï¼Œå°† &lt;code>s1&lt;/code> æ¨è¿›å±€éƒ¨å˜é‡åŒºï¼ˆæ ˆå¸§å†…éƒ¨ï¼‰; å…ˆåˆ¤æ–­ &amp;ldquo;1&amp;rdquo; åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± åœ¨ä¸åœ¨ï¼Œä¸å­˜åœ¨çš„è¯åˆ›å»ºå¸¸é‡ &amp;ldquo;1&amp;rdquo; åŠ å…¥å¸¸é‡æ± ï¼Œå¹¶ç›´æ¥å°† &lt;code>s1&lt;/code> æŒ‡å‘å­—ç¬¦ä¸²å¸¸é‡æ± çš„å¯¹è±¡ &amp;ldquo;1&amp;rdquo; åœ°å€ï¼›&lt;/li>
&lt;li>å½“ä»£ç è¿è¡Œ &lt;code>s2&lt;/code> æ—¶å€™ï¼Œä½¿ç”¨çš„ &lt;code>new&lt;/code> å­—æ®µï¼Œ&lt;code>JVM&lt;/code> å…ˆæ£€æŸ¥å­—ç¬¦ä¸²å¸¸é‡åœ¨å¸¸é‡æ± å­˜ä¸å­˜åœ¨ï¼Œå¦‚æœå·²ç»å­˜åœ¨ï¼Œç›´æ¥åœ¨å †ä¸­å¤åˆ¶æ”¹å¯¹è±¡çš„å‰¯æœ¬ï¼Œå¹¶ä¸”å°† &lt;code>s2&lt;/code> æŒ‡å‘å †ä¸­çš„åˆšåˆšåˆ›å»ºçš„å¯¹è±¡åœ°å€ã€‚
å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä¼šå®ä¾‹åŒ–è¯¥å­—ç¬¦ä¸² &amp;ldquo;1&amp;rdquo; å¹¶ä¸”å°†å…¶æ”¾åˆ°å¸¸é‡æ± ä¸­ï¼ˆè¿™æ—¶å€™æ˜¯è¿è¡Œæ—¶å¸¸é‡æ± ï¼‰,ç„¶ååœ¨å †ä¸­å¤åˆ¶åˆšåˆšåŠ å…¥å¸¸é‡æ± å¯¹è±¡çš„å‰¯æœ¬åˆ›å»ºå‡ºæ–°çš„å¯¹è±¡ï¼Œå¹¶å°† &lt;code>s2&lt;/code> æŒ‡å‘å®ƒ&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;ul>
&lt;li>&amp;lsquo;+&amp;lsquo;å·è¿æ¥çš„å­—ç¬¦ä¸²&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">String s1 = &lt;span style="color:#cd5555">&amp;#34;1&amp;#34;&lt;/span>+&lt;span style="color:#cd5555">&amp;#34;2&amp;#34;&lt;/span>+&lt;span style="color:#cd5555">&amp;#34;3&amp;#34;&lt;/span>;
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;ul>
&lt;li>ç¼–è¯‘æœŸé—´å°±èƒ½ç¡®å®šï¼Œç›´æ¥ä½œä¸º &amp;ldquo;123&amp;rdquo; çš„å¸¸é‡è¿›å…¥å¸¸é‡æ± ;&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">String s2 = &lt;span style="color:#cd5555">&amp;#34;1&amp;#34;&lt;/span>+&lt;span style="color:#cd5555">&amp;#34;2&amp;#34;&lt;/span>+&lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> String(&lt;span style="color:#cd5555">&amp;#34;3&amp;#34;&lt;/span>)+&lt;span style="color:#cd5555">&amp;#34;4&amp;#34;&lt;/span>;
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;ul>
&lt;li>å½“ &amp;lsquo;+&amp;rsquo; ä¸­é—´æœ‰å˜é‡æ—¶å€™ï¼Œä¹Ÿåªèƒ½åœ¨è¿è¡ŒæœŸæ‰èƒ½ç¡®å®šï¼Œä½†æ˜¯åœ¨ç¼–è¯‘æœŸé—´ä¼šå°½é‡çš„å°†å­—ç¬¦ä¸²å¸¸é‡è¿æ¥èµ·æ¥ï¼Œå½¢æˆæ–°çš„å­—ç¬¦ä¸²å¸¸é‡;&lt;/li>
&lt;li>åç¼–è¯‘å &lt;code>String s2 = new StringBuilder(&amp;quot;12&amp;quot;).append(new String(&amp;quot;3&amp;quot;&amp;quot;)).append(&amp;quot;4&amp;quot;).toString()&lt;/code>;&lt;/li>
&lt;li>ä¹Ÿå°±æ˜¯è¯´ç”¨ &amp;lsquo;+&amp;rsquo; è¿æ¥ä¸­é—´æœ‰å˜é‡çš„æ—¶å€™ï¼Œ&amp;ldquo;13&amp;rdquo;, &amp;ldquo;3&amp;rdquo;, &amp;ldquo;4&amp;rdquo; åœ¨å¸¸é‡æ± ä¸­ï¼Œåœ¨å †ä¸­æœ‰ &lt;code>StringBuilder(&amp;quot;1234&amp;quot;)&lt;/code>, &lt;code>String(&amp;quot;4&amp;quot;)&lt;/code>,ä»¥åŠ&lt;code>toString&lt;/code>åäº§ç”Ÿçš„&lt;code>String&lt;/code>å¯¹è±¡&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">String s3 = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> String(&lt;span style="color:#cd5555">&amp;#34;3&amp;#34;&lt;/span>) + &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> String(&lt;span style="color:#cd5555">&amp;#34;3&amp;#34;&lt;/span>);
&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;ul>
&lt;li>&amp;ldquo;3&amp;rdquo; åœ¨å¸¸é‡æ± ä¸­ï¼ˆç¼–è¯‘çš„æ—¶å€™ï¼‰&lt;/li>
&lt;li>è¿è¡Œæ—¶ï¼Œåœ¨å †ä¸­äº§ç”Ÿ &amp;ldquo;3&amp;rdquo; çš„å‰¯æœ¬ä¸¤ä¸ª &lt;code>String&lt;/code> å¯¹è±¡ï¼Œå¹¶äº§ç”Ÿ &lt;code>StringBuilder(&amp;quot;11&amp;quot;)&lt;/code> å¯¹è±¡ä»¥åŠ &lt;code>toString&lt;/code> çš„ &lt;code>String&lt;/code> å¯¹è±¡&lt;/li>
&lt;/ul>
&lt;/blockquote>
- https://pinkhello.me/posts/03-string%E4%B8%BA%E4%BB%80%E4%B9%88%E8%AE%BE%E8%AE%A1%E6%88%90final/ - PinkHello, All Rights Reserved</description></item><item><title>02 å…³äºfinalçš„æ€è€ƒ</title><link>https://pinkhello.me/posts/02-%E5%85%B3%E4%BA%8Efinal%E7%9A%84%E6%80%9D%E8%80%83/</link><pubDate>Sun, 10 Feb 2019 08:09:36 +0800</pubDate><guid>https://pinkhello.me/posts/02-%E5%85%B3%E4%BA%8Efinal%E7%9A%84%E6%80%9D%E8%80%83/</guid><description>PinkHello https://pinkhello.me/posts/02-%E5%85%B3%E4%BA%8Efinal%E7%9A%84%E6%80%9D%E8%80%83/ -&lt;h2 id="å…³äºfinalçš„æ€è€ƒ">å…³äº&lt;code>final&lt;/code>çš„æ€è€ƒ&lt;/h2>
&lt;ul>
&lt;li>&lt;code>final&lt;/code> æ˜¯å£°æ˜æ•°æ®åŸŸæœ€ç»ˆçš„,ä¸å¯ä»¥ä¿®æ”¹çš„ï¼Œå¸¸è§çš„ æ˜¯ç±»çš„ åºåˆ—åŒ–&lt;code>ID&lt;/code>&lt;/li>
&lt;li>&lt;code>String&lt;/code> ç±»ï¼Œå…¶æ•°æ®åŸŸéƒ½æ˜¯ &lt;code>final&lt;/code> çš„&lt;/li>
&lt;/ul>
&lt;h3 id="ä¿®æ”¹-final-ä¿®é¥°çš„å±æ€§">ä¿®æ”¹ &lt;code>final&lt;/code> ä¿®é¥°çš„å±æ€§&lt;/h3>
&lt;p>åå°„ä¿®æ”¹ &lt;code>final&lt;/code> ä¿®é¥°çš„æ•°æ®åŸŸã€éå¸¸æˆåŠŸçš„ä¿®æ”¹äº†ã€‘&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">Test&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">final&lt;/span> String name = &lt;span style="color:#cd5555">&amp;#34;hello world&amp;#34;&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">main&lt;/span>(String[] args) &lt;span style="color:#8b008b;font-weight:bold">throws&lt;/span> NoSuchFieldException, IllegalAccessException {
Test test = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> Test();
Field field = test.&lt;span style="color:#658b00">getClass&lt;/span>().&lt;span style="color:#658b00">getDeclaredField&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;name&amp;#34;&lt;/span>);
field.&lt;span style="color:#658b00">setAccessible&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>);
field.&lt;span style="color:#658b00">set&lt;/span>(test,&lt;span style="color:#cd5555">&amp;#34;HELLO, WORLD!&amp;#34;&lt;/span>);
System.&lt;span style="color:#658b00">out&lt;/span>.&lt;span style="color:#658b00">println&lt;/span>(field.&lt;span style="color:#658b00">get&lt;/span>(test));
System.&lt;span style="color:#658b00">out&lt;/span>.&lt;span style="color:#658b00">println&lt;/span>(test.&lt;span style="color:#658b00">name&lt;/span>);
}
}
è¾“å‡º
Hello, WORLD!
hello world
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¬¬ä¸€ä¸ªè¾“å‡ºæ˜¯å› ä¸ºè¯´æ˜è¿è¡ŒæˆåŠŸï¼Œä¿®æ”¹&lt;code>final&lt;/code>ä¿®é¥°çš„å¯¹è±¡çš„å±æ€§æˆåŠŸä¿®æ”¹ï¼›&lt;/p>
&lt;p>ä½†æ˜¯ç¬¬äºŒä¸ªè¾“å‡ºï¼Œè¡¨æ˜äº†æˆ‘ç›´æ¥ä½¿ç”¨ &lt;code>name&lt;/code> çš„å±æ€§å´è¿˜æ˜¯è¾“å‡ºç«¯é¢åŸæ¥çš„å€¼.&lt;/p>
&lt;p>åç¼–è¯‘åçš„ä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">Test&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">final&lt;/span> String name = &lt;span style="color:#cd5555">&amp;#34;hello world&amp;#34;&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#008b45">Test&lt;/span>() {
}
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">main&lt;/span>(String[] args) &lt;span style="color:#8b008b;font-weight:bold">throws&lt;/span> NoSuchFieldException, IllegalAccessException {
Test test = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> Test();
Field field = test.&lt;span style="color:#658b00">getClass&lt;/span>().&lt;span style="color:#658b00">getDeclaredField&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;name&amp;#34;&lt;/span>);
field.&lt;span style="color:#658b00">setAccessible&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>);
field.&lt;span style="color:#658b00">set&lt;/span>(test, &lt;span style="color:#cd5555">&amp;#34;HELLO, WORLD!&amp;#34;&lt;/span>);
System.&lt;span style="color:#658b00">out&lt;/span>.&lt;span style="color:#658b00">println&lt;/span>(field.&lt;span style="color:#658b00">get&lt;/span>(test));
PrintStream var10000 = System.&lt;span style="color:#658b00">out&lt;/span>;
test.&lt;span style="color:#658b00">getClass&lt;/span>();
var10000.&lt;span style="color:#658b00">println&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;hello world&amp;#34;&lt;/span>);
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥çœ‹å‡º ä½¿ç”¨å¯¹è±¡.å±æ€§çš„å·²ç»è¢«æ›¿æ¢äº†ï¼Œè¿™æ˜¯ç”±äº&lt;code>JVM&lt;/code> çš„å†…è”ä¼˜åŒ–ï¼ˆæ–¹æ³•è°ƒç”¨(å‚æ•°å‹æ ˆ,è·³è½¬åˆ°æ–¹æ³•å¤„æ‰§è¡Œ,å†è°ƒå›,å¤„ç†æ ˆå‚æ•°,å¤„ç†è¿”å›å€¼)ï¼‰å¯¼è‡´çš„ï¼Œä¼šç›´æ¥æ›¿æ¢æ‰ä½¿ç”¨ final ä¿®é¥°çš„å­—æ®µã€‚ã€å½“ç„¶ä¹Ÿå¯ä»¥å…³é—­å†…è”ä¼˜åŒ–ã€‘&lt;/p>
&lt;h3 id="ä¿®æ”¹ä½¿ç”¨-final-ä¿®é¥°çš„-static-ç±»å±æ€§">ä¿®æ”¹ä½¿ç”¨ &lt;code>final&lt;/code> ä¿®é¥°çš„ &lt;code>static&lt;/code> ç±»å±æ€§&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">Test&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">final&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> String NAME = &lt;span style="color:#cd5555">&amp;#34;static hello world&amp;#34;&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">main&lt;/span>(String[] args) &lt;span style="color:#8b008b;font-weight:bold">throws&lt;/span> NoSuchFieldException, IllegalAccessException {
Test test = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> Test();
&lt;span style="color:#228b22">//ä¿®æ”¹NAME
&lt;/span>&lt;span style="color:#228b22">&lt;/span> Field sfield = test.&lt;span style="color:#658b00">getClass&lt;/span>().&lt;span style="color:#658b00">getDeclaredField&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;NAME&amp;#34;&lt;/span>);
sfield.&lt;span style="color:#658b00">setAccessible&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>);
sfield.&lt;span style="color:#658b00">set&lt;/span>(test,&lt;span style="color:#cd5555">&amp;#34;STATIC HELLO, WORLD!&amp;#34;&lt;/span>);
System.&lt;span style="color:#658b00">out&lt;/span>.&lt;span style="color:#658b00">println&lt;/span>(sfield.&lt;span style="color:#658b00">get&lt;/span>(test));
System.&lt;span style="color:#658b00">out&lt;/span>.&lt;span style="color:#658b00">println&lt;/span>(test.&lt;span style="color:#658b00">NAME&lt;/span>);
}
}
è¾“å‡ºå¼‚å¸¸ Can not set &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">final&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¿®æ”¹&lt;code>Field&lt;/code>ä¸­çš„&lt;code>modifiers&lt;/code>æ•°æ®åŸŸï¼Œæ¸…é™¤ä»£è¡¨&lt;code>final&lt;/code>çš„é‚£ä¸ªbitï¼Œæ‰å¯ä»¥æˆåŠŸä¿®æ”¹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java">&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">Test&lt;/span> {
&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">final&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> String NAME = &lt;span style="color:#cd5555">&amp;#34;static hello world&amp;#34;&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">main&lt;/span>(String[] args) &lt;span style="color:#8b008b;font-weight:bold">throws&lt;/span> NoSuchFieldException, IllegalAccessException {
Test test = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> Test();
&lt;span style="color:#228b22">//ä¿®æ”¹NAME
&lt;/span>&lt;span style="color:#228b22">&lt;/span> Field sfield = test.&lt;span style="color:#658b00">getClass&lt;/span>().&lt;span style="color:#658b00">getDeclaredField&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;NAME&amp;#34;&lt;/span>);
Field modifiers = sfield.&lt;span style="color:#658b00">getClass&lt;/span>().&lt;span style="color:#658b00">getDeclaredField&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;modifiers&amp;#34;&lt;/span>);
modifiers.&lt;span style="color:#658b00">setAccessible&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>);
modifiers.&lt;span style="color:#658b00">setInt&lt;/span>(sfield, sfield.&lt;span style="color:#658b00">getModifiers&lt;/span>() &amp;amp; ~Modifier.&lt;span style="color:#658b00">FINAL&lt;/span>);&lt;span style="color:#228b22">//fianlæ ‡å¿—ä½ç½®0
&lt;/span>&lt;span style="color:#228b22">&lt;/span>
sfield.&lt;span style="color:#658b00">setAccessible&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">true&lt;/span>);
sfield.&lt;span style="color:#658b00">set&lt;/span>(test,&lt;span style="color:#cd5555">&amp;#34;STATIC HELLO, WORLD!&amp;#34;&lt;/span>);
System.&lt;span style="color:#658b00">out&lt;/span>.&lt;span style="color:#658b00">println&lt;/span>(sfield.&lt;span style="color:#658b00">get&lt;/span>(test));
System.&lt;span style="color:#658b00">out&lt;/span>.&lt;span style="color:#658b00">println&lt;/span>(test.&lt;span style="color:#658b00">NAME&lt;/span>);
}
}
è¾“å‡º
STATIC HELLO, WORLD!
&lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> hello world
&lt;/code>&lt;/pre>&lt;/div>- https://pinkhello.me/posts/02-%E5%85%B3%E4%BA%8Efinal%E7%9A%84%E6%80%9D%E8%80%83/ - PinkHello, All Rights Reserved</description></item><item><title>01 ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</title><link>https://pinkhello.me/posts/01-%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/</link><pubDate>Sat, 09 Feb 2019 22:50:46 +0800</pubDate><guid>https://pinkhello.me/posts/01-%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/</guid><description>PinkHello https://pinkhello.me/posts/01-%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/ -&lt;h1 id="åˆ†å¸ƒå¼å‡è¡¡å¯»å€ç®—æ³•">åˆ†å¸ƒå¼å‡è¡¡å¯»å€ç®—æ³•&lt;/h1>
&lt;p>åœ¨åˆ†å¸ƒå¼é›†ç¾¤ä¸­ï¼Œå¯¹æœºå™¨çš„æ·»åŠ åˆ é™¤ï¼Œæˆ–è€…æœºå™¨æ•…éšœåè‡ªåŠ¨è„±è½é›†ç¾¤çš„æ“ä½œæ˜¯åˆ†å¸ƒå¼é›†ç¾¤ç®¡ç†çš„åŸºæœ¬åŠŸèƒ½ã€‚&lt;/p>
&lt;blockquote>
&lt;p>åœ¨é›†ç¾¤ç¯å¢ƒä¸­ï¼Œåˆ¤æ–­åˆ†å¸ƒå¼å¯»å€ç®—æ³•å¥½åçš„åŸåˆ™ï¼š&lt;/p>
&lt;ul>
&lt;li>å¹³è¡¡æ€§ï¼ˆBalanceï¼‰&lt;/li>
&lt;li>å•è°ƒæ€§ï¼ˆMonotonicityï¼‰&lt;/li>
&lt;li>åˆ†æ•£æ€§ï¼ˆSpreadï¼‰&lt;/li>
&lt;li>è´Ÿè½½ï¼ˆLoadï¼‰&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h2 id="hashobjectn">Hash(Object)%N&lt;/h2>
&lt;p>é›†ç¾¤Nå°æœºå™¨ï¼Œæ ¹æ®Nå–æ¨¡ï¼Œè·¯ç”±åˆ°å¯¹åº”çš„æœºå™¨ï¼Œä½†æ˜¯ç¼ºç‚¹åœ¨äºï¼Œå¯¹äºæœºå™¨çš„æ·»åŠ åˆ é™¤ï¼Œå·²ç»ç¼“å­˜çš„æ•°æ®éƒ½å¤±æ•ˆã€ä¸¥é‡è¿åå•è°ƒæ€§ï¼Œ
å¤§é‡çš„ç¼“å­˜é‡å»º&lt;/p>
&lt;blockquote>
&lt;p>å‡è®¾0-3ä¸ªèŠ‚ç‚¹ã€20ä¸ªæ•°æ®:
&lt;img src="https://pinkhello.me/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/hash.png" alt="å“ˆå¸Œæ•°æ®">&lt;/p>
&lt;p>è¿›è¡Œå–æ¨¡ååˆ†å¸ƒ:
&lt;img src="https://pinkhello.me/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/hash1.png" alt="å“ˆå¸Œå–æ¨¡ååˆ†å¸ƒ">&lt;/p>
&lt;p>æ‰©å®¹å:
&lt;img src="https://pinkhello.me/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/hash3.png" alt="æ‰©å®¹å">
å½“å‰åªæœ‰4ä¸ªæ•°æ®èƒ½å‘½ä¸­ã€‚å‘½ä¸­ç‡ 4/20 = 20% ,å‘½ä¸­ç‡åº•ä¸‹ï¼Œå¹¶ä¸”æœ‰å¤§é‡ç¼“å­˜éœ€è¦é‡å»º&lt;/p>
&lt;/blockquote>
&lt;h2 id="ä¸€è‡´æ€§hash--dht-">ä¸€è‡´æ€§Hash ( DHT )&lt;/h2>
&lt;blockquote>
&lt;p>å…¬å…±å“ˆå¸Œå‡½æ•°å’Œå“ˆå¸Œç¯
Hashç®—æ³•è®¾è®¡: é‡‡å–å–æ¨¡æ–¹å¼ï¼ŒæŒ‰å¸¸ç”¨çš„ Hash ç®—æ³•å°†å¯¹åº”çš„ Key å“ˆå¸Œåˆ°ä¸€ä¸ªå…·æœ‰ 2^32 æ¬¡æ–¹çš„æ¡¶ç©ºé—´ä¸­ï¼Œå³ 0 ~ (2^32)-1 çš„æ•°å­—ç©ºé—´ã€‚æƒ³æƒ³ä¸€ä¸‹ï¼Œå°†æ•°å­—é¦–ä½ç›¸è¿ï¼Œç»„æˆä¸€ä¸ªé—­åˆçš„ç¯å½¢ã€‚
&lt;img src="https://pinkhello.me/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/hash4.png" alt="ç¯å½¢Hashç©ºé—´">&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>å¯¹è±¡(Object)æ˜ å°„åˆ°å“ˆå¸Œç¯
æŠŠå¯¹è±¡æ˜ å°„åˆ° 0-2^32-1 ç©ºé—´é‡Œï¼Œå‡è®¾æœ‰4ä¸ªå¯¹è±¡ object1-4 ï¼Œæ˜ å°„è¿›hashç¯çŠ¶
&lt;img src="https://pinkhello.me/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/hash5.png" alt="å¯¹è±¡æ˜ å°„ç¯å½¢Hashç©ºé—´">&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>ç¼“å­˜(Cache)æ˜ å°„åˆ°å“ˆå¸Œç¯
ä¸‹é¢å°† Cache æ˜ å°„è¿› Hash ç©ºé—´ï¼Œå‡è®¾ç°åœ¨æœ‰ä¸‰ä¸ªcacheï¼š&lt;/p>
&lt;blockquote>
&lt;p>åŸºæœ¬æ€æƒ³å°±æ˜¯ Object å’Œ Cache éƒ½æ˜ å°„åˆ°åŒä¸€ Hash æ•°å€¼ç©ºé—´ä¸­ï¼Œå¹¶ä¸”ä½¿ç”¨ç›¸åŒçš„ Hashç®—æ³•ï¼Œå¯ä»¥ä½¿ç”¨ Cache çš„ IPåœ°å€æˆ–è€…å…¶ä»–å› å­ï¼‰&lt;/p>
&lt;/blockquote>
&lt;p>&lt;img src="https://pinkhello.me/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/hash6.png" alt="Cacheæ˜ å°„ç¯å½¢Hashç©ºé—´">&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>å¯¹è±¡ï¼ˆObjectæ˜ å°„åˆ°ç¼“å­˜(Cache)èŠ‚ç‚¹
æ¯ä¸ª Cache çš„ Key é¡ºæ—¶é’ˆï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ª Cache èŠ‚ç‚¹å°±æ˜¯å­˜å‚¨ä½ç½®:
&lt;img src="https://pinkhello.me/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/hash7.png" alt="æ‰¾åˆ°Cacheå­˜å‚¨ä½ç½®">&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>ç§»é™¤ä¸€ä¸ªç¼“å­˜èŠ‚ç‚¹
ç§»é™¤ä¸€ä¸ª CacheB èŠ‚ç‚¹, è¿™æ—¶å€™ key4 æ— æ³•æ‰¾å¯»åˆ° Cacheï¼Œkey4å°†ç»§ç»­ä½¿ç”¨ä¸€è‡´æ€§Hashç®—æ³•ç®—å‡ºæœ€æ–°çš„ CacheC, ä»¥åå­˜å‚¨ä¸è¯»å–éƒ½åœ¨ CacheC ä¸Šã€‚
&lt;img src="https://pinkhello.me/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/hash8.png" alt="ç§»é™¤CacheBèŠ‚ç‚¹">&lt;/p>
&lt;blockquote>
&lt;p>ç§»é™¤èŠ‚ç‚¹åçš„å½±å“èŒƒå›´åœ¨è¯¥èŠ‚ç‚¹é€†æ—¶é’ˆè®¡ç®—åˆ°é‡åˆ°çš„ç¬¬ä¸€ä¸ªcacheèŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®èŠ‚ç‚¹ã€‚&lt;/p>
&lt;/blockquote>
&lt;/blockquote>
&lt;blockquote>
&lt;p>å¢åŠ ä¸€ä¸ªç¼“å­˜èŠ‚ç‚¹
å¢åŠ ä¸€ä¸ª CacheèŠ‚ç‚¹
&lt;img src="https://pinkhello.me/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/hash9.png" alt="æ–°å¢CacheèŠ‚ç‚¹">&lt;/p>
&lt;blockquote>
&lt;p>å½±å“èŒƒå›´ä¸ºï¼šæ·»åŠ èŠ‚ç‚¹é€†æ—¶é’ˆé‡åˆ°çš„ç¬¬ä¸€ä¸ªcacheèŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®èŠ‚ç‚¹&lt;/p>
&lt;/blockquote>
&lt;/blockquote>
&lt;blockquote>
&lt;p>è™šæ‹ŸCacheèŠ‚ç‚¹
ç‰©ç†ä¸Šä¸å¯èƒ½éƒ¨ç½²èŠ‚ç‚¹æœ‰é™ï¼Œæ‰€ä»¥éœ€è¦è™šæ‹Ÿå‡ºè¶³å¤Ÿå¤šçš„è™šæ‹ŸèŠ‚ç‚¹ï¼Œæœ€ç»ˆè¾¾åˆ°æ•°æ®åœ¨å“ˆå¸Œæ¢ä¸Šå‡åŒ€åˆ†å¸ƒ&lt;/p>
&lt;blockquote>
&lt;p>å‡å¦‚åªæœ‰ä¸¤ä¸ªèŠ‚ç‚¹,æ¯ä¸ªèŠ‚ç‚¹éƒ½å¤åˆ¶æˆ3å€ï¼Œç»“æœçœ‹ä¸Šå»éƒ¨ç½²äº†6ä¸ªèŠ‚ç‚¹ã€‚å¯ä»¥æƒ³è±¡å½“å¤åˆ¶å€æ•°æ˜¯ 2^32 æ—¶å€™ï¼Œå°±è¾¾åˆ°ç»å¯¹çš„å‡åŒ€ï¼Œé€šå¸¸å¯å–çš„å¤åˆ¶å€æ•°ä¸º32 æˆ–è€…æ›´é«˜&lt;/p>
&lt;/blockquote>
&lt;p>è™šæ‹ŸèŠ‚ç‚¹å“ˆå¸Œå€¼è®¡ç®—æ–¹æ³•è°ƒæ•´ä¸º å¯¹ &amp;ldquo;èŠ‚ç‚¹IPï¼ˆæˆ–æœºå™¨åï¼‰+è™šæ‹ŸèŠ‚ç‚¹çš„åºå·ï¼ˆ1~Nï¼‰&amp;rdquo; ä½œå“ˆå¸Œ&lt;/p>
&lt;/blockquote>
&lt;h1 id="redis-cluster">Redis Cluster&lt;/h1>
&lt;p>Redis Cluster æ˜¯ Redis å®˜æ–¹å‡ºå“çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆ&lt;/p>
&lt;p>Redis Cluster ç”±å¤šä¸ª Redis å®ä¾‹ç»„æˆçš„æ•´ä½“ï¼Œæ•°æ®æŒ‰ç…§ &lt;em>æ§½(slot)&lt;/em> å­˜å‚¨åˆ†å¸ƒåœ¨å¤šä¸ªå®ä¾‹ä¸Šï¼Œé€šè¿‡ Gossip åè®®æ¥è¿›è¡ŒèŠ‚ç‚¹é€šä¿¡ã€‚&lt;/p>
&lt;p>redis ä¸ºä»€ä¹ˆä½¿ç”¨ 16384 slots? &lt;a href="https://github.com/antirez/redis/issues/2576">redis ä½œè€…ç»™å‡ºç­”æ¡ˆ&lt;/a>&lt;/p>
&lt;h1 id="ä¸€è‡´æ€§hashç®—æ³•çš„javaå®ç°ä¸æ£€éªŒ">ä¸€è‡´æ€§hashç®—æ³•çš„JAVAå®ç°ä¸æ£€éªŒ&lt;/h1>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java"> &lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">ConsistentHashing&lt;/span> {
&lt;span style="color:#228b22">// ç‰©ç†èŠ‚ç‚¹
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> Set&amp;lt;String&amp;gt; physicalNodes = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> TreeSet&amp;lt;String&amp;gt;() {
{
add(&lt;span style="color:#cd5555">&amp;#34;192.168.1.101&amp;#34;&lt;/span>);
add(&lt;span style="color:#cd5555">&amp;#34;192.168.1.102&amp;#34;&lt;/span>);
add(&lt;span style="color:#cd5555">&amp;#34;192.168.1.103&amp;#34;&lt;/span>);
add(&lt;span style="color:#cd5555">&amp;#34;192.168.1.104&amp;#34;&lt;/span>);
add(&lt;span style="color:#cd5555">&amp;#34;192.168.1.105&amp;#34;&lt;/span>);
add(&lt;span style="color:#cd5555">&amp;#34;192.168.1.106&amp;#34;&lt;/span>);
}
};
&lt;span style="color:#228b22">//è™šæ‹ŸèŠ‚ç‚¹
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">final&lt;/span> &lt;span style="color:#00688b;font-weight:bold">int&lt;/span> VIRTUAL_COPIES = 1; &lt;span style="color:#228b22">// ç‰©ç†èŠ‚ç‚¹è‡³è™šæ‹ŸèŠ‚ç‚¹çš„å¤åˆ¶å€æ•°
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> TreeMap&amp;lt;Long, String&amp;gt; virtualNodes = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> TreeMap&amp;lt;&amp;gt;(); &lt;span style="color:#228b22">// å“ˆå¸Œå€¼ =&amp;gt; ç‰©ç†èŠ‚ç‚¹
&lt;/span>&lt;span style="color:#228b22">&lt;/span>
&lt;span style="color:#228b22">// 32ä½çš„ Fowler-Noll-Vo å“ˆå¸Œç®—æ³•
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#228b22">// https://en.wikipedia.org/wiki/Fowlerâ€“Nollâ€“Vo_hash_function
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> Long &lt;span style="color:#008b45">FNVHash&lt;/span>(String key) {
&lt;span style="color:#8b008b;font-weight:bold">final&lt;/span> &lt;span style="color:#00688b;font-weight:bold">int&lt;/span> p = 16777619;
Long hash = 2166136261L;
&lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> (&lt;span style="color:#00688b;font-weight:bold">int&lt;/span> idx = 0, num = key.&lt;span style="color:#658b00">length&lt;/span>(); idx &amp;lt; num; ++idx) {
hash = (hash ^ key.&lt;span style="color:#658b00">charAt&lt;/span>(idx)) * p;
}
hash += hash &amp;lt;&amp;lt; 13;
hash ^= hash &amp;gt;&amp;gt; 7;
hash += hash &amp;lt;&amp;lt; 3;
hash ^= hash &amp;gt;&amp;gt; 17;
hash += hash &amp;lt;&amp;lt; 5;
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> (hash &amp;lt; 0) {
hash = Math.&lt;span style="color:#658b00">abs&lt;/span>(hash);
}
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> hash;
}
&lt;span style="color:#228b22">// æ ¹æ®ç‰©ç†èŠ‚ç‚¹ï¼Œæ„å»ºè™šæ‹ŸèŠ‚ç‚¹æ˜ å°„è¡¨
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#008b45">ConsistentHashing&lt;/span>() {
&lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> (String nodeIp : physicalNodes) {
addPhysicalNode(nodeIp);
}
}
&lt;span style="color:#228b22">// æ·»åŠ ç‰©ç†èŠ‚ç‚¹
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">addPhysicalNode&lt;/span>(String nodeIp) {
&lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> (&lt;span style="color:#00688b;font-weight:bold">int&lt;/span> idx = 0; idx &amp;lt; VIRTUAL_COPIES; ++idx) {
&lt;span style="color:#00688b;font-weight:bold">long&lt;/span> hash = FNVHash(nodeIp + &lt;span style="color:#cd5555">&amp;#34;#&amp;#34;&lt;/span> + idx);
virtualNodes.&lt;span style="color:#658b00">put&lt;/span>(hash, nodeIp);
}
}
&lt;span style="color:#228b22">// åˆ é™¤ç‰©ç†èŠ‚ç‚¹
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">removePhysicalNode&lt;/span>(String nodeIp) {
&lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> (&lt;span style="color:#00688b;font-weight:bold">int&lt;/span> idx = 0; idx &amp;lt; VIRTUAL_COPIES; ++idx) {
&lt;span style="color:#00688b;font-weight:bold">long&lt;/span> hash = FNVHash(nodeIp + &lt;span style="color:#cd5555">&amp;#34;#&amp;#34;&lt;/span> + idx);
virtualNodes.&lt;span style="color:#658b00">remove&lt;/span>(hash);
}
}
&lt;span style="color:#228b22">// æŸ¥æ‰¾å¯¹è±¡æ˜ å°„çš„èŠ‚ç‚¹
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> String &lt;span style="color:#008b45">getObjectNode&lt;/span>(String object) {
&lt;span style="color:#00688b;font-weight:bold">long&lt;/span> hash = FNVHash(object);
SortedMap&amp;lt;Long, String&amp;gt; tailMap = virtualNodes.&lt;span style="color:#658b00">tailMap&lt;/span>(hash); &lt;span style="color:#228b22">// æ‰€æœ‰å¤§äº hash çš„èŠ‚ç‚¹
&lt;/span>&lt;span style="color:#228b22">&lt;/span> Long key = tailMap.&lt;span style="color:#658b00">isEmpty&lt;/span>() ? virtualNodes.&lt;span style="color:#658b00">firstKey&lt;/span>() : tailMap.&lt;span style="color:#658b00">firstKey&lt;/span>();
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> virtualNodes.&lt;span style="color:#658b00">get&lt;/span>(key);
}
&lt;span style="color:#228b22">// ç»Ÿè®¡å¯¹è±¡ä¸èŠ‚ç‚¹çš„æ˜ å°„å…³ç³»
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">dumpObjectNodeMap&lt;/span>(String label, &lt;span style="color:#00688b;font-weight:bold">int&lt;/span> objectMin, &lt;span style="color:#00688b;font-weight:bold">int&lt;/span> objectMax) {
&lt;span style="color:#228b22">// ç»Ÿè®¡
&lt;/span>&lt;span style="color:#228b22">&lt;/span> Map&amp;lt;String, Integer&amp;gt; objectNodeMap = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> TreeMap&amp;lt;&amp;gt;(); &lt;span style="color:#228b22">// IP =&amp;gt; COUNT
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> (&lt;span style="color:#00688b;font-weight:bold">int&lt;/span> object = objectMin; object &amp;lt;= objectMax; ++object) {
String nodeIp = getObjectNode(Integer.&lt;span style="color:#658b00">toString&lt;/span>(object));
Integer count = objectNodeMap.&lt;span style="color:#658b00">get&lt;/span>(nodeIp);
objectNodeMap.&lt;span style="color:#658b00">put&lt;/span>(nodeIp, (count == &lt;span style="color:#8b008b;font-weight:bold">null&lt;/span> ? 0 : count + 1));
}
&lt;span style="color:#228b22">// æ‰“å°
&lt;/span>&lt;span style="color:#228b22">&lt;/span> &lt;span style="color:#00688b;font-weight:bold">double&lt;/span> totalCount = objectMax - objectMin + 1;
System.&lt;span style="color:#658b00">out&lt;/span>.&lt;span style="color:#658b00">println&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;======== &amp;#34;&lt;/span> + label + &lt;span style="color:#cd5555">&amp;#34; ========&amp;#34;&lt;/span>);
&lt;span style="color:#8b008b;font-weight:bold">for&lt;/span> (Map.&lt;span style="color:#658b00">Entry&lt;/span>&amp;lt;String, Integer&amp;gt; entry : objectNodeMap.&lt;span style="color:#658b00">entrySet&lt;/span>()) {
&lt;span style="color:#00688b;font-weight:bold">long&lt;/span> percent = (&lt;span style="color:#00688b;font-weight:bold">int&lt;/span>) (100 * entry.&lt;span style="color:#658b00">getValue&lt;/span>() / totalCount);
System.&lt;span style="color:#658b00">out&lt;/span>.&lt;span style="color:#658b00">println&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;IP=&amp;#34;&lt;/span> + entry.&lt;span style="color:#658b00">getKey&lt;/span>() + &lt;span style="color:#cd5555">&amp;#34;: RATE=&amp;#34;&lt;/span> + percent + &lt;span style="color:#cd5555">&amp;#34;%&amp;#34;&lt;/span>);
}
}
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">main&lt;/span>(String[] args) {
ConsistentHashing ch = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> ConsistentHashing();
&lt;span style="color:#228b22">// åˆå§‹æƒ…å†µ
&lt;/span>&lt;span style="color:#228b22">&lt;/span> ch.&lt;span style="color:#658b00">dumpObjectNodeMap&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;åˆå§‹æƒ…å†µ&amp;#34;&lt;/span>, 0, 65536);
&lt;span style="color:#228b22">// åˆ é™¤ç‰©ç†èŠ‚ç‚¹
&lt;/span>&lt;span style="color:#228b22">&lt;/span> ch.&lt;span style="color:#658b00">removePhysicalNode&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;192.168.1.105&amp;#34;&lt;/span>);
ch.&lt;span style="color:#658b00">dumpObjectNodeMap&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;åˆ é™¤ç‰©ç†èŠ‚ç‚¹&amp;#34;&lt;/span>, 0, 65536);
&lt;span style="color:#228b22">// æ·»åŠ ç‰©ç†èŠ‚ç‚¹
&lt;/span>&lt;span style="color:#228b22">&lt;/span> ch.&lt;span style="color:#658b00">addPhysicalNode&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;192.168.1.107&amp;#34;&lt;/span>);
ch.&lt;span style="color:#658b00">dumpObjectNodeMap&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;æ·»åŠ ç‰©ç†èŠ‚ç‚¹&amp;#34;&lt;/span>, 0, 65536);
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¤åˆ¶å€æ•°ä¸º 1 æ—¶çš„å‡è¡¡æ€§ï¼ˆVIRTUAL_COPIES = 1ï¼‰&lt;/p>
&lt;pre>&lt;code> ======== åˆå§‹æƒ…å†µ ========
IP=192.168.1.101: RATE=28%
IP=192.168.1.102: RATE=3%
IP=192.168.1.103: RATE=28%
IP=192.168.1.104: RATE=19%
IP=192.168.1.105: RATE=16%
IP=192.168.1.106: RATE=2%
======== åˆ é™¤ç‰©ç†èŠ‚ç‚¹ ========
IP=192.168.1.101: RATE=45%
IP=192.168.1.102: RATE=3%
IP=192.168.1.103: RATE=28%
IP=192.168.1.104: RATE=19%
IP=192.168.1.106: RATE=2%
======== æ·»åŠ ç‰©ç†èŠ‚ç‚¹ ========
IP=192.168.1.101: RATE=45%
IP=192.168.1.102: RATE=3%
IP=192.168.1.103: RATE=25%
IP=192.168.1.104: RATE=19%
IP=192.168.1.106: RATE=2%
IP=192.168.1.107: RATE=3%
&lt;/code>&lt;/pre>&lt;p>å¤åˆ¶å€æ•°ä¸º 32 æ—¶çš„å‡è¡¡æ€§ï¼ˆVIRTUAL_COPIES = 32ï¼‰&lt;/p>
&lt;pre>&lt;code> ======== åˆå§‹æƒ…å†µ ========
IP=192.168.1.101: RATE=17%
IP=192.168.1.102: RATE=12%
IP=192.168.1.103: RATE=23%
IP=192.168.1.104: RATE=12%
IP=192.168.1.105: RATE=12%
IP=192.168.1.106: RATE=21%
======== åˆ é™¤ç‰©ç†èŠ‚ç‚¹ ========
IP=192.168.1.101: RATE=17%
IP=192.168.1.102: RATE=12%
IP=192.168.1.103: RATE=25%
IP=192.168.1.104: RATE=23%
IP=192.168.1.106: RATE=21%
======== æ·»åŠ ç‰©ç†èŠ‚ç‚¹ ========
IP=192.168.1.101: RATE=16%
IP=192.168.1.102: RATE=12%
IP=192.168.1.103: RATE=14%
IP=192.168.1.104: RATE=23%
IP=192.168.1.106: RATE=15%
IP=192.168.1.107: RATE=17%
&lt;/code>&lt;/pre>&lt;p>å¤åˆ¶å€æ•°ä¸º 1M æ—¶çš„å‡è¡¡æ€§ï¼ˆVIRTUAL_COPIES = 1048576ï¼‰&lt;/p>
&lt;pre>&lt;code> ======== åˆå§‹æƒ…å†µ ========
IP=192.168.1.101: RATE=16%
IP=192.168.1.102: RATE=16%
IP=192.168.1.103: RATE=16%
IP=192.168.1.104: RATE=16%
IP=192.168.1.105: RATE=16%
IP=192.168.1.106: RATE=16%
======== åˆ é™¤ç‰©ç†èŠ‚ç‚¹ ========
IP=192.168.1.101: RATE=19%
IP=192.168.1.102: RATE=19%
IP=192.168.1.103: RATE=20%
IP=192.168.1.104: RATE=19%
IP=192.168.1.106: RATE=19%
======== æ·»åŠ ç‰©ç†èŠ‚ç‚¹ ========
IP=192.168.1.101: RATE=16%
IP=192.168.1.102: RATE=16%
IP=192.168.1.103: RATE=16%
IP=192.168.1.104: RATE=16%
IP=192.168.1.106: RATE=16%
IP=192.168.1.107: RATE=16%
&lt;/code>&lt;/pre>- https://pinkhello.me/posts/01-%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/ - PinkHello, All Rights Reserved</description></item><item><title>00 Threadlocal é­”æ³•</title><link>https://pinkhello.me/posts/00-threadlocal-%E9%AD%94%E6%B3%95/</link><pubDate>Sat, 09 Feb 2019 22:25:26 +0800</pubDate><guid>https://pinkhello.me/posts/00-threadlocal-%E9%AD%94%E6%B3%95/</guid><description>PinkHello https://pinkhello.me/posts/00-threadlocal-%E9%AD%94%E6%B3%95/ -&lt;h1 id="threadlocal-è¯¦è§£">&lt;code>ThreadLocal&lt;/code> è¯¦è§£&lt;/h1>
&lt;h2 id="å‰è¨€">å‰è¨€&lt;/h2>
&lt;p>å¯¹äº &lt;code>ThreadLocal&lt;/code> çš„ä½¿ç”¨ï¼Œå¹¶ä¸éš¾ï¼Œè¿™æ¬¡ä¸»è¦è®²è¿° &lt;code>ThreadLocal&lt;/code> çš„å®ç°æ–¹å¼ä»¥åŠåŸç†&lt;/p>
&lt;h2 id="threadlocal-æ˜¯ä»€ä¹ˆ">&lt;code>ThreadLocal&lt;/code> æ˜¯ä»€ä¹ˆ&lt;/h2>
&lt;p>&lt;code>ThreadLocal&lt;/code> ä¸ºè§£å†³å¤šçº¿ç¨‹å¹¶å‘é—®é¢˜æä¾›çš„ä¸€ç§æ–°çš„æ€è·¯ã€‚&lt;/p>
&lt;p>å½“ä½¿ç”¨ &lt;code>ThreadLocal&lt;/code> ç»´æŠ¤å˜é‡çš„æ—¶å€™ï¼Œ&lt;code>ThreadLocal&lt;/code> ä¸ºæ¯ä¸ªä½¿ç”¨è¯¥å˜é‡çš„çº¿ç¨‹æä¾›ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œæ‰€ä»¥æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ç‹¬ç«‹ä¿®æ”¹è‡ªå·±çš„å‰¯æœ¬ï¼Œè€Œä¸ä¼šä¿®æ”¹åˆ°å…¶ä»–äººçš„å˜é‡å‰¯æœ¬ã€‚&lt;/p>
&lt;p>ä»çº¿ç¨‹è§’åº¦çœ‹ï¼Œ&lt;code>Local&lt;/code> å³æœ¬åœ°æ„æ€ï¼Œç›®æ ‡å˜é‡å°±åƒæ˜¯çº¿ç¨‹çš„æœ¬åœ°å˜é‡ã€‚&lt;/p>
&lt;h3 id="åŸç†">åŸç†&lt;/h3>
&lt;p>&lt;code>ThreadLocal&lt;/code> æ˜¯è¿æ¥ &lt;code>Thread&lt;/code> ä¸ &lt;code>ThreadLocalMap&lt;/code> ç²˜åˆå‰‚ï¼Œæ˜¯ç”¨æ¥å¤„ç† &lt;code>Thread&lt;/code> çš„ &lt;code>ThreadLocalMap&lt;/code> å±æ€§ï¼Œ
åŒ…æ‹¬ &lt;em>initialValue()&lt;/em> å˜é‡ï¼Œ&lt;em>set&lt;/em> å¯¹åº”çš„å˜é‡ï¼Œ&lt;em>get&lt;/em> å¯¹åº”çš„å˜é‡ã€‚&lt;/p>
&lt;p>&lt;code>ThreadLocalMap&lt;/code> ç”¨æ¥å­˜å‚¨æ•°æ®ï¼Œé‡‡ç”¨ç±»ä¼¼&lt;code>HashMap&lt;/code>çš„æœºåˆ¶ï¼Œå­˜å‚¨äº†ä»¥&lt;code>ThreadLocal&lt;/code>ä¸º&lt;code>Key&lt;/code>ï¼Œç›®æ ‡æ•°æ®ä¸º&lt;code>Value&lt;/code>çš„&lt;code>Entry&lt;/code>é”®å€¼å¯¹æ•°ç»„ç»“æ„ã€‚&lt;/p>
&lt;p>&lt;code>Thread&lt;/code> æœ‰ä¸ª &lt;em>ThreadLocalMap&lt;/em> çš„å±æ€§ï¼Œå­˜å‚¨çš„æ•°æ®å­˜æ”¾åœ¨æ­¤å¤„ã€‚&lt;/p>
&lt;h3 id="threadthreadlocal-threadlocalmapçš„å…³ç³»">&lt;code>Thread&lt;/code>ã€&lt;code>ThreadLocal&lt;/code>ã€ &lt;code>ThreadLocalMap&lt;/code>çš„å…³ç³»&lt;/h3>
&lt;p>&lt;code>ThreadLocalMap&lt;/code> æ˜¯ &lt;code>ThreadLocal&lt;/code> çš„å†…éƒ¨ç±»ï¼Œæœ‰ &lt;code>ThreadLocal&lt;/code>åˆ›å»ºï¼Œ&lt;code>Thread&lt;/code>æœ‰ &lt;code>ThreadLocal.ThreadLocalMap&lt;/code> ç±»å‹çš„å±æ€§ï¼Œæºç å¦‚ä¸‹&lt;/p>
&lt;h4 id="thread">Thread&lt;/h4>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java"> &lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">Thread&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">implements&lt;/span> Runnable {
&lt;span style="color:#228b22">/*
&lt;/span>&lt;span style="color:#228b22"> * ThreadLocal values pertaining to this thread. This map is maintained
&lt;/span>&lt;span style="color:#228b22"> * by the ThreadLocal class.
&lt;/span>&lt;span style="color:#228b22"> */&lt;/span>
ThreadLocal.&lt;span style="color:#658b00">ThreadLocalMap&lt;/span> threadLocals = &lt;span style="color:#8b008b;font-weight:bold">null&lt;/span>;
&lt;span style="color:#228b22">/*
&lt;/span>&lt;span style="color:#228b22"> * InheritableThreadLocal values pertaining to this thread. This map is
&lt;/span>&lt;span style="color:#228b22"> * maintained by the InheritableThreadLocal class.
&lt;/span>&lt;span style="color:#228b22"> */&lt;/span>
ThreadLocal.&lt;span style="color:#658b00">ThreadLocalMap&lt;/span> inheritableThreadLocals = &lt;span style="color:#8b008b;font-weight:bold">null&lt;/span>;
}
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="threadlocal-å’Œ-threadlocalmap">&lt;code>ThreadLocal&lt;/code> å’Œ &lt;code>ThreadLocalMap&lt;/code>&lt;/h4>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java"> &lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">ThreadLocal&lt;/span>&amp;lt;T&amp;gt; {
&lt;span style="color:#228b22">/**
&lt;/span>&lt;span style="color:#228b22"> * ThreadLocalMap is a customized hash map suitable only for
&lt;/span>&lt;span style="color:#228b22"> * maintaining thread local values. No operations are exported
&lt;/span>&lt;span style="color:#228b22"> * outside of the ThreadLocal class. The class is package private to
&lt;/span>&lt;span style="color:#228b22"> * allow declaration of fields in class Thread. To help deal with
&lt;/span>&lt;span style="color:#228b22"> * very large and long-lived usages, the hash table entries use
&lt;/span>&lt;span style="color:#228b22"> * WeakReferences for keys. However, since reference queues are not
&lt;/span>&lt;span style="color:#228b22"> * used, stale entries are guaranteed to be removed only when
&lt;/span>&lt;span style="color:#228b22"> * the table starts running out of space.
&lt;/span>&lt;span style="color:#228b22"> */&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">ThreadLocalMap&lt;/span> {
&lt;span style="color:#228b22">/**
&lt;/span>&lt;span style="color:#228b22"> * The entries in this hash map extend WeakReference, using
&lt;/span>&lt;span style="color:#228b22"> * its main ref field as the key (which is always a
&lt;/span>&lt;span style="color:#228b22"> * ThreadLocal object). Note that null keys (i.e. entry.get()
&lt;/span>&lt;span style="color:#228b22"> * == null) mean that the key is no longer referenced, so the
&lt;/span>&lt;span style="color:#228b22"> * entry can be expunged from table. Such entries are referred to
&lt;/span>&lt;span style="color:#228b22"> * as &amp;#34;stale entries&amp;#34; in the code that follows.
&lt;/span>&lt;span style="color:#228b22"> */&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">class&lt;/span> &lt;span style="color:#008b45;font-weight:bold">Entry&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">extends&lt;/span> WeakReference&amp;lt;ThreadLocal&amp;lt;?&amp;gt;&amp;gt; {
&lt;span style="color:#228b22">/** The value associated with this ThreadLocal. */&lt;/span>
Object value;
Entry(ThreadLocal&amp;lt;?&amp;gt; k, Object v) {
&lt;span style="color:#8b008b;font-weight:bold">super&lt;/span>(k);
value = v;
}
}
}
}
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="threadlocal-ä¸º-thread-çš„-threadlocalmap-è¿›è¡Œèµ‹å€¼">&lt;code>ThreadLocal&lt;/code> ä¸º &lt;code>Thread&lt;/code> çš„ &lt;code>ThreadLocalMap&lt;/code> è¿›è¡Œèµ‹å€¼&lt;/h4>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java"> &lt;span style="color:#228b22">/**
&lt;/span>&lt;span style="color:#228b22"> * Create the map associated with a ThreadLocal. Overridden in
&lt;/span>&lt;span style="color:#228b22"> * InheritableThreadLocal.
&lt;/span>&lt;span style="color:#228b22"> *
&lt;/span>&lt;span style="color:#228b22"> * @param t the current thread
&lt;/span>&lt;span style="color:#228b22"> * @param firstValue value for the initial entry of the map
&lt;/span>&lt;span style="color:#228b22"> */&lt;/span>
&lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">createMap&lt;/span>(Thread t, T firstValue) {
t.&lt;span style="color:#658b00">threadLocals&lt;/span> = &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> ThreadLocalMap(&lt;span style="color:#8b008b;font-weight:bold">this&lt;/span>, firstValue);
}
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;em>ThreadLocal&lt;/em> ç›´æ¥åˆ›å»ºä¸€ä¸ª &lt;em>ThreadLocalMap&lt;/em> å‡ºæ¥ï¼Œä»¥å½“å‰ &lt;em>ThreadLocal&lt;/em> çš„å¯¹è±¡ä¸º &lt;em>key&lt;/em> ï¼Œä»¥ç›®æ ‡å€¼ä¸º &lt;em>value&lt;/em> å­˜å…¥&lt;/li>
&lt;/ul>
&lt;h5 id="threadlocal-æ ¸å¿ƒçš„æ–¹æ³•">&lt;code>ThreadLocal&lt;/code> æ ¸å¿ƒçš„æ–¹æ³•&lt;/h5>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java"> &lt;span style="color:#228b22">/**
&lt;/span>&lt;span style="color:#228b22"> * Sets the current thread&amp;#39;s copy of this thread-local variable
&lt;/span>&lt;span style="color:#228b22"> * to the specified value. Most subclasses will have no need to
&lt;/span>&lt;span style="color:#228b22"> * override this method, relying solely on the {@link #initialValue}
&lt;/span>&lt;span style="color:#228b22"> * method to set the values of thread-locals.
&lt;/span>&lt;span style="color:#228b22"> *
&lt;/span>&lt;span style="color:#228b22"> * @param value the value to be stored in the current thread&amp;#39;s copy of
&lt;/span>&lt;span style="color:#228b22"> * this thread-local.
&lt;/span>&lt;span style="color:#228b22"> */&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">set&lt;/span>(T value) {
Thread t = Thread.&lt;span style="color:#658b00">currentThread&lt;/span>();
ThreadLocalMap map = getMap(t);
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> (map != &lt;span style="color:#8b008b;font-weight:bold">null&lt;/span>)
map.&lt;span style="color:#658b00">set&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">this&lt;/span>, value);
&lt;span style="color:#8b008b;font-weight:bold">else&lt;/span>
createMap(t, value);
}
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>set(T)&lt;/code> è®¾ç½®å½“å‰çº¿ç¨‹çš„å±€éƒ¨å˜é‡ï¼Œä»¥å½“å‰çš„ &lt;code>ThreadLocal&lt;/code> å¯¹è±¡ ä¸ºé”®ï¼Œç›®æ ‡å˜é‡å¯¹è±¡ä¸ºå€¼å­˜å…¥å½“å‰çº¿ç¨‹çš„ &lt;code>ThreadLocalMap&lt;/code> å¯¹è±¡ä¸­&lt;/li>
&lt;li>åœ¨è·å–å½“å‰çº¿ç¨‹çš„ &lt;code>ThreadLocalMap&lt;/code> çš„æ—¶å€™ï¼Œä¸å­˜åœ¨çš„æ—¶å€™ä¼šåˆ›å»ºä¸€ä¸ª &lt;code>ThreadLocalMap&lt;/code> ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ&lt;code>Thread&lt;/code> çš„&lt;code>ThreadLocal.ThreadLocalMap&lt;/code> å¯¹è±¡æ˜¯ç”± &lt;code>ThreadLocal&lt;/code> å®ä¾‹åŒ–å¤„ç†çš„&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java"> &lt;span style="color:#228b22">/**
&lt;/span>&lt;span style="color:#228b22"> * Returns the value in the current thread&amp;#39;s copy of this
&lt;/span>&lt;span style="color:#228b22"> * thread-local variable. If the variable has no value for the
&lt;/span>&lt;span style="color:#228b22"> * current thread, it is first initialized to the value returned
&lt;/span>&lt;span style="color:#228b22"> * by an invocation of the {@link #initialValue} method.
&lt;/span>&lt;span style="color:#228b22"> *
&lt;/span>&lt;span style="color:#228b22"> * @return the current thread&amp;#39;s value of this thread-local
&lt;/span>&lt;span style="color:#228b22"> */&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> T &lt;span style="color:#008b45">get&lt;/span>() {
Thread t = Thread.&lt;span style="color:#658b00">currentThread&lt;/span>();
ThreadLocalMap map = getMap(t);
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> (map != &lt;span style="color:#8b008b;font-weight:bold">null&lt;/span>) {
ThreadLocalMap.&lt;span style="color:#658b00">Entry&lt;/span> e = map.&lt;span style="color:#658b00">getEntry&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">this&lt;/span>);
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> (e != &lt;span style="color:#8b008b;font-weight:bold">null&lt;/span>) {
&lt;span style="color:#707a7c">@SuppressWarnings&lt;/span>(&lt;span style="color:#cd5555">&amp;#34;unchecked&amp;#34;&lt;/span>)
T result = (T)e.&lt;span style="color:#658b00">value&lt;/span>;
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> result;
}
}
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> setInitialValue();
}
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>get()&lt;/code> ä¸ºä» &lt;code>ThreadLocalMap&lt;/code> ä¸­è·å–å€¼ï¼Œå¦‚æœ &lt;code>ThreadLocalMap&lt;/code> ä¸å­˜åœ¨ï¼Œåˆ™èµ° &lt;code>setInitialValue&lt;/code> æ–¹å¼ï¼Œå¦åˆ™å–å‡ºä¹‹å‰è®¾ç½®çš„å€¼&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java"> &lt;span style="color:#228b22">/**
&lt;/span>&lt;span style="color:#228b22"> * Get the map associated with a ThreadLocal. Overridden in
&lt;/span>&lt;span style="color:#228b22"> * InheritableThreadLocal.
&lt;/span>&lt;span style="color:#228b22"> *
&lt;/span>&lt;span style="color:#228b22"> * @param t the current thread
&lt;/span>&lt;span style="color:#228b22"> * @return the map
&lt;/span>&lt;span style="color:#228b22"> */&lt;/span>
ThreadLocalMap &lt;span style="color:#008b45">getMap&lt;/span>(Thread t) {
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> t.&lt;span style="color:#658b00">threadLocals&lt;/span>;
}
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java"> &lt;span style="color:#228b22">/**
&lt;/span>&lt;span style="color:#228b22"> * Returns the current thread&amp;#39;s &amp;#34;initial value&amp;#34; for this
&lt;/span>&lt;span style="color:#228b22"> * thread-local variable. This method will be invoked the first
&lt;/span>&lt;span style="color:#228b22"> * time a thread accesses the variable with the {@link #get}
&lt;/span>&lt;span style="color:#228b22"> * method, unless the thread previously invoked the {@link #set}
&lt;/span>&lt;span style="color:#228b22"> * method, in which case the {@code initialValue} method will not
&lt;/span>&lt;span style="color:#228b22"> * be invoked for the thread. Normally, this method is invoked at
&lt;/span>&lt;span style="color:#228b22"> * most once per thread, but it may be invoked again in case of
&lt;/span>&lt;span style="color:#228b22"> * subsequent invocations of {@link #remove} followed by {@link #get}.
&lt;/span>&lt;span style="color:#228b22"> *
&lt;/span>&lt;span style="color:#228b22"> * This implementation simply returns {@code null}; if the
&lt;/span>&lt;span style="color:#228b22"> * programmer desires thread-local variables to have an initial
&lt;/span>&lt;span style="color:#228b22"> * value other than {@code null}, {@code ThreadLocal} must be
&lt;/span>&lt;span style="color:#228b22"> * subclassed, and this method overridden. Typically, an
&lt;/span>&lt;span style="color:#228b22"> * anonymous inner class will be used.
&lt;/span>&lt;span style="color:#228b22"> *
&lt;/span>&lt;span style="color:#228b22"> * @return the initial value for this thread-local
&lt;/span>&lt;span style="color:#228b22"> */&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">protected&lt;/span> T &lt;span style="color:#008b45">initialValue&lt;/span>() {
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">null&lt;/span>;
}
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>initialValue()&lt;/code> è¿”å›äº†è¯¥çº¿ç¨‹å˜é‡çš„åˆå§‹å€¼ï¼Œæ˜¯ä¸€ä¸ªä¿æŠ¤æ–¹æ³•ï¼Œä¸ºäº†è®©å­ç±»è¦†ç›–æ­¤æ–¹æ³•ï¼Œ&lt;/li>
&lt;li>æ­¤æ–¹æ³•åªæ‰§è¡Œä¸€æ¬¡ï¼Œæ˜¯ä¸€ä¸ªå»¶è¿Ÿæ–¹æ³•ï¼Œåœ¨è°ƒç”¨ &lt;code>set&lt;/code> æˆ– &lt;code>get&lt;/code> çš„æ—¶å€™åˆ›å»ºå‡ºæ¥&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java"> &lt;span style="color:#228b22">/**
&lt;/span>&lt;span style="color:#228b22"> * Creates a thread local variable. The initial value of the variable is
&lt;/span>&lt;span style="color:#228b22"> * determined by invoking the {@code get} method on the {@code Supplier}.
&lt;/span>&lt;span style="color:#228b22"> *
&lt;/span>&lt;span style="color:#228b22"> * @param the type of the thread local&amp;#39;s value
&lt;/span>&lt;span style="color:#228b22"> * @param supplier the supplier to be used to determine the initial value
&lt;/span>&lt;span style="color:#228b22"> * @return a new thread local variable
&lt;/span>&lt;span style="color:#228b22"> * @throws NullPointerException if the specified supplier is null
&lt;/span>&lt;span style="color:#228b22"> * @since 1.8
&lt;/span>&lt;span style="color:#228b22"> */&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">static&lt;/span> &amp;lt;S&amp;gt; ThreadLocal&amp;lt;S&amp;gt; &lt;span style="color:#008b45">withInitial&lt;/span>(Supplier&amp;lt;? &lt;span style="color:#8b008b;font-weight:bold">extends&lt;/span> S&amp;gt; supplier) {
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> &lt;span style="color:#8b008b;font-weight:bold">new&lt;/span> SuppliedThreadLocal&amp;lt;&amp;gt;(supplier);
}
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java"> &lt;span style="color:#228b22">/**
&lt;/span>&lt;span style="color:#228b22"> * Variant of set() to establish initialValue. Used instead
&lt;/span>&lt;span style="color:#228b22"> * of set() in case user has overridden the set() method.
&lt;/span>&lt;span style="color:#228b22"> *
&lt;/span>&lt;span style="color:#228b22"> * @return the initial value
&lt;/span>&lt;span style="color:#228b22"> */&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">private&lt;/span> T &lt;span style="color:#008b45">setInitialValue&lt;/span>() {
T value = initialValue();
Thread t = Thread.&lt;span style="color:#658b00">currentThread&lt;/span>();
ThreadLocalMap map = getMap(t);
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> (map != &lt;span style="color:#8b008b;font-weight:bold">null&lt;/span>)
map.&lt;span style="color:#658b00">set&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">this&lt;/span>, value);
&lt;span style="color:#8b008b;font-weight:bold">else&lt;/span>
createMap(t, value);
&lt;span style="color:#8b008b;font-weight:bold">return&lt;/span> value;
}
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-java" data-lang="java"> &lt;span style="color:#228b22">/**
&lt;/span>&lt;span style="color:#228b22"> * Removes the current thread&amp;#39;s value for this thread-local
&lt;/span>&lt;span style="color:#228b22"> * variable. If this thread-local variable is subsequently
&lt;/span>&lt;span style="color:#228b22"> * {@linkplain #get read} by the current thread, its value will be
&lt;/span>&lt;span style="color:#228b22"> * reinitialized by invoking its {@link #initialValue} method,
&lt;/span>&lt;span style="color:#228b22"> * unless its value is {@linkplain #set set} by the current thread
&lt;/span>&lt;span style="color:#228b22"> * in the interim. This may result in multiple invocations of the
&lt;/span>&lt;span style="color:#228b22"> * {@code initialValue} method in the current thread.
&lt;/span>&lt;span style="color:#228b22"> *
&lt;/span>&lt;span style="color:#228b22"> * @since 1.5
&lt;/span>&lt;span style="color:#228b22"> */&lt;/span>
&lt;span style="color:#8b008b;font-weight:bold">public&lt;/span> &lt;span style="color:#00688b;font-weight:bold">void&lt;/span> &lt;span style="color:#008b45">remove&lt;/span>() {
ThreadLocalMap m = getMap(Thread.&lt;span style="color:#658b00">currentThread&lt;/span>());
&lt;span style="color:#8b008b;font-weight:bold">if&lt;/span> (m != &lt;span style="color:#8b008b;font-weight:bold">null&lt;/span>)
m.&lt;span style="color:#658b00">remove&lt;/span>(&lt;span style="color:#8b008b;font-weight:bold">this&lt;/span>);
}
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>remove()&lt;/code> æ–¹æ³•è·å–å½“å‰çº¿ç¨‹çš„å‰¯æœ¬å˜é‡ï¼Œæ¥æŒ‡å®šç§»é™¤å¯¹åº”çš„å€¼;&lt;/li>
&lt;li>æ­¤æ–¹æ³•ä¸º 1.5 å¼•å…¥ï¼Œæ—¨åœ¨ååŠ©&lt;code>jvm&lt;/code>è¿›è¡Œæœ‰æ•ˆçš„å¿«é€Ÿ &lt;code>gc&lt;/code>ï¼›&lt;/li>
&lt;li>å‡å¦‚ä¸ç§»é™¤ &lt;code>ThreadLocal&lt;/code> å‰¯æœ¬å˜é‡ å¦å¤– &lt;code>ThreadLocalMap&lt;/code> çš„ &lt;code>key&lt;/code> ä¸ºå¼±å¼•ç”¨&lt;/li>
&lt;/ul>
- https://pinkhello.me/posts/00-threadlocal-%E9%AD%94%E6%B3%95/ - PinkHello, All Rights Reserved</description></item></channel></rss>